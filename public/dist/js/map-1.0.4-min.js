/*! imsep 2021-01-09 */

window.ol&&!ol.ext&&(ol.ext={}),ol.ext.inherits=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},window.ol&&(ol.inherits||(ol.inherits=ol.ext.inherits)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.Element&&!Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),ol.ext.Ajax=function(e){e=e||{},ol.Object.call(this),this._auth=e.auth,this.set("dataType",e.dataType||"JSON")},ol.ext.inherits(ol.ext.Ajax,ol.Object),ol.ext.Ajax.get=function(t){var e=new ol.ext.Ajax(t);t.success&&e.on("success",function(e){t.success(e.response,e)}),t.error&&e.on("error",function(e){t.error(e)}),e.send(t.url,t.data,t.options)},ol.ext.Ajax.prototype.send=function(e,t,a){var i=this,o=!1!==(a=a||{}).encode;o&&(e=encodeURI(e));var n="";for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&(n+=(n?"&":"?")+r+"="+(o?encodeURIComponent(t[r]):t[r]));this._request&&!1!==a.abort&&this._request.abort();var s=this._request=new XMLHttpRequest;s.open("GET",e+n,!0),this._auth&&s.setRequestHeader("Authorization","Basic "+this._auth),this.dispatchEvent({type:"loadstart"}),s.onload=function(){if(i._request=null,i.dispatchEvent({type:"loadend"}),200<=this.status&&this.status<400){var e;try{switch(i.get("dataType")){case"JSON":e=JSON.parse(this.response);break;default:e=this.response}}catch(e){return void i.dispatchEvent({type:"error",status:0,statusText:"parsererror",error:e,options:a,jqXHR:this})}i.dispatchEvent({type:"success",response:e,status:this.status,statusText:this.statusText,options:a,jqXHR:this})}else i.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:a,jqXHR:this})},s.onerror=function(){i._request=null,i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:a,jqXHR:this})},s.send()},ol.ext.element={},ol.ext.element.create=function(e,t){var a;if(t=t||{},"TEXT"===e)a=document.createTextNode(t.html||""),t.parent&&t.parent.appendChild(a);else for(var i in a=document.createElement(e),/button/i.test(e)&&a.setAttribute("type","button"),t)switch(i){case"className":t.className&&t.className.trim&&a.setAttribute("class",t.className.trim());break;case"html":t.html instanceof Element?a.appendChild(t.html):void 0!==t.html&&(a.innerHTML=t.html);break;case"parent":t.parent.appendChild(a);break;case"style":this.setStyle(a,t.style);break;case"change":case"click":ol.ext.element.addListener(a,i,t[i]);break;case"on":for(var o in t.on)ol.ext.element.addListener(a,o,t.on[o]);break;case"checked":a.checked=!!t.checked;break;default:a.setAttribute(i,t[i])}return a},ol.ext.element.setHTML=function(e,t){t instanceof Element?e.appendChild(t):void 0!==t&&(e.innerHTML=t)},ol.ext.element.appendText=function(e,t){e.appendChild(document.createTextNode(t||""))},ol.ext.element.addListener=function(t,e,a){"string"==typeof e&&(e=e.split(" ")),e.forEach(function(e){t.addEventListener(e,a)})},ol.ext.element.removeListener=function(t,e,a){"string"==typeof e&&(e=e.split(" ")),e.forEach(function(e){t.removeEventListener(e,a)})},ol.ext.element.show=function(e){e.style.display=""},ol.ext.element.hide=function(e){e.style.display="none"},ol.ext.element.hidden=function(e){return"none"===ol.ext.element.getStyle(e,"display")},ol.ext.element.toggle=function(e){e.style.display="none"===e.style.display?"":"none"},ol.ext.element.setStyle=function(e,t){for(var a in t)switch(a){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":"number"==typeof t[a]?e.style[a]=t[a]+"px":e.style[a]=t[a];break;default:e.style[a]=t[a]}},ol.ext.element.getStyle=function(e,t){var a,i,o,n,r=(e.ownerDocument||document).defaultView;if(r&&r.getComputedStyle)t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),a=r.getComputedStyle(e,null).getPropertyValue(t);else if(e.currentStyle&&(t=t.replace(/-(\w)/g,function(e,t){return t.toUpperCase()}),a=e.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(a)))return i=a,o=e.style.left,n=e.runtimeStyle.left,e.runtimeStyle.left=e.currentStyle.left,e.style.left=i||0,i=e.style.pixelLeft+"px",e.style.left=o,e.runtimeStyle.left=n,i;return/px$/.test(a)?parseInt(a):a},ol.ext.element.outerHeight=function(e){return e.offsetHeight+ol.ext.element.getStyle(e,"marginBottom")},ol.ext.element.outerWidth=function(e){return e.offsetWidth+ol.ext.element.getStyle(e,"marginLeft")},ol.ext.element.offsetRect=function(e){var t=e.getBoundingClientRect();return{top:t.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:t.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:t.height||t.bottom-t.top,width:t.widtth||t.right-t.left}},ol.ext.element.scrollDiv=function(a,e){var i,o=!1,n=0,r=0,s="function"==typeof e.onmove?e.onmove:function(){},l=e.vertical?"pageY":"pageX",c=e.vertical?"scrollTop":"scrollLeft";a.querySelectorAll("img").forEach(function(e){e.ondragstart=function(){return!1}}),ol.ext.element.addListener(a,["mousedown"],function(e){o=e[l],r=new Date,a.classList.add("ol-move")}),ol.ext.element.addListener(window,["mousemove"],function(e){if(!1!==o){var t=o-e[l];a[c]+=t,(i=new Date)-r&&(n=(n+t/(i-r))/2),o=e[l],r=i,t&&s(!0)}else s(!1)}),ol.ext.element.addListener(window,["mouseup"],function(e){a.classList.remove("ol-move"),100<(r=new Date-r)?n=0:0<r&&(n=((n||0)+(o-e[l])/r)/2),a[c]+=100*n,o=!1,r=n=0}),e.mousewheel&&!a.classList.contains("ol-touch")&&ol.ext.element.addListener(a,["mousewheel","DOMMouseScroll","onmousewheel"],function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));return a.classList.add("ol-move"),a[c]-=30*t,!1})},ol.ext.getMapCanvas=function(t){if(!t)return null;var a=t.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return!a&&t.getViewport().querySelector(".ol-layers")&&((a=document.createElement("canvas")).className="ol-fixedoverlay",t.getViewport().querySelector(".ol-layers").after(a),t.on("precompose",function(e){a.width=t.getSize()[0]*e.frameState.pixelRatio,a.height=t.getSize()[1]*e.frameState.pixelRatio})),a},window.ol&&!ol.sphere&&(ol.sphere={},ol.sphere.getDistance=function(e,t,a){return new ol.Sphere(a||6371008.8).haversineDistance(e,t)},ol.sphere.getArea=ol.Sphere.getArea,ol.sphere.getLength=ol.Sphere.getLength),ol.control.CanvasBase=function(e){e||(e={}),this.setStyle(e.style),ol.control.Control.call(this,e)},ol.ext.inherits(ol.control.CanvasBase,ol.control.Control),ol.control.CanvasBase.prototype.setMap=function(e){this.getCanvas(e);var t=this.getMap();this._listener&&(ol.Observable.unByKey(this._listener),this._listener=null),ol.control.Control.prototype.setMap.call(this,e),t&&t.renderSync(),e&&(this._listener=e.on("postcompose",this._draw.bind(this)))},ol.control.CanvasBase.prototype.getCanvas=function(e){return ol.ext.getMapCanvas(e)},ol.control.CanvasBase.prototype.getContext=function(e){var t=e.context;if(!t&&this.getMap()){var a=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];t=a?a.getContext("2d"):null}return t},ol.control.CanvasBase.prototype.setStyle=function(e){this._style=e||new ol.style.Style({})},ol.control.CanvasBase.prototype.getStyle=function(){return this._style},ol.control.CanvasBase.prototype.getStroke=function(){return this._style.getStroke()||this._style.setStroke(new ol.style.Stroke({color:"#000",width:1.25})),this._style.getStroke()},ol.control.CanvasBase.prototype.getFill=function(){return this._style.getFill()||this._style.setFill(new ol.style.Fill({color:"#fff"})),this._style.getFill()},ol.control.CanvasBase.prototype.getTextStroke=function(){var e=this._style.getText();return e||(e=new ol.style.Text({})),e.getStroke()||e.setStroke(new ol.style.Stroke({color:"#fff",width:3})),e.getStroke()},ol.control.CanvasBase.prototype.getTextFill=function(){var e=this._style.getText();return e||(e=new ol.style.Text({})),e.getFill()||e.setFill(new ol.style.Fill({color:"#fff",width:3})),e.getFill()},ol.control.CanvasBase.prototype.getTextFont=function(){var e=this._style.getText();return e||(e=new ol.style.Text({})),e.getFont()||e.setFont("12px sans-serif"),e.getFont()},ol.control.CanvasBase.prototype._draw=function(){console.warn("[CanvasBase] draw function not implemented.")},ol.interaction.Transform=function(e){e||(e={});var t=this;this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(e){return t.style[(e.get("handle")||"default")+(e.get("constraint")||"")+(e.get("option")||"")]}}),ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=e.features,"function"==typeof e.filter&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this.addFn_=e.addCondition||function(){return!1},this.set("translateFeature",!1!==e.translateFeature),this.set("translate",!1!==e.translate),this.set("stretch",!1!==e.stretch),this.set("scale",!1!==e.scale),this.set("rotate",!1!==e.rotate),this.set("keepAspectRatio",e.keepAspectRatio||function(e){return e.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(e){return e.originalEvent.metaKey||e.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",!1!==e.selection),this.set("hitTolerance",e.hitTolerance||0),this.selection_=[],this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()},ol.ext.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"},ol.interaction.Transform.prototype.setMap=function(e){this.getMap()&&(this.getMap().removeLayer(this.overlayLayer_),this.previousCursor_&&(this.getMap().getTargetElement().style.cursor=this.previousCursor_,this.previousCursor_=void 0)),ol.interaction.Pointer.prototype.setMap.call(this,e),this.overlayLayer_.setMap(e),null!==e&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())},ol.interaction.Transform.prototype.setActive=function(e){this.select(null),this.overlayLayer_.setVisible(e),ol.interaction.Pointer.prototype.setActive.call(this,e)},ol.interaction.Transform.prototype.setDefaultStyle=function(){var e=new ol.style.Stroke({color:[255,0,0,1],width:1}),t=new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),a=new ol.style.Fill({color:[255,0,0,.01]}),i=new ol.style.Fill({color:[255,255,255,.8]}),o=new ol.style.RegularShape({fill:i,stroke:e,radius:this.isTouch?12:6,points:15});o.getAnchor()[0]=this.isTouch?-10:-5;var n=new ol.style.RegularShape({fill:i,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),r=new ol.style.RegularShape({fill:i,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function s(e,t,a){return[new ol.style.Style({image:e,stroke:t,fill:a})]}this.style={default:s(n,t,a),translate:s(n,e,i),rotate:s(o,e,i),rotate0:s(n,e,i),scale:s(n,e,i),scale1:s(n,e,i),scale2:s(n,e,i),scale3:s(n,e,i),scalev:s(r,e,i),scaleh1:s(r,e,i),scalev2:s(r,e,i),scaleh3:s(r,e,i)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var a=0;a<this.style[e].length;a++){var i=this.style[e][a].getImage();i&&("rotate"==e&&(i.getAnchor()[0]=-5),this.isTouch&&i.setScale(1.8));var o=this.style[e][a].getText();o&&("rotate"==e&&o.setOffsetX(this.isTouch?14:7),this.isTouch&&o.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(e){var o=this;return this.getMap().forEachFeatureAtPixel(e,function(t,e){var a=!1;if(!e){if(t===o.bbox_)return!1;if(o.handles_.forEach(function(e){e===t&&(a=!0)}),a)return{feature:t,handle:t.get("handle"),constraint:t.get("constraint"),option:t.get("option")}}if(!o.get("selection"))return o.selection_.some(function(e){return t===e})?{feature:t}:null;if(o._filter)return o._filter(t,e)?{feature:t}:null;if(o.layers_){for(var i=0;i<o.layers_.length;i++)if(o.layers_[i]===e)return{feature:t};return null}return o.features_?(o.features_.forEach(function(e){e===t&&(a=!0)}),a?{feature:t}:null):{feature:t}},{hitTolerance:this.get("hitTolerance")})||{}},ol.interaction.Transform.prototype.drawSketch_=function(e){var t,a,i;if(this.overlayLayer_.getSource().clear(),this.selection_.length){var o=this.selection_[0].getGeometry().getExtent();for(o=ol.extent.buffer(o,0),t=1;a=this.selection_[t];t++)ol.extent.extend(o,a.getGeometry().getExtent());if(!0===e)this.ispt_||(this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"})),i=ol.geom.Polygon.fromExtent(o),a=this.bbox_=new ol.Feature(i),this.overlayLayer_.getSource().addFeature(a));else{if(this.ispt_){var n=this.getMap().getPixelFromCoordinate([o[0],o[1]]);o=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([n[0]-10,n[1]-10]),this.getMap().getCoordinateFromPixel([n[0]+10,n[1]+10])])}i=ol.geom.Polygon.fromExtent(o),a=this.bbox_=new ol.Feature(i);var r=[],s=i.getCoordinates()[0];if(!this.ispt_){if(r.push(a),this.get("stretch")&&this.get("scale"))for(t=0;t<s.length-1;t++)a=new ol.Feature({geometry:new ol.geom.Point([(s[t][0]+s[t+1][0])/2,(s[t][1]+s[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),r.push(a);if(this.get("scale"))for(t=0;t<s.length-1;t++)a=new ol.Feature({geometry:new ol.geom.Point(s[t]),handle:"scale",option:t}),r.push(a);this.get("translate")&&!this.get("translateFeature")&&(a=new ol.Feature({geometry:new ol.geom.Point([(s[0][0]+s[2][0])/2,(s[0][1]+s[2][1])/2]),handle:"translate"}),r.push(a))}this.get("rotate")&&(a=new ol.Feature({geometry:new ol.geom.Point(s[3]),handle:"rotate"}),r.push(a)),this.overlayLayer_.getSource().addFeatures(r)}}},ol.interaction.Transform.prototype.select=function(e,t){if(!e)return this.selection_=[],void this.drawSketch_();e.getGeometry&&e.getGeometry()&&(t?this.selection_.push(e):this.selection_=[e],this.ispt_=1===this.selection_.length&&"Point"==this.selection_[0].getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_}))},ol.interaction.Transform.prototype.watchFeatures_=function(){this._featureListeners&&this._featureListeners.forEach(function(e){ol.Observable.unByKey(e)}),this._featureListeners=[],this.selection_.forEach(function(e){this._featureListeners.push(e.on("change",function(){this.drawSketch_()}.bind(this)))}.bind(this))},ol.interaction.Transform.prototype.handleDownEvent_=function(e){var t=this.getFeatureAtPixel_(e.pixel),a=t.feature;if(this.selection_.length&&0<=this.selection_.indexOf(a)&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint,this.coordinate_=e.coordinate,this.pixel_=e.pixel,this.geoms_=[];for(var i,o=ol.extent.createEmpty(),n=0;i=this.selection_[n];n++)this.geoms_.push(i.getGeometry().clone()),o=ol.extent.extend(o,i.getGeometry().getExtent());if(this.extent_=ol.geom.Polygon.fromExtent(o).getCoordinates()[0],"rotate"===this.mode_){this.center_=this.getCenter()||ol.extent.getCenter(o);var r=e.map.getTargetElement();r.style.cursor=this.Cursors.rotate0,this.previousCursor_=r.style.cursor}else this.center_=ol.extent.getCenter(o);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_[0],features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}if(this.get("selection")){if(a){this.addFn_(e)||(this.selection_=[]);var s=this.selection_.indexOf(a);s<0?this.selection_.push(a):this.selection_.splice(s,1)}else this.selection_=[];return this.ispt_=1===this.selection_.length&&"Point"==this.selection_[0].getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:a,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}},ol.interaction.Transform.prototype.getFeatures=function(){return this.selection_},ol.interaction.Transform.prototype.getCenter=function(){return this.get("center")},ol.interaction.Transform.prototype.setCenter=function(e){return this.set("center",e)},ol.interaction.Transform.prototype.handleDragEvent_=function(e){var i,t,a;switch(this.mode_){case"rotate":var o=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]);if(!this.ispt)for(i=0;t=this.selection_[i];i++)(a=this.geoms_[i].clone()).rotate(o-this.angle_,this.center_),t.setGeometry(a);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_[0],features:this.selection_,angle:o-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break;case"translate":var n=e.coordinate[0]-this.coordinate_[0],r=e.coordinate[1]-this.coordinate_[1];for(i=0;t=this.selection_[i];i++)t.getGeometry().translate(n,r);this.handles_.forEach(function(e){e.getGeometry().translate(n,r)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_[0],features:this.selection_,delta:[n,r],pixel:e.pixel,coordinate:e.coordinate});break;case"scale":var s=this.center_;this.get("modifyCenter")(e)&&(s=this.extent_[(Number(this.opt_)+2)%4]);var l=(e.coordinate[0]-s[0])/(this.coordinate_[0]-s[0]),c=(e.coordinate[1]-s[1])/(this.coordinate_[1]-s[1]);for(this.get("noFlip")&&(l<0&&(l=-l),c<0&&(c=-c)),this.constraint_?"h"==this.constraint_?l=1:c=1:this.get("keepAspectRatio")(e)&&(l=c=Math.min(l,c)),i=0;t=this.selection_[i];i++)(a=this.geoms_[i].clone()).applyTransform(function(e,t,a){if(a<2)return t;for(i=0;i<e.length;i+=a)1!=l&&(t[i]=s[0]+(e[i]-s[0])*l),1!=c&&(t[i+1]=s[1]+(e[i+1]-s[1])*c);return t}),t.setGeometry(a);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_[0],features:this.selection_,scale:[l,c],pixel:e.pixel,coordinate:e.coordinate})}},ol.interaction.Transform.prototype.handleMoveEvent_=function(e){if(!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),a=e.map.getTargetElement();if(t.feature){var i=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=a.style.cursor),a.style.cursor=i}else void 0!==this.previousCursor_&&(a.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(e){"rotate"===this.mode_&&(e.map.getTargetElement().style.cursor=this.Cursors.default,this.previousCursor_=void 0);return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_[0],features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1},ol.control.LayerSwitcher=function(e){e=e||{};var t,a=this;this._activeLayer=void 0,this.dcount=0,this.show_progress=e.show_progress,this.toggleVisiblityOnLabelClick=e.toggleVisiblityOnLabelClick,this.oninfo="function"==typeof e.oninfo?e.oninfo:null,this.onClick="function"==typeof e.onClick?e.onClick:null,this.onDblClick="function"==typeof e.onDblClick?e.onDblClick:null,this.onextent="function"==typeof e.onextent?e.onextent:null,this.hasextent=e.extent||e.onextent,this.hastrash=e.trash,this.reordering=!1!==e.reordering,"function"==typeof e.displayInLayerSwitcher&&(this.displayInLayerSwitcher=e.displayInLayerSwitcher),e.target?t=$("<div>").addClass(e.switcherClass||"ol-layerswitcher"):(t=$("<div>").addClass((e.switcherClass||"ol-layerswitcher")+" ol-unselectable ol-control ol-collapsed"),this.button=$("<button>").attr("type","button").on("touchstart",function(e){t.toggleClass("ol-collapsed"),e.preventDefault(),a.overflow()}).click(function(){t.toggleClass("ol-forceopen").addClass("ol-collapsed"),a.overflow()}).appendTo(t),e.mouseover&&$(t).mouseleave(function(){t.addClass("ol-collapsed")}).mouseover(function(){t.removeClass("ol-collapsed")}),this.topv=$("<div>").addClass("ol-switchertopdiv").click(function(){a.overflow("+50%")}).appendTo(t),this.botv=$("<div>").addClass("ol-switcherbottomdiv").click(function(){a.overflow("-50%")}).appendTo(t)),this.panel_=$("<ul>").addClass("panel").appendTo(t),this.panel_.on("mousewheel DOMMouseScroll onmousewheel",function(e){a.overflow(Math.max(-1,Math.min(1,e.originalEvent.wheelDelta||-e.originalEvent.detail)))&&(e.stopPropagation(),e.preventDefault())}),this.header_=$("<li>").addClass("ol-header").appendTo(this.panel_),ol.control.Control.call(this,{element:t.get(0),target:e.target}),this.target=e.target},ol.ext.inherits(ol.control.LayerSwitcher,ol.control.Control),ol.control.LayerSwitcher.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",f:"expand/shrink"},ol.control.LayerSwitcher.prototype.displayInLayerSwitcher=function(e){return(!e.get("custom")||!e.get("custom").hiddenInToc)&&!1!==e.get("displayInLayerSwitcher")},ol.control.LayerSwitcher.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e),this.drawPanel(),this._listener&&(this._listener&&ol.Observable.unByKey(this._listener.change),this._listener&&ol.Observable.unByKey(this._listener.moveend),this._listener&&ol.Observable.unByKey(this._listener.size),this._listener&&ol.Observable.unByKey(this._listener.remove)),this._listener=null,(this.map_=e)&&(this._listener={change:e.getLayerGroup().on("change",this.drawPanel.bind(this)),moveend:e.on("moveend",this.viewChange.bind(this)),size:e.on("change:size",this.overflow.bind(this)),remove:e.getLayers().on("remove",this.onLayerRemoved.bind(this))})},ol.control.LayerSwitcher.prototype.setActiveLayer=function(e){e!==this._activeLayer&&(this._activeLayer=e,this.dispatchEvent({type:"activeLayerChanged"}),this.drawPanel())},ol.control.LayerSwitcher.prototype.getActiveLayer=function(){return this._activeLayer},ol.control.LayerSwitcher.prototype.setHeader=function(e){this.header_.html(e)},ol.control.LayerSwitcher.prototype.overflow=function(e){if(this.button){if("none"==this.panel_.css("display"))return void $(this.element).css("height","auto");var t=$(this.element).outerHeight(),a=this.panel_.outerHeight(),i=this.button.position().top+this.button.outerHeight(!0),o=this.panel_.position().top-i;if(t-i<a){switch($(this.element).css("height","100%"),e){case 1:o+=2*$("li.visible .li-content",this.panel_).height();break;case-1:o-=2*$("li.visible .li-content",this.panel_).height();break;case"+50%":o+=Math.round(t/2);break;case"-50%":o-=Math.round(t/2)}return o+a<=t-3*i/2?(o=t-3*i/2-a,this.botv.hide()):this.botv.css("display",""),0<=o?(o=0,this.topv.hide()):this.topv.css("display",""),this.panel_.css("top",o+"px"),!0}return $(this.element).css("height","auto"),this.panel_.css("top","0px"),this.botv.hide(),this.topv.hide(),!1}return!1},ol.control.LayerSwitcher.prototype.viewChange=function(e){var i=this.map_,o=this.map_.getView().getResolution();$("li",this.panel_).each(function(){var e=$(this).data("layer");if(e)if(e.getMaxResolution()<=o||e.getMinResolution()>=o)$(this).addClass("ol-layer-hidden");else{var t=e.getExtent();if(t){var a=i.getView().calculateExtent(i.getSize());ol.extent.intersects(a,t)?$(this).removeClass("ol-layer-hidden"):$(this).addClass("ol-layer-hidden")}else $(this).removeClass("ol-layer-hidden")}})},ol.control.LayerSwitcher.prototype.drawPanel=function(e){if(this.getMap()){var t=this;this.dcount++,setTimeout(function(){t.drawPanel_()},0)}},ol.control.LayerSwitcher.prototype.onLayerRemoved=function(e){if(this.getMap()){e.element==this._activeLayer&&this.setActiveLayer(null)}},ol.control.LayerSwitcher.prototype.drawPanel_=function(e){--this.dcount||this.dragging_||($("li",this.panel_).not(".ol-header").remove(),this.drawList(this.panel_,this.getMap().getLayers()))},ol.control.LayerSwitcher.prototype.switchLayerVisibility=function(t,e,a){if(t.get("baseLayer"))t.getVisible()||t.setVisible(!0),e.forEach(function(e){t!==e&&e.get("baseLayer")&&e.getVisible()&&e.setVisible(!1)});else{var i=!t.getVisible();void 0!==a&&(i=a),t.setVisible(i);var o=t.get("_parent");o&&i&&this.switchLayerVisibility(o,e,i)}},ol.control.LayerSwitcher.prototype.testLayerVisibility=function(e){if(this.map_){var t=this.map_.getView().getResolution();if(e.getMaxResolution()<=t||e.getMinResolution()>=t)return!1;var a=e.getExtent();if(a){var i=this.map_.getView().calculateExtent(this.map_.getSize());return ol.extent.intersects(i,a)}return!0}return!0},ol.control.LayerSwitcher.prototype.dragOrdering_=function(e){var t=e.data;switch(e.type){case"mousedown":case"touchstart":e.stopPropagation(),e.preventDefault();var a=e.pageY||e.originalEvent.touches&&e.originalEvent.touches.length&&e.originalEvent.touches[0].pageY||e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length&&e.originalEvent.changedTouches[0].pageY;(t={self:t.self,elt:$(e.currentTarget).closest("li"),start:!0,element:t.self.element,panel:t.self.panel_,pageY:a}).elt.parent().addClass("drag"),$(document).on("mouseup mousemove touchend touchcancel touchmove",t,t.self.dragOrdering_);break;case"touchcancel":case"touchend":case"mouseup":if(t.target){var i=t.layer,o=t.target;if(i&&o){for(var n,r=(n=t.group?t.group.getLayers():t.self.getMap().getLayers()).getArray(),s=0;s<r.length;s++)if(r[s]==i){n.removeAt(s);break}for(var l=0;l<r.length;l++)if(r[l]==o){l<s?n.insertAt(l,i):n.insertAt(l+1,i);break}}}$("li",t.elt.parent()).removeClass("dropover dropover-after dropover-before"),t.elt.removeClass("drag"),t.elt.parent().removeClass("drag"),$(t.element).removeClass("drag"),t.div&&t.div.remove(),$(document).off("mouseup mousemove touchend touchcancel touchmove",t.self.dragOrdering_);break;case"mousemove":case"touchmove":a=e.pageY||e.originalEvent.touches&&e.originalEvent.touches.length&&e.originalEvent.touches[0].pageY||e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length&&e.originalEvent.changedTouches[0].pageY;if(t.start&&2<Math.abs(t.pageY-a)&&(t.start=!1,t.elt.addClass("drag"),t.layer=t.elt.data("layer"),t.target=!1,t.group=t.elt.parent().parent().data("layer"),t.div=$("<li>").appendTo(t.panel),t.div.css({position:"absolute","z-index":1e4,left:t.elt.position().left,opacity:.5}).html($(t.elt).html()).addClass("ol-dragover").width(t.elt.outerWidth()).height(t.elt.height()),$(t.element).addClass("drag")),!t.start){var c;if(e.preventDefault(),e.stopPropagation(),t.div.css({top:a-t.panel.offset().top+t.panel.scrollTop()+5}),(c=e.originalEvent.touches?$(document.elementFromPoint(e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY)):$(e.target)).hasClass("ol-switcherbottomdiv")?(t.self.overflow(-1),console.log("bottom")):c.hasClass("ol-switchertopdiv")&&t.self.overflow(1),c.is("li")||(c=c.closest("li")),c.hasClass("dropover")||$("li",t.elt.parent()).removeClass("dropover dropover-after dropover-before"),c.parent().hasClass("drag")&&c.get(0)!==t.elt.get(0))(o=c.data("layer"))&&!o.get("allwaysOnTop")==!t.layer.get("allwaysOnTop")?(c.addClass("dropover"),c.addClass(t.elt.position().top<c.position().top?"dropover-after":"dropover-before"),t.target=o):t.target=!1,t.div.show();else t.target=!1,c.get(0)===t.elt.get(0)?t.div.hide():t.div.show();t.target?t.div.removeClass("forbidden"):t.div.addClass("forbidden")}}},ol.control.LayerSwitcher.prototype.dragOpacity_=function(e){var t=e.data;switch(e.type){case"mousedown":case"touchstart":e.stopPropagation(),e.preventDefault(),t.start=e.pageX||e.originalEvent.touches&&e.originalEvent.touches.length&&e.originalEvent.touches[0].pageX||e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length&&e.originalEvent.changedTouches[0].pageX,t.elt=$(e.target),t.layer=t.elt.closest("li").data("layer"),t.self.dragging_=!0,$(document).on("mouseup touchend mousemove touchmove touchcancel",t,t.self.dragOpacity_);break;case"touchcancel":case"touchend":case"mouseup":$(document).off("mouseup touchend mousemove touchmove touchcancel",t.self.dragOpacity_),t.layer.setOpacity(t.opacity),t.elt.parent().next().text(Math.round(100*t.opacity)),t.self.dragging_=!1,t=!1;break;default:var a=e.pageX||e.originalEvent.touches&&e.originalEvent.touches.length&&e.originalEvent.touches[0].pageX||e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length&&e.originalEvent.changedTouches[0].pageX,i=Math.max(0,Math.min(1,(a-t.elt.parent().offset().left)/t.elt.parent().width()));t.elt.css("left",100*i+"%"),t.elt.parent().next().text(Math.round(100*t.opacity)),t.opacity=i,t.layer.setOpacity(i)}},ol.control.LayerSwitcher.prototype.drawList=function(e,a){var n=this,t=$(e).attr("id")||"",i=a.getArray(),o=function(e){e.stopPropagation(),e.preventDefault();var t=$(this).parent().parent().data("layer");n.switchLayerVisibility(t,a)},r=function(e){e.stopPropagation(),e.preventDefault();var t=$(this).parent().parent().data("layer");n.toggleVisiblityOnLabelClick&&n.switchLayerVisibility(t,a),32<e.clientX&&n.setActiveLayer(t)};function s(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("li").data("layer");n.oninfo(t),n.dispatchEvent({type:"info",layer:t})}function l(e){e.stopPropagation(),e.preventDefault();var t=$(this).data("layer");n.onClick(t),n.dispatchEvent({type:"click",layer:t}),n.setActiveLayer(t)}function c(e){e.stopPropagation(),e.preventDefault();var t=$(this).data("layer");n.onDblClick(t),n.dispatchEvent({type:"dblclick",layer:t}),n.setActiveLayer(t)}function d(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("li").data("layer");n.onextent?n.onextent(t):n.map_.getView().fit(t.getExtent(),n.map_.getSize()),n.dispatchEvent({type:"extent",layer:t})}function p(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("ul").parent(),a=t.data("layer");if(a){var i={type:"beforeLayerRemoved",layer:o=$(this).closest("li").data("layer"),parentLayer:a,cancel:!1};if(n.dispatchEvent(i),i.cancel)return;n._activeLayer==o&&n.setActiveLayer(null),n.map_.removeLayer(o),a.getLayers().remove(o),0!=a.getLayers().getLength()||a.get("noSwitcherDelete")||p.call($(".layerTrash",t),e)}else{var o;$(this).closest("li"),i={type:"beforeLayerRemoved",layer:o=$(this).closest("li").data("layer"),cancel:!1};if(n.dispatchEvent(i),i.cancel)return;n._activeLayer==o&&n.setActiveLayer(null),n.map_.removeLayer(o)}}for(var u=i.length-1;0<=u;u--){var h=i[u],f=t+"_"+u;if(n.displayInLayerSwitcher(h)){var m=$('<li id="'+f+'">').addClass((h.getVisible()?"visible ":" ")+(h.get("baseLayer")?"baselayer":"")).data("layer",h).appendTo(e);m.on("click",l),m.on("dblclick",c);var g=$("<div>").addClass("li-content").appendTo(m),y=$("<div>").addClass("ol-layerswitcher-buttons").appendTo(m);this.testLayerVisibility(h)||g.addClass("ol-layer-hidden");h.get("baseLayer");if(h instanceof ol.layer.Vector&&this.setLoadingStatus_(h),(h instanceof ol.layer.Image||h instanceof ol.layer.Tile)&&this.setLoadingStatus_(h),this.reordering&&(u<i.length-1&&(h.get("allwaysOnTop")||!i[u+1].get("allwaysOnTop"))||0<u&&(!h.get("allwaysOnTop")||i[u-1].get("allwaysOnTop")))&&$("<div>").addClass("layerup2 glyphicon glyphicon-move").on("mousedown touchstart",{self:this},this.dragOrdering_).attr("title",this.tip.up).appendTo(y),h.getLayers){var v=0;h.getLayers().forEach(function(e){n.displayInLayerSwitcher(e)&&v++}),v&&$("<span>").addClass(h.get("openInLayerSwitcher")?"expand-collapse glyphicon glyphicon-folder-open":"expand-collapse glyphicon glyphicon-folder-close").click(function(){var e=$(this).closest("li").data("layer");e.set("openInLayerSwitcher",!e.get("openInLayerSwitcher"))}).attr("title",this.tip.plus).appendTo(g)}if(h.get("switcherTable")?$("<span>").addClass("fa fa-table").appendTo(g):$("<input>").attr("type",h.get("baseLayer")?"radio":"checkbox").attr("checked",h.getVisible()).on("click",o).appendTo(g),h.layerswitcher_label=$("<label>").text(h.get("title")||h.get("name")).attr("title",h.get("title")||h.get("name")).on("click",r).attr("unselectable","on").css("user-select","none").on("selectstart",!1).appendTo(g),this.oninfo&&!h.get("noSwitcherInfo")&&$("<div>").addClass("layerInfo").on("click",s).attr("title",this.tip.info).appendTo(y),this.hastrash&&!h.get("noSwitcherDelete")&&$("<div>").addClass("layerTrash2 glyphicon glyphicon-trash").on("click",p).attr("title",this.tip.trash).appendTo(y),this.hasextent&&i[u].getExtent()){var b=i[u].getExtent();4==b.length&&b[0]<b[2]&&b[1]<b[3]&&$("<div>").addClass("layerExtent").on("click",d).attr("title",this.tip.extent).appendTo(y)}if(this.show_progress&&h instanceof ol.layer.Tile){var _=$("<div>").addClass("layerswitcher-progress").appendTo(g);this.setprogress_(h),h.layerswitcher_progress=$("<div>").appendTo(_)}m.addClass("ol-layer-item"),h==this._activeLayer&&m.addClass("layerswitcher-active-layer"),h.getLayers?(m.addClass("ol-layer-group"),!0===h.get("openInLayerSwitcher")&&this.drawList($('<ul class="chl" id="'+f+'_layers">').appendTo(m),h.getLayers())):h instanceof ol.layer.Vector?m.addClass("ol-layer-vector"):h instanceof ol.layer.VectorTile?m.addClass("ol-layer-vector"):h instanceof ol.layer.Tile?m.addClass("ol-layer-tile"):h instanceof ol.layer.Image?m.addClass("ol-layer-image"):h instanceof ol.layer.Heatmap&&m.addClass("ol-layer-heatmap"),h.set("layerswitcher_el_id",f),this.dispatchEvent({type:"drawlist",layer:h,li:m.get(0)})}}this.viewChange(),e==this.panel_&&this.overflow()},ol.control.LayerSwitcher.prototype.setprogress_=function(e){if(!e.layerswitcher_progress){var t=0,a=0;function i(){a===t?(a=t=0,e.layerswitcher_progress.width(0)):e.layerswitcher_progress.css("width",(t/a*100).toFixed(1)+"%")}e.getSource().on("tileloadstart",function(){a++,i()}),e.getSource().on("tileloadend",function(){t++,i()}),e.getSource().on("tileloaderror",function(){t++,i()})}},ol.control.LayerSwitcher.prototype.setLoadingStatus_=function(e){var t=e;function a(){t.layerswitcher_label&&(t.layerswitcher_label.removeClass("vector-loading_status-started"),t.layerswitcher_label.removeClass("vector-loading_status-complete"),t.layerswitcher_label.removeClass("vector-loading_status-failed"),t.layerswitcher_label.removeClass("vector-loading_status-out_of_date"),t.layerswitcher_label.addClass("vector-loading_status-"+t.getSource().get("loading_status")),"failed"==t.getSource().get("loading_status")?t.layerswitcher_label.attr("title",t.getSource().get("loading_details")):"out_of_date"==t.getSource().get("loading_status")?t.layerswitcher_label.attr("title",t.getSource().get("loading_details")):t.layerswitcher_label.attr("title",t.get("title")||t.get("name")))}a(),t.getSource().on("change:loading_status",function(e){a()})},ol.Overlay.Popup=function(e){var t=this;"number"==typeof(e=e||{}).offsetBox?this.offsetBox=[e.offsetBox,e.offsetBox,e.offsetBox,e.offsetBox]:this.offsetBox=e.offsetBox;var a=document.createElement("div");e.element=a;var i=document.createElement("div");i.classList.add("anchor"),a.appendChild(i),this.content=ol.ext.element.create("div",{html:e.html||"",className:"ol-popup-content",parent:a}),this.closeBox=e.closeBox,this.onclose=e.onclose,this.onshow=e.onshow;var o=document.createElement("button");o.classList.add("closeBox"),e.closeBox&&o.classList.add("hasclosebox"),o.setAttribute("type","button"),a.insertBefore(o,i),o.addEventListener("click",function(){t.hide()}),e.stopEvent&&(a.addEventListener("mousedown",function(e){e.stopPropagation()}),a.addEventListener("mousemove",function(e){e.stopPropagation()}),a.addEventListener("mouseup",function(e){e.stopPropagation()}),a.addEventListener("touchstart",function(e){e.stopPropagation()})),ol.Overlay.call(this,e),this._elt=a,this.setPositioning(e.positioning||"auto"),this.setPopupClass(e.popupClass||e.className||"default"),e.position&&setTimeout(function(){this.show(e.position)}.bind(this))},ol.ext.inherits(ol.Overlay.Popup,ol.Overlay),ol.Overlay.Popup.prototype.getClassPositioning=function(){var e="",t=this.getPositioning();return/bottom/.test(t)&&(e+="ol-popup-bottom "),/top/.test(t)&&(e+="ol-popup-top "),/left/.test(t)&&(e+="ol-popup-left "),/right/.test(t)&&(e+="ol-popup-right "),/^center/.test(t)&&(e+="ol-popup-middle "),/center$/.test(t)&&(e+="ol-popup-center "),e},ol.Overlay.Popup.prototype.setClosebox=function(e){(this.closeBox=e)?this.element.classList.add("hasclosebox"):this.element.classList.remove("hasclosebox")},ol.Overlay.Popup.prototype.setPopupClass=function(e){this.element.className="";var t=this.getClassPositioning().split(" ").filter(function(e){return 0<e.length}),a=["ol-popup"];e?e.split(" ").filter(function(e){return 0<e.length}).forEach(function(e){a.push(e)}):a.push("default"),t.forEach(function(e){a.push(e)}),this.closeBox&&a.push("hasclosebox"),this.element.classList.add.apply(this.element.classList,a)},ol.Overlay.Popup.prototype.addPopupClass=function(e){this.element.classList.add(e)},ol.Overlay.Popup.prototype.removePopupClass=function(e){this.element.classList.remove(e)},ol.Overlay.Popup.prototype.setPositioning=function(e){void 0!==e&&(/auto/.test(e)?(this.autoPositioning=e.split("-"),1==this.autoPositioning.length&&(this.autoPositioning[1]="auto")):this.autoPositioning=!1,"center"==(e=e.replace(/auto/g,"center"))&&(e="bottom-center"),this.setPositioning_(e))},ol.Overlay.Popup.prototype.setPositioning_=function(e){if(this.element){ol.Overlay.prototype.setPositioning.call(this,e),this.element.classList.remove("ol-popup-top","ol-popup-bottom","ol-popup-left","ol-popup-right","ol-popup-center","ol-popup-middle");var t=this.getClassPositioning().split(" ").filter(function(e){return 0<e.length});this.element.classList.add.apply(this.element.classList,t)}},ol.Overlay.Popup.prototype.getVisible=function(){return this.element.classList.contains("visible")},ol.Overlay.Popup.prototype.show=function(e,t){t||"string"!=typeof e||(t=e,e=null),!0===e&&(e=this.getPosition());var a=this,i=this.getMap();if(i&&(t&&t.length&&!("string"==typeof t||t instanceof String)&&(t=t[0]),t&&t!==this.prevHTML&&(this.prevHTML=t,this.content.innerHTML="",t instanceof Element?this.content.appendChild(t):this.content.insertAdjacentHTML("beforeend",t),Array.prototype.slice.call(this.content.querySelectorAll("img")).forEach(function(e){e.addEventListener("load",function(){i.renderSync()})})),e)){if(this.autoPositioning){var o=i.getPixelFromCoordinate(e),n=i.getSize(),r=[];"auto"==this.autoPositioning[0]?r[0]=o[1]<n[1]/3?"top":"bottom":r[0]=this.autoPositioning[0],r[1]=o[0]<2*n[0]/3?"left":"right",this.setPositioning_(r[0]+"-"+r[1]),this.offsetBox&&this.setOffset([this.offsetBox["left"==r[1]?2:0],this.offsetBox["top"==r[0]?3:1]])}else this.offsetBox&&this.setOffset(this.offsetBox);this.setPosition(e),this.element.parentElement.style.display="","function"==typeof this.onshow&&this.onshow(),this._tout=setTimeout(function(){a.element.classList.add("visible")},0)}},ol.Overlay.Popup.prototype.hide=function(){null!=this.getPosition()&&("function"==typeof this.onclose&&this.onclose(),this.setPosition(void 0),this._tout&&clearTimeout(this._tout),this.element.classList.remove("visible"))},ol.control.Button=function(t){t=t||{};var e=$("<div>").addClass((t.className||"")+" ol-button ol-unselectable ol-control"),a=this,i=$("<button>").html(t.html||"").attr("type","button").attr("title",t.title).on("touchstart click",function(e){e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),a.getDisable()||t.handleClick&&t.handleClick.call(a,e)}).appendTo(e);t.title||i.attr("title",i.children().first().attr("title")),ol.control.Control.call(this,{element:e.get(0),target:t.target}),t.title&&this.set("title",t.title)},ol.ext.inherits(ol.control.Button,ol.control.Control),ol.control.Button.prototype.setVisible=function(e){e?$(this.element).show():$(this.element).hide()},ol.control.Button.prototype.getVisible=function(){return"none"!=$(this.element).css("display")},ol.control.Button.prototype.getDisable=function(){return $("button",this.element).hasClass("disabled")},ol.control.Button.prototype.setDisable=function(e){this.getDisable()!=e&&(e?$("button",this.element).addClass("disabled"):$("button",this.element).removeClass("disabled"),this.dispatchEvent({type:"change:disable",key:"disable",oldValue:!e,disable:e}))},ol.control.TextButton=function(e){(e=e||{}).className=(e.className||"")+" ol-text-button",ol.control.Button.call(this,e)},ol.ext.inherits(ol.control.TextButton,ol.control.Button),ol.control.Toggle=function(e){e=e||{};var t=this;this.interaction_=e.interaction,this.interaction_&&this.interaction_.on("change:active",function(e){t.setActive(!e.oldValue)}),e.toggleFn&&(e.onToggle=e.toggleFn),this._onToggle=e.onToggle,e.handleClick=function(){t.toggle(),e.onToggle&&e.onToggle.call(t,t.getActive())},e.className=(e.className||"")+" ol-toggle",ol.control.Button.call(this,e),this.set("title",e.title),this.set("autoActivate",e.autoActivate),e.bar&&(this.subbar_=e.bar,this.subbar_.setTarget(this.element),$(this.subbar_.element).addClass("ol-option-bar")),this.setActive(e.active),this.setDisable(e.disable)},ol.ext.inherits(ol.control.Toggle,ol.control.Button),ol.control.Toggle.prototype.setMap=function(e){!e&&this.getMap()&&(this.interaction_&&this.getMap().removeInteraction(this.interaction_),this.subbar_&&this.getMap().removeControl(this.subbar_)),ol.control.Control.prototype.setMap.call(this,e),e&&(this.interaction_&&e.addInteraction(this.interaction_),this.subbar_&&e.addControl(this.subbar_))},ol.control.Toggle.prototype.getSubBar=function(){return this.subbar_},ol.control.Toggle.prototype.getDisable=function(){return $("button",this.element).prop("disabled")},ol.control.Toggle.prototype.setDisable=function(e){this.getDisable()!=e&&($("button",this.element).prop("disabled",e),e&&this.getActive()&&this.setActive(!1),this.dispatchEvent({type:"change:disable",key:"disable",oldValue:!e,disable:e}))},ol.control.Toggle.prototype.getActive=function(){return $(this.element).hasClass("ol-active")},ol.control.Toggle.prototype.toggle=function(){this.getActive()?this.setActive(!1):this.setActive(!0)},ol.control.Toggle.prototype.raiseOnToggle=function(){this._onToggle&&this._onToggle.call(this,this.getActive())},ol.control.Toggle.prototype.setActive=function(e){this.getActive()!=e&&(e?$(this.element).addClass("ol-active"):$(this.element).removeClass("ol-active"),this.interaction_&&this.interaction_.setActive(e),this.subbar_&&this.subbar_.setActive(e),this.dispatchEvent({type:"change:active",key:"active",oldValue:!e,active:e}))},ol.control.Toggle.prototype.setInteraction=function(e){this.interaction_=e},ol.control.Toggle.prototype.getInteraction=function(){return this.interaction_},ol.control.Bar=function(e){e||(e={});var t=$("<div>").addClass("ol-unselectable ol-control ol-bar");if(e.className&&t.addClass(e.className),e.group&&t.addClass("ol-group"),ol.control.Control.call(this,{element:t.get(0),target:e.target}),this.set("toggleOne",e.toggleOne),this.set("autoDeactivate",e.autoDeactivate),this.controls_=[],e.controls instanceof Array)for(var a=0;a<e.controls.length;a++)this.addControl(e.controls[a])},ol.ext.inherits(ol.control.Bar,ol.control.Control),ol.control.Bar.prototype.setVisible=function(e){e?$(this.element).show():$(this.element).hide()},ol.control.Bar.prototype.getVisible=function(){return"none"!=$(this.element).css("display")},ol.control.Bar.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);for(var t=0;t<this.controls_.length;t++){this.controls_[t].setMap(e)}},ol.control.Bar.prototype.getControls=function(){return this.controls_},ol.control.Bar.prototype.setPosition=function(e){$(this.element).removeClass("ol-left ol-top ol-bottom ol-right"),e=e.split("-");for(var t=0;t<e.length;t++)switch(e[t]){case"top":case"left":case"bottom":case"right":$(this.element).addClass("ol-"+e[t])}},ol.control.Bar.prototype.addControl=function(e){this.controls_.push(e),e.setTarget(this.element),this.getMap()&&this.getMap().addControl(e),e.on("change:active",this.onActivateControl_.bind(this)),e.getActive&&e.getActive()&&e.dispatchEvent({type:"change:active",key:"active",oldValue:!1,active:!0})},ol.control.Bar.prototype.deactivateControls=function(e){for(var t=0;t<this.controls_.length;t++)this.controls_[t]!==e&&this.controls_[t].setActive&&this.controls_[t].setActive(!1)},ol.control.Bar.prototype.getActiveControls=function(){for(var e,t=[],a=0;e=this.controls_[a];a++)e.getActive&&e.getActive()&&t.push(e);return t},ol.control.Bar.prototype.setActive=function(e){if(!e&&this.get("autoDeactivate")&&this.deactivateControls(),e)for(var t,a=this.getControls(),i=0;t=a[i];i++)t.get("autoActivate")&&t.setActive(!0)},ol.control.Bar.prototype.onActivateControl_=function(e){if(this.get("toggleOne"))if(e.active){var t,a=e.target;for(t=0;t<this.controls_.length&&this.controls_[t]!==a;t++);if(t==this.controls_.length)return;this.deactivateControls(this.controls_[t])}else if(!this.getActiveControls().length)for(var i,o=0;i=this.controls_[o];o++)if(i.get("autoActivate")){i.setActive();break}},ol.control.Search=function(i){var o=this;i||(i={}),null==i.typing&&(i.typing=300),this._classname=i.className||"search";var n=document.createElement("DIV"),e=(i.className||"")+" ol-search";if(i.target||(e+=" ol-unselectable ol-control ol-collapsed",this.button=document.createElement("BUTTON"),this.button.setAttribute("type","button"),this.button.setAttribute("title",i.label||"search"),this.button.addEventListener("click",function(){if(n.classList.toggle("ol-collapsed"),!n.classList.contains("ol-collapsed")){n.querySelector("input.search").focus();for(var e=n.querySelectorAll("li"),t=0;t<e.length;t++)e[t].classList.remove("select");l.value||o.drawList_()}}),n.appendChild(this.button)),n.setAttribute("class",e),i.inputLabel){var t=document.createElement("LABEL");t.innerText=i.inputLabel,n.appendChild(t)}var r,s="",l=this._input=document.createElement("INPUT");l.setAttribute("type","search"),l.setAttribute("class","search"),l.setAttribute("placeholder",i.placeholder||"Search..."),l.addEventListener("change",function(e){o.dispatchEvent({type:"change:input",input:e,value:l.value})});var a=function(e){var t=n.querySelector("ul.autocomplete li.select"),a=l.value;if("ArrowDown"==e.key||"ArrowUp"==e.key||"Down"==e.key||"Up"==e.key)t?(t.classList.remove("select"),(t=/Down/.test(e.key)?t.nextElementSibling:t.previousElementSibling)&&t.classList.add("select")):n.querySelector("ul.autocomplete li").classList.add("select");else if("input"!=e.type||a)if(!t||"search"!=e.type&&"Enter"!=e.key)if("search"==e.type||"Enter"==e.key||s!=a&&0<=i.typing)(s=a)?(r&&clearTimeout(r),r=setTimeout(function(){if(s.length>=o.get("minLength")){var e=o.autocomplete(s,function(e){o.drawList_(e)});e&&o.drawList_(e)}else o.drawList_()},i.typing)):o.drawList_();else{(t=n.querySelector("ul.autocomplete li"))&&t.classList.remove("select")}else n.classList.contains("ol-control")&&l.blur(),t.classList.remove("select"),s=a,o._handleSelect(o._list[t.getAttribute("data-search")]);else o.drawList_()};l.addEventListener("keyup",a),l.addEventListener("search",a),l.addEventListener("cut",a),l.addEventListener("paste",a),l.addEventListener("input",a),i.noCollapse||(l.addEventListener("blur",function(){setTimeout(function(){n.classList.add("ol-collapsed")},200)}),l.addEventListener("focus",function(){n.classList.remove("ol-collapsed")})),n.appendChild(l);var c=document.createElement("UL");c.classList.add("autocomplete"),n.appendChild(c),ol.control.Control.call(this,{element:n,target:i.target}),"function"==typeof i.getTitle&&(this.getTitle=i.getTitle),"function"==typeof i.autocomplete&&(this.autocomplete=i.autocomplete),this.set("minLength",i.minLength||1),this.set("maxItems",i.maxItems||10),this.set("maxHistory",i.maxHistory||i.maxItems||10),this.restoreHistory(),this.drawList_()},ol.ext.inherits(ol.control.Search,ol.control.Control),ol.control.Search.prototype.getTitle=function(e){return e.name||"No title"},ol.control.Search.prototype.search=function(){var e=this.element.querySelector("input.search");this._triggerCustomEvent("search",e)},ol.control.Search.prototype._triggerCustomEvent=function(e,t){var a;window.CustomEvent?a=new CustomEvent(e):(a=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{}),t.dispatchEvent(a)},ol.control.Search.prototype.setInput=function(e,t){var a=this.element.querySelector("input.search");a.value=e,t&&this._triggerCustomEvent("keyup",a)},ol.control.Search.prototype.select=function(e){this.dispatchEvent({type:"select",search:e})},ol.control.Search.prototype._handleSelect=function(t){if(t){var a=this.get("history");try{for(var e=JSON.stringify(t),i=a.length-1;0<=i;i--)a[i]&&JSON.stringify(a[i])!==e||a.splice(i,1)}catch(e){for(i=a.length-1;0<=i;i--)a[i]===t&&a.splice(i,1)}for(a.unshift(t);a.length>(this.get("maxHistory")||10);)a.pop();this.saveHistory(),this.select(t)}},ol.control.Search.prototype.saveHistory=function(){if(0<=this.get("maxHistory"))try{localStorage["ol@search-"+this._classname]=JSON.stringify(this.get("history"))}catch(e){}else localStorage.removeItem("ol@search-"+this._classname)},ol.control.Search.prototype.restoreHistory=function(){try{this.set("history",JSON.parse(localStorage["ol@search-"+this._classname]))}catch(e){this.set("history",[])}},ol.control.Search.prototype.clearHistory=function(){this.set("history",[]),this.saveHistory(),this.drawList_()},ol.control.Search.prototype.getHistory=function(){return this.get("history")},ol.control.Search.prototype.autocomplete=function(e,t){return t([]),!1},ol.control.Search.prototype.drawList_=function(e){var t=this,a=this.element.querySelector("ul.autocomplete");if(a.innerHTML="",this._list=[],e)a.setAttribute("class","autocomplete");else{if(this.element.querySelector("input.search").value)return;e=this.get("history"),a.setAttribute("class","autocomplete history")}for(var i=Math.min(t.get("maxItems"),e.length),o=0;o<i;o++){var n;if(e[o])if(!o||!t.equalFeatures(e[o],e[o-1]))(n=document.createElement("LI")).setAttribute("data-search",o),this._list.push(e[o]),n.addEventListener("click",function(e){t._handleSelect(t._list[e.currentTarget.getAttribute("data-search")])}),n.innerHTML=t.getTitle(e[o]),a.appendChild(n)}i&&this.get("copy")&&((n=document.createElement("LI")).classList.add("clear-history"),n.innerHTML="Clear history",a.appendChild(n),n.addEventListener("click",function(e){t.clearHistory()}))},ol.control.Search.prototype.equalFeatures=function(e,t){return!1},ol.control.SearchJSON=function(e){(e=e||{}).className=e.className||"JSON",delete e.autocomplete,e.minLength=e.minLength||3,e.typing=e.typing||800,ol.control.Search.call(this,e);var t=e.url||"";if("https:"===window.location.protocol){var a=document.createElement("a");a.href=t,a.protocol=window.location.protocol,t=a.href}this.set("url",t),this._auth=e.authentication,"function"==typeof e.handleResponse&&(this.handleResponse=e.handleResponse)},ol.ext.inherits(ol.control.SearchJSON,ol.control.Search),ol.control.SearchJSON.prototype.autocomplete=function(e,a){var t=this.requestData(e),i=encodeURI(this.get("url")),o="";for(var n in t)o+=o?"&":"?",t.hasOwnProperty(n)&&(o+=n+"="+encodeURIComponent(t[n]));this.ajax(i+o,function(e){if(200<=e.status&&e.status<400){var t=JSON.parse(e.response);a(this.handleResponse(t))}else console.log(i+o,arguments)},function(){console.log(i+o,arguments)})},ol.control.SearchJSON.prototype.ajax=function(e,t,a){var i=this;this._request&&this._request.abort();var o=this._request=new XMLHttpRequest;o.open("GET",e,!0),this._auth&&o.setRequestHeader("Authorization","Basic "+this._auth),this.element.classList.add("searching"),o.onload=function(){i._request=null,i.element.classList.remove("searching"),t.call(i,this)},o.onerror=function(){i._request=null,i.element.classList.remove("searching"),a&&a.call(i)},o.send()},ol.control.SearchJSON.prototype.requestData=function(e){return{q:e}},ol.control.SearchJSON.prototype.handleResponse=function(e){return e},ol.control.SearchPhoton=function(e){(e=e||{}).className=e.className||"photon",e.url=e.url||"http://photon.komoot.de/api/",ol.control.SearchJSON.call(this,e),this.set("lang",e.lang),this.set("position",e.position),this.set("copy","<a href='http://www.openstreetmap.org/copyright' target='new'>&copy; OpenStreetMap contributors</a>")},ol.ext.inherits(ol.control.SearchPhoton,ol.control.SearchJSON),ol.control.SearchPhoton.prototype.getTitle=function(e){var t=e.properties;return(t.housenumber||"")+" "+(t.street||t.name||"")+"<i> "+(t.postcode||"")+" "+(t.city||"")+" ("+t.country+")</i>"},ol.control.SearchPhoton.prototype.requestData=function(e){var t={q:e,lang:this.get("lang"),limit:this.get("maxItems")};if(this.get("position")){var a=this.getMap().getView(),i=new ol.geom.Point(a.getCenter());i=i.transform(a.getProjection(),"EPSG:4326").getCoordinates(),t.lon=i[0],t.lat=i[1]}return t},ol.control.SearchPhoton.prototype.handleResponse=function(e,t){return e.features},ol.control.SearchPhoton.prototype.equalFeatures=function(e,t){return this.getTitle(e)===this.getTitle(t)&&e.geometry.coordinates[0]===t.geometry.coordinates[0]&&e.geometry.coordinates[1]===t.geometry.coordinates[1]},ol.control.SearchPhoton.prototype.select=function(e){var t=e.geometry.coordinates;try{t=ol.proj.transform(e.geometry.coordinates,"EPSG:4326",this.getMap().getView().getProjection())}catch(e){}this.dispatchEvent({type:"select",search:e,coordinate:t})},ol.control.SearchNominatim=function(e){(e=e||{}).className=e.className||"nominatim",e.typing=e.typing||500,e.url=e.url||"https://nominatim.openstreetmap.org/search",ol.control.SearchJSON.call(this,e),this.set("copy","<a href='http://www.openstreetmap.org/copyright' target='new'>&copy; OpenStreetMap contributors</a>"),this.set("polygon",e.polygon)},ol.ext.inherits(ol.control.SearchNominatim,ol.control.SearchJSON),ol.control.SearchNominatim.prototype.getTitle=function(e){var t=e.display_name+"<i>"+e.class+" - "+e.type+"</i>";return e.icon&&(t="<img src='"+e.icon+"' />"+t),t},ol.control.SearchNominatim.prototype.requestData=function(e){return{format:"json",addressdetails:1,q:e,polygon_geojson:this.get("polygon")?1:0,limit:this.get("maxItems")}},ol.control.SearchNominatim.prototype.select=function(e){var t=[Number(e.lon),Number(e.lat)];try{t=ol.proj.transform(t,"EPSG:4326",this.getMap().getView().getProjection())}catch(e){}this.dispatchEvent({type:"select",search:e,coordinate:t})},ol.style.Chart=function(e){var t=e||{},a=0;e.stroke&&(a=e.stroke.getWidth()),ol.style.RegularShape.call(this,{radius:t.radius+a,fill:new ol.style.Fill({color:[0,0,0]}),rotation:t.rotation,snapToPixel:t.snapToPixel}),t.scale&&this.setScale(t.scale),this._stroke=t.stroke,this._radius=t.radius||20,this._donutratio=t.donutRatio||.5,this._type=t.type,this._offset=[t.offsetX?t.offsetX:0,t.offsetY?t.offsetY:0],this._animation="number"==typeof t.animation?{animate:!0,step:t.animation}:this._animation={animate:!1,step:1},this._max=t.max,this._data=t.data,t.colors instanceof Array?this._colors=t.colors:(this._colors=ol.style.Chart.colors[t.colors],this._colors||(this._colors=ol.style.Chart.colors.classic)),this.renderChart_()},ol.ext.inherits(ol.style.Chart,ol.style.RegularShape),ol.style.Chart.colors={classic:["#ffa500","blue","red","green","cyan","magenta","yellow","#0f0"],dark:["#960","#003","#900","#060","#099","#909","#990","#090"],pale:["#fd0","#369","#f64","#3b7","#880","#b5d","#666"],pastel:["#fb4","#79c","#f66","#7d7","#acc","#fdd","#ff9","#b9b"],neon:["#ff0","#0ff","#0f0","#f0f","#f00","#00f"]},ol.style.Chart.prototype.clone=function(){var e=new ol.style.Chart({type:this._type,radius:this._radius,rotation:this.getRotation(),scale:this.getScale(),data:this.getData(),snapToPixel:!!this.getSnapToPixel&&this.getSnapToPixel(),stroke:this._stroke,colors:this._colors,offsetX:this._offset[0],offsetY:this._offset[1],animation:this._animation});return e.setScale(this.getScale()),e.setOpacity(this.getOpacity()),e},ol.style.Chart.prototype.getData=function(){return this._data},ol.style.Chart.prototype.setData=function(e){this._data=e,this.renderChart_()},ol.style.Chart.prototype.getRadius=function(){return this._radius},ol.style.Chart.prototype.setRadius=function(e,t){this._radius=e,this.donuratio_=t||this.donuratio_,this.renderChart_()},ol.style.Chart.prototype.setAnimation=function(e){if(!1===e){if(0==this._animation.animate)return;this._animation.animate=!1}else{if(this._animation.step==e)return;this._animation.animate=!0,this._animation.step=e}this.renderChart_()},ol.style.Chart.prototype.renderChart_=function(e){if(e){var t,a=0;this._stroke&&(t=ol.color.asString(this._stroke.getColor()),a=this._stroke.getWidth());var i=this.getImage(e),o=i.getContext("2d");o.clearRect(0,0,i.width,i.height),o.lineJoin="round";var n,r,s=0;for(n=0;n<this._data.length;n++)s+=this._data[n];o.save(),o.setTransform(e,0,0,e,0,0),o.translate(0,0);var l=this._animation.animate?this._animation.step:1;switch(this._type){case"donut":case"pie3D":case"pie":var c,d=Math.PI*(l-1.5);for(r=i.width/2/e,o.strokeStyle=t,o.lineWidth=a,o.save(),"pie3D"==this._type&&(o.translate(0,.3*r),o.scale(1,.7),o.beginPath(),o.fillStyle="#369",o.arc(r,1.4*r,this._radius*l,0,2*Math.PI),o.fill(),o.stroke()),"donut"==this._type&&(o.save(),o.beginPath(),o.rect(0,0,2*r,2*r),o.arc(r,r,this._radius*l*this._donutratio,0,2*Math.PI),o.clip("evenodd")),n=0;n<this._data.length;n++)o.beginPath(),o.moveTo(r,r),o.fillStyle=this._colors[n%this._colors.length],c=d+2*Math.PI*this._data[n]/s*l,o.arc(r,r,this._radius*l,d,c),o.closePath(),o.fill(),o.stroke(),d=c;"donut"==this._type&&(o.restore(),o.beginPath(),o.strokeStyle=t,o.lineWidth=a,o.arc(r,r,this._radius*l*this._donutratio,Math.PI*(l-1.5),d),o.stroke()),o.restore();break;case"bar":default:var p=0;if(this._max)p=this._max;else for(n=0;n<this._data.length;n++)p<this._data[n]&&(p=this._data[n]);var u=Math.min(5,2*this._radius/this._data.length);r=i.width/2/e;var h,f=i.width/e-a,m=r-this._data.length*u/2;for(o.strokeStyle=t,o.lineWidth=a,n=0;n<this._data.length;n++){o.beginPath(),o.fillStyle=this._colors[n%this._colors.length],h=m+u;var g=this._data[n]/p*2*this._radius*l;o.rect(m,f-g,u,g),o.closePath(),o.fill(),o.stroke(),m=h}}o.restore();var y=this.getAnchor();y[0]=r-this._offset[0],y[1]=r-this._offset[1]}else this.getPixelRatio?(e=window.devicePixelRatio,this.renderChart_(e),this.getPixelRatio&&1!==e&&this.renderChart_(1)):this.renderChart_(1)},ol.style.FillPattern=function(e){var t;e||(e={});var a=this.canvas_=document.createElement("canvas"),i=(0<Number(e.scale)?Number(e.scale):1)*ol.has.DEVICE_PIXEL_RATIO||ol.has.DEVICE_PIXEL_RATIO,o=a.getContext("2d");if(e.image){e.image.load();var n=e.image.getImage();if(n.width)a.width=Math.round(n.width*i),a.height=Math.round(n.height*i),o.globalAlpha="number"==typeof e.opacity?e.opacity:1,o.drawImage(n,0,0,n.width,n.height,0,0,a.width,a.height),t=o.createPattern(a,"repeat");else{var r=this;t=[0,0,0,0],n.onload=function(){a.width=Math.round(n.width*i),a.height=Math.round(n.height*i),o.globalAlpha="number"==typeof e.opacity?e.opacity:1,o.drawImage(n,0,0,n.width,n.height,0,0,a.width,a.height),t=o.createPattern(a,"repeat"),r.setColor(t)}}}else{var s=this.getPattern_(e);if(a.width=Math.round(s.width*i),a.height=Math.round(s.height*i),o.beginPath(),e.fill&&(o.fillStyle=ol.color.asString(e.fill.getColor()),o.fillRect(0,0,a.width,a.height)),o.scale(i,i),o.lineCap="round",o.lineWidth=s.stroke||1,o.fillStyle=ol.color.asString(e.color||"#000"),o.strokeStyle=ol.color.asString(e.color||"#000"),s.circles)for(var l=0;l<s.circles.length;l++){var c=s.circles[l];o.beginPath(),o.arc(c[0],c[1],c[2],0,2*Math.PI),s.fill&&o.fill(),s.stroke&&o.stroke()}if(s.repeat||(s.repeat=[[0,0]]),s.char&&(o.font=s.font||s.width+"px Arial",o.textAlign="center",o.textBaseline="middle",s.angle?(o.fillText(s.char,s.width/4,s.height/4),o.fillText(s.char,5*s.width/4,5*s.height/4),o.fillText(s.char,s.width/4,5*s.height/4),o.fillText(s.char,5*s.width/4,s.height/4),o.fillText(s.char,3*s.width/4,3*s.height/4),o.fillText(s.char,-s.width/4,-s.height/4),o.fillText(s.char,3*s.width/4,-s.height/4),o.fillText(s.char,-s.width/4,3*s.height/4)):o.fillText(s.char,s.width/2,s.height/2)),s.lines)for(l=0;l<s.lines.length;l++)for(var d=0;d<s.repeat.length;d++){var p=s.lines[l];o.beginPath(),o.moveTo(p[0]+s.repeat[d][0],p[1]+s.repeat[d][1]);for(var u=2;u<p.length;u+=2)o.lineTo(p[u]+s.repeat[d][0],p[u+1]+s.repeat[d][1]);s.fill&&o.fill(),s.stroke&&o.stroke(),o.save(),o.strokeStyle="red",o.strokeWidth=.1,o.restore()}if(t=o.createPattern(a,"repeat"),e.offset){var h=e.offset;if("number"==typeof h&&(h=[h,h]),h instanceof Array){var f=Math.round(h[0]*i),m=Math.round(h[1]*i);o.scale(1/i,1/i),o.clearRect(0,0,a.width,a.height),o.translate(f,m),o.fillStyle=t,o.fillRect(-f,-m,a.width,a.height),t=o.createPattern(a,"repeat")}}}ol.style.Fill.call(this,{color:t})},ol.ext.inherits(ol.style.FillPattern,ol.style.Fill),ol.style.FillPattern.prototype.clone=function(){var e=ol.style.Fill.prototype.clone.call(this);return e.canvas_=this.canvas_,e},ol.style.FillPattern.prototype.getImage=function(){return this.canvas_},ol.style.FillPattern.prototype.getPattern_=function(e){var t=ol.style.FillPattern.prototype.patterns[e.pattern]||ol.style.FillPattern.prototype.patterns.dot,a=Math.round(e.spacing)||10;Math.round(a/2);switch(e.pattern){case"dot":case"circle":var i=0===e.size?0:e.size/2||2;e.angle?(a=t.width=t.height=Math.round(1.4*a),t.circles=[[a/4,a/4,i],[3*a/4,3*a/4,i]],"circle"==e.pattern&&(t.circles=t.circles.concat([[a/4+a,a/4,i],[a/4,a/4+a,i],[3*a/4-a,3*a/4,i],[3*a/4,3*a/4-a,i],[a/4+a,a/4+a,i],[3*a/4-a,3*a/4-a,i]]))):(t.width=t.height=a,t.circles=[[a/2,a/2,i]],"circle"==e.pattern&&(t.circles=t.circles.concat([[a/2+a,a/2,i],[a/2-a,a/2,i],[a/2,a/2+a,i],[a/2,a/2-a,i],[a/2+a,a/2+a,i],[a/2+a,a/2-a,i],[a/2-a,a/2+a,i],[a/2-a,a/2-a,i]])));break;case"tile":case"square":i=0===e.size?0:e.size/2||2;e.angle?(t.width=t.height=a,t.lines=[[a/2-i,a/2,a/2,a/2-i,a/2+i,a/2,a/2,a/2+i,a/2-i,a/2]]):(t.width=t.height=a,t.lines=[[a/2-i,a/2-i,a/2+i,a/2-i,a/2+i,a/2+i,a/2-i,a/2+i,a/2-i,a/2-i]]),"square"==e.pattern&&(t.repeat=[[0,0],[0,a],[a,0],[0,-a],[-a,0],[-a,-a],[a,a],[-a,a],[a,-a]]);break;case"cross":e.angle&&(e.angle=45);case"hatch":var o=Math.round(((e.angle||0)-90)%360);180<o&&(o-=360),o*=Math.PI/180;var n=Math.cos(o),r=Math.sin(o);if(Math.abs(r)<1e-4)t.width=t.height=a,t.lines=[[0,.5,a,.5]],t.repeat=[[0,0],[0,a]];else if(Math.abs(n)<1e-4)t.width=t.height=a,t.lines=[[.5,0,.5,a]],t.repeat=[[0,0],[a,0]],"cross"==e.pattern&&(t.lines.push([0,.5,a,.5]),t.repeat.push([0,a]));else{var s=t.width=Math.round(Math.abs(a/r))||1,l=t.height=Math.round(Math.abs(a/n))||1;"cross"==e.pattern?(t.lines=[[-s,-l,2*s,2*l],[2*s,-l,-s,2*l]],t.repeat=[[0,0]]):t.repeat=0<n*r?(t.lines=[[-s,-l,2*s,2*l]],[[0,0],[s,0],[0,l]]):(t.lines=[[2*s,-l,-s,2*l]],[[0,0],[-s,0],[0,l]])}t.stroke=0===e.size?0:e.size||4}return t},ol.style.FillPattern.addPattern=function(e,t){t||(t={}),ol.style.FillPattern.prototype.patterns[e||t.char]={width:t.width||t.size||10,height:t.height||t.size||10,font:t.font,char:t.char,circles:t.circles,lines:t.lines,repeat:t.repeat,stroke:t.stroke,angle:t.angle,fill:t.fill}},ol.style.FillPattern.prototype.patterns={hatch:{width:5,height:5,lines:[[0,2.5,5,2.5]],stroke:1},cross:{width:7,height:7,lines:[[0,3,10,3],[3,0,3,10]],stroke:1},dot:{width:8,height:8,circles:[[5,5,2]],stroke:!1,fill:!0},circle:{width:10,height:10,circles:[[5,5,2]],stroke:1,fill:!1},square:{width:10,height:10,lines:[[3,3,3,8,8,8,8,3,3,3]],stroke:1,fill:!1},tile:{width:10,height:10,lines:[[3,3,3,8,8,8,8,3,3,3]],fill:!0},woven:{width:12,height:12,lines:[[3,3,9,9],[0,12,3,9],[9,3,12,0],[-1,1,1,-1],[13,11,11,13]],stroke:1},crosses:{width:8,height:8,lines:[[2,2,6,6],[2,6,6,2]],stroke:1},caps:{width:8,height:8,lines:[[2,6,4,2,6,6]],stroke:1},nylon:{width:20,height:20,lines:[[1,6,1,1,6,1],[6,11,11,11,11,6],[11,16,11,21,16,21],[16,11,21,11,21,16]],repeat:[[0,0],[-20,0],[0,-20]],stroke:1},hexagon:{width:20,height:12,lines:[[0,10,4,4,10,4,14,10,10,16,4,16,0,10]],stroke:1,repeat:[[0,0],[10,6],[10,-6],[-10,-6]]},cemetry:{width:15,height:19,lines:[[0,3.5,7,3.5],[3.5,0,3.5,10]],stroke:1,repeat:[[0,0],[7,9]]},sand:{width:20,height:20,circles:[[1,2,1],[9,3,1],[2,16,1],[7,8,1],[6,14,1],[4,19,1],[14,2,1],[12,10,1],[14,18,1],[18,8,1],[18,14,1]],fill:1},conglomerate:{width:30,height:20,circles:[[2,4,1],[17,3,1],[26,18,1],[12,17,1],[5,17,2],[28,11,2]],lines:[[7,5,6,7,9,9,11,8,11,6,9,5,7,5],[16,10,15,13,16,14,19,15,21,13,22,9,20,8,19,8,16,10],[24,6,26,7,27,5,26,4,24,4,24,6]],stroke:1},gravel:{width:15,height:10,circles:[[4,2,1],[5,9,1],[1,7,1]],lines:[[7,5,6,6,7,7,8,7,9,7,10,5,9,4,7,5],[11,2,14,4,14,1,12,1,11,2]],stroke:1},brick:{width:18,height:16,lines:[[0,1,18,1],[0,10,18,10],[6,1,6,10],[12,10,12,18],[12,0,12,1]],stroke:1},dolomite:{width:20,height:16,lines:[[0,1,20,1],[0,9,20,9],[1,9,6,1],[11,9,14,16],[14,0,14.4,1]],stroke:1},coal:{width:20,height:16,lines:[[1,5,7,1,7,7],[11,10,12,5,18,9],[5,10,2,15,9,15],[15,16,15,13,20,16],[15,0,15,2,20,0]],fill:1},breccia:{width:20,height:16,lines:[[1,5,7,1,7,7,1,5],[11,10,12,5,18,9,11,10],[5,10,2,15,9,15,5,10],[15,16,15,13,22,18],[15,0,15,2,20,0]],stroke:1},clay:{width:20,height:20,lines:[[0,0,3,11,0,20],[11,0,10,3,13,13,11,20],[0,0,10,3,20,0],[0,12,3,11,13,13,20,12]],stroke:1},flooded:{width:15,height:10,lines:[[0,1,10,1],[0,6,5,6],[10,6,15,6]],stroke:1},chaos:{width:40,height:40,lines:[[40,2,40,0,38,0,40,2],[4,0,3,2,2,5,0,0,0,3,2,7,5,6,7,7,8,10,9,12,9,13,9,14,8,14,6,15,2,15,0,20,0,22,2,20,5,19,8,15,10,14,11,12.25,10,12,10,10,12,9,13,7,12,6,13,4,16,7,17,4,20,0,18,0,15,3,14,2,14,0,12,1,11,0,10,1,11,4,10,7,9,8,8,5,6,4,5,3,5,1,5,0,4,0],[7,1,7,3,8,3,8,2,7,1],[4,3,5,5,4,5,4,3],[34,5,33,7,38,10,38,8,36,5,34,5],[27,0,23,2,21,8,30,0,27,0],[25,8,26,12,26,16,22.71875,15.375,20,13,18,15,17,18,13,22,17,21,19,22,21,20,19,18,22,17,30,25,26,26,24,28,21.75,33.34375,20,36,18,40,20,40,24,37,25,32,27,31,26,38,27,37,30,32,32,35,36,37,38,40,38,39,40,40,37,36,34,32,37,31,36,29,33,27,34,24,39,21,40,21,40,16,37,20,31,22,32,25,27,20,29,15,30,20,32,20,34,18,33,12,31,11,29,14,26,9,25,8],[39,24,37,26,40,28,39,24],[13,15,9,19,14,18,13,15],[18,23,14,27,16,27,17,25,20,26,18,23],[6,24,2,26,1,28,2,30,5,28,12,30,16,32,18,30,15,30,12,28,9,25,7,27,6,24],[29,27,32,28,33,31,30,29,27,28,29,27],[5,35,1,33,3,36,13,38,15,35,10,36,5,35]],fill:1},grass:{width:27,height:22,lines:[[0,10.5,13,10.5],[2.5,10,1.5,7],[4.5,10,4.5,5,3.5,4],[7,10,7.5,6,8.5,3],[10,10,11,6]],repeat:[[0,0],[14,10]],stroke:1},swamp:{width:24,height:23,lines:[[0,10.5,9.5,10.5],[2.5,10,2.5,7],[4.5,10,4.5,4],[6.5,10,6.5,6],[3,12.5,7,12.5]],repeat:[[0,0],[14,10]],stroke:1},wave:{width:10,height:8,lines:[[0,0,5,4,10,0]],stroke:1},vine:{width:13,height:13,lines:[[3,0,3,6],[9,7,9,13]],stroke:1},forest:{width:55,height:30,circles:[[7,7,3.5],[20,20,1.5],[42,22,3.5],[35,5,1.5]],stroke:1},scrub:{width:26,height:20,lines:[[1,4,4,8,6,4]],circles:[[20,13,1.5]],stroke:1},tree:{width:30,height:30,lines:[[7.78,10.61,4.95,10.61,4.95,7.78,3.54,7.78,2.12,6.36,.71,6.36,0,4.24,.71,2.12,4.24,0,7.78,.71,9.19,3.54,7.78,4.95,7.07,7.07,4.95,7.78]],repeat:[[3,1],[18,16]],stroke:1},pine:{width:30,height:30,lines:[[5.66,11.31,2.83,11.31,2.83,8.49,0,8.49,2.83,0,5.66,8.49,2.83,8.49]],repeat:[[3,1],[18,16]],stroke:1},pines:{width:22,height:20,lines:[[1,4,3.5,1,6,4],[1,8,3.5,5,6,8],[3.5,1,3.5,11],[12,14.5,14.5,14,17,14.5],[12,18,17,18],[14.5,12,14.5,18]],repeat:[[2,1]],stroke:1},rock:{width:20,height:20,lines:[[1,0,1,9],[4,0,4,9],[7,0,7,9],[10,1,19,1],[10,4,19,4],[10,7,19,7],[0,11,9,11],[0,14,9,14],[0,17,9,17],[12,10,12,19],[15,10,15,19],[18,10,18,19]],repeat:[[.5,.5]],stroke:1},rocks:{width:20,height:20,lines:[[5,0,3,0,5,4,4,6,0,3,0,5,3,6,5,9,3.75,10,2.5,10,0,9,0,10,4,11,5,14,4,15,0,13,0,13,0,13,0,14,0,14,5,16,5,18,3,19,0,19,-.25,19.9375,5,20,10,19,10,20,11,20,12,19,14,20,15,20,17,19,20,20,20,19,19,16,20,15,20,11,20,10,19,8,20,5,20,0,19,0,20,2,19,4,17,4,16,3,15,0,14,0,15,4,11,5,10,4,11,0,10,0,9,4,6,5,5,0],[18,5,19,6,18,10,16,10,14,9,16,5,18,5],[5,6,9,5,10,6,10,9,6,10,5,6],[14,5,14,8,13,9,12,9,11,7,12,5,14,5],[5,11,8,10,9,11,10,14,6,15,6,15,5,11],[13,10,14,11,15,14,15,14,15,14,11,15,10,11,11,10,13,10],[15,12,16,11,19,11,19,15,16,14,16,14,15,12],[6,16,9,15,10,18,5,19,6,16],[10,16,14,16,14,18,13,19,11,18,10,16],[15,15,18,16,18,18,16,19,15,18,15,15]],stroke:1}},ol.style.FontSymbol=function(e){var t=0;(e=e||{}).stroke&&(t=e.stroke.getWidth()),ol.style.RegularShape.call(this,{radius:e.radius,fill:e.fill,rotation:e.rotation,rotateWithView:e.rotateWithView}),"number"==typeof e.opacity&&this.setOpacity(e.opacity),this.color_=e.color,this.fontSize_=e.fontSize||1,this.fontStyle_=e.fontStyle||"",this.stroke_=e.stroke,this.fill_=e.fill,this.radius_orig=e.radius,this.radius_=e.radius-t,this.form_=e.form||"none",this.gradient_=e.gradient,this.offset_=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this.glyph_=this.getGlyph(e.glyph)||"",this.renderMarker_()},ol.ext.inherits(ol.style.FontSymbol,ol.style.RegularShape),ol.style.Image.prototype.getImagePNG=function(){var e=this.getImage();if(!e)return!1;try{return e.toDataURL("image/png")}catch(e){return!1}},ol.style.FontSymbol.prototype.defs={fonts:{},glyphs:{}},ol.style.FontSymbol.addDefs=function(e,t){var a=e;if("string"==typeof e&&(a={font:e,name:e,copyright:""}),a.font&&"string"==typeof a.font){var i=a.font;for(var o in ol.style.FontSymbol.prototype.defs.fonts[i]=a,t){var n=t[o];"string"==typeof n&&1==n.length&&(n={char:n}),ol.style.FontSymbol.prototype.defs.glyphs[o]={font:a.font,char:n.char||""+String.fromCharCode(n.code)||"",theme:n.theme||a.name,name:n.name||o,search:n.search||""}}}else console.log("bad font def")},ol.style.FontSymbol.prototype.clone=function(){var e=new ol.style.FontSymbol({glyph:"",color:this.color_,fontSize:this.fontSize_,fontStyle:this.fontStyle_,stroke:this.stroke_,fill:this.fill_,radius:this.radius_orig||this.radius_+(this.stroke_?this.stroke_.getWidth():0),form:this.form_,gradient:this.gradient_,offsetX:this.offset_[0],offsetY:this.offset_[1],opacity:this.getOpacity(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()});return e.setScale(this.getScale()),e.glyph_=this.glyph_,e.renderMarker_(),e},ol.style.FontSymbol.prototype.getRadius=function(){return this.radius_orig||this.radius_+(this.stroke_?this.stroke_.getWidth():0)},ol.style.FontSymbol.prototype.getFill=function(){return this.fill_},ol.style.FontSymbol.prototype.getStroke=function(){return this.stroke_},ol.style.FontSymbol.prototype.getGlyph=function(e){return e?ol.style.FontSymbol.prototype.defs.glyphs[e]||{font:"none",char:e.charAt(0),theme:"none",name:"none",search:""}:this.glyph_},ol.style.FontSymbol.prototype.getGlyphName=function(){for(var e in ol.style.FontSymbol.prototype.defs.glyphs)if(ol.style.FontSymbol.prototype.defs.glyphs[e]===this.glyph_)return e;return""},ol.style.FontSymbol.prototype.getFontInfo=function(e){return ol.style.FontSymbol.prototype.defs.fonts[e.font]},ol.style.FontSymbol.prototype.renderMarker_=function(e){var t,a=0;this.stroke_&&(t=ol.color.asString(this.stroke_.getColor()),a=this.stroke_.getWidth());var i=this.getImage(),o={strokeStyle:t,strokeWidth:a,size:i.width},n=i.getContext("2d");n.clearRect(0,0,i.width,i.height),this.drawMarker_(o,n,0,0);var r=this.getAnchor();r[0]=i.width/2-this.offset_[0],r[1]=i.width/2-this.offset_[1]},ol.style.FontSymbol.prototype.drawPath_=function(e,t){var a=2*this.radius_+e.strokeWidth+1,i=e.strokeWidth/2,o=e.size/2,n={fac:1,posX:e.size/2,posY:e.size/2};switch(t.lineJoin="round",t.beginPath(),this.form_){case"none":n.fac=1;break;case"circle":case"ban":t.arc(o,o,a/2,0,2*Math.PI,!0);break;case"poi":t.arc(o,o-.4*this.radius_,.6*this.radius_,.15*Math.PI,.85*Math.PI,!0),t.lineTo(o-.89*.05*a,(.95+.45*.05)*a+i),t.arc(o,.95*a+i,.05*a,.85*Math.PI,.15*Math.PI,!0),n={fac:.45,posX:o,posY:o-.35*this.radius_};break;case"bubble":t.arc(o,o-.2*this.radius_,.8*this.radius_,.4*Math.PI,.6*Math.PI,!0),t.lineTo(.5*a+i,a+i),n={fac:.7,posX:o,posY:o-.2*this.radius_};break;case"marker":t.arc(o,o-.2*this.radius_,.8*this.radius_,.25*Math.PI,.75*Math.PI,!0),t.lineTo(.5*a+i,a+i),n={fac:.7,posX:o,posY:o-.2*this.radius_};break;case"coma":t.moveTo(o+.8*this.radius_,o-.2*this.radius_),t.quadraticCurveTo(.95*a+i,.75*a+i,.5*a+i,a+i),t.arc(o,o-.2*this.radius_,.8*this.radius_,.45*Math.PI,0,!1),n={fac:.7,posX:o,posY:o-.2*this.radius_};break;default:var r;switch(this.form_){case"shield":r=[.05,0,.95,0,.95,.8,.5,1,.05,.8,.05,0],n.posY=.45*a+i;break;case"blazon":r=[.1,0,.9,0,.9,.8,.6,.8,.5,1,.4,.8,.1,.8,.1,0],n.fac=.8,n.posY=.4*a+i;break;case"bookmark":r=[.05,0,.95,0,.95,1,.5,.8,.05,1,.05,0],n.fac=.9,n.posY=.4*a+i;break;case"hexagon":r=[.05,.2,.5,0,.95,.2,.95,.8,.5,1,.05,.8,.05,.2],n.fac=.9,n.posY=.5*a+i;break;case"diamond":r=[.25,0,.75,0,1,.2,1,.4,.5,1,0,.4,0,.2,.25,0],n.fac=.75,n.posY=.35*a+i;break;case"triangle":r=[0,0,1,0,.5,1,0,0],n.fac=.6,n.posY=.3*a+i;break;case"sign":r=[.5,.05,1,.95,0,.95,.5,.05],n.fac=.7,n.posY=.65*a+i;break;case"lozenge":r=[.5,0,1,.5,.5,1,0,.5,.5,0],n.fac=.7;break;case"square":default:r=[0,0,1,0,1,1,0,1,0,0]}for(var s=0;s<r.length;s+=2)t.lineTo(r[s]*a+i,r[s+1]*a+i)}return t.closePath(),n},ol.style.FontSymbol.prototype.drawMarker_=function(e,t,a,i){var o=this.fill_?this.fill_.getColor():"#000",n=this.stroke_?this.stroke_.getColor():"#000";"none"==this.form_&&this.stroke_&&this.fill_&&(n=this.fill_.getColor(),o=this.stroke_.getColor()),t.setTransform(1,0,0,1,0,0),t.translate(a,i);var r=this.drawPath_(e,t);if(this.fill_){if(this.gradient_&&"none"!=this.form_){var s=t.createLinearGradient(0,0,e.size/2,e.size);s.addColorStop(1,ol.color.asString(o)),s.addColorStop(0,ol.color.asString(n)),t.fillStyle=s}else t.fillStyle=ol.color.asString(o);t.fill()}if(this.stroke_&&e.strokeWidth&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,t.stroke()),this.glyph_.char){var l="";"Font Awesome 5 Free"==this.glyph_.font&&(l=900),t.font=this.fontStyle_+" "+l+" "+2*r.fac*this.radius_*this.fontSize_+'px "'+this.glyph_.font+'"',t.strokeStyle=t.fillStyle,t.lineWidth=e.strokeWidth*("none"==this.form_?2:1),t.fillStyle=ol.color.asString(this.color_||n),t.textAlign="center",t.textBaseline="middle";var c=this.glyph_.char;e.strokeWidth&&"transparent"!=n&&t.strokeText(c,r.posX,r.posY),t.fillText(c,r.posX,r.posY)}if("ban"==this.form_&&this.stroke_&&e.strokeWidth){t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth;var d=this.radius_+e.strokeWidth,p=this.radius_*Math.cos(Math.PI/4);t.moveTo(d+p,d-p),t.lineTo(d-p,d+p),t.stroke()}},ol.style.FontSymbol.prototype.getChecksum=function(){var e=null!==this.stroke_?this.stroke_.getChecksum():"-",t=null!==this.fill_?this.fill_.getChecksum():"-";if(null===this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.form_+"-"+this.glyphs_!=this.checksums_[4]){var a="c"+e+t+(void 0!==this.radius_?this.radius_.toString():"-")+this.form_+"-"+this.glyphs_;this.checksums_=[a,e,t,this.radius_,this.form_+"-"+this.glyphs_]}return this.checksums_[0]},ol.style.Photo=function(e){e=e||{},this.sanchor_="anchored"==e.kind?8:0,this.shadow_=Number(e.shadow)||0,e.stroke||(e.stroke=new ol.style.Stroke({width:0,color:"#000"}));var t=e.stroke.getWidth();if(t<0&&(t=0),"folio"==e.kind&&(t+=6),e.stroke.setWidth(t),ol.style.RegularShape.call(this,{radius:e.radius+t+this.sanchor_/2+this.shadow_/2,points:0}),!this.hitDetectionCanvas_){var a=this.getImage();for(var i in this)if(this[i]&&this[i].getContext&&this[i]!==a){this.hitDetectionCanvas_=this[i];break}}this.stroke_=e.stroke,this.fill_=e.fill,this.crop_=e.crop,this.crossOrigin_=e.crossOrigin,this.kind_=e.kind||"default",this.radius_=e.radius,this.src_=e.src,this.offset_=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this.onload_=e.onload,"number"==typeof e.opacity&&this.setOpacity(e.opacity),"number"==typeof e.rotation&&this.setRotation(e.rotation),this.renderPhoto_()},ol.ext.inherits(ol.style.Photo,ol.style.RegularShape),ol.style.Photo.prototype.clone=function(){return new ol.style.Photo({stroke:this.stroke_,fill:this.fill_,shadow:this.shadow_,crop:this.crop_,crossOrigin:this.crossOrigin_,kind:this.kind_,radius:this.radius_,src:this.src_,offsetX:this.offset_[0],offsetY:this.offset_[1],opacity:this.getOpacity(),rotation:this.getRotation()})},CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,i,o){return o?(a<2*o&&(o=a/2),i<2*o&&(o=i/2),this.beginPath(),this.moveTo(e+o,t),this.arcTo(e+a,t,e+a,t+i,o),this.arcTo(e+a,t+i,e,t+i,o),this.arcTo(e,t+i,e,t,o),this.arcTo(e,t,e+a,t,o),this.closePath()):this.rect(e,t,a,i),this},ol.style.Photo.prototype.drawBack_=function(e,t,a){var i=e.canvas;switch(e.beginPath(),e.fillStyle=t,e.clearRect(0,0,i.width,i.height),this.kind_){case"square":e.rect(0,0,i.width-this.shadow_,i.height-this.shadow_);break;case"circle":e.arc(this.radius_+a,this.radius_+a,this.radius_+a,0,2*Math.PI,!1);break;case"folio":offset=6,a-=offset,e.strokeStyle="rgba(0,0,0,0.5)";var o=i.width-this.shadow_-2*offset,n=Math.atan(6/o);e.save(),e.rotate(-n),e.translate(-6,2),e.beginPath(),e.rect(offset,offset,o,o),e.stroke(),e.fill(),e.restore(),e.save(),e.translate(6,-1),e.rotate(n),e.beginPath(),e.rect(offset,offset,o,o),e.stroke(),e.fill(),e.restore(),e.beginPath(),e.rect(offset,offset,o,o),e.stroke();break;case"anchored":e.roundRect(this.sanchor_/2,0,i.width-this.sanchor_-this.shadow_,i.height-this.sanchor_-this.shadow_,a),e.moveTo(i.width/2-this.sanchor_-this.shadow_/2,i.height-this.sanchor_-this.shadow_),e.lineTo(i.width/2+this.sanchor_-this.shadow_/2,i.height-this.sanchor_-this.shadow_),e.lineTo(i.width/2-this.shadow_/2,i.height-this.shadow_);break;default:e.roundRect(0,0,i.width-this.shadow_,i.height-this.shadow_,a)}e.closePath()},ol.style.Photo.prototype.renderPhoto_=function(){var e,t=0;this.stroke_&&(e=ol.color.asString(this.stroke_.getColor()),t=this.stroke_.getWidth());var a=this.getImage(),i=this.hitDetectionCanvas_.getContext("2d");this.drawBack_(i,"#000",t),i.fill();i=a.getContext("2d");this.drawBack_(i,e,t),this.shadow_&&(i.shadowColor="rgba(0,0,0,0.5)",i.shadowBlur=this.shadow_/2,i.shadowOffsetX=this.shadow_/2,i.shadowOffsetY=this.shadow_/2),i.fill(),i.shadowColor="transparent";var o=this,n=this.img_=new Image;this.crossOrigin_&&(n.crossOrigin=this.crossOrigin_),n.src=this.src_,n.width?o.drawImage_(n):n.onload=function(){o.drawImage_(n),o.onload_&&o.onload_()};var r=this.getAnchor();r[0]=(a.width-this.shadow_)/2,r[1]=(a.height-this.shadow_)/2,this.sanchor_&&(r[1]=a.height-this.shadow_)},ol.style.Photo.prototype.drawImage_=function(e){var t=this.getImage().getContext("2d"),a=0;this.stroke_&&(a=this.stroke_.getWidth());var i,o,n,r,s,l,c,d,p,u=2*this.radius_;t.save(),"circle"==this.kind_&&(t.beginPath(),t.arc(this.radius_+a,this.radius_+a,this.radius_,0,2*Math.PI,!1),t.clip()),this.crop_?(d=p=(i=Math.min(e.width/u,e.height/u))*u,l=(e.width-d)/2,c=(e.height-p)/2,o=n=0,r=s=u+1):(l=c=0,o=(u-(r=(i=Math.min(u/e.width,u/e.height))*(d=e.width)))/2,n=(u-(s=i*(p=e.height)))/2),o+=a+this.sanchor_/2,n+=a,t.drawImage(e,l,c,d,p,o,n,r,s),t.restore(),"circle"==this.kind_&&a&&(t.beginPath(),t.strokeStyle=ol.color.asString(this.stroke_.getColor()),t.lineWidth=a/4,t.arc(this.radius_+a,this.radius_+a,this.radius_,0,2*Math.PI,!1),t.stroke())},ol.style.Photo.prototype.getChecksum=function(){var e=null!==this.stroke_?this.stroke_.getChecksum():"-",t=null!==this.fill_?this.fill_.getChecksum():"-";if(null===this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]){var a="c"+e+t+(void 0!==this.radius_?this.radius_.toString():"-");this.checksums_=[a,e,t,this.radius_]}return this.checksums_[0]},ol.layer.Vector.prototype.setTextPathStyle=function(e,t){if(null===e)return this.textPath_&&this.unByKey(this.textPath_),this.textPath_=null,void this.changed();this.textPath_||(this.textPath_=this.on("postcompose",function(e){if(!(e.frameState.viewState.resolution>this.textPathMaxResolution_)){var t=e.frameState.extent,n=e.frameState.coordinateToPixelTransform,a=e.context;a.save(),a.scale(e.frameState.pixelRatio,e.frameState.pixelRatio);for(var i,o=this.getSource().getFeaturesInExtent(t),r=0;i=o[r];r++)for(var s,l=this.textPathStyle_(i,e.frameState.viewState.resolution),c=0;s=l[c];c++){var d,p=s.getGeometry()||i.getGeometry();switch(p.getType()){case"LineString":d=p.getCoordinates();break;case"MultiLineString":d=p.getLineString(0).getCoordinates();break;default:continue}var u=s.getText(),h=f(d,u.getRotateWithView());a.font=u.getFont(),a.textBaseline=u.getTextBaseline(),a.textAlign=u.getTextAlign(),a.lineWidth=u.getStroke()&&u.getStroke().getWidth()||0,a.strokeStyle=u.getStroke()&&u.getStroke().getColor()||"#fff",a.fillStyle=u.getFill()&&u.getFill().getColor()||"#000",a.textJustify="justify"==u.getTextAlign(),a.textOverflow=u.getTextOverflow?u.getTextOverflow():"",a.minWidth=u.getMinWidth?u.getMinWidth():0,a.textPath(u.getText()||i.get("name"),h)}a.restore()}function f(e,t){for(var a=[],i=0;i<e.length;i++)a.push(n[0]*e[i][0]+n[1]*e[i][1]+n[4]),a.push(n[2]*e[i][0]+n[3]*e[i][1]+n[5]);if(t&&a[0]>a[a.length-2]){var o=[];for(i=a.length-2;0<=i;i-=2)o.push(a[i]),o.push(a[i+1]);return o}return a}}.bind(this))),void 0===e&&(e=[new ol.style.Style({text:new ol.style.Text})]),this.textPathStyle_="function"==typeof e?e:function(){return e},this.textPathMaxResolution_=Number(t)||Number.MAX_VALUE,this.changed()},ol.style.TextPath=function(e){e||(e={}),ol.style.Text.call(this,e),this.textOverflow_=void 0!==e.textOverflow?e.textOverflow:"visible",this.minWidth_=e.minWidth||0},ol.ext.inherits(ol.style.TextPath,ol.style.Text),ol.style.TextPath.prototype.getTextOverflow=function(){return this.textOverflow_},ol.style.TextPath.prototype.getMinWidth=function(){return this.minWidth_},CanvasRenderingContext2D.prototype.textPath=function(e,t){var a=this;function r(e,t,a,i){var o=a-e,n=i-t;return Math.sqrt(o*o+n*n)}var s,l=0,c=2;function i(e,t){if(!s||l+s<t)for(;c<e.length&&(s=r(e[c-2],e[c-1],e[c],e[c+1]),!(t<l+s))&&!((c+=2)>=e.length);)l+=s;var a,i,o,n=t-l;return c>=e.length&&(c=e.length-2),o=(i=n?(a=e[c-2]+(e[c]-e[c-2])*n/s,e[c-1]+(e[c+1]-e[c-1])*n/s):(a=e[c-2],e[c-1]),Math.atan2(e[c+1]-e[c-1],e[c]-e[c-2])),[a,i,o]}for(var o=.25*a.measureText(" ").width,n=0,d=0,p=2;p<t.length;p+=2)d+=r(t[p-2],t[p-1],t[p],t[p+1]);if(!(d<a.minWidth)){var u=e.split(" ").length-1;if("visible"!=a.textOverflow&&d<a.measureText(e).width+(e.length-1+u)*o){for(var h="ellipsis"==a.textOverflow?"…":a.textOverflow;u=e.split(" ").length-1,(e=e.slice(0,e.length-1))&&d<a.measureText(e+h).width+(e.length+h.length-1+u)*o;);e+=h}switch(a.textJustify||a.textAlign){case!0:case"center":case"end":case"right":a.textJustify?(n=0,o=(d-a.measureText(e).width)/(e.length-1+u)):(n=d-a.measureText(e).width-(e.length+u)*o,"center"==a.textAlign&&(n/=2))}for(var f=0;f<e.length;f++){var m=e[f],g=a.measureText(m).width,y=i(t,n+g/2);a.save(),a.textAlign="center",a.translate(y[0],y[1]),a.rotate(y[2]),a.lineWidth&&a.strokeText(m,0,0),a.fillText(m,0,0),a.restore(),n+=g+o*(" "==m?2:1)}}},ol.style.Shadow=function(e){(e=e||{}).fill||(e.fill=new ol.style.Fill({color:"rgba(0,0,0,0.5)"})),ol.style.RegularShape.call(this,{radius:e.radius,fill:e.fill}),this.fill_=e.fill,this.radius_=e.radius,this.blur_=0===e.blur?0:e.blur||e.radius/3,this.offset_=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this.renderShadow_()},ol.ext.inherits(ol.style.Shadow,ol.style.RegularShape),ol.style.Shadow.prototype.clone=function(){var e=new ol.style.Shadow({fill:this.fill_,radius:this.radius_,blur:this.blur_,offsetX:this.offset_[0],offsetY:this.offset_[1]});return e.setScale(this.getScale()),e.setOpacity(this.getOpacity()),e},ol.style.Shadow.prototype.renderShadow_=function(){var e=this.radius_,t=this.getImage();[t.width,t.height][1]=e;var a=t.getContext("2d");a.beginPath(),a.clearRect(0,0,t.width,t.height),a.scale(1,.5),a.arc(e,-e,e-this.blur_,0,2*Math.PI,!1),a.fillStyle="#000",a.shadowColor=this.fill_.getColor(),a.shadowBlur=.7*this.blur_,a.shadowOffsetX=0,a.shadowOffsetY=1.5*e,a.closePath(),a.fill(),a.shadowColor="transparent";var i=this.getAnchor();i[0]=t.width/2-this.offset_[0],i[1]=t.height/2-this.offset_[1]},ol.style.Shadow.prototype.getChecksum=function(){var e=null!==this.stroke_?this.stroke_.getChecksum():"-",t=null!==this.fill_?this.fill_.getChecksum():"-";if(null===this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.form_+"-"+this.glyphs_!=this.checksums_[4]){var a="c"+e+t+(void 0!==this.radius_?this.radius_.toString():"-")+this.form_+"-"+this.glyphs_;this.checksums_=[a,e,t,this.radius_,this.form_+"-"+this.glyphs_]}return this.checksums_[0]},ol.style.StrokePattern=function(e){var t;e||(e={});var a=this.canvas_=document.createElement("canvas"),i=(0<Number(e.scale)?Number(e.scale):1)*ol.has.DEVICE_PIXEL_RATIO||ol.has.DEVICE_PIXEL_RATIO,o=a.getContext("2d");if(e.image){e.image.load();var n=e.image.getImage();if(n.width)a.width=Math.round(n.width*i),a.height=Math.round(n.height*i),o.globalAlpha="number"==typeof e.opacity?e.opacity:1,o.drawImage(n,0,0,n.width,n.height,0,0,a.width,a.height),t=o.createPattern(a,"repeat");else{var r=this;t=[0,0,0,0],n.onload=function(){a.width=Math.round(n.width*i),a.height=Math.round(n.height*i),o.globalAlpha="number"==typeof e.opacity?e.opacity:1,o.drawImage(n,0,0,n.width,n.height,0,0,a.width,a.height),t=o.createPattern(a,"repeat"),r.setColor(t)}}}else{var s=this.getPattern_(e);if(a.width=Math.round(s.width*i),a.height=Math.round(s.height*i),o.beginPath(),e.fill&&(o.fillStyle=ol.color.asString(e.fill.getColor()),o.fillRect(0,0,a.width,a.height)),o.scale(i,i),o.lineCap="round",o.lineWidth=s.stroke||1,o.fillStyle=ol.color.asString(e.color||"#000"),o.strokeStyle=ol.color.asString(e.color||"#000"),s.circles)for(var l=0;l<s.circles.length;l++){var c=s.circles[l];o.beginPath(),o.arc(c[0],c[1],c[2],0,2*Math.PI),s.fill&&o.fill(),s.stroke&&o.stroke()}if(s.repeat||(s.repeat=[[0,0]]),s.char&&(o.font=s.font||s.width+"px Arial",o.textAlign="center",o.textBaseline="middle",s.angle?(o.fillText(s.char,s.width/4,s.height/4),o.fillText(s.char,5*s.width/4,5*s.height/4),o.fillText(s.char,s.width/4,5*s.height/4),o.fillText(s.char,5*s.width/4,s.height/4),o.fillText(s.char,3*s.width/4,3*s.height/4),o.fillText(s.char,-s.width/4,-s.height/4),o.fillText(s.char,3*s.width/4,-s.height/4),o.fillText(s.char,-s.width/4,3*s.height/4)):o.fillText(s.char,s.width/2,s.height/2)),s.lines)for(l=0;l<s.lines.length;l++)for(var d=0;d<s.repeat.length;d++){var p=s.lines[l];o.beginPath(),o.moveTo(p[0]+s.repeat[d][0],p[1]+s.repeat[d][1]);for(var u=2;u<p.length;u+=2)o.lineTo(p[u]+s.repeat[d][0],p[u+1]+s.repeat[d][1]);s.fill&&o.fill(),s.stroke&&o.stroke(),o.save(),o.strokeStyle="red",o.strokeWidth=.1,o.restore()}if(t=o.createPattern(a,"repeat"),e.offset){var h=e.offset;if("number"==typeof h&&(h=[h,h]),h instanceof Array){var f=Math.round(h[0]*i),m=Math.round(h[1]*i);o.scale(1/i,1/i),o.clearRect(0,0,a.width,a.height),o.translate(f,m),o.fillStyle=t,o.fillRect(-f,-m,a.width,a.height),t=o.createPattern(a,"repeat")}}}e.color=t,ol.style.Stroke.call(this,e)},ol.ext.inherits(ol.style.StrokePattern,ol.style.Stroke),ol.style.StrokePattern.prototype.clone=function(){var e=ol.style.Fill.prototype.clone.call(this);return e.canvas_=this.canvas_,e},ol.style.StrokePattern.prototype.getImage=function(){return this.canvas_},ol.style.StrokePattern.prototype.getPattern_=function(e){var t=ol.style.FillPattern.prototype.patterns[e.pattern]||ol.style.FillPattern.prototype.patterns.dot,a=Math.round(e.spacing)||10;Math.round(a/2);switch(e.pattern){case"dot":case"circle":var i=0===e.size?0:e.size/2||2;e.angle?(a=t.width=t.height=Math.round(1.4*a),t.circles=[[a/4,a/4,i],[3*a/4,3*a/4,i]],"circle"==e.pattern&&(t.circles=t.circles.concat([[a/4+a,a/4,i],[a/4,a/4+a,i],[3*a/4-a,3*a/4,i],[3*a/4,3*a/4-a,i],[a/4+a,a/4+a,i],[3*a/4-a,3*a/4-a,i]]))):(t.width=t.height=a,t.circles=[[a/2,a/2,i]],"circle"==e.pattern&&(t.circles=t.circles.concat([[a/2+a,a/2,i],[a/2-a,a/2,i],[a/2,a/2+a,i],[a/2,a/2-a,i],[a/2+a,a/2+a,i],[a/2+a,a/2-a,i],[a/2-a,a/2+a,i],[a/2-a,a/2-a,i]])));break;case"tile":case"square":i=0===e.size?0:e.size/2||2;e.angle?(t.width=t.height=a,t.lines=[[a/2-i,a/2,a/2,a/2-i,a/2+i,a/2,a/2,a/2+i,a/2-i,a/2]]):(t.width=t.height=a,t.lines=[[a/2-i,a/2-i,a/2+i,a/2-i,a/2+i,a/2+i,a/2-i,a/2+i,a/2-i,a/2-i]]),"square"==e.pattern&&(t.repeat=[[0,0],[0,a],[a,0],[0,-a],[-a,0],[-a,-a],[a,a],[-a,a],[a,-a]]);break;case"cross":e.angle&&(e.angle=45);case"hatch":var o=Math.round(((e.angle||0)-90)%360);180<o&&(o-=360),o*=Math.PI/180;var n=Math.cos(o),r=Math.sin(o);if(Math.abs(r)<1e-4)t.width=t.height=a,t.lines=[[0,.5,a,.5]],t.repeat=[[0,0],[0,a]];else if(Math.abs(n)<1e-4)t.width=t.height=a,t.lines=[[.5,0,.5,a]],t.repeat=[[0,0],[a,0]],"cross"==e.pattern&&(t.lines.push([0,.5,a,.5]),t.repeat.push([0,a]));else{var s=t.width=Math.round(Math.abs(a/r))||1,l=t.height=Math.round(Math.abs(a/n))||1;"cross"==e.pattern?(t.lines=[[-s,-l,2*s,2*l],[2*s,-l,-s,2*l]],t.repeat=[[0,0]]):t.repeat=0<n*r?(t.lines=[[-s,-l,2*s,2*l]],[[0,0],[s,0],[0,l]]):(t.lines=[[2*s,-l,-s,2*l]],[[0,0],[-s,0],[0,l]])}t.stroke=0===e.size?0:e.size||4}return t},ol.style.FontSymbol.addDefs({font:"fontmaki",name:"Maki",copyright:"CC0 - MapBox - https://www.mapbox.com/maki/",prefix:"maki"},{"maki-bicycle":{font:"fontmaki",code:59392,name:"bicycle",search:"bicycle"},"maki-building":{font:"fontmaki",code:59393,name:"building",search:"building"},"maki-bus":{font:"fontmaki",code:59394,name:"bus",search:"bus"},"maki-cafe":{font:"fontmaki",code:59395,name:"cafe",search:"cafe"},"maki-camera":{font:"fontmaki",code:59396,name:"camera",search:"camera"},"maki-campsite":{font:"fontmaki",code:59397,name:"campsite",search:"campsite"},"maki-car":{font:"fontmaki",code:59398,name:"car",search:"car"},"maki-cemetery":{font:"fontmaki",code:59399,name:"cemetery",search:"cemetery"},"maki-chemist":{font:"fontmaki",code:59400,name:"chemist",search:"chemist"},"maki-cinema":{font:"fontmaki",code:59401,name:"cinema",search:"cinema"},"maki-circle":{font:"fontmaki",code:59402,name:"circle",search:"circle"},"maki-circle_stroked":{font:"fontmaki",code:59403,name:"circle_stroked",search:"circle_stroked"},"maki-city":{font:"fontmaki",code:59404,name:"city",search:"city"},"maki-clothing_store":{font:"fontmaki",code:59405,name:"clothing_store",search:"clothing_store"},"maki-college":{font:"fontmaki",code:59406,name:"college",search:"college"},"maki-commercial":{font:"fontmaki",code:59407,name:"commercial",search:"commercial"},"maki-cricket":{font:"fontmaki",code:59408,name:"cricket",search:"cricket"},"maki-cross":{font:"fontmaki",code:59409,name:"cross",search:"cross"},"maki-dam":{font:"fontmaki",code:59410,name:"dam",search:"dam"},"maki-danger":{font:"fontmaki",code:59411,name:"danger",search:"danger"},"maki-dentist":{font:"fontmaki",code:59412,name:"dentist",search:"dentist"},"maki-disability":{font:"fontmaki",code:59413,name:"disability",search:"disability"},"maki-dog_park":{font:"fontmaki",code:59414,name:"dog_park",search:"dog_park"},"maki-embassy":{font:"fontmaki",code:59415,name:"embassy",search:"embassy"},"maki-emergency_telephone":{font:"fontmaki",code:59416,name:"emergency_telephone",search:"emergency_telephone"},"maki-entrance":{font:"fontmaki",code:59417,name:"entrance",search:"entrance"},"maki-farm":{font:"fontmaki",code:59418,name:"farm",search:"farm"},"maki-fast_food":{font:"fontmaki",code:59419,name:"fast_food",search:"fast_food"},"maki-ferry":{font:"fontmaki",code:59420,name:"ferry",search:"ferry"},"maki-fire_station":{font:"fontmaki",code:59421,name:"fire_station",search:"fire_station"},"maki-fuel":{font:"fontmaki",code:59422,name:"fuel",search:"fuel"},"maki-garden":{font:"fontmaki",code:59423,name:"garden",search:"garden"},"maki-gift":{font:"fontmaki",code:59424,name:"gift",search:"gift"},"maki-golf":{font:"fontmaki",code:59425,name:"golf",search:"golf"},"maki-grocery":{font:"fontmaki",code:59426,name:"grocery",search:"grocery"},"maki-hairdresser":{font:"fontmaki",code:59427,name:"hairdresser",search:"hairdresser"},"maki-harbor":{font:"fontmaki",code:59428,name:"harbor",search:"harbor"},"maki-heart":{font:"fontmaki",code:59429,name:"heart",search:"heart"},"maki-heliport":{font:"fontmaki",code:59430,name:"heliport",search:"heliport"},"maki-hospital":{font:"fontmaki",code:59431,name:"hospital",search:"hospital"},"maki-ice_cream":{font:"fontmaki",code:59432,name:"ice_cream",search:"ice_cream"},"maki-industrial":{font:"fontmaki",code:59433,name:"industrial",search:"industrial"},"maki-land_use":{font:"fontmaki",code:59434,name:"land_use",search:"land_use"},"maki-laundry":{font:"fontmaki",code:59435,name:"laundry",search:"laundry"},"maki-library":{font:"fontmaki",code:59436,name:"library",search:"library"},"maki-lighthouse":{font:"fontmaki",code:59437,name:"lighthouse",search:"lighthouse"},"maki-lodging":{font:"fontmaki",code:59438,name:"lodging",search:"lodging"},"maki-logging":{font:"fontmaki",code:59439,name:"logging",search:"logging"},"maki-london_underground":{font:"fontmaki",code:59440,name:"london_underground",search:"london_underground"},"maki-marker":{font:"fontmaki",code:59441,name:"marker",search:"marker"},"maki-minefield":{font:"fontmaki",code:59442,name:"minefield",search:"minefield"},"maki-marker_stroked":{font:"fontmaki",code:59443,name:"marker_stroked",search:"marker_stroked"},"maki-mobilephone":{font:"fontmaki",code:59444,name:"mobilephone",search:"mobilephone"},"maki-monument":{font:"fontmaki",code:59445,name:"monument",search:"monument"},"maki-museum":{font:"fontmaki",code:59446,name:"museum",search:"museum"},"maki-music":{font:"fontmaki",code:59447,name:"music",search:"music"},"maki-oil_well":{font:"fontmaki",code:59448,name:"oil_well",search:"oil_well"},"maki-park":{font:"fontmaki",code:59449,name:"park",search:"park"},"maki-park2":{font:"fontmaki",code:59450,name:"park2",search:"park2"},"maki-parking":{font:"fontmaki",code:59451,name:"parking",search:"parking"},"maki-parking_garage":{font:"fontmaki",code:59452,name:"parking_garage",search:"parking_garage"},"maki-pharmacy":{font:"fontmaki",code:59453,name:"pharmacy",search:"pharmacy"},"maki-pitch":{font:"fontmaki",code:59454,name:"pitch",search:"pitch"},"maki-playground":{font:"fontmaki",code:59455,name:"playground",search:"playground"},"maki-police":{font:"fontmaki",code:59456,name:"police",search:"police"},"maki-polling_place":{font:"fontmaki",code:59457,name:"polling_place",search:"polling_place"},"maki-post":{font:"fontmaki",code:59458,name:"post",search:"post"},"maki-prison":{font:"fontmaki",code:59459,name:"prison",search:"prison"},"maki-rail":{font:"fontmaki",code:59460,name:"rail",search:"rail"},"maki-rail_above":{font:"fontmaki",code:59461,name:"rail_above",search:"rail_above"},"maki-rail_light":{font:"fontmaki",code:59462,name:"rail_light",search:"rail_light"},"maki-rail_metro":{font:"fontmaki",code:59463,name:"rail_metro",search:"rail_metro"},"maki-rail_underground":{font:"fontmaki",code:59464,name:"rail_underground",search:"rail_underground"},"maki-religious-christian":{font:"fontmaki",code:59465,theme:"religious",name:"christian",search:"religious,christian"},"maki-religious-jewish":{font:"fontmaki",code:59466,theme:"religious",name:"jewish",search:"religious,jewish"},"maki-religious-muslim":{font:"fontmaki",code:59467,theme:"religious",name:"muslim",search:"religious,muslim"},"maki-religious-place_of_worship":{font:"fontmaki",code:59468,theme:"religious",name:"place_of_worship",search:"religious,place_of_worship"},"maki-restaurant":{font:"fontmaki",code:59469,name:"restaurant",search:"restaurant"},"maki-roadblock":{font:"fontmaki",code:59470,name:"roadblock",search:"roadblock"},"maki-rocket":{font:"fontmaki",code:59471,name:"rocket",search:"rocket"},"maki-school":{font:"fontmaki",code:59472,name:"school",search:"school"},"maki-scooter":{font:"fontmaki",code:59473,name:"scooter",search:"scooter"},"maki-shop":{font:"fontmaki",code:59474,name:"shop",search:"shop"},"maki-skiing":{font:"fontmaki",code:59475,name:"skiing",search:"skiing"},"maki-slaughterhouse":{font:"fontmaki",code:59476,name:"slaughterhouse",search:"slaughterhouse"},"maki-soccer":{font:"fontmaki",code:59477,name:"soccer",search:"soccer"},"maki-square":{font:"fontmaki",code:59478,name:"square",search:"square"},"maki-square_stroked":{font:"fontmaki",code:59479,name:"square_stroked",search:"square_stroked"},"maki-star":{font:"fontmaki",code:59480,name:"star",search:"star"},"maki-star_stroked":{font:"fontmaki",code:59481,name:"star_stroked",search:"star_stroked"},"maki-suitcase":{font:"fontmaki",code:59482,name:"suitcase",search:"suitcase"},"maki-swimming":{font:"fontmaki",code:59483,name:"swimming",search:"swimming"},"maki-telephone":{font:"fontmaki",code:59484,name:"telephone",search:"telephone"},"maki-tennis":{font:"fontmaki",code:59485,name:"tennis",search:"tennis"},"maki-theatre":{font:"fontmaki",code:59486,name:"theatre",search:"theatre"},"maki-toilets":{font:"fontmaki",code:59487,name:"toilets",search:"toilets"},"maki-town":{font:"fontmaki",code:59488,name:"town",search:"town"},"maki-town_hall":{font:"fontmaki",code:59489,name:"town_hall",search:"town_hall"},"maki-triangle":{font:"fontmaki",code:59490,name:"triangle",search:"triangle"},"maki-triangle_stroked":{font:"fontmaki",code:59491,name:"triangle_stroked",search:"triangle_stroked"},"maki-village":{font:"fontmaki",code:59492,name:"village",search:"village"},"maki-warehouse":{font:"fontmaki",code:59493,name:"warehouse",search:"warehouse"},"maki-waste_basket":{font:"fontmaki",code:59494,name:"waste_basket",search:"waste_basket"},"maki-water":{font:"fontmaki",code:59495,name:"water",search:"water"},"maki-wetland":{font:"fontmaki",code:59496,name:"wetland",search:"wetland"},"maki-zoo":{font:"fontmaki",code:59497,name:"zoo",search:"zoo"},"maki-aerialway":{font:"fontmaki",code:59498,name:"aerialway",search:"aerialway"},"maki-airfield":{font:"fontmaki",code:59499,name:"airfield",search:"airfield"},"maki-airport":{font:"fontmaki",code:59500,name:"airport",search:"airport"},"maki-alcohol_shop":{font:"fontmaki",code:59501,name:"alcohol_shop",search:"alcohol_shop"},"maki-america_football":{font:"fontmaki",code:59502,name:"america_football",search:"america_football"},"maki-art_gallery":{font:"fontmaki",code:59503,name:"art_gallery",search:"art_gallery"},"maki-bakery":{font:"fontmaki",code:59504,name:"bakery",search:"bakery"},"maki-bank":{font:"fontmaki",code:59505,name:"bank",search:"bank"},"maki-bar":{font:"fontmaki",code:59506,name:"bar",search:"bar"},"maki-baseball":{font:"fontmaki",code:59507,name:"baseball",search:"baseball"},"maki-basketball":{font:"fontmaki",code:59508,name:"basketball",search:"basketball"},"maki-beer":{font:"fontmaki",code:59509,name:"beer",search:"beer"}}),ol.style.FontSymbol.addDefs({font:"fontmaki2",name:"Maki2",copyright:"CC0 - MapBox - https://www.mapbox.com/maki/",prefix:"maki2"},{"maki2-aerialway":{font:"fontmaki2",code:59392,name:"aerialway",search:"telepherique,ski,neige",theme:"transport"},"maki2-airfield":{font:"fontmaki2",code:59393,name:"airfield",search:"aerodrome,avion",theme:"transport"},"maki2-airport":{font:"fontmaki2",code:59394,name:"airport",search:"aeroport,avion",theme:"transport"},"maki2-alcohol-shop":{font:"fontmaki2",code:59395,theme:"commerce",name:"shop",search:"boisson,alcool,vin,verre"},"maki2-america-football":{font:"fontmaki2",code:59396,theme:"sport",name:"football",search:"fooball,rugby"},"maki2-amusement-park":{font:"fontmaki2",code:59397,theme:"loisir",name:"park",search:"pac,roue,attraction"},"maki2-aquarium":{font:"fontmaki2",code:59398,name:"aquarium",search:"aquarium,poison,mer,animal",theme:"loisir"},"maki2-art-gallery":{font:"fontmaki2",code:59399,theme:"loisir",name:"gallery",search:"art,gallerie,peinture"},"maki2-attraction":{font:"fontmaki2",code:59400,name:"attraction",search:"photo,attraction,camera",theme:"tourisme"},"maki2-bakery":{font:"fontmaki2",code:59401,name:"bakery",search:"boulangerie,croissant",theme:"commerce"},"maki2-bank":{font:"fontmaki2",code:59402,name:"bank",search:"banque,carte,paiment",theme:"service"},"maki2-bar":{font:"fontmaki2",code:59403,name:"bar",search:"bar,coupe,verre,boisson",theme:"commerce"},"maki2-barrier":{font:"fontmaki2",code:59404,name:"barrier",search:"barriere,travaux",theme:"service"},"maki2-baseball":{font:"fontmaki2",code:59405,name:"baseball",search:"baseball",theme:"sport"},"maki2-basketball":{font:"fontmaki2",code:59406,name:"basketball",search:"basketball,ballon",theme:"sport"},"maki2-bbq":{font:"fontmaki2",code:59407,name:"bbq",search:"bbq,barbecue,camping",theme:"loisir"},"maki2-beer":{font:"fontmaki2",code:59408,name:"beer",search:"biere,boisson,cafe",theme:"commerce"},"maki2-bicycle":{font:"fontmaki2",code:59409,name:"bicycle",search:"velo,cycle,bicyclette",theme:"transport"},"maki2-bicycle-share":{font:"fontmaki2",code:59410,theme:"transport",name:"share",search:"velo,cycle,bicyclette"},"maki2-blood-bank":{font:"fontmaki2",code:59411,theme:"service",name:"bank",search:"santé,sang,don"},"maki2-buddhism":{font:"fontmaki2",code:59412,name:"buddhism",search:"bouddhisme",theme:"religion"},"maki2-building":{font:"fontmaki2",code:59413,name:"building",search:"maison,batiment",theme:"construction"},"maki2-building-alt1":{font:"fontmaki2",code:59414,theme:"construction",name:"alt1",search:"building,tour,immeuble"},"maki2-bus":{font:"fontmaki2",code:59415,name:"bus",search:"bus",theme:"transport"},"maki2-cafe":{font:"fontmaki2",code:59416,name:"cafe",search:"cafe,bar",theme:"commerce"},"maki2-campsite":{font:"fontmaki2",code:59417,name:"campsite",search:"camping,tente",theme:"tourisme"},"maki2-car":{font:"fontmaki2",code:59418,name:"car",search:"voiture",theme:"transport"},"maki2-car-rental":{font:"fontmaki2",code:59419,theme:"service",name:"rental",search:"voiture,location,parking"},"maki2-car-repair":{font:"fontmaki2",code:59420,theme:"service",name:"repair",search:"voiture,reparation,mecanique"},"maki2-casino":{font:"fontmaki2",code:59421,name:"casino",search:"casino,carte,pique",theme:"loisir"},"maki2-castle":{font:"fontmaki2",code:59422,name:"castle",search:"chateau,tour",theme:"loisir"},"maki2-cemetery":{font:"fontmaki2",code:59423,name:"cemetery",search:"cimetiere,tombe",theme:"religion"},"maki2-charging-station":{font:"fontmaki2",code:59424,theme:"transport",name:"station",search:"voiture,chargement,electrique,station"},"maki2-cinema":{font:"fontmaki2",code:59425,name:"cinema",search:"cinema,film",theme:"tourisme"},"maki2-circle":{font:"fontmaki2",code:59426,name:"circle",search:"cercle",theme:"forme"},"maki2-circle-stroked":{font:"fontmaki2",code:59427,theme:"forme",name:"stroked",search:"cercle,rond"},"maki2-city":{font:"fontmaki2",code:59428,name:"city",search:"ville,batiment,hlm",theme:"construction"},"maki2-clothing-store":{font:"fontmaki2",code:59429,theme:"commerce",name:"store",search:"vetement,magasin"},"maki2-college":{font:"fontmaki2",code:59430,name:"college",search:"college,universite",theme:"education"},"maki2-commercial":{font:"fontmaki2",code:59431,name:"commercial",search:"commercial,tour",theme:"construction"},"maki2-cricket":{font:"fontmaki2",code:59432,name:"cricket",search:"cricket",theme:"sport"},"maki2-cross":{font:"fontmaki2",code:59433,name:"cross",search:"croix",theme:"forme"},"maki2-dam":{font:"fontmaki2",code:59434,name:"dam",search:"barrage,eau",theme:"industrie"},"maki2-danger":{font:"fontmaki2",code:59435,name:"danger",search:"danger,mort,tete",theme:"panneau"},"maki2-defibrillator":{font:"fontmaki2",code:59436,name:"defibrillator",search:"defibrillateur,medecin,sante",theme:"service"},"maki2-dentist":{font:"fontmaki2",code:59437,name:"dentist",search:"dentiste,sante",theme:"service"},"maki2-doctor":{font:"fontmaki2",code:59438,name:"doctor",search:"docteur,medecin,stetoscope",theme:"service"},"maki2-dog-park":{font:"fontmaki2",code:59439,theme:"service",name:"park",search:"chien,parc"},"maki2-drinking-water":{font:"fontmaki2",code:59440,theme:"service",name:"water",search:"eau,ba,boison,robinet"},"maki2-embassy":{font:"fontmaki2",code:59441,name:"embassy",search:"ambassade",theme:"service"},"maki2-emergency-phone":{font:"fontmaki2",code:59442,theme:"service",name:"phone",search:"urgence,sante,telephone"},"maki2-entrance":{font:"fontmaki2",code:59443,name:"entrance",search:"entree",theme:"construction"},"maki2-entrance-alt1":{font:"fontmaki2",code:59444,theme:"service",name:"alt1",search:"sortie,secours"},"maki2-farm":{font:"fontmaki2",code:59445,name:"farm",search:"ferme,batiment",theme:"construction"},"maki2-fast-food":{font:"fontmaki2",code:59446,theme:"commerce",name:"food",search:"fast food,retaurant,hamburger"},"maki2-fence":{font:"fontmaki2",code:59447,name:"fence",search:"herse,barriere",theme:"panneau"},"maki2-ferry":{font:"fontmaki2",code:59448,name:"ferry",search:"ferry,bac,bateau",theme:"transport"},"maki2-fire-station":{font:"fontmaki2",code:59449,theme:"service",name:"station",search:"pompier,feu,station"},"maki2-florist":{font:"fontmaki2",code:59450,name:"florist",search:"fleur,fleuriste,nature",theme:"commerce"},"maki2-fuel":{font:"fontmaki2",code:59451,name:"fuel",search:"pompe,essence",theme:"commerce"},"maki2-furniture":{font:"fontmaki2",code:59452,name:"furniture",search:"meuble,lampe,magazin",theme:"commerce"},"maki2-gaming":{font:"fontmaki2",code:59453,name:"gaming",search:"gaming,jeu,manette,console",theme:"commerce"},"maki2-garden":{font:"fontmaki2",code:59454,name:"garden",search:"jardin,fleur",theme:"loisir"},"maki2-garden-center":{font:"fontmaki2",code:59455,theme:"loisir",name:"center",search:"jardin,arrosoir,fleur"},"maki2-gift":{font:"fontmaki2",code:59456,name:"gift",search:"cadeau,achat",theme:"commerce"},"maki2-globe":{font:"fontmaki2",code:59457,name:"globe",search:"globe,terre",theme:"divers"},"maki2-golf":{font:"fontmaki2",code:59458,name:"golf",search:"golf",theme:"sport"},"maki2-grocery":{font:"fontmaki2",code:59459,name:"grocery",search:"caddy,super,marche",theme:"commerce"},"maki2-hairdresser":{font:"fontmaki2",code:59460,name:"hairdresser",search:"coiffeur",theme:"commerce"},"maki2-harbor":{font:"fontmaki2",code:59461,name:"harbor",search:"port,bateau,ancre",theme:"transport"},"maki2-hardware":{font:"fontmaki2",code:59462,name:"hardware",search:"mecanicien,outil",theme:"service"},"maki2-heart":{font:"fontmaki2",code:59463,name:"heart",search:"coeur,amour",theme:"forme"},"maki2-heliport":{font:"fontmaki2",code:59464,name:"heliport",search:"heliport,helicoptere",theme:"transport"},"maki2-home":{font:"fontmaki2",code:59465,name:"home",search:"maison,bati",theme:"construction"},"maki2-horse-riding":{font:"fontmaki2",code:59466,theme:"sport",name:"riding",search:"animal,cavalier,cheval"},"maki2-hospital":{font:"fontmaki2",code:59467,name:"hospital",search:"hopital,croix",theme:"service"},"maki2-ice-cream":{font:"fontmaki2",code:59468,theme:"loisir",name:"cream",search:"glace,cornet,enfant"},"maki2-industry":{font:"fontmaki2",code:59469,name:"industry",search:"industrie,usine,cheminee",theme:"industrie"},"maki2-information":{font:"fontmaki2",code:59470,name:"information",search:"information,i",theme:"tourisme"},"maki2-jewelry":{font:"fontmaki2",code:59471,name:"jewelry",search:"bijoutier,bague,or",theme:"commerce"},"maki2-karaoke":{font:"fontmaki2",code:59472,name:"karaoke",search:"karaoke,micro,chant",theme:"commerce"},"maki2-landmark":{font:"fontmaki2",code:59473,name:"landmark",search:"manege,info",theme:"service"},"maki2-landuse":{font:"fontmaki2",code:59474,name:"landuse",search:"paysage,maison",theme:"paysage"},"maki2-laundry":{font:"fontmaki2",code:59475,name:"laundry",search:"machine,laver,blanchisserie",theme:"commerce"},"maki2-library":{font:"fontmaki2",code:59476,name:"library",search:"livre,bibliotheque",theme:"service"},"maki2-lighthouse":{font:"fontmaki2",code:59477,name:"lighthouse",search:"phare,lumiere",theme:"transport"},"maki2-lodging":{font:"fontmaki2",code:59478,name:"lodging",search:"lit,hotel",theme:"hebergement"},"maki2-logging":{font:"fontmaki2",code:59479,name:"logging",search:"enregistrement",theme:"hebergement"},"maki2-marker":{font:"fontmaki2",code:59480,name:"marker",search:"marker,poi",theme:"forme"},"maki2-marker-stroked":{font:"fontmaki2",code:59481,theme:"forme",name:"stroked",search:"marker,poi"},"maki2-mobile-phone":{font:"fontmaki2",code:59482,theme:"divers",name:"phone",search:"mobile,telephone"},"maki2-monument":{font:"fontmaki2",code:59483,name:"monument",search:"monument,obelix,tour",theme:"construction"},"maki2-mountain":{font:"fontmaki2",code:59484,name:"mountain",search:"montagne,mont,neige",theme:"paysage"},"maki2-museum":{font:"fontmaki2",code:59485,name:"museum",search:"musee,maison",theme:"tourisme"},"maki2-music":{font:"fontmaki2",code:59486,name:"music",search:"musique,note",theme:"loisir"},"maki2-natural":{font:"fontmaki2",code:59487,name:"natural",search:"naturel,arbre",theme:"paysage"},"maki2-optician":{font:"fontmaki2",code:59488,name:"optician",search:"lunette,opticien",theme:"commerce"},"maki2-paint":{font:"fontmaki2",code:59489,name:"paint",search:"peintre,peinture,rouleau",theme:"commerce"},"maki2-park":{font:"fontmaki2",code:59490,name:"park",search:"parc,arbre,feuille",theme:"paysage"},"maki2-park-alt1":{font:"fontmaki2",code:59491,theme:"paysage",name:"alt1",search:"parc,arbre,sapin"},"maki2-parking":{font:"fontmaki2",code:59492,name:"parking",search:"parking,p",theme:"transport"},"maki2-parking-garage":{font:"fontmaki2",code:59493,theme:"transport",name:"garage",search:"parking,garage"},"maki2-pharmacy":{font:"fontmaki2",code:59494,name:"pharmacy",search:"pharmacie,medicament",theme:"service"},"maki2-picnic-site":{font:"fontmaki2",code:59495,theme:"loisir",name:"site",search:"picnic,site,halte,aire"},"maki2-pitch":{font:"fontmaki2",code:59496,name:"pitch",search:"saut,course",theme:"sport"},"maki2-place-of-worship":{font:"fontmaki2",code:59497,theme:"construction",name:"of",search:"place,immeuble,chateau"},"maki2-playground":{font:"fontmaki2",code:59498,name:"playground",search:"balancoire,enfant,jardin",theme:"loisir"},"maki2-police":{font:"fontmaki2",code:59499,name:"police",search:"police,kepi",theme:"service"},"maki2-post":{font:"fontmaki2",code:59500,name:"post",search:"poste,lettre",theme:"service"},"maki2-prison":{font:"fontmaki2",code:59501,name:"prison",search:"prison,herse,barriere",theme:"service"},"maki2-rail":{font:"fontmaki2",code:59502,name:"rail",search:"rail,fer",theme:"transport"},"maki2-rail-light":{font:"fontmaki2",code:59503,theme:"transport",name:"light",search:"transport,train,sncf,rail"},"maki2-rail-metro":{font:"fontmaki2",code:59504,theme:"transport",name:"metro",search:"transport,train,sncf,rail"},"maki2-ranger-station":{font:"fontmaki2",code:59505,theme:"construction",name:"station",search:"station,maison,ranger"},"maki2-recycling":{font:"fontmaki2",code:59506,name:"recycling",search:"recyclable,fleche",theme:"service"},"maki2-religious-christian":{font:"fontmaki2",code:59507,theme:"religion",name:"christian",search:"religion,chretien,coix"},"maki2-religious-jewish":{font:"fontmaki2",code:59508,theme:"religion",name:"jewish",search:"religion,juif,etoile"},"maki2-religious-muslim":{font:"fontmaki2",code:59509,theme:"religion",name:"muslim",search:"religion,musulman,etoile"},"maki2-residential-community":{font:"fontmaki2",code:59510,theme:"construction",name:"community",search:"residentiel,immeuble,tour"},"maki2-restaurant":{font:"fontmaki2",code:59511,name:"restaurant",search:"restaurant,fourchette,couteau",theme:"commerce"},"maki2-roadblock":{font:"fontmaki2",code:59512,name:"roadblock",search:"sens,interdit,panneau",theme:"transport"},"maki2-rocket":{font:"fontmaki2",code:59513,name:"rocket",search:"fusee",theme:"transport"},"maki2-school":{font:"fontmaki2",code:59514,name:"school",search:"education,ecole,enfant,primaire",theme:"education"},"maki2-scooter":{font:"fontmaki2",code:59515,name:"scooter",search:"scooter,velo",theme:"transport"},"maki2-shelter":{font:"fontmaki2",code:59516,name:"shelter",search:"barriere,pont",theme:"transport"},"maki2-shoe":{font:"fontmaki2",code:59517,name:"shoe",search:"chaussure,cordonnier",theme:"commerce"},"maki2-shop":{font:"fontmaki2",code:59518,name:"shop",search:"boutique,sac",theme:"commerce"},"maki2-skiing":{font:"fontmaki2",code:59519,name:"skiing",search:"ski,descente,montagne",theme:"sport"},"maki2-slaughterhouse":{font:"fontmaki2",code:59520,name:"slaughterhouse",search:"vache,animal,ferme,abatoire",theme:"industrie"},"maki2-snowmobile":{font:"fontmaki2",code:59521,name:"snowmobile",search:"neige,ski,skido,moto",theme:"transport"},"maki2-soccer":{font:"fontmaki2",code:59522,name:"soccer",search:"foot,ballon",theme:"sport"},"maki2-square":{font:"fontmaki2",code:59523,name:"square",search:"carre",theme:"forme"},"maki2-square-stroked":{font:"fontmaki2",code:59524,theme:"forme",name:"stroked",search:"carre"},"maki2-stadium":{font:"fontmaki2",code:59525,name:"stadium",search:"stade,drapeau,chapiteau",theme:"construction"},"maki2-star":{font:"fontmaki2",code:59526,name:"star",search:"etoile",theme:"forme"},"maki2-star-stroked":{font:"fontmaki2",code:59527,theme:"forme",name:"stroked",search:"etoile"},"maki2-suitcase":{font:"fontmaki2",code:59528,name:"suitcase",search:"valise,voyage",theme:"transport"},"maki2-sushi":{font:"fontmaki2",code:59529,name:"sushi",search:"sushi,restaurant,poison",theme:"commerce"},"maki2-swimming":{font:"fontmaki2",code:59530,name:"swimming",search:"eau,nage,piscine",theme:"sport"},"maki2-teahouse":{font:"fontmaki2",code:59531,name:"teahouse",search:"the,salon,tasse",theme:"commerce"},"maki2-telephone":{font:"fontmaki2",code:59532,name:"telephone",search:"telephone,urgence",theme:"service"},"maki2-tennis":{font:"fontmaki2",code:59533,name:"tennis",search:"tennis,balle,raquette",theme:"sport"},"maki2-theatre":{font:"fontmaki2",code:59534,name:"theatre",search:"theatre,culture",theme:"tourisme"},"maki2-toilet":{font:"fontmaki2",code:59535,name:"toilet",search:"toilettte,wc",theme:"service"},"maki2-town":{font:"fontmaki2",code:59536,name:"town",search:"ville,maisons",theme:"construction"},"maki2-town-hall":{font:"fontmaki2",code:59537,theme:"construction",name:"hall",search:"batiment,institution"},"maki2-triangle":{font:"fontmaki2",code:59538,name:"triangle",search:"triangle",theme:"forme"},"maki2-triangle-stroked":{font:"fontmaki2",code:59539,theme:"forme",name:"stroked",search:"triangle"},"maki2-veterinary":{font:"fontmaki2",code:59540,name:"veterinary",search:"animal,veterinaire,patte,empreinte",theme:"commerce"},"maki2-village":{font:"fontmaki2",code:59541,name:"village",search:"village,maison",theme:"construction"},"maki2-volcano":{font:"fontmaki2",code:59542,name:"volcano",search:"volcan,mont,feu",theme:"paysage"},"maki2-warehouse":{font:"fontmaki2",code:59543,name:"warehouse",search:"gite",theme:"construction"},"maki2-waste-basket":{font:"fontmaki2",code:59544,theme:"service",name:"basket",search:"poubelle,recyclage"},"maki2-watch":{font:"fontmaki2",code:59545,name:"watch",search:"montre,bijouterie,heure",theme:"commerce"},"maki2-water":{font:"fontmaki2",code:59546,name:"water",search:"eau,goutte",theme:"forme"},"maki2-watermill":{font:"fontmaki2",code:59547,name:"watermill",search:"moulin,eau",theme:"construction"},"maki2-wetland":{font:"fontmaki2",code:59548,name:"wetland",search:"humide,riziere,marecage",theme:"paysage"},"maki2-wheelchair":{font:"fontmaki2",code:59549,name:"wheelchair",search:"handicape,roue,fauteuil,sante",theme:"service"},"maki2-windmill":{font:"fontmaki2",code:59550,name:"windmill",search:"moulin,vent",theme:"construction"},"maki2-zoo":{font:"fontmaki2",code:59551,name:"zoo",search:"zoo,girafe,animal",theme:"loisir"}}),ol.style.FontSymbol.addDefs({font:"Font Awesome 5 Free",name:"FontAwesome",copyright:"SIL OFL 1.1",prefix:"fa"},{"fa-ad":"","fa-address-book":"","fa-address-card":"","fa-adjust":"","fa-air-freshener":"","fa-align-center":"","fa-align-justify":"","fa-align-left":"","fa-align-right":"","fa-allergies":"","fa-ambulance":"","fa-american-sign-language-interpreting":"","fa-anchor":"","fa-angle-double-down":"","fa-angle-double-left":"","fa-angle-double-right":"","fa-angle-double-up":"","fa-angle-down":"","fa-angle-left":"","fa-angle-right":"","fa-angle-up":"","fa-angry":"","fa-ankh":"","fa-apple-alt":"","fa-archive":"","fa-archway":"","fa-arrow-alt-circle-down":"","fa-arrow-alt-circle-left":"","fa-arrow-alt-circle-right":"","fa-arrow-alt-circle-up":"","fa-arrow-circle-down":"","fa-arrow-circle-left":"","fa-arrow-circle-right":"","fa-arrow-circle-up":"","fa-arrow-down":"","fa-arrow-left":"","fa-arrow-right":"","fa-arrow-up":"","fa-arrows-alt":"","fa-arrows-alt-h":"","fa-arrows-alt-v":"","fa-assistive-listening-systems":"","fa-asterisk":"","fa-at":"","fa-atlas":"","fa-atom":"","fa-audio-description":"","fa-award":"","fa-backspace":"","fa-backward":"","fa-balance-scale":"","fa-ban":"","fa-band-aid":"","fa-barcode":"","fa-bars":"","fa-baseball-ball":"","fa-basketball-ball":"","fa-bath":"","fa-battery-empty":"","fa-battery-full":"","fa-battery-half":"","fa-battery-quarter":"","fa-battery-three-quarters":"","fa-bed":"","fa-beer":"","fa-bell":"","fa-bell-slash":"","fa-bezier-curve":"","fa-bible":"","fa-bicycle":"","fa-binoculars":"","fa-birthday-cake":"","fa-blender":"","fa-blender-phone":"","fa-blind":"","fa-bold":"","fa-bolt":"","fa-bomb":"","fa-bone":"","fa-bong":"","fa-book":"","fa-book-dead":"","fa-book-open":"","fa-book-reader":"","fa-bookmark":"","fa-bowling-ball":"","fa-box":"","fa-box-open":"","fa-boxes":"","fa-braille":"","fa-brain":"","fa-briefcase":"","fa-briefcase-medical":"","fa-broadcast-tower":"","fa-broom":"","fa-brush":"","fa-bug":"","fa-building":"","fa-bullhorn":"","fa-bullseye":"","fa-burn":"","fa-bus":"","fa-bus-alt":"","fa-business-time":"","fa-calculator":"","fa-calendar":"","fa-calendar-alt":"","fa-calendar-check":"","fa-calendar-minus":"","fa-calendar-plus":"","fa-calendar-times":"","fa-camera":"","fa-camera-retro":"","fa-campground":"","fa-cannabis":"","fa-capsules":"","fa-car":"","fa-car-alt":"","fa-car-battery":"","fa-car-crash":"","fa-car-side":"","fa-caret-down":"","fa-caret-left":"","fa-caret-right":"","fa-caret-square-down":"","fa-caret-square-left":"","fa-caret-square-right":"","fa-caret-square-up":"","fa-caret-up":"","fa-cart-arrow-down":"","fa-cart-plus":"","fa-cat":"","fa-certificate":"","fa-chair":"","fa-chalkboard":"","fa-chalkboard-teacher":"","fa-charging-station":"","fa-chart-area":"","fa-chart-bar":"","fa-chart-line":"","fa-chart-pie":"","fa-check":"","fa-check-circle":"","fa-check-double":"","fa-check-square":"","fa-chess":"","fa-chess-bishop":"","fa-chess-board":"","fa-chess-king":"","fa-chess-knight":"","fa-chess-pawn":"","fa-chess-queen":"","fa-chess-rook":"","fa-chevron-circle-down":"","fa-chevron-circle-left":"","fa-chevron-circle-right":"","fa-chevron-circle-up":"","fa-chevron-down":"","fa-chevron-left":"","fa-chevron-right":"","fa-chevron-up":"","fa-child":"","fa-church":"","fa-circle":"","fa-circle-notch":"","fa-city":"","fa-clipboard":"","fa-clipboard-check":"","fa-clipboard-list":"","fa-clock":"","fa-clone":"","fa-closed-captioning":"","fa-cloud":"","fa-cloud-download-alt":"","fa-cloud-meatball":"","fa-cloud-moon":"","fa-cloud-moon-rain":"","fa-cloud-rain":"","fa-cloud-showers-heavy":"","fa-cloud-sun":"","fa-cloud-sun-rain":"","fa-cloud-upload-alt":"","fa-cocktail":"","fa-code":"","fa-code-branch":"","fa-coffee":"","fa-cog":"","fa-cogs":"","fa-coins":"","fa-columns":"","fa-comment":"","fa-comment-alt":"","fa-comment-dollar":"","fa-comment-dots":"","fa-comment-slash":"","fa-comments":"","fa-comments-dollar":"","fa-compact-disc":"","fa-compass":"","fa-compress":"","fa-concierge-bell":"","fa-cookie":"","fa-cookie-bite":"","fa-copy":"","fa-copyright":"","fa-couch":"","fa-credit-card":"","fa-crop":"","fa-crop-alt":"","fa-cross":"","fa-crosshairs":"","fa-crow":"","fa-crown":"","fa-cube":"","fa-cubes":"","fa-cut":"","fa-database":"","fa-deaf":"","fa-democrat":"","fa-desktop":"","fa-dharmachakra":"","fa-diagnoses":"","fa-dice":"","fa-dice-d20":"","fa-dice-d6":"","fa-dice-five":"","fa-dice-four":"","fa-dice-one":"","fa-dice-six":"","fa-dice-three":"","fa-dice-two":"","fa-digital-tachograph":"","fa-directions":"","fa-divide":"","fa-dizzy":"","fa-dna":"","fa-dog":"","fa-dollar-sign":"","fa-dolly":"","fa-dolly-flatbed":"","fa-donate":"","fa-door-closed":"","fa-door-open":"","fa-dot-circle":"","fa-dove":"","fa-download":"","fa-drafting-compass":"","fa-dragon":"","fa-draw-polygon":"","fa-drum":"","fa-drum-steelpan":"","fa-drumstick-bite":"","fa-dumbbell":"","fa-dungeon":"","fa-edit":"","fa-eject":"","fa-ellipsis-h":"","fa-ellipsis-v":"","fa-envelope":"","fa-envelope-open":"","fa-envelope-open-text":"","fa-envelope-square":"","fa-equals":"","fa-eraser":"","fa-euro-sign":"","fa-exchange-alt":"","fa-exclamation":"","fa-exclamation-circle":"","fa-exclamation-triangle":"","fa-expand":"","fa-expand-arrows-alt":"","fa-external-link-alt":"","fa-external-link-square-alt":"","fa-eye":"","fa-eye-dropper":"","fa-eye-slash":"","fa-fast-backward":"","fa-fast-forward":"","fa-fax":"","fa-feather":"","fa-feather-alt":"","fa-female":"","fa-fighter-jet":"","fa-file":"","fa-file-alt":"","fa-file-archive":"","fa-file-audio":"","fa-file-code":"","fa-file-contract":"","fa-file-csv":"","fa-file-download":"","fa-file-excel":"","fa-file-export":"","fa-file-image":"","fa-file-import":"","fa-file-invoice":"","fa-file-invoice-dollar":"","fa-file-medical":"","fa-file-medical-alt":"","fa-file-pdf":"","fa-file-powerpoint":"","fa-file-prescription":"","fa-file-signature":"","fa-file-upload":"","fa-file-video":"","fa-file-word":"","fa-fill":"","fa-fill-drip":"","fa-film":"","fa-filter":"","fa-fingerprint":"","fa-fire":"","fa-fire-extinguisher":"","fa-first-aid":"","fa-fish":"","fa-fist-raised":"","fa-flag":"","fa-flag-checkered":"","fa-flag-usa":"","fa-flask":"","fa-flushed":"","fa-folder":"","fa-folder-minus":"","fa-folder-open":"","fa-folder-plus":"","fa-font":"","fa-font-awesome-logo-full":"","fa-football-ball":"","fa-forward":"","fa-frog":"","fa-frown":"","fa-frown-open":"","fa-funnel-dollar":"","fa-futbol":"","fa-gamepad":"","fa-gas-pump":"","fa-gavel":"","fa-gem":"","fa-genderless":"","fa-ghost":"","fa-gift":"","fa-glass-martini":"","fa-glass-martini-alt":"","fa-glasses":"","fa-globe":"","fa-globe-africa":"","fa-globe-americas":"","fa-globe-asia":"","fa-golf-ball":"","fa-gopuram":"","fa-graduation-cap":"","fa-greater-than":"","fa-greater-than-equal":"","fa-grimace":"","fa-grin":"","fa-grin-alt":"","fa-grin-beam":"","fa-grin-beam-sweat":"","fa-grin-hearts":"","fa-grin-squint":"","fa-grin-squint-tears":"","fa-grin-stars":"","fa-grin-tears":"","fa-grin-tongue":"","fa-grin-tongue-squint":"","fa-grin-tongue-wink":"","fa-grin-wink":"","fa-grip-horizontal":"","fa-grip-vertical":"","fa-h-square":"","fa-hammer":"","fa-hamsa":"","fa-hand-holding":"","fa-hand-holding-heart":"","fa-hand-holding-usd":"","fa-hand-lizard":"","fa-hand-paper":"","fa-hand-peace":"","fa-hand-point-down":"","fa-hand-point-left":"","fa-hand-point-right":"","fa-hand-point-up":"","fa-hand-pointer":"","fa-hand-rock":"","fa-hand-scissors":"","fa-hand-spock":"","fa-hands":"","fa-hands-helping":"","fa-handshake":"","fa-hanukiah":"","fa-hashtag":"","fa-hat-wizard":"","fa-haykal":"","fa-hdd":"","fa-heading":"","fa-headphones":"","fa-headphones-alt":"","fa-headset":"","fa-heart":"","fa-heartbeat":"","fa-helicopter":"","fa-highlighter":"","fa-hiking":"","fa-hippo":"","fa-history":"","fa-hockey-puck":"","fa-home":"","fa-horse":"","fa-hospital":"","fa-hospital-alt":"","fa-hospital-symbol":"","fa-hot-tub":"","fa-hotel":"","fa-hourglass":"","fa-hourglass-end":"","fa-hourglass-half":"","fa-hourglass-start":"","fa-house-damage":"","fa-hryvnia":"","fa-i-cursor":"","fa-id-badge":"","fa-id-card":"","fa-id-card-alt":"","fa-image":"","fa-images":"","fa-inbox":"","fa-indent":"","fa-industry":"","fa-infinity":"","fa-info":"","fa-info-circle":"","fa-italic":"","fa-jedi":"","fa-joint":"","fa-journal-whills":"","fa-kaaba":"","fa-key":"","fa-keyboard":"","fa-khanda":"","fa-kiss":"","fa-kiss-beam":"","fa-kiss-wink-heart":"","fa-kiwi-bird":"","fa-landmark":"","fa-language":"","fa-laptop":"","fa-laptop-code":"","fa-laugh":"","fa-laugh-beam":"","fa-laugh-squint":"","fa-laugh-wink":"","fa-layer-group":"","fa-leaf":"","fa-lemon":"","fa-less-than":"","fa-less-than-equal":"","fa-level-down-alt":"","fa-level-up-alt":"","fa-life-ring":"","fa-lightbulb":"","fa-link":"","fa-lira-sign":"","fa-list":"","fa-list-alt":"","fa-list-ol":"","fa-list-ul":"","fa-location-arrow":"","fa-lock":"","fa-lock-open":"","fa-long-arrow-alt-down":"","fa-long-arrow-alt-left":"","fa-long-arrow-alt-right":"","fa-long-arrow-alt-up":"","fa-low-vision":"","fa-luggage-cart":"","fa-magic":"","fa-magnet":"","fa-mail-bulk":"","fa-male":"","fa-map":"","fa-map-marked":"","fa-map-marked-alt":"","fa-map-marker":"","fa-map-marker-alt":"","fa-map-pin":"","fa-map-signs":"","fa-marker":"","fa-mars":"","fa-mars-double":"","fa-mars-stroke":"","fa-mars-stroke-h":"","fa-mars-stroke-v":"","fa-mask":"","fa-medal":"","fa-medkit":"","fa-meh":"","fa-meh-blank":"","fa-meh-rolling-eyes":"","fa-memory":"","fa-menorah":"","fa-mercury":"","fa-meteor":"","fa-microchip":"","fa-microphone":"","fa-microphone-alt":"","fa-microphone-alt-slash":"","fa-microphone-slash":"","fa-microscope":"","fa-minus":"","fa-minus-circle":"","fa-minus-square":"","fa-mobile":"","fa-mobile-alt":"","fa-money-bill":"","fa-money-bill-alt":"","fa-money-bill-wave":"","fa-money-bill-wave-alt":"","fa-money-check":"","fa-money-check-alt":"","fa-monument":"","fa-moon":"","fa-mortar-pestle":"","fa-mosque":"","fa-motorcycle":"","fa-mountain":"","fa-mouse-pointer":"","fa-music":"","fa-network-wired":"","fa-neuter":"","fa-newspaper":"","fa-not-equal":"","fa-notes-medical":"","fa-object-group":"","fa-object-ungroup":"","fa-oil-can":"","fa-om":"","fa-otter":"","fa-outdent":"","fa-paint-brush":"","fa-paint-roller":"","fa-palette":"","fa-pallet":"","fa-paper-plane":"","fa-paperclip":"","fa-parachute-box":"","fa-paragraph":"","fa-parking":"","fa-passport":"","fa-pastafarianism":"","fa-paste":"","fa-pause":"","fa-pause-circle":"","fa-paw":"","fa-peace":"","fa-pen":"","fa-pen-alt":"","fa-pen-fancy":"","fa-pen-nib":"","fa-pen-square":"","fa-pencil-alt":"","fa-pencil-ruler":"","fa-people-carry":"","fa-percent":"","fa-percentage":"","fa-person-booth":"","fa-phone":"","fa-phone-slash":"","fa-phone-square":"","fa-phone-volume":"","fa-piggy-bank":"","fa-pills":"","fa-place-of-worship":"","fa-plane":"","fa-plane-arrival":"","fa-plane-departure":"","fa-play":"","fa-play-circle":"","fa-plug":"","fa-plus":"","fa-plus-circle":"","fa-plus-square":"","fa-podcast":"","fa-poll":"","fa-poll-h":"","fa-poo":"","fa-poo-storm":"","fa-poop":"","fa-portrait":"","fa-pound-sign":"","fa-power-off":"","fa-pray":"","fa-praying-hands":"","fa-prescription":"","fa-prescription-bottle":"","fa-prescription-bottle-alt":"","fa-print":"","fa-procedures":"","fa-project-diagram":"","fa-puzzle-piece":"","fa-qrcode":"","fa-question":"","fa-question-circle":"","fa-quidditch":"","fa-quote-left":"","fa-quote-right":"","fa-quran":"","fa-rainbow":"","fa-random":"","fa-receipt":"","fa-recycle":"","fa-redo":"","fa-redo-alt":"","fa-registered":"","fa-reply":"","fa-reply-all":"","fa-republican":"","fa-retweet":"","fa-ribbon":"","fa-ring":"","fa-road":"","fa-robot":"","fa-rocket":"","fa-route":"","fa-rss":"","fa-rss-square":"","fa-ruble-sign":"","fa-ruler":"","fa-ruler-combined":"","fa-ruler-horizontal":"","fa-ruler-vertical":"","fa-running":"","fa-rupee-sign":"","fa-sad-cry":"","fa-sad-tear":"","fa-save":"","fa-school":"","fa-screwdriver":"","fa-scroll":"","fa-search":"","fa-search-dollar":"","fa-search-location":"","fa-search-minus":"","fa-search-plus":"","fa-seedling":"","fa-server":"","fa-shapes":"","fa-share":"","fa-share-alt":"","fa-share-alt-square":"","fa-share-square":"","fa-shekel-sign":"","fa-shield-alt":"","fa-ship":"","fa-shipping-fast":"","fa-shoe-prints":"","fa-shopping-bag":"","fa-shopping-basket":"","fa-shopping-cart":"","fa-shower":"","fa-shuttle-van":"","fa-sign":"","fa-sign-in-alt":"","fa-sign-language":"","fa-sign-out-alt":"","fa-signal":"","fa-signature":"","fa-sitemap":"","fa-skull":"","fa-skull-crossbones":"","fa-slash":"","fa-sliders-h":"","fa-smile":"","fa-smile-beam":"","fa-smile-wink":"","fa-smog":"","fa-smoking":"","fa-smoking-ban":"","fa-snowflake":"","fa-socks":"","fa-solar-panel":"","fa-sort":"","fa-sort-alpha-down":"","fa-sort-alpha-up":"","fa-sort-amount-down":"","fa-sort-amount-up":"","fa-sort-down":"","fa-sort-numeric-down":"","fa-sort-numeric-up":"","fa-sort-up":"","fa-spa":"","fa-space-shuttle":"","fa-spider":"","fa-spinner":"","fa-splotch":"","fa-spray-can":"","fa-square":"","fa-square-full":"","fa-square-root-alt":"","fa-stamp":"","fa-star":"","fa-star-and-crescent":"","fa-star-half":"","fa-star-half-alt":"","fa-star-of-david":"","fa-star-of-life":"","fa-step-backward":"","fa-step-forward":"","fa-stethoscope":"","fa-sticky-note":"","fa-stop":"","fa-stop-circle":"","fa-stopwatch":"","fa-store":"","fa-store-alt":"","fa-stream":"","fa-street-view":"","fa-strikethrough":"","fa-stroopwafel":"","fa-subscript":"","fa-subway":"","fa-suitcase":"","fa-suitcase-rolling":"","fa-sun":"","fa-superscript":"","fa-surprise":"","fa-swatchbook":"","fa-swimmer":"","fa-swimming-pool":"","fa-synagogue":"","fa-sync":"","fa-sync-alt":"","fa-syringe":"","fa-table":"","fa-table-tennis":"","fa-tablet":"","fa-tablet-alt":"","fa-tablets":"","fa-tachometer-alt":"","fa-tag":"","fa-tags":"","fa-tape":"","fa-tasks":"","fa-taxi":"","fa-teeth":"","fa-teeth-open":"","fa-temperature-high":"","fa-temperature-low":"","fa-terminal":"","fa-text-height":"","fa-text-width":"","fa-th":"","fa-th-large":"","fa-th-list":"","fa-theater-masks":"","fa-thermometer":"","fa-thermometer-empty":"","fa-thermometer-full":"","fa-thermometer-half":"","fa-thermometer-quarter":"","fa-thermometer-three-quarters":"","fa-thumbs-down":"","fa-thumbs-up":"","fa-thumbtack":"","fa-ticket-alt":"","fa-times":"","fa-times-circle":"","fa-tint":"","fa-tint-slash":"","fa-tired":"","fa-toggle-off":"","fa-toggle-on":"","fa-toilet-paper":"","fa-toolbox":"","fa-tooth":"","fa-torah":"","fa-torii-gate":"","fa-tractor":"","fa-trademark":"","fa-traffic-light":"","fa-train":"","fa-transgender":"","fa-transgender-alt":"","fa-trash":"","fa-trash-alt":"","fa-tree":"","fa-trophy":"","fa-truck":"","fa-truck-loading":"","fa-truck-monster":"","fa-truck-moving":"","fa-truck-pickup":"","fa-tshirt":"","fa-tty":"","fa-tv":"","fa-umbrella":"","fa-umbrella-beach":"","fa-underline":"","fa-undo":"","fa-undo-alt":"","fa-universal-access":"","fa-university":"","fa-unlink":"","fa-unlock":"","fa-unlock-alt":"","fa-upload":"","fa-user":"","fa-user-alt":"","fa-user-alt-slash":"","fa-user-astronaut":"","fa-user-check":"","fa-user-circle":"","fa-user-clock":"","fa-user-cog":"","fa-user-edit":"","fa-user-friends":"","fa-user-graduate":"","fa-user-injured":"","fa-user-lock":"","fa-user-md":"","fa-user-minus":"","fa-user-ninja":"","fa-user-plus":"","fa-user-secret":"","fa-user-shield":"","fa-user-slash":"","fa-user-tag":"","fa-user-tie":"","fa-user-times":"","fa-users":"","fa-users-cog":"","fa-utensil-spoon":"","fa-utensils":"","fa-vector-square":"","fa-venus":"","fa-venus-double":"","fa-venus-mars":"","fa-vial":"","fa-vials":"","fa-video":"","fa-video-slash":"","fa-vihara":"","fa-volleyball-ball":"","fa-volume-down":"","fa-volume-mute":"","fa-volume-off":"","fa-volume-up":"","fa-vote-yea":"","fa-vr-cardboard":"","fa-walking":"","fa-wallet":"","fa-warehouse":"","fa-water":"","fa-weight":"","fa-weight-hanging":"","fa-wheelchair":"","fa-wifi":"","fa-wind":"","fa-window-close":"","fa-window-maximize":"","fa-window-minimize":"","fa-window-restore":"","fa-wine-bottle":"","fa-wine-glass":"","fa-wine-glass-alt":"","fa-won-sign":"","fa-wrench":"","fa-x-ray":"","fa-yen-sign":"","fa-yin-yang":""}),ol.source.GeoImage=function(e){var t={attributions:e.attributions,logo:e.logo,projection:e.projection};this.center=e.imageCenter,this.scale=e.imageScale,this.rotate=e.imageRotate?e.imageRotate:0,this.crop=e.imageCrop,this.mask=e.imageMask,this._image=e.image?e.image:new Image,this._image.crossOrigin=e.crossOrigin;var a=this;this._image.onload=function(){a.set("loading_status","compelete"),a.dispatchEvent({type:"loading_compelete"}),a.setCrop(a.crop),a.changed()},this._image.onerror=function(e,t){a.set("loading_status","failed"),a.set("loading_details","Loading failed"),console.log("Image URL '"+this.src+"' is invalid."),a.dispatchEvent({type:"loading_failed"})},e.image||(this._image.src=e.url),t.canvasFunction=function(t,e,a,i,o){var n=document.createElement("canvas");n.width=i[0],n.height=i[1];var r=n.getContext("2d");if(!this._imageSize)return n;function s(e){return[(e[0]-t[0])/(t[2]-t[0])*i[0],(e[1]-t[3])/(t[1]-t[3])*i[1]]}if(this.mask){r.beginPath();var l=s(this.mask[0]);r.moveTo(l[0],l[1]);for(var c=1;c<this.mask.length;c++)l=s(this.mask[c]),r.lineTo(l[0],l[1]);r.clip()}var d=s(this.center),p=(this._image.naturalWidth/2-this.crop[0])*this.scale[0]/e*a,u=(this._image.naturalHeight/2-this.crop[1])*this.scale[1]/e*a,h=this._imageSize[0]*this.scale[0]/e*a,f=this._imageSize[1]*this.scale[1]/e*a;return r.translate(d[0],d[1]),this.rotate&&r.rotate(this.rotate),r.drawImage(this._image,this.crop[0],this.crop[1],this._imageSize[0],this._imageSize[1],-p,-u,h,f),n},ol.source.ImageCanvas.call(this,t),this.set("loading_status",""),e.image||(this.set("loading_status","started"),this.dispatchEvent({type:"loading_strted"})),this.setCrop(this.crop)},ol.ext.inherits(ol.source.GeoImage,ol.source.ImageCanvas),ol.source.GeoImage.prototype.getCenter=function(){return this.center},ol.source.GeoImage.prototype.setCenter=function(e){this.center=e,this.changed()},ol.source.GeoImage.prototype.getScale=function(){return this.scale},ol.source.GeoImage.prototype.setScale=function(e){switch(typeof e){case"number":e=[e,e];break;case"object":if(2!=e.length)return;break;default:return}this.scale=e,this.changed()},ol.source.GeoImage.prototype.getRotation=function(){return this.rotate},ol.source.GeoImage.prototype.setRotation=function(e){this.rotate=e,this.changed()},ol.source.GeoImage.prototype.getGeoImage=function(){return this._image},ol.source.GeoImage.prototype.getCrop=function(){return this.crop},ol.source.GeoImage.prototype.setMask=function(e){this.mask=e,this.changed()},ol.source.GeoImage.prototype.getMask=function(){return this.mask},ol.source.GeoImage.prototype.setCrop=function(e){if(this._image.naturalWidth){if(e){switch(typeof e){case"number":e=[e,e,this._image.naturalWidth-e,this._image.naturalHeight-e];break;case"object":if(4!=e.length)return;break;default:return}e=ol.extent.boundingExtent([[e[0],e[1]],[e[2],e[3]]]);this.crop=[Math.max(0,e[0]),Math.max(0,e[1]),Math.min(this._image.naturalWidth,e[2]),Math.min(this._image.naturalHeight,e[3])]}else this.crop=[0,0,this._image.naturalWidth,this._image.naturalHeight];this.crop[2]<=this.crop[0]&&(this.crop[2]=this.crop[0]+1),this.crop[3]<=this.crop[1]&&(this.crop[3]=this.crop[1]+1),this._imageSize=[this.crop[2]-this.crop[0],this.crop[3]-this.crop[1]],this.changed()}else this.crop=e},ol.control.Legend=function(e){var t=this;e=e||{};var a,i=document.createElement("div");e.target?i.className=e.className||"ol-legend":(i.className=(e.className||"ol-legend")+" ol-unselectable ol-control ol-collapsed"+(!1===e.collapsible?" ol-uncollapsible":""),(a=document.createElement("button")).setAttribute("type","button"),a.addEventListener("click",function(e){i.classList.toggle("ol-collapsed"),t.dispatchEvent({type:"toggle"})}),i.appendChild(a),(a=document.createElement("button")).setAttribute("type","button"),a.className="ol-closebox",a.addEventListener("click",function(e){i.classList.toggle("ol-collapsed"),t.dispatchEvent({type:"toggle"})}),i.appendChild(a));this._imgElement=document.createElement("div"),this._imgElement.className="ol-legendImg",i.appendChild(this._imgElement),this._tableElement=document.createElement("ul"),this._tableElement.className="ol-legendTable",i.appendChild(this._tableElement),ol.control.Control.call(this,{element:i,target:e.target}),this._rows=[],this.set("size",e.size||[40,25]),this.set("margin",0===e.margin?0:e.margin||10),this.set("title",e.title||""),this._style=e.style,!1===e.collapsed&&this.show(),this.refresh()},ol.ext.inherits(ol.control.Legend,ol.control.Control),ol.control.Legend.prototype.setStyle=function(e){this._style=e,this.refresh()},ol.control.Legend.prototype.addRow=function(e){this._rows.push(e||{})},ol.control.Legend.prototype.removeRow=function(e){this._rows.splice(e,1),this.refresh()},ol.control.Legend.prototype.getRow=function(e){return this._rows[e]},ol.control.Legend.prototype.getLength=function(){return this._rows.length},ol.control.Legend.prototype.refresh0=function(){var l=this,c=this._tableElement;c.innerHTML="";var d=this.get("size")[0]+2*this.get("margin"),p=this.get("size")[1]+2*this.get("margin");function e(e,t,a,i,o){var n=document.createElement("li");n.style.height=p+"px",n.addEventListener("click",function(){l.dispatchEvent({type:"select",title:e,row:a,index:i})}),n.addEventListener("dblclick",function(){l.dispatchEvent({type:"dblclick",title:e,row:a,index:i})});var r=document.createElement("div");if(n.appendChild(r),o){var s=document.createElement("img");s.src=o,r.appendChild(s)}r.style.height=p+"px",r=document.createElement("div"),t?n.className="ol-title":r.style.paddingLeft=d+"px",r.innerHTML=e||"",n.appendChild(r),c.appendChild(n)}this.get("title")&&e(this.get("title"),!0,{},-1);var t=document.createElement("canvas");t.width=5*d,t.height=(this._rows.length+1)*p*ol.has.DEVICE_PIXEL_RATIO,this._imgElement.innerHTML="",this._imgElement.appendChild(t),this._imgElement.style.height=(this._rows.length+1)*p+"px";for(var a,i=this.get("size"),o=(i[0],this.get("margin"),i[1],this.get("margin"),ol.has.DEVICE_PIXEL_RATIO,0);a=this._rows[o];o++)e(a.title,!1,a,o),t=this.getStyleImage(a,t,o+(this.get("title")?1:0))},ol.control.Legend.prototype.refresh=function(){var l=this,c=this._tableElement;c.innerHTML="";var d=this.get("size")[0]+2*this.get("margin"),p=this.get("size")[1]+2*this.get("margin");function e(e,t,a,i,o){var n=document.createElement("li");n.style.height=p+"px",n.addEventListener("click",function(){l.dispatchEvent({type:"select",title:e,row:a,index:i})}),n.addEventListener("dblclick",function(){l.dispatchEvent({type:"dblclick",title:e,row:a,index:i})});var r=document.createElement("div");if(n.appendChild(r),o){var s=document.createElement("img");s.src=o,s.style.width=d+"px",s.style.height=p+"px",s.style.objectFit="contain",r.appendChild(s)}r.style.height=p+"px",r=document.createElement("div"),a.css&&(n.className=a.css),t?n.className+="ol-title":app&&"rtl"==app.layout?r.style.paddingRight=o?"8px":d+"px":r.style.paddingLeft=o?"8px":d+"px",r.innerHTML=e||"",n.appendChild(r),c.appendChild(n)}this.get("title")&&e(this.get("title"),!0,{},-1);var t=document.createElement("canvas");t.width=5*d,t.height=(this._rows.length+1)*p*ol.has.DEVICE_PIXEL_RATIO,this._imgElement.innerHTML="",this._imgElement.appendChild(t),this._imgElement.style.height=(this._rows.length+1)*p+"px";var a,i=this.get("size"),o=i[0]+2*this.get("margin"),n=i[1]+2*this.get("margin"),r=ol.has.DEVICE_PIXEL_RATIO;(a=document.createElement("canvas")).width=o*r,a.height=n*r;for(var s,u=0;s=this._rows[u];u++){var h=s.imgSrc;h||(h=this.getStyleImageData(s,a,u+(this.get("title")?1:0))),e(s.title,!1,s,u,h)}},ol.control.Legend.prototype.getVisible=function(){return!this.element.classList.contains("ol-collapsed")},ol.control.Legend.prototype.setVisible=function(e){e?this.show():this.hide()},ol.control.Legend.prototype.show=function(){this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"toggle"})},ol.control.Legend.prototype.hide=function(){this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"toggle"})},ol.control.Legend.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"toggle"})},ol.control.Legend.prototype.getStyleImage=function(e,t,a){e=e||{};var i=(w=this.get("size"))[0]+2*this.get("margin"),o=w[1]+2*this.get("margin"),n=t,r=ol.has.DEVICE_PIXEL_RATIO;n||((n=document.createElement("canvas")).width=i*r,n.height=o*r);var s=n.getContext("2d");s.save();var l,c=ol.render.toContext(s),d=e.typeGeom,p=e.feature;!p&&e.properties&&d&&(p=new ol.Feature(new ol.geom[d]([0,0]))).setProperties(e.properties),p?((l=p.getStyle())||(l="function"==typeof this._style?this._style(p):this._style||[]),d=p.getGeometry().getType()):l=e.style,l instanceof Array||(l=[l]);var u=i/2;e.leftOffset&&(u+=e.leftOffset);var h,f,m=o/2,g=w[0]/2,y=w[1]/2;if("Point"===d){var v=null;for(h=0;f=l[h];h++){var b=f.getImage();if(b&&b.getAnchor){var _=b.getAnchor(),w=b.getSize(),k=_[0]-w[0],S=_[1]-w[1];v?ol.extent.extend(v,[k,S,k+w[0],S+w[1]]):v=[k,S,k+w[0],S+w[1]]}}v&&(u+=(v[2]+v[0])/2,m+=(v[3]+v[1])/2)}for(m+=t?a*o:0,h=0;f=l[h];h++)switch(c.setStyle(f),d){case ol.geom.Point:case"Point":c.drawGeometry(new ol.geom.Point([u,m]));break;case ol.geom.LineString:case"LineString":s.save(),s.rect(this.get("margin")*r,0,w[0]*r,n.height),s.clip(),c.drawGeometry(new ol.geom.LineString([[u-g,m],[u+g,m]])),s.restore();break;case ol.geom.Polygon:case"Polygon":c.drawGeometry(new ol.geom.Polygon([[[u-g,m-y],[u+g,m-y],[u+g,m+y],[u-g,m+y],[u-g,m-y]]]))}return s.restore(),n},ol.control.Legend.prototype.getStyleImageData=function(e,t,a){e=e||{};var i=(_=this.get("size"))[0]+2*this.get("margin"),o=_[1]+2*this.get("margin"),n=ol.has.DEVICE_PIXEL_RATIO;t||((t=document.createElement("canvas")).width=i*n,t.height=o*n);var r=t.getContext("2d");r.save(),r.clearRect(0,0,t.width,t.height);var s,l=ol.render.toContext(r),c=e.typeGeom,d=e.feature;!d&&e.properties&&c&&(d=new ol.Feature(new ol.geom[c]([0,0]))).setProperties(e.properties),d?((s=d.getStyle())||(s="function"==typeof this._style?this._style(d):this._style||[]),c=d.getGeometry().getType()):s=e.style,s instanceof Array||(s=[s]);var p=i/2;e.leftOffset&&(p+=e.leftOffset);var u=o/2,h=_[0]/2;e.leftOffset;var f,m,g=_[1]/2;if("Point"===c){var y=null;for(f=0;m=s[f];f++){var v=m.getImage();if(v&&v.getAnchor){var b=v.getAnchor(),_=v.getSize(),w=b[0]-_[0],k=b[1]-_[1];y?ol.extent.extend(y,[w,k,w+_[0],k+_[1]]):y=[w,k,w+_[0],k+_[1]]}}y&&(p+=(y[2]+y[0])/2,u+=(y[3]+y[1])/2)}for(u+=0,f=0;m=s[f];f++)switch(l.setStyle(m),c){case ol.geom.Point:case"Point":l.drawGeometry(new ol.geom.Point([p,u]));break;case ol.geom.LineString:case"LineString":l.drawGeometry(new ol.geom.LineString([[p-h,u],[p+h,u]]));break;case ol.geom.Polygon:case"Polygon":l.drawGeometry(new ol.geom.Polygon([[[p-h-2,u-g],[p+h-2,u-g],[p+h-2,u+g],[p-h+2,u+g],[p-h+2,u-g]]]))}return r.restore(),t.toDataURL("image/png").replace("image/png","image/octet-stream")},ol.control.CanvasScaleLine=function(e){ol.control.ScaleLine.call(this,e),this.scaleHeight_=6,e||(e={}),e.style||(e.style=new ol.style.Style),this.setStyle(e.style),this.custom=void 0,this.set("showScaleNumber",e.showScaleNumber),this.set("ppi",e.ppi||96)},ol.ext.inherits(ol.control.CanvasScaleLine,ol.control.ScaleLine),ol.control.CanvasScaleLine.prototype.getContext=ol.control.CanvasBase.prototype.getContext,ol.control.CanvasScaleLine.prototype.setMap=function(e){ol.control.CanvasBase.prototype.getCanvas.call(this,e);var t=this.getMap();this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.ScaleLine.prototype.setMap.call(this,e),t&&t.renderSync(),e&&(this._listener=e.on("postcompose",this.drawScale_.bind(this))),this.element.style.visibility="hidden",this.olscale=this.element.querySelector(".ol-scale-line-inner")},ol.control.CanvasScaleLine.prototype.setStyle=function(e){var t=e.getStroke();this.strokeStyle_=t?ol.color.asString(t.getColor()):"#000",this.strokeWidth_=t?t.getWidth():2;var a=e.getFill();this.fillStyle_=a?ol.color.asString(a.getColor()):"#fff";var i=e.getText();this.font_=i?i.getFont():"10px Arial",t=i?i.getStroke():null,a=i?i.getFill():null,this.fontStrokeStyle_=t?ol.color.asString(t.getColor()):this.fillStyle_,this.fontStrokeWidth_=t?t.getWidth():3,this.fontFillStyle_=a?ol.color.asString(a.getColor()):this.strokeStyle_,this.getMap()&&this.getMap().render()},ol.control.CanvasScaleLine.prototype.drawScale_=function(e){if("hidden"===this.element.style.visibility){var t=e.context;if(t||(t=this.getContext(e)),t){var a=parseInt(this.olscale.style.width);if(this.custom&&this.custom.width&&(a=this.custom.width),a){var i=this.get("showScaleNumber"),o=this.olscale.textContent,n="",r=this.getMap(),s=r.get("_printingScale");s||(s=1);var l=this.getMap().getView().getResolution(),c=this.viewState_.projection.getMetersPerUnit(),d=parseFloat(l.toString())*c*39.37*(25.4/.28);d=Math.round(d)*s;var p=r.getView(),u=p.getProjection(),h=p.getCenter(),f=r.getPixelFromCoordinate(h);f[1]+=1;var m=r.getCoordinateFromPixel(f),g=ol.sphere.getDistance(ol.proj.transform(h,u,"EPSG:4326"),ol.proj.transform(m,u,"EPSG:4326")),y=g,v=100*s,b=v*y,_=";";b<.001?(_="μm",y*=1e6):b<1?(_="mm",y*=1e3):b<1e3?_="m":(_="km",y/=1e3);for(var w,k,S,T=[1,2,5],C=3*Math.floor(Math.log(v*y)/Math.log(10));;){S=Math.floor(C/3);var x=Math.pow(10,S);if(w=T[(C%3+3)%3]*x,k=Math.round(w/y),isNaN(k))return;if(v<=k)break;++C}o=w+" "+_,a=k;var D;g*=this.get("ppi")/.0254,n="1 / "+(D=100<(D=g*=s)?100*Math.round(D/100):Math.round(D)).toLocaleString();var L={left:this.element.offsetLeft,top:this.element.offsetTop};this.custom&&void 0!==this.custom.left&&(L.left=this.custom.left),this.custom&&void 0!==this.custom.top&&(L.top=this.custom.top);var P=e.frameState.pixelRatio;t.save(),t.scale(P,P),L.top+=this.element.clientHeight-this.scaleHeight_,t.beginPath(),t.strokeStyle=this.fontStrokeStyle_,t.fillStyle=this.fontFillStyle_,t.lineWidth=this.fontStrokeWidth_,t.textAlign="center",t.textBaseline="bottom",this.custom&&void 0!==this.custom.font?t.font=this.custom.font:t.font=this.font_;var O=t.direction;t.direction="ltr",i&&n?(t.strokeText(n,L.left+a/2,L.top),t.fillText(n,L.left+a/2,L.top),t.textAlign="start",t.textBaseline="hanging",t.strokeText(o,4+L.left+a,L.top+this.scaleHeight_/2),t.fillText(o,4+L.left+a,L.top+this.scaleHeight_/2)):(t.strokeText(o,L.left+a/2,L.top),t.fillText(o,L.left+a/2,L.top)),t.direction=O,t.closePath(),L.top+=2,t.lineWidth=this.strokeWidth_,t.strokeStyle=this.strokeStyle_;for(var I=4,F=parseInt(o);F%10==0;)F/=10;F%5==0&&(I=5);for(C=0;C<I;C++)t.beginPath(),t.fillStyle=C%2?this.fillStyle_:this.strokeStyle_,t.rect(L.left+C*a/I,L.top,a/I,this.scaleHeight_),t.stroke(),t.fill(),t.closePath();t.restore()}}}},ol.control.CanvasScaleLine.prototype.setScale=function(e){var t=this.getMap();if(t&&e){e.target&&(e=e.target.value);var a=e;"string"==typeof e&&((a=e.split("/")[1])||(a=e),a=a.replace(/[^\d]/g,""),a=parseInt(a));var i=t.getView(),o=i.getProjection(),n=i.getCenter(),r=t.getPixelFromCoordinate(n);r[1]+=1;var s=t.getCoordinateFromPixel(r),l=ol.sphere.getDistance(ol.proj.transform(n,o,"EPSG:4326"),ol.proj.transform(s,o,"EPSG:4326"));l*=this.get("ppi")/.0254,i.setResolution(i.getResolution()*a/l)}},ol.control.CoordinatesBar=function(e){var t=e||{},a=document.createElement("div");a.className=void 0!==t.className?t.className:"ol-coordinates-bar",ol.control.Control.call(this,{element:a,target:t.target}),this.button=$('<button class="btn btn-xs  glyphicon glyphicon-cog"/>').attr("type","button").on("touchstart click",function(e){e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),t.handleClick&&t.handleClick.call(self,e)}).appendTo(a),this.coordinateDiv=$('<div class="ol-coordinates-panel">').appendTo(a),t.coordinateFormat&&(this.coordinateFormat=t.coordinateFormat),t.projection&&(this.projection=t.projection),this.undefinedHTML_=void 0!==t.undefinedHTML?t.undefinedHTML:"&#160;",this.renderOnMouseOut_=!!this.undefinedHTML_,this.renderedHTML_=a.innerHTML,this.mapProjection_=null,this.transform_=null,this.lastMouseMovePixel_=null},ol.ext.inherits(ol.control.CoordinatesBar,ol.control.Control),ol.control.CoordinatesBar.prototype.handleMouseMove=function(e){var t=this.getMap();this.lastMouseMovePixel_=t.getEventPixel(e),this.updateHTML_(this.lastMouseMovePixel_)},ol.control.CoordinatesBar.prototype.handleMouseOut=function(e){this.updateHTML_(null),this.lastMouseMovePixel_=null},ol.control.CoordinatesBar.prototype.setProjection=function(e){this.projection=e,this.transform_=null},ol.control.CoordinatesBar.prototype.setMap=function(e){if(ol.control.Control.prototype.setMap.call(this,e),e){var t=e.getViewport();this._listener_mousemove=t.addEventListener("mousemove",this.handleMouseMove.bind(this)),this._listener_touchstart=t.addEventListener("touchstart",this.handleMouseMove.bind(this)),this.renderOnMouseOut_&&(this._listener_mouseout=t.addEventListener("mouseout",this.handleMouseOut.bind(this)),this._listener_touchend=t.addEventListener("touchend",this.handleMouseOut.bind(this)))}},ol.control.CoordinatesBar.prototype.updateHTML_=function(e){var t=this.undefinedHTML_,a=this.getMap(),i=a.getView();if(this.mapProjection_=i.getProjection(),e&&this.mapProjection_){if(!this.transform_){var o=this.projection;this.transform_=o?ol.proj.getTransform(this.mapProjection_,o):identityTransform}var n=a.getCoordinateFromPixel(e);if(n){this.transform_(n,n);var r=this.coordinateFormat;t=r?r(n):n.toString()}}this.renderedHTML_&&t===this.renderedHTML_||($(this.coordinateDiv).html(t),this.renderedHTML_=t)},ol.control.Status=function(e){e||(e={}),null==e.typing&&(e.typing=300),this._classname=e.className;var t=document.createElement("DIV"),a=(e.className||"")+" ol-status ol-bottom";e.target||(a+=" ol-unselectable ol-control",e.noCollapse||(a+=" ol-collapsed")),t.setAttribute("class",a),ol.control.Control.call(this,{element:t,target:e.target}),e.position&&this.setPosition(e.position),this.status(e.status||"")},ol.ext.inherits(ol.control.Status,ol.control.Control),ol.control.Status.prototype.status=function(e){var t=e||"";if(t){if(this.element.style.display="","object"==typeof t&&!(t instanceof String))for(var a in t="",e)t+="<label>"+a+":</label> "+e[a]+"<br/>";t instanceof Element?this.element.appendChild(t):void 0!==t&&(this.element.innerHTML=t)}else this.element.style.display="none"},ol.control.Status.prototype.setPosition=function(e){this.element.classList.remove("ol-left"),this.element.classList.remove("ol-right"),this.element.classList.remove("ol-bottom"),this.element.classList.remove("ol-center"),/^left$|^right$|^bottom$|^center$/.test(e)&&this.element.classList.add("ol-"+e)},ol.control.Status.prototype.show=function(e){this.element.style.display=!1===e?"none":""},ol.control.Status.prototype.hide=function(){this.element.style.display="none"},ol.control.Status.prototype.toggle=function(){this.element.style.display="none"===element.style.display?"":"none"},ol.control.Status.prototype.isShown=function(){return"none"!==this.element.style.display};var LayerHelper={getDatasetId:function(e){var t=e.get("custom");return t&&t.dataObj?t.dataObj.id:void 0},getDetails:function(e){var t=e.get("custom");if(t&&t.dataObj){try{("string"==typeof t.dataObj.details||t.dataObj.details instanceof String)&&(t.dataObj.details=JSON.parse(t.dataObj.details))}catch(e){}return t.dataObj.details}return null},setDetails:function(e,t){var a=e.get("custom");return a||(e.set("custom",{}),a=e.get("custom")),a.dataObj||(a.dataObj={}),a.dataObj.details=t},getFields:function(e){var t=e.get("custom");return t&&t.dataObj&&t.dataObj.details?t.dataObj.details.fields:null},setFields:function(e,t){var a=e.get("custom");return a||(e.set("custom",{}),a=e.get("custom")),a.dataObj||(a.dataObj={}),a.dataObj.details||(a.dataObj.details={}),a.dataObj.details.fields=t},getShapeType:function(e){var t=e.get("custom");return t&&void 0!==typeof t.shapeType?t.shapeType:t&&t.dataObj&&t.dataObj.details?t.dataObj.details.shapeType:null},setShapeType:function(e,t){var a=this.getDetails(e);a||(a=this.setDetails(e,{})),e.get("custom").shapeType=t,a.shapeType=t},getDisplayInLegend:function(e){var t=e.get("custom");return!(!t||void 0===typeof t.displayInLegend)&&t.displayInLegend},setDisplayInLegend:function(e,t){var a=e.get("custom");a&&(a.displayInLegend=t)},getRenderer:function(e){var t=e.get("renderer");if(t)return t;var a=e.get("c");return a&&a.dataObj&&a.dataObj.details?RendererFactory.createFromJson(a.dataObj.details.renderer):null},setRenderer:function(e,t){var a=e.get("custom");return a||(e.set("custom",{}),a=e.get("custom")),a.dataObj||(a.dataObj={}),a.dataObj.details||(a.dataObj.details={}),e.set("renderer",t),t?(a.dataObj.details.renderer=t.toJson(),e.setStyle(t.findStyleFunction(e))):(a.dataObj.details.renderer=null,e.setStyle(StyleFactory.randomStyle())),t},getFeatureLabeler:function(e){var t=e.get("featureLabeler");if(t)return t;var a=e.get("custom");return a&&a.dataObj&&a.dataObj.details&&a.dataObj.details.featureLabeler?new FeatureLabeler(a.dataObj.details.featureLabeler):null},setFeatureLabeler:function(e,t){var a=e.get("custom");return a||(e.set("custom",{}),a=e.get("custom")),a.dataObj||(a.dataObj={}),a.dataObj.details||(a.dataObj.details={}),e.set("featureLabeler",t),a.dataObj.details.featureLabeler=t?t.toJson():null,t},setRasterDisplay:function(e,t){var a=e.get("custom");return a||(e.set("custom",{}),a=e.get("custom")),a.dataObj||(a.dataObj={}),a.dataObj.details||(a.dataObj.details={}),a.dataObj.details.display=t,e.set("display",t),t},getVectorLayerSelectTask:function(e){if(!e)return null;var t=e.get("layerTasks");return t?t.getTaskByName("VectorLayerSelectTask"):null},getVectorLayerEditTask:function(e){if(!e)return null;var t=e.get("layerTasks");return t?t.getTaskByName("VectorLayerEditTask"):null},isLayerVisible:function(e,t){if(!e)return!1;if(!e.getVisible)return!0;if(!e.getVisible())return!1;var a=e.get("parent")||e.get("_parent");return!t||!a||this.isLayerVisible(a,t)}},PrintData={a0:{w:1189,h:841},a1:{w:841,h:594},a2:{w:594,h:420},a2p:{h:594,w:420},a3:{w:420,h:297},a3p:{h:420,w:297},a4:{w:297,h:210},a4p:{h:297,w:210},a5:{w:210,h:148},resolutions:{"Coarse (fast)":96,Medium:150,"Fine (slow)":300},compass_url:"/images/print/compass.png",compass_data:void 0,compass_image:void 0,thumbnail_75_url:"/css/images/earth75.png",thumbnail_75_data:void 0,toDataURL:function(e,t){var a=new XMLHttpRequest;a.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(a.response)};try{a.open("GET",e),a.responseType="blob",a.send()}catch(e){console.log("Error:",e)}}};$(function(){setTimeout(function(){PrintData.toDataURL(PrintData.thumbnail_75_url,function(e){PrintData.thumbnail_75_data=e})},1e3),setTimeout(function(){PrintData.toDataURL(PrintData.compass_url,function(e){PrintData.compass_data=e;var t=new Image;t.onload=function(){PrintData.compass_image=t},t.src=e})},4e3)});var PrintUtil={templates:[{name:"A4 landscape",orientation:"landscape",thumbnail:"/images/print/A4 landscape.png",pageSize:"a4",width:PrintData.a4.w,height:PrintData.a4.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:77,top:15,width:PrintData.a4.w-77-5,height:PrintData.a4.h-15-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a4.h-15-10-7,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a4.w-10-5-3,top:PrintData.a4.h-10-10-3,width:10,height:10,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a4.w-10-5-3,top:PrintData.a4.h-10-10-3,width:10,height:10},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:77+(PrintData.a4.w-77-10)/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:10,top:PrintData.a4.h-75-10-1+25+5,width:64,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a4.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a4.w-5,top:PrintData.a4.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:10,top:20,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:10,y1:25,x2:72,y2:25,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:7,top:25,width:66,height:PrintData.a4.h-75-10-1,columnCount:1,scaleFactor:1.5,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:15,width:70,height:PrintData.a4.h-15-10,borderWidth:.2}]},{name:"A4 portrait",orientation:"portrait",thumbnail:"/images/print/A4 portrait.png",pageSize:"a4",width:PrintData.a4p.w,height:PrintData.a4p.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:5,top:15,width:PrintData.a4p.w-5-5,height:PrintData.a4p.h-82-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a4p.h-82-10-10,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a4p.w-10-5-3,top:PrintData.a4p.h-82-5-3,width:10,height:10,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a4p.w-10-5-3,top:PrintData.a4p.h-82-5-3,width:10,height:10},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:PrintData.a4p.w/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:10+PrintData.a4p.w-87-10,top:PrintData.a4p.h-72,width:64,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a4p.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a4p.w-5,top:PrintData.a4p.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:8,top:PrintData.a4p.h-67-5,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:8,y1:PrintData.a4p.h-67,x2:8+PrintData.a4p.w-87-10,y2:PrintData.a4p.h-67,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:8,top:PrintData.a4p.h-67,width:PrintData.a4p.w-87-10,height:54,columnCount:3,scaleFactor:1.5,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:PrintData.a4p.h-74,width:PrintData.a4p.w-5-5,height:64,borderWidth:.2}]},{name:"A3 landscape",orientation:"landscape",thumbnail:"/images/print/A3 landscape.png",pageSize:"a3",width:PrintData.a3.w,height:PrintData.a3.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:77,top:15,width:PrintData.a3.w-77-5,height:PrintData.a3.h-15-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a3.h-15-10-10,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a3.w-10-5-3,top:PrintData.a3.h-10-10-3,width:10,height:10,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a3.w-10-5-3,top:PrintData.a3.h-10-10-3,width:10,height:10},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:77+(PrintData.a3.w-77-10)/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:10,top:28+PrintData.a3.h-80-10-1,width:64,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a3.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a3.w-5,top:PrintData.a3.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:10,top:20,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:10,y1:25,x2:72,y2:25,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:7,top:25,width:66,height:PrintData.a3.h-80-10-1,columnCount:1,scaleFactor:1,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:15,width:70,height:PrintData.a3.h-15-10,borderWidth:.2}]},{name:"A3 portrait",orientation:"portrait",thumbnail:"/images/print/A3 portrait.png",pageSize:"a3",width:PrintData.a3p.w,height:PrintData.a3p.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:5,top:15,width:PrintData.a3p.w-5-5,height:PrintData.a3p.h-82-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a3p.h-82-10-10,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a3p.w-10-5-3,top:PrintData.a3p.h-82-5-3,width:10,height:10,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a3p.w-10-5-3,top:PrintData.a3p.h-82-5-3,width:10,height:10},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:PrintData.a3p.w/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:10+PrintData.a3p.w-127-10,top:PrintData.a3p.h-72,width:104,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a3p.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a3p.w-5,top:PrintData.a3p.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:8,top:PrintData.a3p.h-67-5,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:8,y1:PrintData.a3p.h-67,x2:8+PrintData.a3p.w-127-10,y2:PrintData.a3p.h-67,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:8,top:PrintData.a3p.h-67,width:PrintData.a3p.w-127-10,height:54,columnCount:3,scaleFactor:1.5,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:PrintData.a3p.h-74,width:PrintData.a3p.w-5-5,height:64,borderWidth:.2}]},{name:"A2 landscape",orientation:"landscape",thumbnail:"/images/print/A3 landscape.png",pageSize:"a2",width:PrintData.a2.w,height:PrintData.a2.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:77,top:15,width:PrintData.a2.w-77-5,height:PrintData.a2.h-15-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a2.h-15-10-10,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a2.w-10-10-5-3,top:PrintData.a2.h-10-10-10-3,width:20,height:20,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a2.w-10-10-5-3,top:PrintData.a2.h-10-10-10-3,width:20,height:20},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:77+(PrintData.a2.w-77-10)/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:10,top:25+PrintData.a2.h-100-10-1,width:64,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a2.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a2.w-5,top:PrintData.a2.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:10,top:18,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:10,y1:23,x2:72,y2:23,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:7,top:23,width:66,height:PrintData.a2.h-100-10-1,columnCount:1,scaleFactor:1.5,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:15,width:70,height:PrintData.a2.h-15-10,borderWidth:.2}]},{name:"A2 portrait",orientation:"portrait",thumbnail:"/images/print/A2 portrait.png",pageSize:"a2",width:PrintData.a2p.w,height:PrintData.a2p.h,borderWidth:.5,borderOffset:1,resolution:150,defaults:{font:"times",fontStyle:"normal",fontSize:12,textColor:"black",lineWidth:.5,lineColor:"rgb(50, 50, 50)"},mapFrame:{left:5,top:15,width:PrintData.a2p.w-5-5,height:PrintData.a2p.h-82-10,borderWidth:.2},scaleBar:{left:5,top:PrintData.a2p.h-82-10-10,width:50,font:"20px Arial"},elements:[{type:"image",name:"logo",imageData:function(){return PrintData.thumbnail_75_data},format:"PNG",left:5,top:3,width:10,height:10},{type:"box",name:"compass-border",left:PrintData.a2p.w-10-10-5-3,top:PrintData.a2p.h-82-10-5-3,width:20,height:20,lineColor:"rgb(100,100,100)",fillColor:"#ffffff82",borderWidth:.2},{type:"image",rotation:"{north}",name:"compass",imageData:function(){return PrintData.compass_data},image:function(){return PrintData.compass_image},format:"PNG",left:PrintData.a2p.w-10-10-5-3,top:PrintData.a2p.h-82-10-5-3,width:20,height:20},{type:"text",name:"logo-title",text:"{site-name}",left:15,top:8,fontSize:14,textColor:"#0471a0",align:"left",baseline:"middle"},{type:"text",name:"title",text:"{name}",left:PrintData.a2p.w/2,top:10,fontSize:14,align:"center",baseline:"alphabetic"},{type:"text",name:"description",text:"{description}",left:15+PrintData.a2p.w-127-10,top:PrintData.a2p.h-72,width:104,fontSize:12,align:"left",baseline:"top"},{type:"text",name:"app-footer",text:"{app-footer}",left:5,top:PrintData.a2p.h-5,fontSize:10,align:"left",baseline:"alphabetic"},{type:"text",name:"map-copyright",text:"{map-copyrights}, User: {user-id}, Date:{dateTime_local} ",left:PrintData.a2p.w-5,top:PrintData.a2p.h-5,fontSize:10,align:"right",baseline:"alphabetic"},{type:"text",name:"legend-title",text:"Legend",left:10,top:PrintData.a2p.h-67-5,fontSize:10,align:"left",baseline:"top",isHidden:function(e){return!e.legend.getVisible()}},{type:"line",x1:10,y1:PrintData.a2p.h-67,x2:10+PrintData.a2p.w-127-10,y2:PrintData.a2p.h-67,lineWidth:.2,lineColor:"rgb(200,200,200)",isHidden:function(e){return!e.legend.getVisible()}},{type:"legend",left:10,top:PrintData.a2p.h-67,width:PrintData.a2p.w-127-10,height:54,columnCount:3,scaleFactor:1.5,isHidden:function(e){return!e.legend.getVisible()}},{type:"box",left:5,top:PrintData.a2p.h-74,width:PrintData.a2p.w-5-5,height:64,borderWidth:.2}]}],activeTemplate:"A4 landscape",print:function(t){var e=this;setTimeout(function(){try{e.print_internal(t)}catch(e){t&&t.onComplete&&t.onComplete({status:!1,message:"Error:"+e.message})}},500)},print_internal:function(k){var S=k.mapContainer,e=k.settings,T=e.template;this.activeTemplate=T.name;var C=!!e.downloadPDF,x=S.map,D=T.pageSize,t=T.resolution||96,L=T.mapFrame,a=Math.round(L.width*t/25.4),i=Math.round(L.height*t/25.4),P=x.getSize(),O=x.getView().calculateExtent(P),I=S.legend.get("title");S.legend.set("title",void 0);$("#footer p").text();x.once("rendercomplete",function(e){try{!function(e){var t=180*x.getView().getRotation()/Math.PI,a=(u=S.getMapRenderedCanvas()).toDataURL("image/png"),i=new jsPDF(T.orientation,void 0,D);i.setFont(T.defaults.font),i.setFontStyle(T.defaults.fontStyle),i.setFontSize(T.defaults.fontSize),i.setTextColor(T.defaults.textColor),i.setLineWidth(T.defaults.lineWidth),i.setDrawColor(T.defaults.lineColor),i.setLineWidth(T.borderWidth),i.rect(T.borderOffset,T.borderOffset,T.width-2*T.borderOffset,T.height-2*T.borderOffset),i.addImage(a,"PNG",L.left,L.top,L.width,L.height),i.setLineWidth(L.borderWidth),i.rect(L.left,L.top,L.width,L.height);var o=void 0;if(T.elements)for(var n=0;n<T.elements.length;n++){var r=T.elements[n];if(!(r.hidden||"function"==typeof r.isHidden&&r.isHidden(S)))if(i.setFont(T.defaults.font),i.setFontStyle(T.defaults.fontStyle),i.setFontSize(T.defaults.fontSize),i.setTextColor(T.defaults.textColor),i.setLineWidth(T.defaults.lineWidth),i.setDrawColor(T.defaults.lineColor),r.font&&i.setFont(r.font),r.fontStyle&&i.setFontStyle(r.fontStyle),r.fontSize&&i.setFontSize(r.fontSize),r.textColor&&i.setTextColor(r.textColor),r.lineWidth&&i.setLineWidth(r.lineWidth),r.borderWidth&&i.setLineWidth(r.borderWidth),r.lineColor&&i.setDrawColor(r.lineColor),"text"==r.type){var s=r.text+"";s&&(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s.replace("{name}",S.mapSettings.name?S.mapSettings.name:"Untitled")).replace("{description}",S.mapSettings.description?S.mapSettings.description:"")).replace("{app-footer}",app.COPY_RIGHTS)).replace("{site-name}",app.SITE_NAME)).replace("{map-copyrights}",app.MAPS_COPY_RIGHTS)).replace("{user-id}",app.identity.name)).replace("{user-firstName}",app.identity.firstName)).replace("{user-lastName}",app.identity.lastName)).replace("{user-email}",app.identity.email)).replace("{updatedAt}",S.mapSettings.updatedAt)).replace("{date_gmt}",(new Date).toLocaleDateString("en",{timeZone:"UTC"})+" GMT")).replace("{date_local}",(new Date).toLocaleDateString())).replace("{time_gmt}",(new Date).toLocaleTimeString("en",{timeZone:"UTC"})+" GMT")).replace("{time_local}",(new Date).toLocaleTimeString())).replace("{dateTime_gmt}",(new Date).toLocaleString("en",{timeZone:"UTC"})+" GMT")).replace("{dateTime_local}",(new Date).toLocaleString())),r.width&&(s=i.splitTextToSize(s,r.width)),s&&i.text(s,r.left,r.top,{align:r.align,baseline:r.baseline})}else if("line"==r.type)i.line(r.x1,r.y1,r.x2,r.y2);else if("box"==r.type){if(r.fillColor){(u=document.createElement("canvas")).width=r.width,u.height=r.height,(h=u.getContext("2d")).save(),h.fillStyle=r.fillColor,h.fillRect(0,0,u.width,u.height),h.restore();try{var l=u.toDataURL("image/png");i.addImage(l,"PNG",r.left,r.top,r.width,r.height)}catch(e){}}i.rect(r.left,r.top,r.width,r.height)}else if("image"==r.type){var c=void 0!==r.rotation?r.rotation+"":"",d=0;if(c=c.replace("{north}",t+"")){try{d=parseFloat(c)}catch(e){}d=d*Math.PI/180}try{if((l=r.imageData)&&"function"==typeof l&&(l=l()),0==d)i.addImage(l,r.format||"PNG",r.left,r.top,r.width,r.height);else{var p=r.image;if(p&&"function"==typeof p&&(p=p()),p){var u,h;(u=document.createElement("canvas")).width=p.width,u.height=p.height,(h=u.getContext("2d")).save(),h.translate(u.width/2,u.height/2),h.rotate(d),h.drawImage(p,-p.width/2,-p.height/2),h.restore();try{l=u.toDataURL("image/png"),i.addImage(l,"PNG",r.left,r.top,r.width,r.height)}catch(e){}}}}catch(e){}}else"legend"==r.type&&(o=r)}var f=function(){C?i.save("Map-"+T.name+".pdf"):window.open(i.output("bloburl"),"_blank"),S.scaleLineControl.custom=void 0,S.legend.set("title",I),x.setSize(P),setTimeout(function(){x.getView().fit(O,{size:P})},1e3),k.onComplete&&k.onComplete({status:!0})};if(o&&S.legend.getVisible()){var m=o.scaleFactor||1,g=o.width*m,y=o.height*m,v=S.legend._tableElement,b=v.style.width,_=v.style.height,w=v.style.columnCount;v.style.width=g+14+"mm",v.style.height=y+"mm",v.style.columnCount=o.columnCount,v.style.columnFill="auto",S.refreshLegend_immediate(),html2canvas(v,{backgroundColor:"#eeeeee"}).then(function(e){v.style.width=b,v.style.height=_,v.style.columnCount=w;try{var t=e.toDataURL("image/png");i.addImage(t,"PNG",o.left,o.top,o.width,o.height)}catch(e){}f()})}else f()}()}catch(e){k.onComplete&&k.onComplete({status:!1,message:"Error:"+e.message})}});var o=[a,i];T.scaleBar&&(S.scaleLineControl.custom={top:Math.round(T.scaleBar.top*t/25.4),left:Math.round(T.scaleBar.left*t/25.4),width:Math.round(T.scaleBar.width*t/25.4),font:T.scaleBar.font}),x.setSize(o),x.getView().fit(O,{size:o})}},StyleFactory={randomColor:function(a,e){a||(a=[[150,255],[0,190],[0,30]]),void 0===e&&(e=1);var t=function(e){var t=a.splice(Math.floor(Math.random()*a.length),1)[0];return e?(Math.floor(Math.random()*(t[1]-t[0]))+t[0]).toString(16):Math.floor(Math.random()*(t[1]-t[0]))+t[0]};return"rgba("+t()+","+t()+","+t()+","+e+")"},randomStyle:function(e){(e=e||{}).strokeWidth=e.strokeWidth||1.25,e.strokeColor=e.strokeColor||"#3399CC";var t=new ol.style.Fill({color:e.fillColor?e.fillColor:StyleFactory.randomColor(null,.5)}),a=new ol.style.Stroke({color:e.randomStrokeColor?StyleFactory.randomColor(null,.7):e.strokeColor,width:e.strokeWidth});return new ol.style.Style({image:new ol.style.Circle({fill:t,stroke:a,radius:5}),fill:t,stroke:a})},renderStyleSample:function(e,t){(t=t||{}).width||(t.width=40),t.height||(t.height=20);var a=t.width,i=t.height,o=t.canvas,n=t.target;o||n||(n=$('<div style="width:'+a+"px;height="+i+'px;"></div>')),o||(o=$("<canvas/>",{class:"styleSample"}).width(a).height(i),n.append(o),o=o[0]);var r=ol.render.toContext(o.getContext("2d"),{size:[a,i]});e||(e=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}));var s=e.getFill?e.getFill():null;e instanceof ol.style.Fill&&(c=e,t.type||(t.type="Polygon")),s||(s=new ol.style.Fill);var l=e.getStroke?e.getStroke():null;e instanceof ol.style.Stroke&&(c=e,t.type||(t.type="Line")),l||(l=new ol.style.Stroke);var c=e.getImage?e.getImage():null;e instanceof ol.style.Image&&(c=e,t.type||(t.type="Point")),c||(c=new ol.style.Circle);var d=new ol.style.Style({fill:s,stroke:l,image:c});r.setStyle(d);var p=a/10,u=i/10;return"LineString"==t.type||"Line"==t.type||"MultiLineString"==t.type?r.drawGeometry(new ol.geom.LineString([[p,i/2],[a-2*p,i/2]])):"Polygon"==t.type||"MultiPolygon"==t.type?r.drawGeometry(new ol.geom.Polygon([[[p,u],[a-2*p,u],[a-2*p,i-2*u],[p,i-2*u],[p,u]]])):("Point"==t.type||"MultiPoint"==t.type||(r.drawGeometry(new ol.geom.Polygon([[[p,u],[a-2*p,u],[a-2*p,i-2*u],[p,i-2*u],[p,u]]])),r.drawGeometry(new ol.geom.LineString([[p,i/2],[a-2*p,i/2]]))),r.drawGeometry(new ol.geom.Point([a/2,i/2]))),n||o},fill:function(e){return("string"==typeof e||Array.isArray(e))&&(e={color:e}),new ol.style.Fill(e)},getFill:function(e){return e?{color:e.getColor()}:null},stroke:function(e){return"string"==typeof e||Array.isArray(e)?e={color:e}:"number"==typeof e&&(e={width:e}),new ol.style.Stroke(e)},getStroke:function(e){return e?{color:e.getColor(),lineCap:e.getLineCap(),lineJoin:e.getLineJoin(),lineDash:e.getLineDash(),miterLimit:e.getMiterLimit(),width:e.getWidth()}:null},text:function(e){return"string"==typeof e&&(e={text:e}),e.fill&&(e.fill=StyleFactory.fill(e.fill)),e.stroke&&(e.stroke=StyleFactory.stroke(e.stroke)),new ol.style.Text(e)},circle:function(e){return e.fill&&(e.fill=StyleFactory.fill(e.fill)),e.stroke&&(e.stroke=StyleFactory.stroke(e.stroke)),new ol.style.Circle(e)},getCircle:function(e){return e?{radius:e.getRadius(),fill:StyleFactory.getFill(e.getFill()),stroke:StyleFactory.getStroke(e.getStroke()),opacity:e.getOpacity(),rotation:e.getRotation(),scale:e.getScale()}:null},icon:function(e){return new ol.style.Icon(e)},getFontSymbol:function(e){return e?{form:e.form_,gradient:e.gradient_,glyph:e.getGlyphName(),fontSize:e.fontSize_,fontStyle:e.fontStyle_,radius:e.radius_orig,offsetX:e.offset_[0],offsetY:e.offset_[1],rotation:e.getRotation(),rotateWithView:e.getRotateWithView(),color:e.color_,fill:StyleFactory.getFill(e.fill_),stroke:StyleFactory.getStroke(e.stroke_),opacity:e.getOpacity(),rotation:e.getRotation(),scale:e.getScale()}:null},fontSymbol:function(e){return e.fill&&(e.fill=StyleFactory.fill(e.fill)),e.stroke&&(e.stroke=StyleFactory.stroke(e.stroke)),new ol.style.FontSymbol(e)},getIcon:function(e){return e?{anchor:e.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",size:e.getSize(),src:e.getSrc(),snapToPixel:e.getSnapToPixel(),opacity:e.getOpacity(),rotation:e.getRotation(),rotateWithView:e.getRotateWithView(),scale:e.getScale()}:null},image:function(e){return void 0!==e.glyph?StyleFactory.fontSymbol(e):void 0!==e.radius?StyleFactory.circle(e):StyleFactory.icon(e)},makeStyle:function(a){var i=this;if(Array.isArray(a))return a.map(function(e){return i.makeStyle(e)});var o={};return Object.keys(a).forEach(function(e){var t=a[e];if(i[e])if("circle"==e||"icon"==e||"fontSymbol"==e)try{t&&t.src&&(app.API_BASE_URL&&t.src.startsWith("/images/")?t.src=t.src.replace("/images/","images/"):!app.API_BASE_URL&&t.src.startsWith("images/")&&(t.src="/"+t.src)),o.image=new i[e](t)}catch(e){}else o[e]=new i[e](t);else o[e]=t}),new ol.style.Style(o)},jsonToStyle:function(e){return this.makeStyle(e)},styleToJson:function(e){var t=this,a={};if(e.getFill&&(a.fill=t.getFill(e.getFill())),e.getStroke&&(a.stroke=t.getStroke(e.getStroke())),e.getImage){var i=e.getImage();i instanceof ol.style.Circle&&(a.circle=t.getCircle(i)),i instanceof ol.style.Icon&&(a.icon=t.getIcon(i)),i instanceof ol.style.FontSymbol&&(a.fontSymbol=t.getFontSymbol(i))}return e.getZIndex&&(a.zIndex=e.getZIndex()),a},cloneStyle:function(e){var t=this.styleToJson(e);return this.jsonToStyle(t)}};function SimpleRenderer(e){this.name="simpleRenderer",this.style=StyleFactory.randomStyle(),e&&this.fromJson(e)}function UniqueValueRenderer(e){this.name="uniqueValueRenderer",this.defaultStyle=StyleFactory.randomStyle(),this.defaultLabel="Other values",this.field,this.uniqueValueInfos={},e&&this.fromJson(e)}function RangeValueRenderer(e){this.name="rangeValueRenderer",this.defaultStyle=StyleFactory.randomStyle(),this.defaultLabel="Other values",this.field,this.rangeValueInfos=[],e&&this.fromJson(e)}SimpleRenderer.prototype.getName=function(){return this.name},SimpleRenderer.prototype.findStyleFunction=function(i){var o=this,n={},e=LayerHelper.getFields(i);if(e)for(var t=0;t<e.length;t++){var a=e[t];if((n[a.name]=a).domain&&"codedValues"==a.domain.type&&a.domain.items){for(var r={},s=0;s<a.domain.items.length;s++)r[a.domain.items[s].code]=a.domain.items[s].value;n[a.name].codedValues=r}}return function(e,t){var a=o.style;return i&&i.get("featureLabeler")&&a.setText(i.get("featureLabeler").getTextStyle(e,t,n)),a}},SimpleRenderer.prototype.getDefaultStyle=function(){return this.getStyle()},SimpleRenderer.prototype.setDefaultStyle=function(e){this.setStyle(e)},SimpleRenderer.prototype.getStyle=function(){return this.style},SimpleRenderer.prototype.setStyle=function(e){this.style=e},SimpleRenderer.prototype.clone=function(){return new SimpleRenderer(this.toJson())},SimpleRenderer.prototype.toJson=function(){return{name:this.name,style:StyleFactory.styleToJson(this.style)}},SimpleRenderer.prototype.fromJson=function(e){if(e&&e.style)try{this.setStyle(StyleFactory.jsonToStyle(e.style))}catch(e){}},UniqueValueRenderer.prototype.getName=function(){return this.name},UniqueValueRenderer.prototype.findStyleFunction=function(n){var r=this,s={},e=LayerHelper.getFields(n);if(e)for(var t=0;t<e.length;t++){var a=e[t];if((s[a.name]=a).domain&&"codedValues"==a.domain.type&&a.domain.items){for(var i={},o=0;o<a.domain.items.length;o++)i[a.domain.items[o].code]=a.domain.items[o].value;s[a.name].codedValues=i}}return function(e,t){var a=r.defaultStyle;if(!e)return a;var i=e.get(r.field);if(void 0!==i){var o=r.findUniqueValueItem(i);o&&(a=o.style)}return n&&n.get("featureLabeler")&&a.setText(n.get("featureLabeler").getTextStyle(e,t,s)),a}},UniqueValueRenderer.prototype.getField=function(){return this.field},UniqueValueRenderer.prototype.setField=function(e){this.field=e},UniqueValueRenderer.prototype.getDefaultLabel=function(){return this.defaultLabel},UniqueValueRenderer.prototype.setDefaultLabel=function(e){this.defaultLabel=e},UniqueValueRenderer.prototype.getDefaultStyle=function(){return this.defaultStyle},UniqueValueRenderer.prototype.setDefaultStyle=function(e){this.defaultStyle=e},UniqueValueRenderer.prototype.getUniqueValueInfos=function(){return this.uniqueValueInfos},UniqueValueRenderer.prototype.ClearAllValues=function(){this.uniqueValueInfos={}},UniqueValueRenderer.prototype.addValue=function(e,t,a){this.uniqueValueInfos[e+""]={value:e,label:t,style:a}},UniqueValueRenderer.prototype.findUniqueValueItem=function(e){return this.uniqueValueInfos[e+""]},UniqueValueRenderer.prototype.clone=function(){return new UniqueValueRenderer(this.toJson())},UniqueValueRenderer.prototype.toJson=function(){var e={name:this.name,defaultStyle:StyleFactory.styleToJson(this.defaultStyle),field:this.field,defaultLabel:this.defaultLabel,uniqueValueInfos:{}};if(this.uniqueValueInfos)for(var t in this.uniqueValueInfos){var a=this.uniqueValueInfos[t],i={value:a.value,label:a.label,style:StyleFactory.styleToJson(a.style)};e.uniqueValueInfos[t]=i}return e},UniqueValueRenderer.prototype.fromJson=function(e){if(e){if(e.defaultStyle)try{this.setDefaultStyle(StyleFactory.jsonToStyle(e.defaultStyle))}catch(e){}if(this.setField(e.field),this.setDefaultLabel(e.defaultLabel),this.uniqueValueInfos={},e.uniqueValueInfos)for(var t in e.uniqueValueInfos){var a=e.uniqueValueInfos[t];this.addValue(a.value,a.label,StyleFactory.jsonToStyle(a.style))}}},RangeValueRenderer.prototype.getName=function(){return this.name},RangeValueRenderer.prototype.findStyleFunction=function(n){var r=this,s={},e=LayerHelper.getFields(n);if(e)for(var t=0;t<e.length;t++){var a=e[t];if((s[a.name]=a).domain&&"codedValues"==a.domain.type&&a.domain.items){for(var i={},o=0;o<a.domain.items.length;o++)i[a.domain.items[o].code]=a.domain.items[o].value;s[a.name].codedValues=i}}return function(e,t){var a=r.defaultStyle;if(!e)return a;var i=e.get(r.field);if(void 0!==i){var o=r.findRangeValueItem(i);o&&(a=o.style)}return n&&n.get("featureLabeler")&&a.setText(n.get("featureLabeler").getTextStyle(e,t,s)),a}},RangeValueRenderer.prototype.getField=function(){return this.field},RangeValueRenderer.prototype.setField=function(e){this.field=e},RangeValueRenderer.prototype.getDefaultLabel=function(){return this.defaultLabel},RangeValueRenderer.prototype.setDefaultLabel=function(e){this.defaultLabel=e},RangeValueRenderer.prototype.getDefaultStyle=function(){return this.defaultStyle},RangeValueRenderer.prototype.setDefaultStyle=function(e){this.defaultStyle=e},RangeValueRenderer.prototype.getRangeValueInfos=function(){return this.rangeValueInfos},RangeValueRenderer.prototype.ClearAllValues=function(){this.rangeValueInfos=[]},RangeValueRenderer.prototype.addValue=function(e,t,a,i){this.rangeValueInfos.push({minValue:e,maxValue:t,label:a,style:i})},RangeValueRenderer.prototype.findRangeValueItem=function(e){if(void 0===e)return null;for(var t=0;t<this.rangeValueInfos.length;t++){var a=this.rangeValueInfos[t];if(void 0!==a.minValue&&void 0!==a.maxValue){if(e>=a.minValue&&e<a.maxValue)return a}else if(void 0!==a.minValue){if(e>=a.minValue)return a}else if(void 0!==a.maxValue&&e<a.maxValue)return a}return null},RangeValueRenderer.prototype.clone=function(){return new RangeValueRenderer(this.toJson())},RangeValueRenderer.prototype.toJson=function(){var e={name:this.name,defaultStyle:StyleFactory.styleToJson(this.defaultStyle),field:this.field,defaultLabel:this.defaultLabel,rangeValueInfos:[]};if(this.rangeValueInfos)for(var t=0;t<this.rangeValueInfos.length;t++){var a=this.rangeValueInfos[t],i={minValue:a.minValue,maxValue:a.maxValue,label:a.label,style:StyleFactory.styleToJson(a.style)};e.rangeValueInfos.push(i)}return e},RangeValueRenderer.prototype.fromJson=function(e){if(e){if(e.defaultStyle)try{this.setDefaultStyle(StyleFactory.jsonToStyle(e.defaultStyle))}catch(e){}if(this.setField(e.field),this.setDefaultLabel(e.defaultLabel),this.rangeValueInfos=[],e.rangeValueInfos)for(var t=0;t<e.rangeValueInfos.length;t++){var a=e.rangeValueInfos[t];this.addValue(a.minValue,a.maxValue,a.label,StyleFactory.jsonToStyle(a.style))}}};var RendererFactory={createSimpleRenderer:function(e){return new SimpleRenderer(e)},createUniqueValueRenderer:function(e){return new UniqueValueRenderer(e)},createRangeValueRenderer:function(e){return new RangeValueRenderer(e)},createFromJson:function(e){return e?"simpleRenderer"==e.name?new SimpleRenderer(e):"uniqueValueRenderer"==e.name?new UniqueValueRenderer(e):"rangeValueRenderer"==e.name?new RangeValueRenderer(e):this.createSimpleRenderer():this.createSimpleRenderer()}};function FeatureLabeler(e){this.name="featureLabeler",this.disabled=!1,this.fieldName=void 0,this.type="normal",this.align="",this.baseline="middle",this.rotation=0,this.font="Arial",this.weight="normal",this.placement="point",this.maxangle=.7853981633974483,this.overflow=!1,this.size="12px",this.offsetX=0,this.offsetY=0,this.color="blue",this.outline="#ffffff",this.outlineWidth=3,this.maxreso,String.prototype.trunc=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"...":this.substr(0)},e&&this.fromJson(e)}function SourceFactory(e,t){this.app=e,this.options=t||{}}function DlgTaskBase(e,t,a,i,o){var n=this;n.id=e||"DlgTaskBase",this.mapContainer=a,this.obj=i,this.options=o||{},this.title=t||o.title;var r=void 0===o.closable||o.closable,s=void 0!==o.dialogSize?o.dialogSize:BootstrapDialog.SIZE_NORMAL,l=void 0===o.showOKButton||o.showOKButton,c=o.showApplyButton||!1,d=o.okButtonTitle||"OK",p=o.cancelButtonTitle||"Cancel",u=o.applyButtonTitle||"Apply";this.title||(this.title="Task Dialog"),this.cancelHandlers=[],this.beforeApplyHandlers=[],this.applyHandlers=[],this.body=$("<div></div>");var h='<div id="'+n.id+'_Panel">';h+="</div>",this.mainPanel=$(h).appendTo(this.body),this.dlg=new BootstrapDialog({title:this.title,message:this.body,draggable:!0,size:s,closable:r,closeByBackdrop:!0,closeByKeyboard:!0,buttons:[{id:"btn-apply",label:u,cssClass:"btn-info",action:function(e){var t={data:{},dialogAction:"apply"};n.apply(t)&&(n.changesApplied=!0,n.options.onapply&&n.options.onapply(e,t.data,t.dialogAction))}},{id:"btn-ok",label:d,cssClass:"btn-primary",action:function(e){var t={data:{},dialogAction:"ok"};n.apply(t)&&(n.changesApplied=!0,e.close(),n.options.onapply&&n.options.onapply(e,t.data,t.dialogAction),n.closed())}},{label:p,action:function(e){e.close(),n.closed()}}],onshow:function(e){var t=n.options.helpLink;if(t||(t="/help#"+n.id),t){var a='<a title="Help" class="close" style=" float: right; margin-right: .5em;" ';a+=' target="_blank" href="'+t+'"',a+=">?</a>",e.getModalHeader().find(".bootstrap-dialog-header").append(a)}l||e.getButton("btn-ok").hide(),c||e.getButton("btn-apply").hide(),n.options.onshow&&n.options.onshow(e);var i=n.title;window.location.hash=i,window.onhashchange=function(){location.hash||(e.close(),n.closed())}},onshown:function(e){n.options.onshown&&n.options.onshown(e)},onhide:function(e){n.options.onhide&&n.options.onhide(e);n.title;history.pushState("",document.title,window.location.pathname+window.location.search)},onhidden:function(e){var t=!1;n.changesApplied||(n.cancelSettings(),t=!0),n.options.onhidden&&n.options.onhidden(e,t)}})}function DlgPrint(e,t,a){DlgTaskBase.call(this,"DlgPrint",a.title||"Print",e,t,a);for(var i=this.obj||{},o=i.templates,n=o[0],r=0;r<o.length;r++)if(o[r].name==i.activeTemplate){n=o[r];break}this.templates=o,this.activeTemplate=n,this.resolution=n.resolution||150}function DlgUpload(e,t,a){(a=a||{}).showOKButton=!1,a.cancelButtonTitle="Cancel",a.rtl="rtl"==app.layout,DlgTaskBase.call(this,"DlgUpload",a.title||"Upload",e,t,a);var i=this.obj||{};this.uploadUrl=i.uploadUrl||"/dataset/uploadattachments",this.onUpload=i.onUpload||function(){},this.allowedFileExtensions=i.allowedFileExtensions,this.maxFileSize=i.maxFileSize||(app.UPLOAD_FILE_MAX_SIZE_MB?1024*app.UPLOAD_FILE_MAX_SIZE_MB:3e4)}function LayerTasks(e,t,a,i){var o=this;this.app=e,this.mapContainer=t,this.layer=a,this.layerPermissions={edit:!1,view:!0,isOwner:!1},this.options=i||{},this._initialized=!1,this._activated=!1,this._tasks=[];var n=a.get("custom");if(n)if(n.dataObj&&n.dataObj.id){var r="/datalayer/"+n.dataObj.id+"/info";$.ajax(r,{type:"GET",dataType:"json",success:function(e){e&&(o.layerPermissions.edit=e._userHasPermission_Edit,o.layerPermissions.view=e._userHasPermission_View,o.layerPermissions.isOwner=e._userIsOwner||e._userIsOwnerParent),o._createTasks(),o._activated&&(o.OnDeActivated(),o.OnActivated())},error:function(e,t,a){o._createTasks(),o._activated&&(o.OnDeActivated(),o.OnActivated())}}).done(function(e){})}else o._createTasks()}function VectorLayerSelectTask(e,t,a,i){this._name="VectorLayerSelectTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this.hasEditPermission=this.options.hasEditPermission,this._initialized=!1,this._activated=!1,this._toolbar=null}function VectorLayerEditTask(e,t,a,i){this._name="VectorLayerEditTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this.hasEditPermission=this.options.hasEditPermission,this._initialized=!1,this._activated=!1,this._toolbar=null,this.trackGPS=!1}function VectorLayerAnalysisTask(e,t,a,i){this._name="VectorLayerAnalysisTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this.hasEditPermission=this.options.hasEditPermission,this._initialized=!1,this._activated=!1,this._toolbar=null}function DlgBuffer(e,t,a){DlgTaskBase.call(this,"DlgBuffer",a.title||"Buffer",e,t,a)}function DlgIdentity(e,t,a){DlgTaskBase.call(this,"DlgIdentity",a.title||"Overlay",e,t,a)}function DlgIntersection(e,t,a){DlgTaskBase.call(this,"DlgIntersection",a.title||"Intersection",e,t,a)}function DlgClip(e,t,a){DlgTaskBase.call(this,"DlgClip",a.title||"Clip",e,t,a)}function DlgDissolve(e,t,a){DlgTaskBase.call(this,"DlgDissolve",a.title||"Dissolve",e,t,a)}function DlgVectorSearch(e,t,a){a.showApplyButton=!0,a.applyButtonTitle="Validate",a.closable=!1,a.rtl=!1,a.title||(t.get&&t.get("title")?a.title="Search: "+t.get("title"):a.title="Search"),DlgTaskBase.call(this,"DlgVectorSearch",a.title||"Search",e,t,a)}function DlgVectorTableView(e,t,a){a.showOKButton=!1,a.closable=!1,a.cancelButtonTitle="Close",DlgTaskBase.call(this,"DlgVectorTableView",a.title||"Attributes",e,t,a)}function DlgOSMFilter(e,t,a){(a=a||{}).closable=!1,a.showOKButton=!1,a.showApplyButton=!0,a.applyButtonTitle="Search",DlgTaskBase.call(this,"DlgOSMFilter",a.title||"Select OSM Keys",e,t,a),this.keys=[{key:"amenity",values:["bar","bbq","biergarten","cafe","drinking_water","fast_food","food_court","ice_cream","pub","restaurant","college","kindergarten","library","archive","public_bookcase","school","music_school","driving_school","language_school","university","research_institute","bicycle_parking","bicycle_repair_station","bicycle_rental","boat_rental","boat_sharing","buggy_parking","bus_station","car_rental","car_sharing","car_wash","vehicle_inspection","charging_station","ferry_terminal","fuel","grit_bin","motorcycle_parking","parking","parking_entrance","parking_space","taxi","ticket_validator","atm","bank","bureau_de_change","baby_hatch","clinic","dentist","doctors","hospital","nursing_home","pharmacy","social_facility","veterinary","arts_centre","brothel","casino","cinema","community_centre","fountain","gambling","music_venue","nightclub","planetarium","social_centre","stripclub","studio","swingerclub","theatre","animal_boarding","animal_shelter","baking_oven","bench","clock","courthouse","coworking_space","crematorium","crypt","dive_centre","dojo","embassy","fire_station","firepit","game_feeding","grave_yard","gym","hunting_stand","internet_cafe","kitchen","kneipp_water_cure","marketplace","photo_booth","place_of_worship","police","post_box","post_depot","post_office","prison","public_bath","public_building","ranger_station","recycling","rescue_station","rv_storage","sanitary_dump_station","sauna","shelter","shower","table","telephone","toilets","townhall","vending_machine","waste_basket","waste_disposal","waste_transfer_station","watering_place","water_point","user defined"]},{key:"boundary",values:["aboriginal_lands","administrative","historic","maritime","marker","national_park","political","postal_code","protected_area","religious_administration","user defined"]},{key:"highway",values:["motorway","trunk","primary","secondary","tertiary","unclassified","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","living_street","service","pedestrian","track","bus_guideway","escape","raceway","road","footway","bridleway","steps","path"]},{key:"landuse",values:["commercial","construction","industrial","residential","retail","allotments","basin","brownfield","cemetery","conservation","depot","farmland","farmyard","forest","garages","grass","greenfield","greenhouse_horticulture","landfill","meadow","military","orchard","pasture","peat_cutting","plant_nursery","port","quarry","railway","recreation_ground","religious","reservoir","salt_pond","village_green","vineyard","user defined"]},{key:"leisure",values:["adult_gaming_centre","amusement_arcade","bandstand","beach_resort","bird_hide","bowling_alley","common","dance","disc_golf_course","dog_park","escape_game","firepit","fishing","fitness_centre","garden","golf_course","hackerspace","horse_riding","ice_rink","marina","miniature_golf","nature_reserve","park","picnic_table","pitch","playground","sauna","slipway","sports_centre","stadium","summer_camp","swimming_area","swimming_pool","track","water_park","wildlife_hide","user defined"]},{key:"man_made",values:["adit","beacon","breakwater","bridge","bunker_silo","campanile","chimney","communications_tower","crane","cross","cutline","clearcut","dovecote","embankment","dyke","flagpole","gasometer","groyne","kiln","lighthouse","mast","maypole","mineshaft","monitoring_station","obelisk","observatory","offshore_platform","petroleum_well","pier","pipeline","pumping_station","reservoir_covered","silo","snow_fence","snow_net","storage_tank","street_cabinet","surveillance","survey_point","telescope","tower","wastewater_plant","watermill","water_tower","water_well","water_tap","water_works","wildlife_crossing","windmill","works","yes","user defined"]},{key:"natural",values:["wood","tree_row","tree","scrub","heath","moor","grassland","fell","bare_rock","scree","shingle","sand","mud","water","wetland","glacier","bay","cape","strait","beach","coastline","spring","hot_spring","geyser","reef","peak","hill","volcano","valley","river_terrace","ridge","arete","cliff","saddle","rock","stone","sinkhole","cave_entrance","user defined"]},{key:"place",values:["country","state","region","province","district","county","municipality","city","borough","suburb","quarter","neighbourhood","city_block","plot","town","village","hamlet","isolated_dwelling","farm","allotments","continent","archipelago","island","islet","square","locality","sea","ocean"]},{key:"water",values:["lake","river","pond","oxbow","lagoon","stream_pool","basin","reservoir","canal","lock","fish_pass","reflecting_pool","moat","wastewater"]},{key:"building",values:["yes","house","residential"]},{key:"source",values:["BAG","Bing","cadastre-dgi-fr source : Direction Générale des Impôts - Cadastre. Mise à jour : 2010","cadastre-dgi-fr source : Direction Générale des Impôts - Cadastre. Mise à jour : 2011","cadastre-dgi-fr source : Direction Générale des Impôts - Cadastre. Mise à jour : 2012","bing","NRCan-CanVec-10.0","YahooJapan/ALPSMAP","cadastre-dgi-fr source : Direction Générale des Finances Publiques - Cadastre. Mise à jour : 2014","cadastre-dgi-fr source : Direction Générale des Finances Publiques - Cadastre. Mise à jour : 2013"]},{key:"addr:housenumber",values:["1","2","3","4","5","6","7","8","10","9"]},{key:"addr:street",values:[]},{key:"name",values:[]},{key:"addr:city",values:[]},{key:"addr:postcode",values:[]},{key:"addr:country",values:["DE","DK","CZ","US","AT","RU","SK","IT","EE","CH"]},{key:"source:date",values:["2014-03-24","2014-02-11","2014-05-07","2013-11-26","2014-05-20","201011","2018-12-14","2014-05-24","2014-01-22","1989-07-01"]},{key:"surface",values:["asphalt","unpaved","paved","ground","gravel","concrete","paving_stones","dirt","grass","compacted"]},{key:"power",values:["tower","pole","line","generator","substation","minor_line"]},{key:"waterway",values:["stream","ditch","river","drain","canal","riverbank"]},{key:"start_date",values:["1970","1950","1972","1975","1960","1980","1973","1965","1974","1955"]},{key:"oneway",values:["yes","no"]},{key:"tiger:cfcc",values:["A41","A74","A51","A31"]},{key:"tiger:county",values:[]},{key:"building:levels",values:["1","2","3","5","4","6","9"]},{key:"wall",values:["no"]},{key:"tiger:reviewed",values:["no","yes"]},{key:"ref",values:["1"]},{key:"height",values:["6","3","5","2 m","4.3","4.0","4.5","4.2","4.1","4.4"]},{key:"created_by",values:["JOSM","almien_coastlines","ArcGIS Exporter","polyshp2osm","Merkaartor 0.12","Potlatch 0.10f","Merkaartor 0.13"]},{key:"maxspeed",values:["50","30","40","60","80","30 mph","70","100","25 mph","20"]},{key:"ref:bag",values:[]},{key:"barrier",values:["fence","wall","gate","hedge","bollard","lift_gate","retaining_wall","kerb"]},{key:"service",values:["driveway","parking_aisle","alley","spur","yard","siding"]},{key:"lanes",values:["2","1","3","4","5"]},{key:"tiger:name_base",values:[]},{key:"access",values:["private","yes","no","permissive","customers","destination","agricultural","forestry"]},{key:"addr:place",values:[]},{key:"attribution",values:["Office of Geographic and Environmental Information (MassGIS)","NHD","http://wiki.osm.org/wiki/Attribution#LINZ","GeoBase®","Natural Resources Canada","Bakersfield_GIS","http://www.aucklandcouncil.govt.nz/EN/ratesbuildingproperty/propertyinformation/GIS_maps/Pages/opendata.aspx","Fresno_County_GIS","2001 Her Majesty the Queen in Right of Manitoba, as represented by the Minister of Conservation. All rights reserved.","USFS"]},{key:"source:addr",values:["emuia.gugik.gov.pl","EMUiA (emuia.gugik.gov.pl)","ruian","EMUiA (emuia.geoportal.gov.pl)","Maa-amet 2012","uir_adr","Durham Open Data","mapa.um.warszawa.pl","Maa-amet 2013","Rennes Métropole"]},{key:"tiger:name_type",values:["Rd","St","Dr","Ave","Ln","Ct","Cir","Pl","Way","Blvd"]},{key:"type",values:["multipolygon","restriction","route","boundary","associatedStreet","public_transport","site"]},{key:"ele",values:[]},{key:"layer",values:["1","-1","2","0"]},{key:"tracktype",values:["grade3","grade2","grade4","grade1","grade5"]},{key:"addr:suburb",values:[]},{key:"addr:state",values:["MD","FL","KY","NC","AR","CA","VA","CO","AZ","MN"]},{key:"operator",values:["RTE","PGL LP","DB Netz AG","Enedis","London Borough of Southwark"]},{key:"tiger:tlid",values:[]},{key:"tiger:source",values:["tiger_import_dch_v0.6_20070829","tiger_import_dch_v0.6_20070830","tiger_import_dch_v0.6_20070813","tiger_import_dch_v0.6_20070809","tiger_import_dch_v0.6_20070810","tiger_import_dch_v0.6_20070812","tiger_import_dch_v0.6_20070828","tiger_import_dch_v0.6_20070808"]},{key:"foot",values:["yes","designated","no","permissive"]},{key:"railway",values:["rail","level_crossing","switch","abandoned","buffer_stop","signal","platform","crossing","disused","station"]},{key:"bicycle",values:["yes","no","designated","use_sidepath","dismount","permissive"]},{key:"tiger:zip_left",values:[]},{key:"tiger:upload_uuid",values:[]},{key:"bridge",values:["yes","viaduct"]},{key:"shop",values:["convenience","supermarket","clothes","hairdresser","bakery","car_repair","yes","car","kiosk","beauty"]},{key:"tiger:zip_right",values:[]},{key:"addr:city:simc",values:["0918123"]},{key:"yh:WIDTH",values:["3.0m〜5.5m","1.5m〜3.0m","1.5m未満","5.5m〜13.0m"]},{key:"addr:conscriptionnumber",values:[]},{key:"lit",values:["yes","no"]},{key:"name:en",values:[]},{key:"tiger:separated",values:["no"]},{key:"note",values:["National-Land Numerical Information (River) 2006, MLIT Japan","Ne pas déplacer ce point, cf. - Do not move this node, see - http://wiki.openstreetmap.org/wiki/WikiProject_France/Repères_Géodésiques#Permanence_des_rep.C3.A8res","National-Land Numerical Information (Public Facility) 2006, MLIT Japan","National-Land Numerical Information (Lake and Pond) 2005, MLIT Japan","National-Land Numerical Information (River) 2009, MLIT Japan","National-Land Numerical Information (Railway) 2007, MLIT Japan","verificare se man_made=works","Accurate as of 2010","Nekonzistence cuzk:km a mvcr:adresa"]},{key:"ref:ruian:building",values:[]},{key:"lacounty:bld_id",values:[]},{key:"lacounty:ain",values:[]},{key:"building:ruian:type",values:["7","3","18","19","8","13","6","5","16","15"]},{key:"addr:province",values:["Cavite","Batangas","Misamis Oriental","Zambales","Bataan","Nova Scotia","Leyte","Ilocos Sur","Abra","Metro Manila"]},{key:"building:units",values:["1","2","3","4"]},{key:"source_ref",values:["http://wiki.osm.org/wiki/GSI_KIBAN","http://www.linz.govt.nz/topography/topo-maps/","http://nlftp.mlit.go.jp/ksj/jpgis/datalist/KsjTmplt-W05.html","http://nlftp.mlit.go.jp/ksj/jpgis/datalist/KsjTmplt-A13.html","http://nlftp.mlit.go.jp/ksj/jpgis/datalist/KsjTmplt-P02-v2_0.html","http://nlftp.mlit.go.jp/ksj/jpgis/datalist/KsjTmplt-W09.html","http://nlftp.mlit.go.jp/ksj/jpgis/datalist/KsjTmplt-N02-v1_1.html","http://wiki.openstreetmap.org/wiki/JA:GSI_KIBAN/Using_GSI_KIBAN_WMS"]},{key:"leaf_type",values:["broadleaved","needleleaved","mixed","broadl-leaved"]},{key:"addr:municipality",values:["Aarhus","Aalborg","København","Odense","Vejle","Esbjerg","Viborg","Silkeborg","Hjørring","Odsherred"]},{key:"osak:identifier",values:[]},{key:"yh:STRUCTURE",values:["地上","通常水涯線","橋"]},{key:"yh:TYPE",values:["その他一般道","海岸線","一般都道府県道","主要地方道（都道府県道）","構内道路"]},{key:"roof:shape",values:["gabled","flat","hipped","pyramidal","skillion"]},{key:"yh:TOTYUMONO",values:["供用中"]},{key:"yh:WIDTH_RANK",values:["3","4","5","2"]},{key:"ref:ruian:addr",values:[]},{key:"public_transport",values:["platform","stop_position","stop_area","station"]},{key:"crossing",values:["uncontrolled","zebra","traffic_signals","unmarked","marked","island"]},{key:"addr:interpolation",values:["even","odd"]},{key:"import",values:["yes","budovy201004","budovy201004drev","freemapkapor"]},{key:"intermittent",values:["yes","no"]},{key:"is_in",values:["Iraq , جمهورية العراق","Republic of Yemen , جمهورية اليمن","Elche/Elx, Alicante/Alacant, Comunidad Valenciana, España, Europa","Saudi Arabia , المملكة العربية السعودية"]},{key:"NHD:FCode",values:["46003","46006","39004","55800","46600","33600","46007","39010","39001"]},{key:"ref:linz:address_id",values:[]},{key:"tourism",values:["information","hotel","attraction","viewpoint","guest_house","picnic_site","artwork","camp_site","museum","hostel"]},{key:"NHD:ComID",values:[]},{key:"tunnel",values:["culvert","yes","building_passage","no"]},{key:"entrance",values:["yes","main","staircase","home","service"]},{key:"NHD:ReachCode",values:[]},{key:"footway",values:["sidewalk","crossing"]},{key:"building:flats",values:["1","2","3","4","0"]},{key:"width",values:["2","3","1","4","5","2.5","1.5","0.5","6","12.2"]},{key:"gauge",values:["1435","1520","1067","1000","1676","1668","1524"]},{key:"website",values:[]},{key:"addr:street:sym_ul",values:["10898","20254","17011","21970","03839"]},{key:"NHD:RESOLUTION",values:["High"]},{key:"sport",values:["soccer","tennis","basketball","baseball","multi","swimming","golf","equestrian","athletics","running"]},{key:"admin_level",values:["8","10","6","9","7","4","2","5"]},{key:"electrified",values:["contact_line","no","rail"]},{key:"source:geometry",values:["geoportal.gov.pl:BDOT","geoportal.gov.pl, GPS","geoportal.gov.pl:ortofoto","GRB","Bing","bing","Esri World Imagery","maps4bw (LGL, www.lgl-bw.de); Mapbox Satellite","Bing 2012","Maps4BW, LGL, www.lgl-bw.de"]},{key:"leaf_cycle",values:["deciduous","evergreen","mixed","semi_deciduous","semi_evergreen"]},{key:"smoothness",values:["good","excellent","intermediate","bad","very_bad","horrible","very_horrible"]},{key:"voltage",values:["25000","15000","3000","1500","110000","750","20000","600","132000","220000"]},{key:"wheelchair",values:["yes","no","limited"]},{key:"area",values:["yes","no"]},{key:"sidewalk",values:["both","no","none","right","left","separate"]},{key:"opening_hours",values:["24/7","Mo-Su 09:00-21:00"]},{key:"bus",values:["yes"]},{key:"nhd:reach_code",values:[]},{key:"source:maxspeed",values:["sign","DE:urban","PL:urban","IT:urban","DE:zone30",'FDOT "Maximum Speed Limits" GIS data, updated August 27, 2011: http://www.dot.state.fl.us/planning/statistics/gis/roaddata.shtm',"DE:rural","DE:zone:30","FR:urban","AT:urban"]},{key:"network",values:["lwn","rwn","rcn","NTF-4","lcn","S","VRR","VOR","RMV","ru:regional"]},{key:"phone",values:[]},{key:"NHD:way_id",values:[]},{key:"description",values:["Wohnhaus (allgemein)","Parken (allgemein)","Annexe","Gebäude (allgemein)"]},{key:"NHD:FType",values:["StreamRiver","ArtificialPath","CanalDitch"]},{key:"tiger:name_direction_prefix",values:["N","E","W","S","SW","NW","NE","SE"]},{key:"fixme",values:["continue","Import CTR Veneto. Sostituire con building=stable (stalla) o building=barn (fienile)","resurvey","no population estimate available, defaulted to village","Revisar: este punto fue creado por importación directa","name","yes","Duplicate address in import (zdublowany adres w promieniu 100 metrów; do weryfikacji)","draw geometry and delete this point","Duplicate address in import (zdublowany adres w promieniu 100 metrów)"]},{key:"building:material",values:["cement_block","brick","plaster","wood","concrete","metal","stone","mud","steel","glass"]},{key:"wikidata",values:[]},{key:"nhd:com_id",values:[]},{key:"parking",values:["surface","underground","multi-storey"]},{key:"emergency",values:["fire_hydrant","yes","phone","defibrillator","no","water_tank"]},{key:"gnis:feature_id",values:[]},{key:"tiger:name_base_1",values:[]},{key:"mml:class",values:["36311","42261","35412","42161","42211","42231","34100","35300","32611","36312"]},{key:"religion",values:["christian","muslim","buddhist","shinto","hindu"]},{key:"restriction",values:["no_u_turn","no_left_turn","only_straight_on","no_right_turn","only_right_turn","only_left_turn","no_straight_on"]},{key:"frequency",values:["50","0","16.7","60","16.67"]},{key:"wikipedia",values:[]},{key:"nycdoitt:bin",values:["4000000","3000000"]},{key:"nhd:fdate",values:["Tue Mar 04 00:00:00 PST 2008","Sat Apr 05 00:00:00 PDT 2008","Mon Mar 24 00:00:00 PDT 2008","Fri May 09 00:00:00 PDT 2008","Thu Feb 28 00:00:00 PST 2008","Thu Dec 27 00:00:00 PST 2007","Thu May 27 00:00:00 PDT 2010","Fri Mar 08 00:00:00 PST 2002","Wed May 26 00:00:00 PDT 2010","Thu Mar 28 00:00:00 PST 2002"]},{key:"source:name",values:["OS_OpenData_Locator","Nomenclator Geográfico Básico de España","IBGE","GNS","survey","OS_OpenData_StreetView","Red de Nivelación de Alta Precisión","LPI NSW Base Map","Nomenclátor Geográfico de Municipios y Entidades de Población","services.land.vic.gov.au"]},{key:"gnis:fcode",values:["46003","46007","46006","55800","39004","39001","33600"]},{key:"motor_vehicle",values:["no","yes","private","destination","agricultural","forestry","designated","permissive"]},{key:"name:ru",values:[]},{key:"gnis:ftype",values:["StreamRiver","ArtificialPath","CanalDitch","LakePond"]},{key:"species",values:["Acer platanoides","Aesculus hippocastanum","Juglans regia","Tilia cordata","Pinus mugo","Acer pseudoplatanus","Fraxinus excelsior","Acer saccharum","Quercus robur","Gleditsia triacanthos"]},{key:"usage",values:["main","branch","industrial","tourism"]},{key:"historic",values:["memorial","wayside_cross","ruins","archaeological_site","yes","wayside_shrine","monument","castle","building","charcoal_pile"]},{key:"raba:id",values:["1300","1500","1100","1410","1222","2000","1211","1800"]},{key:"horse",values:["no","yes","designated","permissive","private"]},{key:"alt_name",values:[]},{key:"material",values:["wood","steel","metal","concrete","stone","reinforced_concrete","brick"]},{key:"is_in:state",values:["California","León","Cuenca","Burgos","Asturias","Salamanca","Guadalajara","Zamora","Soria","Palencia"]},{key:"wetland",values:["bog","swamp","marsh","reedbed","wet_meadow","tidalflat","mangrove","saltmarsh"]},{key:"roof:material",values:["roof_tiles","tile","metal","concrete","tar_paper","asbestos","eternit","metal sheet","glass","slate"]},{key:"name_1",values:[]},{key:"building:part",values:["yes","roof"]},{key:"denotation",values:["urban","avenue","natural_monument","landmark","agricultural","street"]},{key:"fire_hydrant:type",values:["underground","pillar"]},{key:"is_in:country",values:["United States of America","Kuwait","Indonesia","Spain","Nigeria","Iran","España","USA","România","Ethiopia"]},{key:"shelter",values:["yes","no"]},{key:"addr:district",values:["Усть-Лабинский район","Лабинский район","Chittagong","Narail","Natore","Лискинский район","Fatih","Arua","North Lanarkshire"]},{key:"LINZ:source_version",values:["2012-06-06","V16"]},{key:"gnis:created",values:["12/01/2003","05/19/1980","11/30/1979","01/23/1980","09/01/1992","06/17/1980","01/19/1981","09/25/1979","08/01/1994","10/13/1978"]},{key:"cycleway",values:["lane","no","track","opposite","shared_lane","shared","crossing","opposite_lane"]},{key:"roof:colour",values:["grey","red","black","#999999","gray","brown","white","maroon","silver","darkgrey"]},{key:"addr:streetnumber",values:["1","3","4","2","5","6","7","8","10","9"]},{key:"is_in:state_code",values:["CA","24","16","9","33","37","19","49","42","34"]},{key:"chicago:building_id",values:[]},{key:"gnis:county_id",values:["031","005","003","001","013","017","037","009","019","025"]},{key:"LINZ:layer",values:["tree_pnt","native_poly","scrub_poly","cliff_edge","exotic_poly","scattered_scrub_poly","river_cl","drain_cl","track_cl","lake_poly"]},{key:"gnis:state_id",values:["48","06","47","13","39","01","36","17","51","28"]},{key:"addr:full",values:[]},{key:"postal_code",values:["71019"]},{key:"cuisine",values:["regional","pizza","burger","italian","chinese","coffee_shop","sandwich","mexican","japanese","indian"]},{key:"LINZ:dataset",values:["mainland","lds_geodetic"]},{key:"route",values:["road","bus","hiking","bicycle","foot","ferry","mtb","power","railway","train"]},{key:"at_bev:addr_date",values:["2017-10-01","2017-04-07","2016-10-02","2018-04-02","2018-10-01"]},{key:"NHD:FDate",values:["2004/12/17","2005/04/02","2003/10/01","2006/05/04","2005/08/26","2006/05/17","2004/11/11","2006/03/29","2007/08/08","2003/10/14"]},{key:"NHD:FTYPE",values:["LakePond","SwampMarsh","StreamRiver","ArtificialPath","Reservoir"]},{key:"building:use",values:["residential","commercial","residential;industrial","car_repair","industrial","garage"]},{key:"junction",values:["roundabout","yes"]},{key:"source:position",values:["Bing","Sentinel-2","DigitalGlobe Standard","bing HR(0,0)","Bing Imagery","bing HR(0;0)","Landsat","MapBox (0,0)","HiRes aerial imagery","bing"]},{key:"source:conscriptionnumber",values:["kapor2"]},{key:"addr:street:name",values:[]},{key:"level",values:["0","1","-1","2","-2","3","-1;0","0;1"]},{key:"note:ja",values:["国土数値情報(河川データ)平成18年国土交通省","国土数値情報（公共施設データ）平成19年　国土交通省","国土数値情報（湖沼データ）平成17年　国土交通省","国土数値情報(河川データ)平成21年度 国土交通省","国土数値情報（鉄道データ）平成19年　国土交通省","国土数値情報（行政区域データ）平成20年　国土交通省"]},{key:"noexit",values:["yes","no"]},{key:"addr:street:type",values:["Avenue","Street","Place","Road","Drive","Boulevard","Lane","Court"]},{key:"it:fvg:ctrn:code",values:["4AED","4ABA","4AAF","4AIN","4AEL"]},{key:"denomination",values:["catholic","roman_catholic","baptist","sunni","orthodox","lutheran","protestant","anglican","methodist","russian_orthodox"]},{key:"it:fvg:ctrn:revision",values:["1A0","000","1AN","1AM"]},{key:"traffic_sign",values:["city_limit","maxspeed","NL:G11","NL:G12a","DE:240","FI:511","DE:274.1[30]","NL:G13","stop","FI:372"]},{key:"ref:ruian",values:[]},{key:"name:ja",values:["セブン-イレブン"]},{key:"hgv",values:["designated","yes","no","destination","delivery","local"]},{key:"design",values:["h-frame","three-level","delta","barrel","triangle","asymmetric","monopolar","flag","two-level","donau"]},{key:"lanes:backward",values:["1","2","3","4"]},{key:"direction",values:["forward","backward","clockwise","both"]},{key:"genus",values:["Acer","Platanus","Tilia","Fraxinus","Aesculus","Quercus","Elaeis","Picea","Celtis","Populus"]},{key:"survey:date",values:["2013","2013-12-10","2010"]},{key:"fee",values:["no","yes"]},{key:"information",values:["guidepost","board","map","office","route_marker","trail_blaze"]}]}function DlgOSMShapeTypeSelection(e,t,a){DlgTaskBase.call(this,"DlgOSMShapeTypeSelection",a.title||"Select shape type",e,t,a)}function DlgOSMTagSelection(e,t,a){(a=a||{}).dialogSize=BootstrapDialog.SIZE_WIDE,DlgTaskBase.call(this,"DlgOSMTagSelection",a.title||"Select shape type",e,t,a)}function DlgAddGeoJSON(e,t,a){DlgTaskBase.call(this,"DlgAddGeoJSON",a.title||"Add GeoJSON",e,t,a)}function DlgWCS(e,t,a){a.showOKButton=!1,a.cancelButtonTitle="Close",DlgTaskBase.call(this,"DlgWCS",a.title||"WCS Service",e,t,a)}function IdentifyTask(e,t,a){this._name="IdentifyTask",this.app=e,this.mapContainer=t,this.options=a||{},this._initialized=!1,this._activated=!1,this._toolbar=null}function wmsLayerTask(e,t,a,i){this._name="wmsLayerTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this._initialized=!1,this._activated=!1,this._toolbar=null}function RasterLayerValueTask(e,t,a,i){this._name="RasterLayerValueTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this._initialized=!1,this._activated=!1,this._toolbar=null}function RasterLayerAnalysisTask(e,t,a,i){this._name="RasterLayerAnalysisTask",this.app=e,this.mapContainer=t,this.layer=a,this.options=i||{},this._initialized=!1,this._activated=!1,this._toolbar=null}function DlgSlope(e,t,a){DlgTaskBase.call(this,"DlgSlope",a.title||"Slope",e,t,a)}function DlgHillshade(e,t,a){DlgTaskBase.call(this,"DlgHillshade",a.title||"Hillshade",e,t,a)}function DlgRasterClassify(e,t,a){DlgTaskBase.call(this,"DlgRasterClassify",a.title||"Classify Raster",e,t,a)}function DlgRasterClip(e,t,a){(a=a||{}).closable=!1,DlgTaskBase.call(this,"DlgRasterClip",a.title||"Clip raster",e,t,a)}function DlgRasterPointBasedFloodArea(e,t,a){(a=a||{}).closable=!1,DlgTaskBase.call(this,"DlgRasterPointBasedFloodArea",a.title||"Point-based flood area",e,t,a)}function MeasureTasks(e,t,a){this.app=e,this.mapContainer=t,this.map=t.map,this.options=a||{},this._initialized=!1,this._activated=!1,this._toolbar=null,this._subBar=null,this.interaction=void 0,this.layer=void 0,this.sourc=void 0,this.helpTooltipElement=void 0,this.helpTooltip=void 0,this.measureTooltipElement=void 0,this.measureTooltip=void 0,this.sketch=void 0,this.overlays=[],this.task=null}function RouteTasks(e,t,a){this.app=e,this.mapContainer=t,this.map=t.map,this.options=a||{},this._initialized=!1,this._activated=!1,this._toolbar=null,this._subBar=null,this.interaction=void 0,this.layer=void 0,this.sourc=void 0,this.helpTooltipElement=void 0,this.helpTooltip=void 0,this.measureTooltipElement=void 0,this.measureTooltip=void 0,this.sketch=void 0,this.overlays=[],this.routeStopPoints=[],this.routeStopFeatures=[],this.segementFeature=null,this.task=null,this.tabId="tabRoute",this.tabLayersId="tabLayers",this._tabContent=null,this._tab=null,this.routeProfile="driving-car"}function GeolocationTasks(e,t,a){this.app=e,this.mapContainer=t,this.map=t.map,this.options=a||{},this._initialized=!1,this._activated=!1,this._toolbar=null,this._subBar=null,this.interaction=void 0,this.interactionSnap=void 0,this.layer=void 0,this.sourc=void 0,this.measureTooltipElement=void 0,this.measureTooltip=void 0,this.overlays=[],this.keepCenter=!1,this.zoomToLocation=!1,this._tracking=!1,e.geolocationTasks=this}function MapContainer(e,t){this.app=e,this.options=t||{},this.mapSettings={},this.sourceFactory=new SourceFactory(e,{}),this.sorceFactory=this.sourceFactory,this.leftToolbar=null,ol.Object.call(this,{currentTool:null,currentEditAction:null})}function LayerGeneralTab(){this.tabId=LayerGeneralTab.TabId}function LayerStyleTab(){this.tabId="tabStyle"}function LayerLabelTab(){this.tabId="LayerLabelTab"}function LayerSourceTab(){this.tabId="tabSource"}function FeatureAttributesTab(e){e=e||{},this.tabId="tabFeatureAttributes"+(e.id?e.id:"")}function FeatureShapeTab(e){e=e||{},this.tabId="tabFeatureShape"+(e.id?e.id:"")}function FeaturePointTab(e){e=e||{},this.tabId="tabFeaturePoint"+(e.id?e.id:"")}function StyleImageTab(){this.tabId="StyleImageTab",this.caption="Point"}function StyleFillTab(){this.tabId="StyleFillTab",this.caption="Polygon"}function StyleStrokeTab(){this.tabId="StyleStrokeTab",this.caption="Line"}function RasterDisplayTab(){this.tabId="tabRasterDisplay"}function ObjectPropertiesDlg(e,t,a){var i=this;this.mapContainer=e,this.obj=t,this.options=a||{},this.isNew=a.isNew,this.title=a.title;var o=void 0===a.closable||a.closable;this._closeWithBackButton=void 0===a.closeWithBackButton||a.closeWithBackButton,this.activeTabIndex=a.activeTabIndex,this.title||(t.get&&t.get("title")?this.title=t.get("title")+" properties":this.title="Properties"),this.cancelHandlers=[],this.beforeApplyHandlers=[],this.applyHandlers=[],this.body=$("<div></div>");this.tabPanel=$('<div id="tabPanel"><ul id="tabPanel_nav" class="nav  nav-pills__ nav-tabs nav-tab-bar_"></ul><div id="tabPanel_content" class="tab-content clearfix_"></div></div>').appendTo(this.body),this.tabPanelNav=this.tabPanel.find("#tabPanel_nav"),this.tabPanelContent=this.tabPanel.find("#tabPanel_content"),this.propertyTabs=a.tabs,this.propertyTabs||(this.propertyTabs=[new LayerGeneralTab,new LayerStyleTab,new LayerSourceTab]);for(var n=0;n<this.propertyTabs.length;n++){var r=this.propertyTabs[n];r&&r.init&&r.init(this)}this.dlg=new BootstrapDialog({title:this.title,message:this.body,draggable:!0,closable:o,closeByBackdrop:!0,closeByKeyboard:!0,buttons:[{label:"OK",cssClass:"btn-primary",action:function(e){i.apply()&&(i.changesApplied=!0,e.close(),i.options.onapply&&i.options.onapply(e))}},{label:"Close",action:function(e){e.close()}}],onshow:function(e){if(i.options.helpLink){var t='<a title="Help" class="close" style=" float: right; margin-right: .5em;" ';t+=' target="_blank" href="'+i.options.helpLink+'"',t+=">?</a>",e.getModalHeader().find(".bootstrap-dialog-header").append(t)}i.options.onshow&&i.options.onshow(e);var a=i.title;window.location.hash=a,window.onhashchange=function(){!location.hash&&i._closeWithBackButton&&e.close()}},onshown:function(e){i.options.onshown&&i.options.onshown(e);for(var t=0;t<i.propertyTabs.length;t++){var a=i.propertyTabs[t];a&&a.onshown&&a.onshown()}if(i.activeTabIndex)try{i.propertyTabs[i.activeTabIndex].activate()}catch(e){}},onhide:function(e){i.options.onhide&&i.options.onhide(e);i.title;history.pushState("",document.title,window.location.pathname+window.location.search)},onhidden:function(e){var t=!1;i.changesApplied||(i.cancelSettings(),t=!0),i.options.onhidden&&i.options.onhidden(e,t)}})}FeatureLabeler.prototype.getName=function(){return this.name},FeatureLabeler.prototype.getSize=function(){try{return parseFloat(this.size)}catch(e){}return this.size},FeatureLabeler.prototype.clone=function(){return new FeatureLabeler(this.toJson())},FeatureLabeler.prototype.toJson=function(){return{fieldName:this.fieldName,disabled:this.disabled,type:this.type,align:this.align,baseline:this.baseline,rotation:this.rotation,font:this.font,weight:this.weight,placement:this.placement,maxangle:this.maxangle,overflow:this.overflow,size:this.size,offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,outline:this.outline,outlineWidth:this.outlineWidth,maxreso:this.maxreso}},FeatureLabeler.prototype.fromJson=function(e){e&&(void 0!==e.disabled&&(this.disabled=e.disabled),void 0!==e.fieldName&&(this.fieldName=e.fieldName),void 0!==e.type&&(this.type=e.type),void 0!==e.align&&(this.align=e.align),void 0!==e.baseline&&(this.baseline=e.baseline),void 0!==e.rotation&&(this.rotation=e.rotation),void 0!==e.font&&(this.font=e.font),void 0!==e.weight&&(this.weight=e.weight),void 0!==e.placement&&(this.placement=e.placement),void 0!==e.maxangle&&(this.maxangle=e.maxangle),void 0!==e.overflow&&(this.overflow=e.overflow),void 0!==e.size&&(this.size=e.size),void 0!==e.offsetX&&(this.offsetX=e.offsetX),void 0!==e.offsetY&&(this.offsetY=e.offsetY),void 0!==e.color&&(this.color=e.color),void 0!==e.outline&&(this.outline=e.outline),void 0!==e.outlineWidth&&(this.outlineWidth=e.outlineWidth),void 0!==e.maxreso&&(this.maxreso=e.maxreso))},FeatureLabeler.prototype.getTextStyle=function(e,t,a){if(this.disabled)return null;if(void 0===this.fieldName)return null;var i=void 0;a&&a[this.fieldName]&&(i=a[this.fieldName].codedValues);this.overflow;if("'Open Sans'"==this.font&&!app.__openSansAdded){var o=document.createElement("link");o.href="https://fonts.googleapis.com/css?family=Open+Sans",o.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(o),app.__openSansAdded=!0}var n=this.weight+" "+this.size+" "+this.font,r=this.color,s=this.outline,l=parseInt(this.outlineWidth,10),c=this.getText(e,t,i);return null==c?null:new ol.style.Text({textAlign:""==this.align?void 0:this.align,textBaseline:this.baseline,font:n,text:c,fill:new ol.style.Fill({color:r}),stroke:new ol.style.Stroke({color:s,width:l}),offsetX:this.offsetX,offsetY:this.offsetY,placement:this.placement,maxAngle:this.maxAngle,overflow:this.overflow,rotation:this.rotation})},FeatureLabeler.prototype.getText=function(e,t,a){var i=this.type,o=this.maxreso,n="";if(!e||(n=e.get(this.fieldName),a&&(n=a[n]),null!=n))return o<t?n="":"hide"==i?n="":"shorten"==i?n=n.trunc(12):"wrap"!=i||this.placement&&"line"==this.placement||(n=this._stringDivider(n,16,"\n")),n+""},FeatureLabeler.prototype._stringDivider=function(e,t,a){if(e.length>t){for(var i=t;0<i&&" "!=e[i]&&"-"!=e[i];)i--;if(0<i){var o;o="-"==e.substring(i,i+1)?e.substring(0,i+1):e.substring(0,i);var n=e.substring(i+1);return o+a+this._stringDivider(n,t,a)}}return e},SourceFactory.prototype.createBaseTileSource=function(e){return e?"OSM"==e.type?new ol.source.OSM({crossOrigin:"Anonymous"}):"BingMaps"==e.type?new ol.source.BingMaps({key:e.key,imagerySet:e.imagerySet}):"XYZ"==e.type?(e.params.crossOrigin="Anonymous",new ol.source.XYZ(e.params)):void 0:null},SourceFactory.prototype.createWMSSource=function(e){if(!e)return null;var t=e.details;try{("string"==typeof t||t instanceof String)&&(t=JSON.parse(t))}catch(e){}var a=t.url;app.url_needs_proxy(a)&&(a="/proxy/?url="+encodeURIComponent(a));var i=t.params||{};i.TILED=!0;var o=new ol.source.TileWMS({url:a,params:i,serverType:t.serverType,crossOrigin:"Anonymous"});return o.set("details",t),o},SourceFactory.prototype.createWFSSource=function(e,t){if(!e)return null;var a=e.details;try{("string"==typeof a||a instanceof String)&&(a=JSON.parse(a))}catch(e){}var i=a.url;app.url_needs_proxy(i)&&(i="/proxy/?url="+encodeURIComponent(i));var o=a.params||{};o.version=o.version||"1.1.0",o.srsname=o.srsname||"EPSG:3857";var n=o.typename;n&&n.indexOf(":")&&(n=n.split(":")[1]);var r=new ol.format.GML({featureNS:o.typenameNamespace||a.url,featureType:n,srsName:o.srsname}),s=(new XMLSerializer,new ol.format.WFS),l=new ol.source.Vector({format:s,loader:function(e){$.ajax(i,{type:"GET",data:{service:"WFS",version:"1.1.0",request:"GetFeature",typename:o.typename,srsname:o.srsname,bbox:e.join(",")+",EPSG:3857"},success:function(e){},error:function(e,t,a){}}).done(function(e){l.addFeatures(s.readFeatures(e))})},strategy:ol.loadingstrategy.bbox,projection:o.srsname});return l.set("formatGML",r),l.set("details",a),l},SourceFactory.prototype.createOsmVectorSource=function(e,c){if(!e)return null;var d=c.map.getView(),t=e.details,a=e.options||{},p=void 0,u=a.shapeType||"Point";a.info&&(p=a.info.epsg4326Extent);var h="";a.info&&(h=a.info.filterExpression);try{("string"==typeof t||t instanceof String)&&(t=JSON.parse(t))}catch(e){}var f=new ol.format.OSMXML,m=new ol.source.Vector({format:f,loader:function(e,t,a){var i=ol.proj.transformExtent(e,a,"EPSG:4326");isFinite(e[0])||(i=c.getCurrentGeoExtentArray()),i=p||i;var o=function(e){if(e){for(var t=[],a=0;a<e.length;a++){var i=e[a],o=i.getGeometry();if(o){var n=o.getType();"Point"==n?n="Point":"LineString"==n||"MultiLineString"==n?n="MultiLineString":"Polygon"!=n&&"MultiPolygon"!=n||(n="MultiPolygon"),u==n&&t.push(i)}}m.addFeatures(t)}};m.set("loading_status","started");var n=m.get("initFeatures");if(n)return o(n),m.set("initFeatures",null),void m.set("loading_status","complete");var r=new XMLHttpRequest;r.open("POST",app.overpassApiServer),r.addEventListener("load",function(){var e=f.readFeatures(r.responseText,{featureProjection:d.getProjection()});o(e),m.set("loading_status","complete")});var s="("+i[1]+","+i[0]+","+i[3]+","+i[2]+")",l="(node"+h+s+";";l+="way"+h+s+";",l+="rel"+h+s+";",l+=");(._; >;);out meta;",r.send(l)}});return m.set("formatOSMXML",f),m.set("details",t),m.set("loading_status",""),m},SourceFactory.prototype.createGeoJsonVectorSource=function(t,e){if(!t)return null;var a,r,o=e.map.getView().getProjection(),s=t.details;try{("string"==typeof s||s instanceof String)&&(s=JSON.parse(s))}catch(e){}s.spatialReference&&(s.spatialReference.name||s.spatialReference.srid)&&(r=s.spatialReference.srid,s.spatialReference.name?(a=s.spatialReference.name,!r&&a&&a.indexOf(":")&&(r=a.split(":")[1])):a="EPSG:"+r,s.spatialReference.proj4&&!proj4.defs[a]&&(proj4.defs(a,s.spatialReference.proj4),ol.proj.proj4.register(proj4)));var l=new ol.format.GeoJSON({dataProjection:a||"EPSG:3857"}),c="/datalayer/"+t.id+"/geojson",d=new ol.source.Vector({format:l,url:c,loader:function(e,t,a){s.filter;var i,o=encodeURIComponent(JSON.stringify({})),n=c+"?settings="+o;e&&4<=e.length&&e[2]!=1/0&&(i=(e=ol.extent.applyTransform(e,ol.proj.getTransform(a,l.dataProjection))).join(","),n=c+"?bbox="+i+","+r+"&settings="+o),d.set("loading_status","started"),d.dispatchEvent({type:"loading_started"}),$.ajax(n,{type:"GET",dataType:"json",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable)e.loaded,e.total},!1),e.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);d.set("loading_percent",t),d.dispatchEvent({type:"loading_progress",percentage:t})}},!1),e},success:function(e){if(e){if(e.features){var t=l.readFeatures(e,{featureProjection:a});l.readProjection(e);d.addFeatures(t)}d.set("loading_details",""),d.set("loading_status","complete"),d.dispatchEvent({type:"loading_complete"})}},error:function(e,t,a){d.set("loading_details",a||t),d.set("loading_status","failed"),d.dispatchEvent({type:"loading_failed",xhr:e,statusText:t})}}).done(function(e){})}});return d.set("details",s),d.set("shapeType",s.shapeType),d.set("loading_status",""),d.on("change:loading_status",function(e,t){}),d.on("loading_failed",function(e){}),d.requestExtent=function(a,i){var e="/datalayer/"+t.id+"/vectorextent";$.ajax(e,{type:"GET",dataType:"json",success:function(e){if(e)try{var t=l.readFeatures(e,{featureProjection:o})[0].get("geometry").getExtent();a&&a(t)}catch(e){}},error:function(e,t,a){i&&i(e,t,a)}}).done(function(e){})},d},SourceFactory.prototype.createGeoJsonVectorSource_native=function(e){if(!e)return null;var t,a,i=e.details;try{("string"==typeof i||i instanceof String)&&(i=JSON.parse(i))}catch(e){}i.spatialReference&&(i.spatialReference.name||i.spatialReference.srid)&&(a=i.spatialReference.srid,i.spatialReference.name?(t=i.spatialReference.name,!a&&t&&t.indexOf(":")&&(a=t.split(":")[1])):t="EPSG:"+a,i.spatialReference.proj4&&!proj4.defs[t]&&(proj4.defs(t,i.spatialReference.proj4),ol.proj.proj4.register(proj4)));var o,n,r,s,l,c,d=new ol.format.GeoJSON({dataProjection:t||"EPSG:3857"}),p="/datalayer/"+e.id+"/geojson",u=new ol.source.Vector({format:d,url:p,loader:(o=p,n=d,r=o,s=n,l=function(e,t){this instanceof ol.source.Vector&&(this.addFeatures(e),this.set("loading_details",""),this.set("loading_status","complete"),this.dispatchEvent({type:"loading_complete"}))},c=function(e,t,a){u.set("loading_details",a||textStatus),this.set("loading_status","failed"),this.dispatchEvent({type:"loading_failed",xhr:e,statusText:t})},function(e,t,i){var o=new XMLHttpRequest,a=this;this.set("loading_status","started"),this.dispatchEvent({type:"loading_started"}),o.open("GET","function"==typeof r?r(e,t,i):r,!0),"arraybuffer"==s.getType()&&(o.responseType="arraybuffer"),o.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);a.set("loading_percent",t),a.dispatchEvent({type:"loading_progress",percentage:t})}},o.onload=function(e){if(!o.status||200<=o.status&&o.status<300){var t,a=s.getType();"json"==a||"text"==a?t=o.responseText:"xml"==a?(t=o.responseXML)||(t=(new DOMParser).parseFromString(o.responseText,"application/xml")):"arraybuffer"==a&&(t=o.response),t?l.call(this,s.readFeatures(t,{featureProjection:i}),s.readProjection(t),s.getLastExtent()):c.call(this,o,o.statusText)}else c.call(this,o,o.statusText)}.bind(this),o.onerror=function(){c.call(this)}.bind(this),o.send()})});return u.set("details",i),u.set("shapeType",i.shapeType),u.set("loading_status",""),u.on("change:loading_status",function(e,t){}),u.on("loading_failed",function(e){}),u},SourceFactory.prototype.createGeoImageSource_old=function(e,t){if(!e)return null;var a=t.map.getView(),i=a.getProjection().getCode();i&&i.indexOf(":")&&(i=i.split(":")[1]),i||(i=3857);var o,n,r=e.details;try{("string"==typeof r||r instanceof String)&&(r=JSON.parse(r))}catch(e){}r.spatialReference&&(r.spatialReference.name||r.spatialReference.srid)&&(n=r.spatialReference.srid,r.spatialReference.name?(o=r.spatialReference.name,!n&&o&&o.indexOf(":")&&(n=o.split(":")[1])):o="EPSG:"+n,r.spatialReference.proj4&&!proj4.defs[o]&&(proj4.defs(o,r.spatialReference.proj4),ol.proj.proj4.register(proj4)));var s=r.metadata_3857,l=18,c=0;r.metadata_3857&&r.metadata_3857.scalex&&(l=a.getZoomForResolution(r.metadata_3857.scalex),(c=(l=Math.floor(l)-1-0)-4)<0&&(c=0));var d="/datalayer/"+e.id+"/rastertile?size=256&x={x}&y={y}&z={z}&srid="+i;d+="&ref_z="+(l-1-0);var p=void 0;if(r.display){var u=JSON.parse(JSON.stringify(r.display));if(u&&u.customColorMap)for(var h=0;h<u.customColorMap.length;h++)delete u.customColorMap[h].caption;"POST",p="display="+encodeURIComponent(JSON.stringify(u)),d.length+p.length<2e3&&("GET",d+="&"+p)}var f=new ol.source.XYZ({url:d,tileSize:[256,256],maxZoom:l,minZoom:c});return f.getExtent=function(){return[s.upperleftx,s.upperlefty+s.scaley*s.height,s.upperleftx+s.scalex*s.width,s.upperlefty]},f.set("details",r),f},SourceFactory.prototype.createGeoImageSource=function(e,t){if(!e)return null;var a=t.map.getView(),i=a.getProjection().getCode();i&&i.indexOf(":")&&(i=i.split(":")[1]),i||(i=3857);var o,n,r=e.details;try{("string"==typeof r||r instanceof String)&&(r=JSON.parse(r))}catch(e){}r.spatialReference&&(r.spatialReference.name||r.spatialReference.srid)&&(n=r.spatialReference.srid,r.spatialReference.name?(o=r.spatialReference.name,!n&&o&&o.indexOf(":")&&(n=o.split(":")[1])):o="EPSG:"+n,r.spatialReference.proj4&&!proj4.defs[o]&&(proj4.defs(o,r.spatialReference.proj4),ol.proj.proj4.register(proj4)));var s=r.metadata_3857,l=18,c=0;r.metadata_3857&&r.metadata_3857.scalex&&(l=a.getZoomForResolution(r.metadata_3857.scalex),(c=(l=Math.floor(l)-1-0)-4)<0&&(c=0));var d="/datalayer/"+e.id+"/rastertile?size=256&x={x}&y={y}&z={z}&srid="+i;d+="&ref_z="+(l-1-0);var p=void 0,u="GET";if(r.display){var h=JSON.parse(JSON.stringify(r.display));if(h&&h.customColorMap)for(var f=0;f<h.customColorMap.length;f++)delete h.customColorMap[f].caption;u="POST",p="display="+encodeURIComponent(JSON.stringify(h)),d.length+p.length<2e3&&(u="GET",d+="&"+p)}var m=new ol.source.XYZ({url:d,tileSize:[256,256],maxZoom:l,minZoom:c});return m.setTileLoadFunction(function(a,e){var i=new XMLHttpRequest;i.responseType="blob",m.set("loading_details",""),m.set("loading_status","started"),i.addEventListener("loadend",function(e){var t=this.response;t&&"text/plain"==t.type?(m.set("loading_details",i.statusText||"Failed"),m.set("loading_status","failed"),a.setState(3)):t?(a.getImage().src=URL.createObjectURL(t),m.set("loading_details",""),m.set("loading_status","complete")):a.setState(3)}),i.addEventListener("error",function(){a.setState(3)}),"POST"==u?(i.open(u,e),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(p)):(i.open(u,e),i.send())}),m.getExtent=function(){return[s.upperleftx,s.upperlefty+s.scaley*s.height,s.upperleftx+s.scalex*s.width,s.upperlefty]},m.set("details",r),m},DlgTaskBase.prototype.closed=function(){},DlgTaskBase.prototype.close=function(){this.dlg.close(),this.closed()},DlgTaskBase.prototype.create=function(){this.createUI&&this.createUI(),this.changesApplied=!1},DlgTaskBase.prototype.apply=function(e){for(var t=e.data,a=0;a<this.beforeApplyHandlers.length;a++){var i={cancel:!1,data:t,dialogAction:e.dialogAction};if((0,this.beforeApplyHandlers[a])(i),i.cancel)return!1}for(a=0;a<this.applyHandlers.length;a++){i={cancel:!1,data:t,dialogAction:e.dialogAction};if((0,this.applyHandlers[a])(i),i.cancel)return!1}return!0},DlgTaskBase.prototype.cancelSettings=function(){for(var e=0;e<this.cancelHandlers.length;e++){(0,this.cancelHandlers[e])({dialogAction:"cancel"})}return!0},DlgTaskBase.prototype.show=function(){return this.create(),this.dlg.open(),this},DlgPrint.prototype=Object.create(DlgTaskBase.prototype),DlgPrint.prototype.createUI=function(){var r=this,e="",t="",a=PrintData.resolutions;r.activeTemplate&&(e=r.activeTemplate.thumbnail,t=r.activeTemplate.name,resolution=r.activeTemplate.resolution);var i='<div class="scrollable-content" ><form id="'+r.id+'_form" class="modal-body form-horizontal">';i+='  <div class="form-group">',i+='    <label class="" for="template">Select print template to generate PDF file</label>',i+='    <select class="form-control " id="template" >';for(var o=0;o<this.templates.length;o++){var n=this.templates[o];i+='    <option value="'+n.name+'" '+(n==this.activeTemplate?'selected="selected"':"")+" >"+n.name+"</option>"}for(var s in i+="    </select>",i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="template">Resolution</label>',i+='    <select class="form-control " id="resolution" >',a){var l=a[s];i+='    <option value="'+l+'" '+(l==this.resolution?'selected="selected"':"")+" >"+s+"</option>"}i+="    </select>",i+="  </div>",i+='  <div class="form-group">',i+='    <img id="printThumbnail" style="object-fit: contain; height: 200px; object-position: center; box-shadow: #a4a4ad 10px 10px 10px;" src="'+e+'" class="img-thumbnail center-block" title="'+t+'"  height=""></img>',i+="  </div>",i+='<div class="form-group">',i+='  <label class="col-sm-offset-1_ col-sm-12 checkbox">',i+='   <input type="checkbox" id="downloadPDF" name="downloadPDF"  value="" /> Download PDF file',i+="</label>",i+="</div>",i+="</form>",i+="  </div>";var c=$(i).appendTo(this.mainPanel);c.find("#template").change(function(){d($(this).val())});var d=function(e){for(var t=void 0,a=0;a<r.templates.length;a++){var i=r.templates[a];if(i.name==e){t=i;break}}t&&t.thumbnail?(c.find("#printThumbnail").attr("src",t.thumbnail),c.find("#printThumbnail").attr("title",t.name)):(c.find("#printThumbnail").attr("src",""),c.find("#printThumbnail").attr("title","")),c.find("#resolution").val(t.resolution)},p=$(c.find("#"+r.id+"_form"));p.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(p),$.validator.setDefaults({ignore:t}),p.validate(),!p.valid()){e.cancel=!0;var a=p.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=p.offset().top,r.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){for(var t=c.find("#template").val(),a=r.activeTemplate,i=0;i<r.templates.length;i++){var o=r.templates[i];if(o.name==t){a=o;break}}var n=c.find("#downloadPDF").prop("checked");a.resolution=parseInt(c.find("#resolution").val()),e.data.settings={template:a,downloadPDF:n}}),this.changesApplied=!1},DlgUpload.prototype=Object.create(DlgTaskBase.prototype),DlgUpload.prototype.createUI=function(){var r=this;r.activeTemplate&&(thumbnail=r.activeTemplate.thumbnail,thumbnail_alt=r.activeTemplate.name,resolution=r.activeTemplate.resolution);var e='<div class="scrollable-content" ><form id="'+r.id+'_form" class="modal-body form-horizontal">';e+='  <div class="form-group">',e+='    <div class="file-loading">',e+='            <input id="file" name="file" type="file" multiple>',e+="    </div>",e+="  </div>",e+="</form>",e+="  </div>";var s=$(e).appendTo(this.mainPanel);s.find("#file").change(function(){}),s.find("#file").fileinput({uploadUrl:r.uploadUrl,uploadExtraData:function(){return{}},rtl:!1,uploadAsync:!1,previewFileType:"any",allowedFileExtensions:r.allowedFileExtensions,allowedPreviewTypes:["image","html","text"],maxFileCount:40,maxFileSize:r.maxFileSize}).on("filebatchuploadsuccess",function(e,t,a,i){if(t&&t.response){t.response.results&&t.response.results.length&&r.onUpload(r,t.response.results);for(var o=0;o<t.response.flash.length;o++){var n=t.response.flash[o];n.notify&&$.notify({message:n.msg},{z_index:5e4,type:n.type||"info",delay:n.delay,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}s.find("#file").fileinput("clear")});var n=$(s.find("#"+r.id+"_form"));n.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(n),$.validator.setDefaults({ignore:t}),n.validate(),!n.valid()){e.cancel=!0;var a=n.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=n.offset().top,r.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){}),this.changesApplied=!1},LayerTasks.prototype._createTasks=function(){var e=this.layer,t=this.layer.get("custom");if(t){if("ol.layer.Vector"===t.type&&t.dataObj&&"ol.source.Vector"===t.source){var a=app.identity.isAdministrator||this.layerPermissions.isOwner||(app.identity.isPowerUser||app.identity.isDataManager)&&this.layerPermissions.edit;this._tasks.push(new VectorLayerSelectTask(this.app,this.mapContainer,e,{hasEditPermission:a})),"ol.format.GeoJSON"===t.format&&(a&&this._tasks.push(new VectorLayerEditTask(this.app,this.mapContainer,e,{hasEditPermission:a})),(app.identity.isAdministrator||app.identity.isPowerUser||app.identity.isDataAnalyst)&&this._tasks.push(new VectorLayerAnalysisTask(this.app,this.mapContainer,e,{hasEditPermission:a})))}t.dataObj&&"ol.source.GeoImage"===t.source&&(this._tasks.push(new RasterLayerValueTask(this.app,this.mapContainer,e,{})),(app.identity.isAdministrator||app.identity.isPowerUser||app.identity.isDataAnalyst)&&this._tasks.push(new RasterLayerAnalysisTask(this.app,this.mapContainer,e,{}))),"ol.source.WMS"===t.source&&this._tasks.push(new wmsLayerTask(this.app,this.mapContainer,e,{}))}},LayerTasks.prototype.getTasks=function(){return this._tasks},LayerTasks.prototype.getTaskByName=function(e){for(var t,a=0;a<this._tasks.length;a++)if(e===this._tasks[a].getName()){t=this._tasks[a];break}return t},LayerTasks.prototype.init=function(){for(var e=0;e<this._tasks.length;e++)this._tasks[e].init();this._initialized=!0},LayerTasks.prototype.OnActivated=function(){this._activated=!0,this._initialized||this.init();for(var e=0;e<this._tasks.length;e++)this._tasks[e].OnActivated()},LayerTasks.prototype.OnDeActivated=function(){if(this._activated){for(var e=0;e<this._tasks.length;e++)this._tasks[e].OnDeActivated();this._activated=!1}},VectorLayerSelectTask.prototype.getName=function(){return this._name},VectorLayerSelectTask.prototype.init=function(e){this._initialized=!0;var r=this,t=this.mapContainer.map,s=this.mapContainer,a=this.layer,l=a.getSource();if(l){l.get("shapeType");var i=l.get("details");i&&i.oidField;var n=this.layer.get("custom"),o=(l.getFormat(),l.get("formatGML"),new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:2}),fill:new ol.style.Fill({color:"rgba(0,255,255,0.6)"}),image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#00ffff"}),stroke:new ol.style.Stroke({color:"blue",width:2})})}));r.interactionSelect=new ol.interaction.Select({hitTolerance:5,multi:!0,layers:[a],style:function(e,t){return o}}),r.interactionSelectByBox=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly,style:function(e,t){return o}}),r.interactionSelectByBox.on("boxend",function(e){var t=r.interactionSelect.getFeatures(),a=r.interactionSelectByBox.getGeometry().getExtent();l.forEachFeatureIntersectingExtent(a,function(e){t.push(e),r.interactionSelect.dispatchEvent({type:"select",selected:[e],deselected:[]})})}),r.interactionSelectByBox.on("boxstart",function(e){}),t.addInteraction(r.interactionSelect),r.interactionSelect.setActive(!1),t.addInteraction(r.interactionSelectByBox),r.interactionSelectByBox.setActive(!1),a.on("change:visible",function(e){a.get("visible")||r.interactionSelect.getFeatures().clear()}),this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mainCtrl=new ol.control.Toggle({html:'<i class="fa fa-mouse-pointer"></i>',className:"myOlbutton24",title:"Select toolbar",bar:this._toolbar,onToggle:function(e){if(e&&s._registeredToolbars)for(var t=0;t<s._registeredToolbars.length;t++){var a=s._registeredToolbars[t];a!==r.mainCtrl&&a.setActive&&a.setActive(!1)}}}),s._registeredToolbars||(s._registeredToolbars=[]),s._registeredToolbars.push(this.mainCtrl),this.mapContainer.leftToolbar.addControl(this.mainCtrl),(new ol.control.Bar).addControl(new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center;color:#F44336;" class="" ><i class="fa fa-times"></i></span>',className:"myOlbutton24",title:"Clear selection",handleClick:function(){r.interactionSelect.getFeatures().clear()}})),this.selectCtrl=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="selectArrow_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Select",onToggle:function(e){r.interactionSelect.setActive(!1),r.interactionSelectByBox.setActive(!1),e?s.setCurrentTool({name:"select_select",cursor:function(e,t){var a='url("/css/images/SelectArrow_32_cursor.png")1 1,auto',i=e.getEventPixel(t.originalEvent);return e.hasFeatureAtPixel(i,{layerFilter:function(e){return e===r.layer}})&&(a='url("/css/images/SelectArrow_hover_32_cursor.png")1 1,auto'),a},onActivate:function(e){t.removeInteraction(r.interactionSelect),t.addInteraction(r.interactionSelect),r.interactionSelect.setActive(!0),t.removeInteraction(r.interactionSelectByBox),t.addInteraction(r.interactionSelectByBox),r.interactionSelectByBox.setActive(!0)},onDeactivate:function(e){r.mapContainer.setCurrentEditAction(""),r.interactionSelect.setActive(!1),r.interactionSelectByBox.setActive(!1),e.newTool&&"select_select"!==e.newTool.name&&r.selectCtrl.setActive(!1)}}):r.mapContainer.setCurrentTool(null)}}),this._toolbar.addControl(this.selectCtrl);var c=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center;" class="" ><i class="glyphicon glyphicon-search"></i></span>',className:"myOlbutton24",title:"Search",handleClick:function(){var e;e=r.layer.get&&r.layer.get("title")?"Search: "+r.layer.get("title"):"Search";new DlgVectorSearch(s,r.layer,{title:e,onapply:function(e,t,a){if("ok"==a){LayerHelper.getDetails(r.layer).filter=t.filter;var i="/datalayer/"+n.dataObj.id+"/geojson"+"?settings="+encodeURIComponent(JSON.stringify({filter:t.filter,onlyIds:!0})),o=$.notify({message:'<i class="wait-icon-with-padding">Selecting ...</i><br />'},{type:"info",delay:0,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&(void 0!==e.status&&e.message?$.notify({message:e.message},{type:"danger",delay:5e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}):function(e){var t={};if(e&&e.length)for(var a=0;a<e.length;a++)t[e[a].id]=e[a].id;r.interactionSelect.getFeatures().clear();var i=[];if(0<e.length)for(var o=l.getFeatures(),a=0;a<o.length;a++){var n=o[a];t[n.getId()]&&(r.interactionSelect.getFeatures().push(n),i.push(n))}r.interactionSelect.dispatchEvent({type:"select",selected:i,deselected:[]})}(e)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:3e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}else{i="/datalayer/"+n.dataObj.id+"/geojson"+"?settings="+encodeURIComponent(JSON.stringify({filter:t.filter,validate:!0})),o=$.notify({message:'<i class="wait-icon-with-padding">Validating ...</i><br />'},{type:"info",delay:0,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&(e.status?$.notify({message:e.rowCount+" row(s) will be selected."},{type:"success",delay:3e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}):$.notify({message:e.message},{type:"danger",delay:5e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:3e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}}).show()}});this.search=c,"ol.format.GeoJSON"===n.format&&this._toolbar.addControl(c);var d=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="tableWindow_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"View rows",handleClick:function(){var e,t,a=r.layer.getSource().getFeatures(),i=LayerHelper.getVectorLayerSelectTask(r.layer),o=a.length,n=!1;if(o>app.MAx_TABLE_VIEW_RECORDS&&(n=!0),i&&0<(t=i.interactionSelect.getFeatures()).getLength()&&(o=t.getLength()),o>app.MAx_TABLE_VIEW_RECORDS)BootstrapDialog.alert({title:"WARNING",message:"Too many records ("+o+") to show!<br/> Please select maximum "+app.MAx_TABLE_VIEW_RECORDS+" number of records and try again.",type:BootstrapDialog.TYPE_WARNING,closable:!0,draggable:!0});else{e=r.layer.get&&r.layer.get("title")?"Rows: "+r.layer.get("title"):"Rows";new DlgVectorTableView(s,r.layer,{forceShowOnlySelection:n,hasEditPermission:r.hasEditPermission,title:e,onapply:function(e,t){}}).show()}}});this.tableView=d,this._toolbar.addControl(d);var p=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center;" class="" ><i class="glyphicon glyphicon-duplicate"></i></span>',className:"myOlbutton24",title:"Duplicate as a new vector data layer",handleClick:function(){s.duplicateLayer(r.layer,{newName:void 0,exportSelectionIfAny:!0,srid:void 0})}});this.duplicateLayer=p,(app.identity.isAdministrator||app.identity.isPowerUser||app.identity.isDataManager||app.identity.isDataAnalyst)&&this._toolbar.addControl(p)}},VectorLayerSelectTask.prototype.OnActivated=function(e){if(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl),this.selectCtrl){var t=this.mapContainer.getCurrentTool();t&&"select_select"===t.name&&(this.selectCtrl.setActive(!0),this.selectCtrl.raiseOnToggle(),this.mainCtrl.setActive(!0))}},VectorLayerSelectTask.prototype.OnDeActivated=function(e){if(this._activated){this.mapContainer.map;this.mapContainer.setCurrentEditAction(void 0),this.interactionSelect&&this.interactionSelect.setActive(!1),this.selectCtrl&&this.selectCtrl.setActive(!1),this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1}},VectorLayerEditTask.prototype.getName=function(){return this._name},VectorLayerEditTask.prototype.init=function(e){this._initialized=!0;var c=this,d=this.mapContainer.map,p=this.mapContainer;app.controller&&(c.mapController=app.controller.controllers.Map);var t,u=this.layer,h=u.getSource(),f=-1;if(h){t=h.get("shapeType");var m=h.get("details");m&&m.oidField;var g=h.getFormat(),y=h.get("formatGML");c.interaction=void 0;var s={};c.dirty=s;var a=function(e,t){if(c.interaction){var a=app.geolocationTasks.getPosition();if(a){if(e)if(c._lastGpsCoords)if(Math.sqrt((c._lastGpsCoords[0]-a[0])*(c._lastGpsCoords[0]-a[0])+(c._lastGpsCoords[1]-a[1])*(c._lastGpsCoords[1]-a[1]))<=(t=t||.1))return;if(c.interaction&&"Point"==c.interaction.type_){c._lastGpsCoords=a;var i=new ol.Feature;i.setGeometry(new ol.geom.Point(a)),c.transactFeature("insert",i)}else if(c.interaction&&c.interaction.addToDrawing_){c._lastGpsCoords=a;try{c.interaction.sketchFeature_?(c.interaction.addToDrawing_({coordinate:a,stopPropagation:function(){}},!0),c.interaction.addToDrawing_({coordinate:a,stopPropagation:function(){}},!0)):c.interaction.startDrawing_({coordinate:a,stopPropagation:function(){}})}catch(e){console.log(e)}}}else $.notify({message:"Location is not available"},{type:"danger",z_index:5e4,delay:1e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}};c.on_change_position=function(e){app.geolocationTasks._tracking&&c.trackGPS&&a(!0,.2)},app.registerEventhandler("change:position",c.on_change_position);var v=function(e,t,o){if(o=o||{},g instanceof ol.format.GeoJSON){var a,i="insert",n=d.getView().getProjection().getCode();switch(e){case"add":case"insert":i="insert",a=g.writeFeatureObject(t,{featureProjection:n});break;case"update":i="update",a=g.writeFeatureObject(t,{featureProjection:n});break;case"delete":i="delete",a=g.writeFeatureObject(t,{featureProjection:n})}(f=t.getId())||(f=-1);var r=h.getUrl()+"/"+f,s={action:i,geoJSON:a};o.onCommit&&o.onCommit(s),$.ajax(r,{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",timeout:3e4,cache:!1,data:JSON.stringify(s),success:function(e){if(e&&e.status)o.onSuccess&&o.onSuccess(e);else{var t="Error";e&&e.message&&(t=e.message),o.onFailed&&o.onFailed(void 0,t,void 0),$.notify({message:"Failed to apply changes, "+t},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}},error:function(e,t,a){var i=a;e.responseJSON&&e.responseJSON.error&&(a=i=e.responseJSON.error),o.onFailed&&o.onFailed(e,t,a),$.notify({message:"Failed to apply changes, "+i},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(){h.refresh()})}else if(g instanceof ol.format.WFS){var l;switch(e){case"insert":l=g.writeTransaction([t],null,null,y);break;case"update":l=g.writeTransaction(null,[t],null,y);break;case"delete":l=g.writeTransaction(null,null,[t],y)}var c=(new XMLSerializer).serializeToString(l);o.onCommit&&o.onCommit(s);r="/proxy/?url="+encodeURIComponent(m.url);$.ajax(r,{type:"POST",dataType:"xml",processData:!1,contentType:"text/xml",data:c,success:function(e){if(e&&e.status)o.onSuccess&&o.onSuccess(e);else{var t="Error";e&&e.message&&(t=e.message),o.onFailed&&o.onFailed(void 0,t,void 0),$.notify({message:"Failed to apply changes, "+t},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}},error:function(e,t,a){var i=a;e.responseJSON&&e.responseJSON.error&&(a=i=e.responseJSON.error),o.onFailed&&o.onFailed(e,t,a),$.notify({message:"Failed to apply changes, "+i},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),h.refresh()}}).done(function(){h.refresh()})}};c.transactFeature=v;var i=new ol.style.Style({stroke:new ol.style.Stroke({color:"#FF2828",width:2}),fill:new ol.style.Fill({color:"rgba(255,100,100,0.2)"}),image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#FF2828"})})});c.interactionSelect=new ol.interaction.Select({hitTolerance:5,layers:[u],style:function(e,t){return[i,new ol.style.Style({image:new ol.style.RegularShape({radius:4,points:4,fill:new ol.style.Fill({color:"#f00"})}),geometry:new ol.geom.MultiPoint([e.getGeometry().getFirstCoordinate(),e.getGeometry().getLastCoordinate()])})]}}),c.interactionSnap=new ol.interaction.Snap({source:u.getSource()}),this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mainCtrl=new ol.control.Toggle({html:'<i class="glyphicon glyphicon-edit"></i>',className:"myOlbutton24",title:"Edit toolbar",bar:this._toolbar,_statusTip:'<i  class="status_tip_glyph glyphicon glyphicon-edit"></i> Edit tools:',onToggle:function(e){if(e){var t=c._toolbar.getControls(),a=t.length-1,i=function(){if(0<=a){var e=t[a];e._statusTip&&p.showTopStatus(e._statusTip,3e3,e.element,function(){a--,i()})}};p.showTopStatus(this._statusTip,2e3,void 0,function(){i()})}else p.showTopStatus("");if(e&&(p.switcher&&p.switcher.collapse&&p.switcher.collapse(),p._registeredToolbars))for(var o=0;o<p._registeredToolbars.length;o++){var n=p._registeredToolbars[o];n!==c.mainCtrl&&n.setActive&&n.setActive(!1)}}}),p._registeredToolbars||(p._registeredToolbars=[]),p._registeredToolbars.push(this.mainCtrl),this.mapContainer.leftToolbar.addControl(this.mainCtrl);var o=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="delete_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Delete selected features",handleClick:function(){p.showTopStatus("");var e=c.interactionSelect.getFeatures();e.getLength()?c.deleteFeatures(e):($.notify({message:"First, select a feature!"},{type:"info",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.selectCtrl.setActive(!0),c.selectCtrl.raiseOnToggle(),c.lastSelectForDeleteHandler&&(ol.Observable.unByKey(c.lastSelectForDeleteHandler),c.lastSelectForDeleteHandler=null),c.lastSelectForDeleteHandler=c.interactionSelect.getFeatures().once("add",function(e){e.element;c.deleteFeatures(c.interactionSelect.getFeatures())}))}});o._statusTip='<i class="status_tip_icon delete_24_Icon"></i>  '+o.get("title"),this.deleteFeature=o,this._toolbar.addControl(o);var n=new ol.control.Toggle({html:'<i class="\tglyphicon glyphicon-move" ></i>',className:"myOlbutton24",title:"Move selected feature",onToggle:function(e){if(e?p.showTopStatus('<i class="status_tip_glyph glyphicon  glyphicon-move" ></i> Move selected feature to new location',3e3):p.showTopStatus(""),c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSelect),!e)return c.mapContainer.setCurrentTool(null),void c.mapContainer.setCurrentEditAction(void 0);p.setCurrentTool({name:"edit_transform",cursor:function(e,t){return""},onActivate:function(e){},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&e.newTool.name,n.setActive(!1)}}),d.addInteraction(c.interactionSelect),c.interaction=new ol.interaction.Transform({features:c.interactionSelect.getFeatures(),addCondition:ol.events.condition.shiftKeyOnly,hitTolerance:2,translateFeature:!1,scale:!1,rotate:!1,keepAspectRatio:!0,translate:!0,stretch:!1}),d.addInteraction(c.interaction),c.mapContainer.setCurrentEditAction("transform"),d.addInteraction(c.interactionSnap);for(var t,a=0;t=c.interactionSelect.getFeatures().item(a);a++){t.on("change",function(e){s[e.target.getId()]=!0})}c.interactionSelect.getFeatures().on("add",function(e){e.element.on("change",function(e){s[e.target.getId()]=!0})}),c.interactionSelect.getFeatures().on("remove",function(e){var t=e.element;if(s[t.getId()]){delete s[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),v("update",i)}}),c.importSelectionFromSelectTask()}});n._statusTip='<i class="status_tip_glyph glyphicon  glyphicon-move" ></i> '+n.get("title"),this.transformShape=n,this._toolbar.addControl(n),c.deleteShapeVertexButton=new ol.control.TextButton({className:"myOlbutton24",html:'<span style="display:block;line-height:28px;background-position:center center" class="deleteVertexIcon" >&nbsp;</span>',_statusTip:'<i  class="status_tip_icon deleteVertexIcon"></i>  Delete selected vertex',title:"Delete selected vertex",handleClick:function(){p.showTopStatus(this._statusTip,3e3),c.interaction&&c.interaction.removePoint&&(c.interaction.removePoint(),c.ShapeVertexBar.setVisible(!1))}});var r=new ol.control.Bar({controls:[c.deleteShapeVertexButton]});c.ShapeVertexBar=r;var l=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="editVertexIcon" >&nbsp;</span>',className:"myOlbutton24",title:"Edit feature's vertices",onToggle:function(e){if(e){var i=this.getSubBar().getControls(),o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&p.showTopStatus(t,a,e.element,function(){o++,r()})}};p.showTopStatus('<i class="status_tip_icon editVertexIcon"></i> Edit feature\'s vertices',2e3,void 0,function(){r()})}else p.showTopStatus("");if(c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSelect),!e)return c.mapContainer.setCurrentTool(null),void c.mapContainer.setCurrentEditAction(void 0);p.setCurrentTool({name:"edit_edit",cursor:function(e,t){var a='url("/css/images/SelectArrow_32_cursor.png")1 1,auto',i=e.getEventPixel(t.originalEvent);return e.hasFeatureAtPixel(i,{layerFilter:function(e){return e===c.layer}})&&(a='url("/css/images/SelectArrow_bold_pencil_32_cursor.png")1 1,auto'),a},onActivate:function(e){},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&e.newTool.name,l.setActive(!1)}}),d.addInteraction(c.interactionSelect),c.interaction=new ol.interaction.Modify({features:c.interactionSelect.getFeatures(),condition:function(e){return c.interaction.lastPointerEvent_&&c.interaction.vertexFeature_?c.ShapeVertexBar.setVisible(!0):c.ShapeVertexBar.setVisible(!1),!0}}),d.addInteraction(c.interaction),c.interaction.on("modifystart",function(e){}),c.interaction.on("modifyend",function(e){}),c.mapContainer.setCurrentEditAction("edit"),d.addInteraction(c.interactionSnap);for(var t,a=0;t=c.interactionSelect.getFeatures().item(a);a++){t.on("change",function(e){s[e.target.getId()]=!0})}c.interactionSelect.getFeatures().on("add",function(e){e.element.on("change",function(e){s[e.target.getId()]=!0})}),c.interactionSelect.getFeatures().on("remove",function(e){var t=e.element;if(s[t.getId()]){delete s[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),v("update",i)}}),c.importSelectionFromSelectTask()},bar:r});l._statusTip='<i class="status_tip_icon editVertexIcon"></i>  '+l.get("title"),this.editShape=l,this._toolbar.addControl(l);var b=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="attributesWindow_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Edit selected feature's attributes",handleClick:function(){p.showTopStatus("");var e=c.interactionSelect.getFeatures();if(e.getLength()){var t=e.item(0);c.editFeatureAttributes(t)}else $.notify({message:"First, select a feature!"},{type:"info",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.selectCtrl.setActive(!0),c.selectCtrl.raiseOnToggle(),c.lastSelectForEditHandler&&(ol.Observable.unByKey(c.lastSelectForEditHandler),c.lastSelectForEditHandler=null),c.lastSelectForEditHandler=c.interactionSelect.getFeatures().once("add",function(e){var t=e.element;c.editFeatureAttributes(t)})}});b._statusTip='<i class="status_tip_icon attributesWindow_24_Icon"></i>  '+b.get("title"),this.editAttribute=b,this._toolbar.addControl(b);var _=new ol.control.Bar;_.addControl(new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center;color:#F44336;" class="" ><i class="fa fa-times"></i></span>',className:"myOlbutton24",title:"Clear selection",_statusTip:'<i  class="status_tip_glyph fa fa-times"></i> Clear selection',handleClick:function(){p.showTopStatus(this._statusTip,3e3),c.interactionSelect.getFeatures().clear()}})),this.selectCtrl=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="selectArrow_Bold_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Select feature to edit",onToggle:function(e){if(e){var i=this.getSubBar().getControls(),o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&p.showTopStatus(t,a,e.element,function(){o++,r()})}};p.showTopStatus('<i class="status_tip_icon selectArrow_Bold_24_Icon"></i> Click features to select',3e3,void 0,function(){r()})}else p.showTopStatus("");c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSelect),e?p.setCurrentTool({name:"edit_select",cursor:function(e,t){var a='url("/css/images/SelectArrow_32_cursor.png")1 1,auto',i=e.getEventPixel(t.originalEvent);return e.hasFeatureAtPixel(i,{layerFilter:function(e){return e===c.layer}})&&(a='url("/css/images/SelectArrow_bold_32_cursor.png")1 1,auto'),a},onActivate:function(e){c.mapContainer.setCurrentEditAction("select"),d.addInteraction(c.interactionSelect),c.importSelectionFromSelectTask()},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&"edit_select"!==e.newTool.name&&c.selectCtrl.setActive(!1)}}):c.mapContainer.setCurrentTool(null)},bar:_}),this.selectCtrl._statusTip='<i class="status_tip_icon selectArrow_Bold_24_Icon"></i>  '+this.selectCtrl.get("title"),this._toolbar.addControl(this.selectCtrl);var w=new ol.control.Button({html:'<i class="\tglyphicon glyphicon-map-marker" >xy</i>',className:"myOlbutton24",title:"Add point feature by lon/lat",handleClick:function(){p.showTopStatus(""),c.addPointByXY()}});w._statusTip='<i class="status_tip_glyph glyphicon glyphicon-map-marker" ></i> '+w.get("title"),this.addPointXY=w,t&&"Point"!=t||this._toolbar.addControl(w);var k=new ol.control.Button({className:"myOlbutton24",html:'<i style="font-size: 1.14em;" class=" glyphicon glyphicon-record"></i><i class="fa fa-plus draw_addFromGPS" ></i>',title:"Add GPS point",handleClick:function(){p.showTopStatus('<i class="status_tip_glyph fa fa-plus  " ></i> Add GPS point',3e3),a(!1)}});k._statusTip='<i class="status_tip_glyph fa fa-plus  " ></i> '+k.get("title");var S=new ol.control.Toggle({className:"myOlbutton24",html:'<i style="" class=" glyphicon glyphicon-record"></i><i class="fa fa-lock draw_trackGPS" ></i>',title:"Track GPS points",onToggle:function(e){e?p.showTopStatus('<i class="status_tip_glyph fa fa-lock  " ></i> Track GPS points',3e3):p.showTopStatus(""),e?(c.trackGPS=!0,a(!1)):c.trackGPS=!1},active:c.trackGPS});S._statusTip='<i class="status_tip_glyph fa fa-lock  " ></i> '+S.get("title");var T=void 0;app.geolocationTasks&&(T=new ol.control.Bar({controls:[k,S]}));var C=new ol.control.Toggle({html:'<i class="\tglyphicon glyphicon-map-marker" ></i>',className:"myOlbutton24",title:"Draw point",onToggle:function(e){if(e){var i=this.getSubBar()?this.getSubBar().getControls():[],o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&p.showTopStatus(t,a,e.element,function(){o++,r()})}};p.showTopStatus('<i  class="status_tip_glyph glyphicon glyphicon-map-marker"></i>  Draw point',2e3,void 0,function(){r()})}else p.showTopStatus("");if(c.removeInteraction(c.interaction),c.interactionSelect.getFeatures().clear(),c.removeInteraction(c.interactionSelect),!e)return c.mapContainer.setCurrentTool(null),void c.mapContainer.setCurrentEditAction(void 0);p.setCurrentTool({name:"edit_draw_point",cursor:function(e,t){return'url("/css/images/SelectArrow_Plus_32_cursor.png")1 1,auto'},onActivate:function(e){},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&e.newTool.name,C.setActive(!1)}}),c.interaction=new ol.interaction.Draw({type:"Point",source:u.getSource()}),c.mapContainer.setCurrentEditAction("draw"),d.addInteraction(c.interaction),c.interaction.on("drawend",function(e){v("insert",e.feature)}),d.addInteraction(c.interactionSnap)},bar:T});C._statusTip='<i class="status_tip_glyph glyphicon glyphicon-map-marker" ></i> '+C.get("title"),this.drawPoint=C,t&&"Point"!=t||this._toolbar.addControl(C);var x=new ol.control.Button({className:"myOlbutton24",html:'<i style="font-size: 1.14em;" class=" glyphicon glyphicon-record"></i><i class="fa fa-plus draw_addFromGPS" ></i>',title:"Add vertex from GPS",handleClick:function(){p.showTopStatus('<i class="status_tip_glyph fa fa-plus  " ></i> Add vertex from GPS',3e3),a(!1)}});x._statusTip='<i class="status_tip_glyph fa fa-plus  " ></i> '+x.get("title");var D=new ol.control.Toggle({className:"myOlbutton24",html:'<i style="" class=" glyphicon glyphicon-record"></i><i class="fa fa-lock draw_trackGPS" ></i>',title:"Track GPS to add vertex",onToggle:function(e){e?p.showTopStatus('<i class="status_tip_glyph fa fa-lock  " ></i> Track GPS to add vertex',3e3):p.showTopStatus(""),e?(c.trackGPS=!0,a(!1)):c.trackGPS=!1},active:c.trackGPS});D._statusTip='<i class="status_tip_glyph fa fa-lock  " ></i> '+D.get("title");var L=[new ol.control.Button({className:"myOlbutton24",html:'<span style="display:block;line-height:28px;background-position:center center" class="undo24Icon" >&nbsp;</span>',title:"Undo last point",_statusTip:'<i  class="status_tip_icon undo24Icon"></i> Undo last point',handleClick:function(){if(p.showTopStatus(""),1<c.interaction.nbpts){var e=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry();"LineString"===this.mode_?((e=this.sketchCoords_).splice(-1,1),this.geometryFunction_(e,t),2<=e.length&&(this.finishCoordinate_=e[e.length-2].slice())):"Polygon"===this.mode_&&((e=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t)),0===e.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}};(e=$.proxy(e,c.interaction))()}}}),new ol.control.Button({className:"myOlbutton24",html:'<span style="display:block;line-height:28px;background-position:center" class="stop24Icon" >&nbsp;</span>',title:"Finish",_statusTip:'<i  class="status_tip_icon stop24Icon"></i> Finish',handleClick:function(){p.showTopStatus(""),c.interaction.nbpts,c.interaction.finishDrawing()}})];app.geolocationTasks&&(L.push(new ol.control.TextButton({className:"myOlTextButton_Space",html:"      "})),L.push(x),L.push(D));var P=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="drawLineIcon" >&nbsp;</span>',className:"myOlbutton24",title:"Draw line",onToggle:function(e){if(e){var i=this.getSubBar().getControls(),o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&p.showTopStatus(t,a,e.element,function(){o++,r()})}};p.showTopStatus('<i  class="status_tip_icon drawLineIcon"></i>  Draw polygon',2e3,void 0,function(){r()})}else p.showTopStatus("");if(c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSelect),!e)return c.mapContainer.setCurrentTool(null),void c.mapContainer.setCurrentEditAction(void 0);p.setCurrentTool({name:"edit_draw_line",cursor:function(e,t){return'url("/css/images/SelectArrow_Plus_32_cursor.png")1 1,auto'},onActivate:function(e){},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&e.newTool.name,P.setActive(!1)}});var s=null;1==c.interactionSelect.getFeatures().getLength()&&(s=c.interactionSelect.getFeatures().item(0)),c.interaction=new ol.interaction.Draw({type:"LineString",source:u.getSource(),geometryFunction:function(e,t){return t?t.setCoordinates(e):t=new ol.geom.LineString(e),this.nbpts=t.getCoordinates().length,t}});var a=$.proxy(c.interaction.addToDrawing_,c.interaction);c.interaction.addToDrawing_=function(e,t){if(c.trackGPS&&!t)return!1;a(e)};var l=$.proxy(c.interaction.modifyDrawing_,c.interaction);c.interaction.modifyDrawing_=function(e,t){if(c.trackGPS&&!t)return!1;l(e)},c.mapContainer.setCurrentEditAction("draw"),d.addInteraction(c.interaction),c.interaction.on("drawend",function(n){s?n.feature&&(new ConfirmDialog).show("Append to the last selected line?",function(e){if(e){var t=n.feature.getGeometry().getCoordinates(),a=s.getGeometry(),i=a.getType(),o=a.getCoordinates();"MultiLineString"==i?(o.push(t),a.setCoordinates(o)):(o=[o,t],a=new ol.geom.MultiLineString(o),s.setGeometry(a)),v("update",s)}else v("insert",n.feature)},{dialogSize:"sm",alertType:"info"}):v("insert",n.feature)}),d.addInteraction(c.interactionSnap)},bar:new ol.control.Bar({controls:L})});P._statusTip='<i class="status_tip_icon drawLineIcon"></i>  '+P.get("title"),this.drawLine=P,t&&"Line"!=t&&"Polyline"!=t&&"MultiLineString"!=t||this._toolbar.addControl(P);var O=new ol.control.Button({className:"myOlbutton24",html:'<i style="font-size: 1.14em;" class=" glyphicon glyphicon-record"></i><i class="fa fa-plus draw_addFromGPS" ></i>',title:"Add vertex from GPS",handleClick:function(){p.showTopStatus('<i class="status_tip_glyph fa fa-plus  " ></i> Add vertex from GPS',3e3),a(!1)}});O._statusTip='<i class="status_tip_glyph fa fa-plus  " ></i>  '+O.get("title");var I=new ol.control.Toggle({className:"myOlbutton24",html:'<i style="" class=" glyphicon glyphicon-record"></i><i class="fa fa-lock draw_trackGPS" ></i>',title:"Track GPS to add vertex",onToggle:function(e){e?p.showTopStatus('<i class="status_tip_glyph fa fa-lock  " ></i> Track GPS to add vertex',3e3):p.showTopStatus(""),e?(c.trackGPS=!0,a(!1)):c.trackGPS=!1},active:c.trackGPS});I._statusTip='<i class="status_tip_glyph fa fa-lock  " ></i> '+I.get("title");L=[new ol.control.Button({className:"myOlbutton24",html:'<span style="display:block;line-height:28px;background-position:center center" class="undo24Icon" >&nbsp;</span>',title:"Undo last point",handleClick:function(){p.showTopStatus(""),1<c.interaction.nbpts&&c.interaction.removeLastPoint()},_statusTip:'<i  class="status_tip_icon undo24Icon"></i> Undo last point'}),new ol.control.Button({className:"myOlbutton24",html:'<span style="display:block;line-height:28px;background-position:center" class="stop24Icon" >&nbsp;</span>',title:"Finish",handleClick:function(){p.showTopStatus(""),3<c.interaction.nbpts?c.interaction.finishDrawing():c.interaction.abortDrawing_()},_statusTip:'<i  class="status_tip_icon stop24Icon"></i> Finish'})];app.geolocationTasks&&(L.push(new ol.control.TextButton({className:"myOlTextButton_Space",html:"      "})),L.push(O),L.push(I));var F=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="drawPolygonIcon" >&nbsp;</span>',className:"myOlbutton24",title:"Draw polygon",onToggle:function(e){if(e){var i=this.getSubBar().getControls(),o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&p.showTopStatus(t,a,e.element,function(){o++,r()})}};p.showTopStatus('<i  class="status_tip_icon drawPolygonIcon"></i>  Draw polygon',2e3,void 0,function(){r()})}else p.showTopStatus("");if(c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSelect),!e)return c.mapContainer.setCurrentTool(null),void c.mapContainer.setCurrentEditAction(void 0);p.setCurrentTool({name:"edit_draw_polygon",cursor:function(e,t){return'url("/css/images/SelectArrow_Plus_32_cursor.png")1 1,auto'},onActivate:function(e){},onDeactivate:function(e){c.removeInteraction(c.interaction),c.removeInteraction(c.interactionSnap),c.mapContainer.setCurrentEditAction(""),c.removeInteraction(c.interactionSelect),e.newTool&&e.newTool.name,F.setActive(!1)}});var s=null;1==c.interactionSelect.getFeatures().getLength()&&(s=c.interactionSelect.getFeatures().item(0)),c.interaction=new ol.interaction.Draw({type:"Polygon",source:u.getSource(),geometryFunction:function(e,t){return this.nbpts=e[0].length,t?t.setCoordinates([e[0].concat([e[0][0]])]):t=new ol.geom.Polygon(e),t}});var a=$.proxy(c.interaction.addToDrawing_,c.interaction);c.interaction.addToDrawing_=function(e,t){if(c.trackGPS&&!t)return!1;a(e)};var l=$.proxy(c.interaction.modifyDrawing_,c.interaction);c.interaction.modifyDrawing_=function(e,t){if(c.trackGPS&&!t)return!1;l(e)},c.mapContainer.setCurrentEditAction("draw"),d.addInteraction(c.interaction),c.interaction.on("drawend",function(n){s?n.feature&&(new ConfirmDialog).show("Merge to the last selected polygon?",function(e){if(e){var t=n.feature.getGeometry().getCoordinates(),a=s.getGeometry(),i=a.getType(),o=a.getCoordinates();t&&t.length&&("MultiPolygon"==i?(o.push(t),a.setCoordinates(o)):"Polygon"==i?(o.push(t[0]),a.setCoordinates(o)):(o=[o,t[0]],a=new ol.geom.Polygon(o),s.setGeometry(a)),v("update",s))}else v("insert",n.feature)},{dialogSize:"sm",alertType:"info"}):v("insert",n.feature)}),d.addInteraction(c.interactionSnap)},bar:new ol.control.Bar({controls:L})});F._statusTip='<i  class="status_tip_icon drawPolygonIcon"></i>  '+F.get("title"),this.drawPolygon=F,t&&"Polygon"!=t&&"MultiPolygon"!=t||this._toolbar.addControl(F);var E=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="refresh24Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Sync changes to server",handleClick:function(){p.showTopStatus(""),c.syncCache({dataObj:e})}});E._statusTip='<i class="status_tip_icon refresh24Icon"></i>  '+E.get("title"),this.cmdSyncCache=E}},VectorLayerEditTask.prototype.removeInteraction=function(e){e&&(e instanceof ol.interaction.Draw&&2<e.nbpts&&e.finishDrawing(),this.mapContainer&&this.mapContainer.map.removeInteraction(e))},VectorLayerEditTask.prototype.OnActivated=function(e){this._activated=!0,this._initialized||this.init(e),this.mapContainer.map.addControl(this.mainCtrl),this.selectCtrl,app.unRegisterEventhandler("change:position",this.on_change_position),app.registerEventhandler("change:position",this.on_change_position)},VectorLayerEditTask.prototype.OnDeActivated=function(e){if(this._activated){this.mapContainer.map;this.interaction&&this.removeInteraction(this.interaction),this.interaction=null,this.mapContainer.setCurrentEditAction(void 0),this.interactionSelect&&this.removeInteraction(this.interactionSelect),this.selectCtrl&&this.selectCtrl.setActive(!1),this.removeInteraction(this.interactionSnap),this.mapContainer.map.removeControl(this.mainCtrl),app.unRegisterEventhandler("change:position",this.on_change_position),this._activated=!1}},VectorLayerEditTask.prototype.importSelectionFromSelectTask=function(){var e=LayerHelper.getVectorLayerSelectTask(this.layer);if(e&&e.interactionSelect.getFeatures().getLength()&&0==this.interactionSelect.getFeatures().getLength()){for(var t,a=0;t=e.interactionSelect.getFeatures().item(a);a++){var i=t;this.interactionSelect.getFeatures().push(i),this.interactionSelect.dispatchEvent({type:"select",selected:[i],deselected:[]})}e.interactionSelect.getFeatures().clear()}},VectorLayerEditTask.prototype.addPointByXY=function(o){var n=this,i=this.layer;o=o||{};var r=new ol.Feature;if(void 0!==o.lat&&void 0!==o.lon){var e=n.mapContainer.map.getView().getProjection(),t=o.lat,a=o.lon;try{t=parseFloat(t),a=parseFloat(a),(s=new ol.geom.Point([a,t])).transform("EPSG:4326",e),r.setGeometry(s)}catch(e){}}else if(o.coordinates){var s=new ol.geom.Point(o.coordinates);r.setGeometry(s)}var l="autosave";if(this.layer&&(l+="_"+this.layer.get("title")),r&&r.getId){var c=r.getId();!c&&r.get("_cacheInfo")&&(c=r.get("_cacheInfo").uid),c||(c=-1),l+="_"+c}var d=o.defaultFieldToEdit;if(o.showInPage&&app.controller&&app.controller.controllers.ObjectProperties){var p=function(e){var t=0,a=[new FeatureAttributesTab({id:"add_pointXY"})];o.attributesOnly||(a.push(new FeaturePointTab({id:"add_pointXY"})),t=1),app.controller.controllers.ObjectProperties.editObject(n.mapContainer,{layer:i,feature:r,defaultFieldToEdit:d,transactFeature:n.transactFeature,autosaveId:l,initData:e},{title:"Add point feature",closeWithBackButton:!app.isMobile(),tabs:a,activeTabIndex:t,onapply:function(e){var t=r;delete n.dirty[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),n.transactFeature("add",i,o)},helpLink:"/help#editing_attributes"})};app&&app.controller&&app.controller.storageService?app.controller.storageService.get(l).then(function(t){t?(console.log("autosaved data loaded"),(new ConfirmDialog).show("Do you want to load last autosaved information?",function(e){p(e?t:null)},{title:"Load autosaved data?",dialogSize:"sm",alertType:"info"})):p(null)}).catch(function(e){console.log("failed to load autosaved data"),p(null)}):p(null)}else{var u=0,h=[new FeatureAttributesTab({id:"add_pointXY_dlg"})];o.attributesOnly||(h.push(new FeaturePointTab({id:"add_pointXY_dlg"})),u=1);new ObjectPropertiesDlg(n.mapContainer,{layer:i,feature:r,defaultFieldToEdit:d,transactFeature:n.transactFeature},{title:"Add point feature",closeWithBackButton:!app.isMobile(),tabs:h,activeTabIndex:u,onapply:function(e){var t=r;delete n.dirty[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),n.transactFeature("add",i,o)},helpLink:"/help#editing_attributes"}).show()}},VectorLayerEditTask.prototype.syncCache=function(l){var c=this.layer.getSource(),d=c.getUrl();app.controller.storageService.getVector(d,!1).then(function(a){if(a){var e=a.data;if(!("true"==a.ismodified))return void(new ConfirmDialog).show("There is no edit to upload!<br/>Do you want to reload data?",function(e){e&&c.refresh()},{title:"Reload?",dialogSize:"sm",alertType:"info"});for(var i=e.features||[],t=[],o=0;o<i.length;o++){var n=i[o];n.properties&&n.properties._cacheInfo&&t.push(n)}var r=e;waitingDialog.show("Applying changes to database",{progressType:""});var s=c.getUrl()+"/sync";$.ajax(s,{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",timeout:3e4,cache:!1,data:JSON.stringify({geojsons:t}),beforeSend:function(e){app.api_token&&e.setRequestHeader("Authorization","Bearer "+app.api_token)},success:function(e){if(waitingDialog.hide(),e&&e.status)return r.features=i,void app.controller.storageService.cacheVector(null,d,r,l.dataObj,{ismodified:!1,insert_count:a.insert_count,update_count:a.update_count,delete_count:a.delete_count}).then(function(){$.notify({message:"Dataset updated successfully"},{type:"info",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.refresh()});var t="Error";e&&e.message&&(t=e.message),$.notify({message:"Failed to apply changes, "+t},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},error:function(e,t,a){waitingDialog.hide();var i=a;e.responseJSON&&e.responseJSON.error&&(a=i=e.responseJSON.error),$.notify({message:"Failed to apply changes, "+i},{type:"danger",z_index:5e4,delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(){waitingDialog.hide()})}})},VectorLayerEditTask.prototype.editFeatureAttributes=function(o,n){var r=this,t=this.layer;n=n||{};var e=LayerHelper.getFields(this.layer),a=[new FeatureAttributesTab({id:"editFeature"})];e&&100<e.length&&app.isMobile()||(a.push(new FeatureShapeTab({id:"editFeature"})),a.push(new FeaturePointTab({id:"editFeature"})));var i="autosave";if(this.layer&&(i+="_"+this.layer.get("title")),o&&o.getId){var s=o.getId();!s&&o.get("_cacheInfo")&&(s=o.get("_cacheInfo").uid),s||(s=-1),i+="_"+s}var l=n.defaultFieldToEdit;if(!n.displayInModal&&app.controller&&app.controller.controllers.ObjectProperties){var c=function(e){app.controller.controllers.ObjectProperties.editObject(r.mapContainer,{layer:t,feature:o,defaultFieldToEdit:l,transactFeature:r.transactFeature,autosaveId:i,initData:e},{title:"Edit attributes",closeWithBackButton:!app.isMobile(),tabs:a,onapply:function(e){var t=o;delete r.dirty[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),r.transactFeature("update",i,n)},helpLink:"/help#editing_attributes"})};app&&app.controller&&app.controller.storageService?app.controller.storageService.get(i).then(function(t){t?(console.log("autosaved data loaded"),(new ConfirmDialog).show("Do you want to load last autosaved information?",function(e){c(e?t:null)},{title:"Load autosaved data",dialogSize:"sm",alertType:"info"})):c(null)}).catch(function(e){console.log("failed to load autosaved data"),c(null)}):c(null)}else new ObjectPropertiesDlg(r.mapContainer,{layer:t,feature:o,defaultFieldToEdit:l,transactFeature:r.transactFeature},{title:"Edit attributes",closeWithBackButton:!app.isMobile(),tabs:a,onapply:function(e){var t=o;delete r.dirty[t.getId()];var a=t.getProperties();delete a.boundedBy;var i=new ol.Feature(a);i.setId(t.getId()),r.transactFeature("update",i,n)},helpLink:"/help#editing_attributes"}).show()},VectorLayerEditTask.prototype.deleteSingleFeature=function(t,a){var i=this,e=(this.layer,(a=a||{}).msg);e||(e="Delete selected feature?"),confirmDialog.show(e,function(e){e&&(i.transactFeature("delete",t,a),i.interactionSelect.getFeatures().clear())},{dialogSize:"sm",alertType:"danger"})},VectorLayerEditTask.prototype.deleteFeatures=function(i,o){var n=this,e=(this.layer,(o=o||{}).msg);e||(e="Delete selected feature?",1<i.getLength()&&(e="Delete selected feature(s)?")),confirmDialog.show(e,function(e){if(e){for(var t,a=0;t=i.item(a);a++)n.transactFeature("delete",t,o);n.interactionSelect.getFeatures().clear()}},{dialogSize:"sm",alertType:"danger"})},VectorLayerAnalysisTask.prototype.getName=function(){return this._name},VectorLayerAnalysisTask.prototype.init=function(e){if(app.identity.isAdministrator||app.identity.isDataAnalyst){this._initialized=!0;var i=this,n=this.mapContainer.map.getView().getProjection().getCode();n&&n.indexOf(":")&&(n=n.split(":")[1]);var t,r=this.mapContainer,a=this.layer,o=a.getSource(),s=a.get("custom");if(o)if(o.get("shapeType"),(t=o.get("details"))&&t.oidField,o)(t=o.get("details"))&&t.oidField,this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mainCtrl=new ol.control.Toggle({html:'<i class="fa fa-tasks"></i>',className:"myOlbutton24",title:"Analysis toolbar",bar:this._toolbar,onToggle:function(e){if(e&&r._registeredToolbars)for(var t=0;t<r._registeredToolbars.length;t++){var a=r._registeredToolbars[t];a!==i.mainCtrl&&a.setActive&&a.setActive(!1)}}}),r._registeredToolbars||(r._registeredToolbars=[]),r._registeredToolbars.push(this.mainCtrl),this.mapContainer.leftToolbar.addControl(this.mainCtrl),this._buffer=new ol.control.TextButton({html:"Buffer",className:"myOlTextButton24",title:"Make buffer area around features",handleClick:function(){new DlgBuffer(r,i.layer,{title:"Buffer",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({distance:t.distance})),i="/datalayer/"+s.dataObj.id+"/analysis?request=buffer&srid="+n+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating buffers...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),r.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._buffer),this._identity=new ol.control.TextButton({html:"Overlay",className:"myOlTextButton24",title:"Overlaying on another layer",handleClick:function(){new DlgIdentity(r,i.layer,{title:"Overlay",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({otherLayer:t.otherLayer})),i="/datalayer/"+s.dataObj.id+"/analysis?request=identity&srid="+n+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating overlay...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){void 0===e.status||e.status||!e.message&&!e.errors?(e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),r.addLayerById(e.id)),o.close()):$.notify({message:e.message||e.errors},{type:"danger",delay:5e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._identity),this._intersection=new ol.control.TextButton({html:"Intersect",className:"myOlTextButton24",title:"Generate intersection with another layer",handleClick:function(){new DlgIntersection(r,i.layer,{title:"Intersect",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({otherLayer:t.otherLayer})),i="/datalayer/"+s.dataObj.id+"/analysis?request=intersection&srid="+n+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating Intersection...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){void 0===e.status||e.status||!e.message&&!e.errors?(e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),r.addLayerById(e.id)),o.close()):$.notify({message:e.message||e.errors},{type:"danger",delay:5e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._intersection),this._clip=new ol.control.TextButton({html:"Clip",className:"myOlTextButton24",title:"Clip by another layer",handleClick:function(){new DlgClip(r,i.layer,{title:"Clip",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({otherLayer:t.otherLayer,clipOutside:t.clipOutside})),i="/datalayer/"+s.dataObj.id+"/analysis?request=clipVector&srid="+n+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating clipped features...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){void 0===e.status||e.status||!e.message&&!e.errors?(e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),r.addLayerById(e.id)),o.close()):$.notify({message:e.message||e.errors},{type:"danger",delay:5e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._clip),this._dissolve=new ol.control.TextButton({html:"Dissolve",className:"myOlTextButton24",title:"Dissolve features and calculate statistics",handleClick:function(){new DlgDissolve(r,i.layer,{title:"Dissolve",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({dissolve:t.dissolve})),i="/datalayer/"+s.dataObj.id+"/analysis?request=dissolve&srid="+n+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating dissolved features...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),r.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._dissolve)}},VectorLayerAnalysisTask.prototype.OnActivated=function(e){(app.identity.isAdministrator||app.identity.isDataAnalyst)&&(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl))},VectorLayerAnalysisTask.prototype.OnDeActivated=function(e){this._activated&&(app.identity.isAdministrator||app.identity.isDataAnalyst)&&(this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1)},DlgBuffer.prototype=Object.create(DlgTaskBase.prototype),DlgBuffer.prototype.createUI=function(){var n=this,e=this.obj;e.get("custom"),LayerHelper.getDetails(e);n.selBand=n.options.selBand||1;var t='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';t+="  <p>",t+="Create buffers around the features of ("+e.get("title")+"):",t+="  </p>",t+='  <div class="form-group">',t+='    <label class="" for="distance">Buffer distance</label>',t+='    <input type="number" name="distance" id="distance" value="" placeholder="Buffer distance" class="form-control" data-val="true" data-val-required="Buffer distance is required"  />',t+='    <span class="field-validation-valid" data-valmsg-for="distance" data-valmsg-replace="true"></span>',t+="  </div>",t+="</form>",t+="  </div>";var a=$(t).appendTo(this.mainPanel),r=$(a.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.distance=a.find("#distance").val()}),this.changesApplied=!1},DlgIdentity.prototype=Object.create(DlgTaskBase.prototype),DlgIdentity.prototype.createUI=function(){for(var n=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e),this.mapContainer.getAllLayersList()),a=[],i=t.length-1;0<=i;i--){var o=(s=t[i]).get("custom");o&&(e!=s&&"ol.layer.Vector"===o.type&&"ol.format.GeoJSON"===o.format&&o.dataObj&&o.dataObj.details&&a.push({title:s.get("title"),value:o.dataObj.id}))}var r='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';r+="  <p>",r+="Overlay  features of ("+e.get("title")+") on layer:",r+="  </p>",r+='<div class="form-group">',r+='<select class="form-control  " id="otherLayer" name="otherLayer" data-val="true" data-val-required="Select intersecting layer">';for(i=0;i<a.length;i++){var s;r+='    <option value="'+(s=a[i]).value+'" >'+s.title+"</option>"}r+="    </select>",r+='    <span class="field-validation-valid" data-valmsg-for="otherLayer" data-valmsg-replace="true"></span>',r+=" </div>",r+="</form>",r+="  </div>";var l=$(r).appendTo(this.mainPanel),c=$(l.find("#"+n.id+"_form"));c.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(c),$.validator.setDefaults({ignore:t}),c.validate(),!c.valid()){e.cancel=!0;var a=c.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=c.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.otherLayer=l.find("#otherLayer").val()}),this.changesApplied=!1},DlgIntersection.prototype=Object.create(DlgTaskBase.prototype),DlgIntersection.prototype.createUI=function(){for(var n=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e),this.mapContainer.getAllLayersList()),a=[],i=t.length-1;0<=i;i--){var o=(s=t[i]).get("custom");o&&(e!=s&&"ol.layer.Vector"===o.type&&"ol.format.GeoJSON"===o.format&&o.dataObj&&o.dataObj.details&&a.push({title:s.get("title"),value:o.dataObj.id}))}var r='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';r+="  <p>",r+="Generate Intersection of ("+e.get("title")+") and layer:",r+="  </p>",r+='<div class="form-group">',r+='<select class="form-control  " id="otherLayer" name="otherLayer" data-val="true" data-val-required="Select intersecting layer">';for(i=0;i<a.length;i++){var s;r+='    <option value="'+(s=a[i]).value+'" >'+s.title+"</option>"}r+="    </select>",r+='    <span class="field-validation-valid" data-valmsg-for="otherLayer" data-valmsg-replace="true"></span>',r+=" </div>",r+="</form>",r+="  </div>";var l=$(r).appendTo(this.mainPanel),c=$(l.find("#"+n.id+"_form"));c.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(c),$.validator.setDefaults({ignore:t}),c.validate(),!c.valid()){e.cancel=!0;var a=c.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=c.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.otherLayer=l.find("#otherLayer").val()}),this.changesApplied=!1},DlgClip.prototype=Object.create(DlgTaskBase.prototype),DlgClip.prototype.createUI=function(){for(var n=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e),this.mapContainer.getAllLayersList()),a=[],i=t.length-1;0<=i;i--){var o=(s=t[i]).get("custom");o&&(e!=s&&"ol.layer.Vector"===o.type&&"ol.format.GeoJSON"===o.format&&o.dataObj&&o.dataObj.details&&("MultiPolygon"===o.dataObj.details.shapeType||"Polygon"===o.dataObj.details.shapeType)&&a.push({title:s.get("title"),value:o.dataObj.id}))}var r='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';r+="  <p>",r+="Clip  features of ("+e.get("title")+") with layer:",r+="  </p>",r+='<div class="form-group">',r+='<select class="form-control  " id="otherLayer" name="otherLayer" data-val="true" data-val-required="Select intersecting layer">';for(i=0;i<a.length;i++){var s;r+='    <option value="'+(s=a[i]).value+'" >'+s.title+"</option>"}r+="    </select>",r+='    <span class="field-validation-valid" data-valmsg-for="otherLayer" data-valmsg-replace="true"></span>',r+=" </div>",r+='<div class="form-group">',r+='  <div class="checkbox col-sm-12 ">',r+='    <label><input id="clipOutside" type="checkbox"> Clip outside</label>',r+="  </div>",r+=" </div>",r+="</form>",r+="  </div>";var l=$(r).appendTo(this.mainPanel),c=$(l.find("#"+n.id+"_form"));c.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(c),$.validator.setDefaults({ignore:t}),c.validate(),!c.valid()){e.cancel=!0;var a=c.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=c.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.otherLayer=l.find("#otherLayer").val(),e.data.clipOutside=l.find("#clipOutside").prop("checked")}),this.changesApplied=!1},DlgDissolve.prototype=Object.create(DlgTaskBase.prototype),DlgDissolve.prototype.createUI=function(){var n=this,e=this.obj,r=(e.get("custom"),LayerHelper.getDetails(e).fields);r||(r=[]);var t='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';t+="  <p>",t+="Dissolve features of ("+e.get("title")+") :",t+="  </p>",t+='  <div class="form-group">',t+='    <label class="" for="dissolveField">Group based on field:</label>',t+='<select class="form-control  " id="dissolveField" name="dissolveField" data-val="true" data-val-required="Select dissolve field">';for(var a=0;a<r.length;a++){var i=r[a];if("bytea"!==i.type){var o=i.name;t+=' <option value="'+o+'"  >'+(i.alias||o)+"</option>"}}t+="    </select>",t+='    <span class="field-validation-valid" data-valmsg-for="dissolveField" data-valmsg-replace="true"></span>',t+="  </div>";var s=0;t+="<hr />",t+='<div class="form-group">',t+=' <label class="col-sm-12">Statistics:</label>',t+=' <table id="tblStatistics" class=" table order-list col-sm-12">',t+="  <thead>",t+="  <tr><td>Statistic</td><td>Field</td></tr>",t+="  </thead>",t+="  <tbody>",t+="  </tbody>",t+="  <tfoot>",t+="         <tr>",t+='   <td colspan="4" style="text-align: left;"><input type="button" class="btn btn-lg btn-block " id="addStatistic" value="Add Statistic" /></td>',t+="  </tr>",t+="  </tfoot>",t+="  </table>",t+="</div>",t+="</form>",t+="  </div>",t=DOMPurify.sanitize(t,{SAFE_FOR_JQUERY:!0});var l=$(t).appendTo(this.mainPanel);l.find("#addStatistic").on("click",function(){var e=$("<tr>"),t="";t+='<td><select class="form-control dissolve-statistic" name="statistic_'+s+'"  >',t+='    <option value="COUNT"  >Count</option>',t+='    <option value="SUM"  >Sum</option>',t+='    <option value="MIN"  >Minimum</option>',t+='    <option value="MAX"  >Maximum</option>',t+='    <option value="AVG"  >Average</option>',t+="</select></td>",t+='<td><select class="form-control  dissolve-field " id="statisticField_'+s+'"  name="statisticField_'+s+'" >';for(var a=0;a<r.length;a++){var i=r[a];if("bytea"!==i.type){var o=i.name;t+=' <option value="'+o+'"  >'+(i.alias||o)+"</option>"}}t+="</select></td>",t+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',e.append(t),l.find("#tblStatistics").append(e),s++}),l.find("#tblStatistics").on("click",".ibtnDel",function(e){$(this).closest("tr").remove(),s-=1}),l.find("#tblStatistics").on("wheel","input[type=number]",function(e){$(this).blur()});var c=$(l.find("#"+n.id+"_form"));c.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(c),$.validator.setDefaults({ignore:t}),c.validate(),!c.valid()){e.cancel=!0;var a=c.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=c.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){var a={};a.dissolveField=l.find("#dissolveField").val(),a.statistics=[];var i={};l.find("#tblStatistics > tbody  > tr").each(function(){var e=$(this).find(".dissolve-field").val(),t=$(this).find(".dissolve-statistic").val();i[e+""+t]||(a.statistics.push({field:e,statistic:t}),i[e+""+t]=!0)}),e.data.dissolve=a}),this.changesApplied=!1},DlgVectorSearch.prototype=Object.create(DlgTaskBase.prototype),DlgVectorSearch.prototype.createUI=function(){var h=this.mapContainer.map.getView().getProjection().getCode(),f=this,t=this.obj,a=(t.get("custom"),LayerHelper.getDetails(t)),i=a.filter,m=a.filter;m||(m={expression:"",spatialFilter:null}),m=JSON.parse(JSON.stringify(m)),this.filter=m;this.tabPanel=$('<div id="tabPanel"><ul id="tabPanel_nav" class="nav  nav-pills__ nav-tabs nav-tab-bar_"></ul><div id="tabPanel_content" class="tab-content clearfix_"></div></div>').appendTo(this.mainPanel),this.tabPanelNav=this.tabPanel.find("#tabPanel_nav"),this.tabPanelContent=this.tabPanel.find("#tabPanel_content");var g=this.createAttributesPanelUI(!0);this.tabAttrbutesContent=g;var y=this.createSpatialPanelUI(!1);this.tabSpatialContent=y,this.setActions(),this.applyHandlers.push(function(e){var t=g.find("#expression").val();m.expression=t,e.data.filter=m,e.dialogAction;var a,i=y.find("#applySpatialFilter").prop("checked"),o=y.find("#spatialOperator").val(),n=y.find("#distance").val(),r=y.find("#nearestSearchDistance").val(),s=y.find("#nearestMaxNumber").val();if("layer"==y.find("input[name='shapeOrLayer']:checked").val()){a=y.find("#byFeaturesOfLayer").val();try{a=parseInt(a)}catch(e){}}var l=[];if(f.drawlayer)for(var c=f.drawlayer.getSource().getFeatures(),d=0;d<c.length;d++)l.push(c[d].getGeometry());if(i&&(0<l.length||a)){var p,u;if(0<l.length)p=1<l.length?new ol.Feature({geometry:new ol.geom.GeometryCollection(l),name:"Search area"}):new ol.Feature({geometry:l[0],name:"Search area"}),u=new ol.format.GeoJSON({featureProjection:h,dataProjection:"EPSG:3857"}).writeFeatureObject(p);e.data.filter.spatialFilter={spatialOperator:o,searchArea:u,searchAreaSrid:3857,byFeaturesOfLayer:a,within_distance:n,nearest_searchDistance:r,nearest_maxNumber:s}}else e.data.filter.spatialFilter=void 0}),this.cancelHandlers.push(function(e){a.filter=i,t.getSource().refresh()}),this.changesApplied=!1},DlgVectorSearch.prototype.setActions=function(){this.setAttributesPanelUI_actions(this.tabAttrbutesContent),this.createSpatialPanelUI_actions(this.tabSpatialContent)},DlgVectorSearch.prototype.createAttributesPanelUI=function(e){var n=this,t=this.obj,a=t.get("custom"),i=(LayerHelper.getDetails(t),this.filter),o=a.dataObj.details.fields;o||(o=[]),this.fields=o;var r="";e&&(r="active");var s="dlgVectorSearch_tabAttrbutes",l=$('<li class="'+r+'"><a href="#'+s+'" data-toggle="tab"><i class="glyphicon glyphicon-list-alt"></i> Attributes</a> </li>').appendTo(this.tabPanelNav);this.tabAttrbutes=$('<div class="tab-pane '+r+'" id="'+s+'"></div>').appendTo(this.tabPanelContent);var c='<div class="scrollable-content" ><form id="'+s+'_form" class="modal-body form-horizontal">';c+='<div class="form-group">',c+='  <label class="col-sm-2 control-label" for="fieldName">Field:</label>',c+='   <div class="col-sm-10 ">  <select class="form-control " id="fieldName" >';for(var d=0;d<o.length;d++){var p=o[d];if("bytea"!==p.type){var u=p.name;c+=' <option value="'+u+'" >'+(p.alias||u)+"</option>"}}c+="    </select></div>",c+=" </div>",c+='<div class="form-group">',c+='  <label class="col-sm-2 control-label" for="operator">Operator:</label>',c+='    <div class="col-sm-4 "><select class="form-control  " id="operator" >',c+='                          <option value="=" >=</option>',c+='                          <option value="<>" >&#x3C;&#x3E;</option>',c+='                          <option value=">" >&#x3E;</option>',c+='                          <option value=">=" >&#x3E;=</option>',c+='                          <option value="<" >&#x3C;</option>',c+='                          <option value="<=" >&#x3C;=</option>',c+='                          <option value="LIKE" >LIKE</option>',c+='                          <option value="IS NULL" >IS NULL</option>',c+='                          <option value="IS NOT NULL" >IS NOT NULL</option>',c+="    </select></div>",c+=" </div>",c+='<div class="form-group">',c+='  <label class="col-sm-2 control-label" for="sampleValue">Value:</label>',c+='  <div class="col-sm-10 ">',c+='    <input id="sampleValue" class=" mySearch-searchinput form-control background-position-right" placeholder="Value" type="search" />',c+='    <button id="addToExpression" type="button" class="btn btn-primary btn-success btn-xs "><span class="glyphicon glyphicon-plus"></span>Add to expression</button>',c+="  </div>",c+=" </div>",c+='  <div class="form-group">',c+='    <label class="" for="expression">Expression:</label>',c+='    <textarea type="text" name="expression" rows="3" id="expression" autofocus placeholder="Expression" class="form-control" >'+(i.expression?i.expression:"")+"</textarea>",c+='    <button id="clearExpression" type="button" class="btn btn-primary btn-danger btn-xs "><span class="glyphicon glyphicon-remove"></span>Clear</button>',c+="  </div>",c+="</form>",c+="  </div>",c=DOMPurify.sanitize(c,{SAFE_FOR_JQUERY:!0});var h=$(c).appendTo(this.tabAttrbutes),f=(h.find("#fieldName"),h.find("#sampleValue"),h.find("#expression"),h.find("#operator"),$(h.find("#"+s+"_form")));return f.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(f),$.validator.setDefaults({ignore:t}),f.validate(),!f.valid()){e.cancel=!0,l.find("a").addClass("text-danger"),$('.nav-tabs a[href="#'+s+'"]').tab("show");var a=f.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=f.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),h},DlgVectorSearch.prototype.setAttributesPanelUI_actions=function(c){for(var d=this.obj,p=(d.get("custom"),LayerHelper.getDetails(d),this.filter,this.fields),u=c.find("#fieldName"),h=c.find("#sampleValue"),f=c.find("#expression"),m=c.find("#operator"),g={},e=0;p&&e<p.length;e++){var t=p[e],a=t.name;t.alias;if((g[a]=t).domain&&"codedValues"==t.domain.type&&t.domain.items){for(var i={},o=0;o<t.domain.items.length;o++)i[t.domain.items[o].code]=t.domain.items[o].value;t.codedValues=i}}u.change(function(){var e=$(this).val(),t=d.getSource().getFeatures(),a={},i=[],o=g[e];if(o&&o.domain&&"codedValues"==o.domain.type&&o.domain.items)for(var n=0;n<o.domain.items.length;n++)i.push({label:o.domain.items[n].value,value:o.domain.items[n].code});else{for(var r=0;r<t.length;r++){var s=t[r].get(e);a[s+""]={label:s+"",value:s+""}}for(var l in a)i.push(a[l])}i=i.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),h.val(void 0),$(h).autocomplete({appendTo:c,minLength:0,source:function(t,e){if(i){t.term;var a=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i");$(this).text();e($.map(i,function(e){if(e&&(!t.term||a.test(e.label)))return{label:e.label,value:e.value}}))}else;},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())},select:function(e,t){return $(this).data("selected_item",t.item),$(this).val(t.item.label),!1}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.label,i=this.term;i&&(a=String(a).replace(new RegExp(i,"gi"),"<strong class='ui-state-highlight'>$&</strong>"));var o="";return o+='<div class="" >',o+="<strong>"+a+"</strong>",$("<li></li>").append(o).appendTo(e)}}),u.trigger("change"),c.find("#clearExpression").click(function(){f.val(void 0)}),c.find("#addToExpression").click(function(){for(var e=f.val(),t=u.val(),a=m.val(),i=void 0,o=0;o<p.length;o++){var n=p[o];if(n.name===t){i=n;break}}if(i){t='"'+t+'"',i.expression&&i.isExpression&&(t="("+i.expression+")");var r="",s=!0;if("IS NULL"!=a&&"IS NOT NULL"!=a||(s=!1),s){var l=h.val(),c=h.data("selected_item");c&&c.label==l&&(l=c.value);var d=new String;if((d=l+"")||(d=""),"varchar"==i.type||"timestamp with time zone"==i.type||"date"==i.type)d="'"+d.replace(new RegExp("'","g"),"''")+"'";else{if(""==d&&s)return void alert("Value is not defined");"LIKE"==a&&(t+="::text",d="'"+d.replace(new RegExp("'","g"),"''")+"'")}r="("+t+" "+a+" "+d+")"}else r="("+t+" "+a+")";r&&(e=e?e+" AND "+r:r),f.val(e)}})},DlgVectorSearch.prototype.createSpatialPanelUI=function(e){var d=this,t=this.obj,a=(t.get("custom"),LayerHelper.getDetails(t),this.filter),i="";e&&(i="active");var p="dlgVectorSearch_tabSpatial",u=$('<li class="'+i+'"><a href="#'+p+'" data-toggle="tab"><i class="glyphicon glyphicon-globe"></i> Spatial</a> </li>').appendTo(this.tabPanelNav);this.tabSpatial=$('<div class="tab-pane '+i+'" id="'+p+'"></div>').appendTo(this.tabPanelContent);var o='<div class="scrollable-content" ><form id="'+p+'_form" class="modal-body form-horizontal">';o+='<div class="form-group">',o+='  <div class="checkbox col-sm-12 ">',a.spatialFilter?o+='    <label><input id="applySpatialFilter" checked="checked" type="checkbox"> Select features that:</label>':o+='    <label><input id="applySpatialFilter" type="checkbox"> Select features that:</label>',o+='<span style="display:none" id= "applySpatialFilter_error"class="field-validation-error" ><span class="">No spatial condition is defined!</span></span>',o+="  </div>",o+=" </div>",o+='<div class="form-group" >',o+='    <div class="col-sm-5 "><select class="form-control  " id="spatialOperator" >',o+='                          <option value="ST_Intersects" >Intersect</option>',o+='                          <option value="NOT ST_Intersects" >Do not Intersect</option>',o+='                          <option value="ST_Contains" >Contain</option>',o+='                          <option value="NOT ST_Contains" >Do not Contain</option>',o+='                          <option value="ST_Within" >Are within</option>',o+='                          <option value="NOT ST_Within" >Are not within</option>',o+='                          <option value="ST_DWithin" >Are within distance</option>',o+='                          <option value="ST_Nearest" >Are nearest to</option>',o+="    </select></div>",o+=" </div>",o+='  <div class="form-group" id="ST_DWithin_options" >',o+='    <span class="col-sm-2 " for="distance">Distance:</span>',o+='    <div class="col-sm-3 ">',o+='      <input type="number" name="distance" id="distance" min="0" value="" placeholder="Meters" class="form-control" data-val="true" data-val-requiredif="Distance is required" data-val-requiredif-dependentproperty="spatialOperator"  data-val-requiredif-targetvalue="ST_DWithin"  />',o+="    </div>",o+='    <span class="field-validation-valid" data-valmsg-for="distance" data-valmsg-replace="true"></span>',o+="  </div>",o+='  <div class="form-group" id="ST_Nearest_options">',o+='    <span class="col-sm-5 " for="nearestSearchDistance">Maximum search distance:</span>',o+='    <div class="col-sm-4 ">',o+='      <input type="number" name="nearestSearchDistance" id="nearestSearchDistance" min="0" value="" placeholder="Meters" class="form-control" data-val="true" data-val-requiredif="Distance is required" data-val-requiredif-dependentproperty="spatialOperator"  data-val-requiredif-targetvalue="ST_Nearest"  />',o+="    </div>",o+='    <span class="field-validation-valid" data-valmsg-for="nearestSearchDistance" data-valmsg-replace="true"></span>',o+="  </div>",o+='  <div class="form-group" id="ST_Nearest_options2">',o+='    <span class="col-sm-offset-2 col-sm-3 " for="nearestMaxNumber">Find maximum</span>',o+='    <div class=" col-sm-2 ">',o+='      <input type="number" name="nearestMaxNumber" id="nearestMaxNumber" min="1" value="1" placeholder="" class="form-control" data-val="true" data-val-requiredif="Maximum number of nearest features is required"  />',o+="    </div>",o+='    <span class=" " >number of nearest features</span>',o+='    <span class="field-validation-valid" data-valmsg-for="nearestMaxNumber" data-valmsg-replace="true"></span>',o+="  </div>",o+='<div class="form-group">',o+='  <div class="radio col-sm-12 ">',a.spatialFilter&&a.spatialFilter.byFeaturesOfLayer?o+='    <label><input id="shapeOrLayer_shape" name="shapeOrLayer" value="shape" type="radio"> Drawing shape:</label>':o+='    <label><input id="shapeOrLayer_shape" name="shapeOrLayer" value="shape" checked="checked" type="radio"> Drawing shape:</label>',o+="  </div>",o+=" </div>",o+='<div class="form-group">',o+='  <div class="col-sm-1 ">',o+='    <button  type="button"  title="Point"  id="drawPoint" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawPointIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>',o+="  </div>",o+='  <div class="col-sm-1 ">',o+='    <button  type="button"   title="Box" id="drawBox" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawRectangleIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>',o+="  </div>",o+='  <div class="col-sm-1 ">',o+='    <button  type="button"   title="Circle" id="drawCircle" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawCircleIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>',o+="  </div>",o+='  <div class="col-sm-1 ">',o+='    <button  type="button"   title="Polygon" id="drawPolygon" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawPolygonIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>',o+="  </div>",o+='  <div class="col-sm-1 ">',o+='    <button  type="button"   title="Line" id="drawLine" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawLineIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>',o+="  </div>",o+=" </div>",o+='  <div class="form-group">',o+='   <div class="col-sm-offset-1 col-sm-2 ">',o+='    <button id="clearShapes" type="button" class="btn btn-primary btn-danger btn-xs "><span class="glyphicon glyphicon-remove"></span>Clear shapes</button>',o+="   </div>",o+="  </div>",o+='<div class="form-group">',o+='  <div class="radio col-sm-12 ">',a.spatialFilter&&a.spatialFilter.byFeaturesOfLayer?o+='    <label><input id="shapeOrLayer_layer" name="shapeOrLayer" value="layer" checked="checked" type="radio"> Layer:</label>':o+='    <label><input id="shapeOrLayer_layer" name="shapeOrLayer" value="layer" type="radio"> Layer:</label>',o+="  </div>",o+=" </div>";for(var n=this.mapContainer.getAllLayersList(),r=[],s=n.length-1;0<=s;s--){var l=(c=n[s]).get("custom");l&&(t!=c&&"ol.layer.Vector"===l.type&&"ol.format.GeoJSON"===l.format&&l.dataObj&&l.dataObj.details&&r.push({title:c.get("title"),value:l.dataObj.id}))}o+='<div class="form-group">',o+='    <div class="col-sm-12 "><select class="form-control  " id="byFeaturesOfLayer" >',o+='                          <option value="" ></option>';for(s=0;s<r.length;s++){var c=r[s];a.spatialFilter&&a.spatialFilter.byFeaturesOfLayer==c.value?o+='    <option selected="selected" value="'+c.value+'" >'+c.title+"</option>":o+='    <option value="'+c.value+'" >'+c.title+"</option>"}o+="    </select></div>",o+=" </div>",o+="</form>",o+="  </div>";var h=$(o).appendTo(this.tabSpatial);a.spatialFilter&&(a.spatialFilter.spatialOperator&&h.find("#spatialOperator").val(a.spatialFilter.spatialOperator),this.addShape(a.spatialFilter.searchArea),a.spatialFilter.within_distance&&h.find("#distance").val(a.spatialFilter.within_distance),a.spatialFilter.nearest_searchDistance&&h.find("#nearestSearchDistance").val(a.spatialFilter.nearest_searchDistance),a.spatialFilter.nearest_maxNumber&&h.find("#nearestMaxNumber").val(a.spatialFilter.nearest_maxNumber));var f=$(h.find("#"+p+"_form"));return f.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){h.find("#applySpatialFilter_error").hide();var t,a=h.find("#applySpatialFilter").prop("checked");h.find("#spatialOperator").val();if("layer"==h.find("input[name='shapeOrLayer']:checked").val()){t=h.find("#byFeaturesOfLayer").val();try{t=parseInt(t)}catch(e){}}var i=[];if(d.drawlayer)for(var o=d.drawlayer.getSource().getFeatures(),n=0;n<o.length;n++)i.push(o[n].getGeometry());if(a){if(!(0<i.length||t))return!1,e.cancel=!0,u.find("a").addClass("text-danger"),$('.nav-tabs a[href="#'+p+'"]').tab("show"),e.cancel=!0,void h.find("#applySpatialFilter_error").show();!0}var r=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(f),$.validator.setDefaults({ignore:r}),f.validate(),!f.valid()){e.cancel=!0,u.find("a").addClass("text-danger"),$('.nav-tabs a[href="#'+p+'"]').tab("show");var s=f.find(".input-validation-error").first();if(s){var l,c=s.offset().top;l=f.offset().top,d.mainPanel.find(".scrollable-content").animate({scrollTop:c-l},1e3)}}}),h},DlgVectorSearch.prototype.createSpatialPanelUI_actions=function(t){var e=this,a=this.obj;a.get("custom"),LayerHelper.getDetails(a),this.filter,t.find("#fieldName"),t.find("#sampleValue"),t.find("#expression"),t.find("#operator");t.find("#spatialOperator").change(function(){var e=$(this).val();"ST_DWithin"===e?t.find("#ST_DWithin_options").show():t.find("#ST_DWithin_options").hide(),"ST_Nearest"===e?(t.find("#ST_Nearest_options").show(),t.find("#ST_Nearest_options2").show()):(t.find("#ST_Nearest_options").hide(),t.find("#ST_Nearest_options2").hide())}),t.find("#spatialOperator").trigger("change"),t.find("#drawPoint").click(function(){e.drawShape("point")}),t.find("#drawBox").click(function(){e.drawShape("box")}),t.find("#drawCircle").click(function(){e.drawShape("circle")}),t.find("#drawPolygon").click(function(){e.drawShape("polygon")}),t.find("#drawLine").click(function(){e.drawShape("line")}),t.find("#clearShapes").click(function(){e.drawlayer&&e.drawlayer.getSource().refresh(),e.tabSpatialContent.find("#applySpatialFilter").prop("checked",!1)}),t.find("#byFeaturesOfLayer").change(function(){$(this).val()?(e.tabSpatialContent.find("#shapeOrLayer_layer").prop("checked",!0),e.tabSpatialContent.find("#applySpatialFilter").prop("checked",!0),e.tabSpatialContent.find("#applySpatialFilter_error").hide()):e.tabSpatialContent.find("#shapeOrLayer_shape").prop("checked",!0)})},DlgVectorSearch.prototype.moveLayerToTop=function(){var e=this.mapContainer.map;e.getLayers().remove(this.drawlayer),e.getLayers().push(this.drawlayer)},DlgVectorSearch.prototype.closed=function(){this.mapContainer.map.getLayers().remove(this.drawlayer),this.onLayerAddEventKey&&ol.Observable.unByKey(this.onLayerAddEventKey)},DlgVectorSearch.prototype.createDrawLayer=function(){var e=this.mapContainer.map,t=this;this.drawsource||(this.drawsource=new ol.source.Vector),this.drawlayer=new ol.layer.Vector({source:this.drawsource,custom:{type:"drawing",keepOnTop:!0,skipSaving:!0,hiddenInToc:!0}}),t.onLayerAddEventKey=e.getLayers().on("add",function(e){e.element!==t.drawlayer&&e.element.get("custom")&&(e.element.get("custom").keepOnTop||t.moveLayerToTop())})},DlgVectorSearch.prototype.addShape=function(e){if(e){var t=this.mapContainer.map.getView().getProjection().getCode(),a=new ol.format.GeoJSON({featureProjection:t,dataProjection:"EPSG:3857"});this.drawlayer||this.createDrawLayer();var i=a.readFeatures(e,{featureProjection:t});this.drawlayer.getSource().addFeatures(i),this.drawlayer.changed(),this.moveLayerToTop()}},DlgVectorSearch.prototype.drawShape=function(e){var t=this;t.tabSpatialContent.find("#applySpatialFilter").prop("checked",!0),t.tabSpatialContent.find("#shapeOrLayer_shape").prop("checked",!0),t.tabSpatialContent.find("#applySpatialFilter_error").hide();var a,i,o,n=this.mapContainer.map;t.drawlayer||t.createDrawLayer(),t.interaction=void 0,n.removeInteraction(t.interaction),i="Point",o=void 0,"line"==(a=e)?i="LineString":"polygon"==a?i="Polygon":"circle"==a?(i="Circle",o=ol.interaction.Draw.createRegularPolygon()):"box"==a&&(i="Circle",o=ol.interaction.Draw.createBox()),t.interaction=new ol.interaction.Draw({source:t.drawsource,type:i,geometryFunction:o}),n.addInteraction(t.interaction),t.interaction.on("drawend",function(e){n.removeInteraction(t.interaction),t.moveLayerToTop(),t.dlg.open(),t.setActions()}),t.dlg.getModal().modal("hide"),t.dlg.getModal().hide()},DlgVectorTableView.prototype=Object.create(DlgTaskBase.prototype),DlgVectorTableView.prototype.createUI_0=function(){for(var n=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e),e.getSource()),a=LayerHelper.getFields(e),i=t.getFeatures(),o=(this.options.hasEditPermission,LayerHelper.getVectorLayerSelectTask(e),[]),r=0;r<a.length;r++){var s=a[r];if("bytea"!==s.type&&"nill"!==s.type){var l=s.name,c=s.alias||l;c=DOMPurify.sanitize(c,{SAFE_FOR_JQUERY:!0}),o.push({title:c,name:l,data:l})}}var d=n.id+"-table",p='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';p+='  <div class="form-group">',p+='    <table id="'+d+'" class="table table-condensed table-hover table-responsive" >',p+="    <thead>",p+="      <tr>";for(r=0;r<o.length;r++)p+="      <th>"+o[r].title+"</th>";p+="      </tr>",p+="    </thead>",p+="    <tbody>";for(var u=0;u<i.length;u++){var h=i[u];p+="      <tr>";for(r=0;r<o.length;r++)p+="      <td>"+h.get(o[r].name)+"</td>";p+="      </tr>"}p+="    </tbody>",p+="    <tfoot>",p+="      <tr>";for(r=0;r<o.length;r++)p+="      <th>"+o[r].title+"</th>";p+="      </tr>",p+="    </tfoot>",p+="  </table>",p+="  </div>",p+="</form>",p+="  </div>",p=DOMPurify.sanitize(p,{SAFE_FOR_JQUERY:!0});var f=$(p).appendTo(this.mainPanel),m=f.find("#"+d).DataTable({select:{style:"single"}});m.on("select",function(e,t,a,i){if("row"===a)m.rows(i).data().pluck("id")});var g=$(f.find("#"+n.id+"_form"));g.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(g),$.validator.setDefaults({ignore:t}),g.validate(),!g.valid()){e.cancel=!0;var a=g.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=g.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){}),this.changesApplied=!1,this.dlg.setSize(BootstrapDialog.SIZE_WIDE)},DlgVectorTableView.prototype.createUI_1=function(){for(var n=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e),e.getSource()),a=LayerHelper.getFields(e),i=t.getFeatures(),o=[],r=0;r<a.length;r++){var s=a[r];if("bytea"!==s.type&&"nill"!==s.type){var l=s.name,c=s.alias||l;c=DOMPurify.sanitize(c,{SAFE_FOR_JQUERY:!0}),o.push({title:c,name:l,data:l})}}for(var d=[],p=0;p<i.length;p++){var u=i[p],h={};for(r=0;r<o.length;r++)h[o[r].name]=u.get(o[r].name);d.push(h)}var f=n.id+"-table",m='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';m+='  <div class="form-group">',m+='    <table id="'+f+'" class="table table-condensed table-hover table-responsive" >',m+="  </table>",m+="  </div>",m+="</form>",m+="  </div>",m=DOMPurify.sanitize(m,{SAFE_FOR_JQUERY:!0});var g=$(m).appendTo(this.mainPanel),y=g.find("#"+f),v=y.DataTable({data:d,columns:o,select:{style:"api"}});v.on("select",function(e,t,a,i){if("row"===a)v.rows(i).data().pluck("id")}),y.on("click","tbody tr",function(){v.row(this,{selected:!0}).any()?v.row(this).deselect():v.row(this).select()});var b=$(g.find("#"+n.id+"_form"));b.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(b),$.validator.setDefaults({ignore:t}),b.validate(),!b.valid()){e.cancel=!0;var a=b.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=b.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){}),this.changesApplied=!1,this.dlg.setSize(BootstrapDialog.SIZE_WIDE)},DlgVectorTableView.prototype.createUI=function(){var n=this;n.mainPanel.html("");var i=this.obj;n.forceShowOnlySelection=n.options.forceShowOnlySelection;var e,s,t=i.get("custom"),o=LayerHelper.getDetails(i),a=i.getSource(),r=LayerHelper.getFields(i),l=a.getFeatures(),c={},d=LayerHelper.getVectorLayerSelectTask(i),p=LayerHelper.getVectorLayerEditTask(i),u=this.options.hasEditPermission&&p;if(n.isInitialized||(n.showSelectedOnly=!1),d&&(e=d.interactionSelect.getFeatures()).getLength()){e.getLength();for(var h,f=0;h=e.item(f);f++){!(L=h.getId())&&h.get("_cacheInfo")&&(L=h.get("_cacheInfo").uid),c[L]=!0}n.isInitialized||(n.isInitialized=!0,n.showSelectedOnly=!0)}var m=function(o,n,e,r){u&&p.editFeatureAttributes(o._row_,{displayInModal:!0,defaultFieldToEdit:e,onCommit:function(){r&&(r.removeClass("updating-record-faild"),r.addClass("wait-updating-record"))},onFailed:function(){r&&(r.removeClass("wait-updating-record"),r.addClass("updating-record-faild"))},onSuccess:function(){r&&(r.removeClass("updating-record-faild"),r.removeClass("wait-updating-record"));for(var e=o._row_,t={_row_:e},a=0;a<y.length;a++)if(y[a].codedValues){t[y[a].field]=e.get(y[a].field);var i=t[y[a].field]+"";y[a].codedValues[i]&&(t[y[a].field]=y[a].codedValues[i])}else t[y[a].field]=e.get(y[a].field);t._sys_featureid_=o._sys_featureid_,t._sys_isSelected_=o._sys_isSelected_,s.bootstrapTable("updateRow",{index:n,row:t})}})},g='<div style="display: flex;">';"table"!==t.type&&(g+='<button style="margin: 2px;" type="button" class="zoomTo btn btn-xs btn-primary\t" title="Zoomto" ><span class="glyphicon glyphicon-zoom-in"></span></button>'),u&&(g+='<button style="margin: 2px;" type="button" class="remove btn btn-xs btn-danger\t" title="Delete" ><span class="glyphicon glyphicon-remove"></span></button>',g+='<button style="margin: 2px;" type="button" class="edit btn btn-xs btn-info\t" title="Edit" ><span class="glyphicon glyphicon-edit"></span></button>'),g+="</div>";var y=[];y.push({checkbox:!0,field:"_sys_isSelected_",sortable:!0}),y.push({title:"",field:"_sys_operate_",width:"100px",formatter:function(e,t,a){return g},events:{"click .zoomTo":function(e,t,a,i){var o=a._row_;o&&o.getGeometry&&n.mapContainer.zoomToFeature(o)},"click .remove":function(e,t,a,i){var o,n,r=e.target.closest("tr");o=a,n=$(r),u&&p.deleteSingleFeature(o._row_,{msg:"Delete feature?",onCommit:function(){n&&(n.removeClass("updating-record-faild"),n.addClass("wait-updating-record"))},onFailed:function(){n&&(n.removeClass("wait-updating-record"),n.addClass("updating-record-faild"))},onSuccess:function(){n&&(n.removeClass("updating-record-faild"),n.removeClass("wait-updating-record")),s.bootstrapTable("remove",{field:"_sys_featureid_",values:[o._sys_featureid_]})}})},"click .edit":function(e,t,a,i){var o=e.target.closest("tr");m(a,i,void 0,$(o))}},sortable:!1}),y.push({title:"id",field:"_sys_featureid_",visible:!0,sortable:!0});for(f=0;f<r.length;f++){var v=r[f];if("bytea"!==v.type&&"nill"!==v.type){var b=v.name,_=v.alias||b;_=DOMPurify.sanitize(_,{SAFE_FOR_JQUERY:!0});var w=void 0;if(v.domain&&"codedValues"==v.domain.type&&v.domain.items){w={};for(var k=0;k<v.domain.items.length;k++)w[v.domain.items[k].code]=v.domain.items[k].value}y.push({title:_,field:b,sortable:!0,codedValues:w})}}for(var S=[],T=0;T<l.length;T++){var C=l[T],x={_row_:C};for(f=0;f<y.length;f++)if(y[f].codedValues){x[y[f].field]=C.get(y[f].field);var D=x[y[f].field]+"";y[f].codedValues[D]&&(x[y[f].field]=y[f].codedValues[D])}else x[y[f].field]=C.get(y[f].field);var L;!(L=C.getId())&&C.get("_cacheInfo")&&(L=C.get("_cacheInfo").uid),x._sys_featureid_=L,x._sys_isSelected_=!!c[L];var P=x._sys_isSelected_;n.showSelectedOnly?P&&S.push(x):S.push(x)}var O=n.id+"-table",I='<div class="scrollable-content" ><form id="'+n.id+'_form" class="bootstrap_table_form modal-body form-horizontal">';n.forceShowOnlySelection?n.showSelectedOnly?I+='    <label><input id="showSelectedOnly" checked="checked" disabled="disabled" type="checkbox"> Show only selected rows</label>':I+='    <label><input id="showSelectedOnly" type="checkbox" disabled="disabled"> Show only selected rows</label>':n.showSelectedOnly?I+='    <label><input id="showSelectedOnly" checked="checked" type="checkbox"> Show only selected rows</label>':I+='    <label><input id="showSelectedOnly" type="checkbox"> Show only selected rows</label>',I+='<div class="form-group" >',I+='<div class="btn-toolbar">',I+=' <button type="button" class="btn btn-xs btn-primary" id="downloadCSV" ><i class="fa fa-download"></i> Download CSV</button>',I+="</div>",I+="</div>",I+='  <div class="form-group">',I+='    <table id="'+O+'" class="table table-condensed table-hover table-responsive" data-search="true" data-show-columns="true" data-pagination="false" >',I+="  </table>",I+="  </div>",u&&"table"==t.type&&(I+='<div class="form-group" >',I+='<div class="btn-toolbar">',I+=' <button type="button" class="btn btn-xs btn-primary" id="addNewRecord" ><i class="glyphicon glyphicon-plus"></i> New record</button>',I+="</div>",I+="</div>"),I+="</form>",I+="  </div>",I=DOMPurify.sanitize(I,{SAFE_FOR_JQUERY:!0});var F=$(I).appendTo(this.mainPanel);F.find("#showSelectedOnly").change(function(){var e=$(this).prop("checked");n.showSelectedOnly=!!e,n.forceShowOnlySelection&&(n.showSelectedOnly=!0),n.createUI()}),l.length||(F.find("#downloadCSV").hide(),F.find("#generateReport").hide()),F.find("#generateReport").click(function(){}),F.find("#downloadCSV").click(function(){var e=i.get("title")||o.shapefileName||o.tableName,t=n.exportToCsv(y,l,c),a=new Blob([t],{type:"text/csv;charset=utf-8"});saveAs(a,e+".csv")}),F.find("#addNewRecord").click(function(){!function(e){if(u){var n=new ol.Feature;p.addFeatureAttributes(n,{defaultFieldToEdit:e,onCommit:function(){},onFailed:function(){},onSuccess:function(e){if(e&&e.id){var t=l.length;n.setId?n.setId(e.id):n.id=e.id;for(var a={_row_:n},i=0;i<y.length;i++)if(y[i].codedValues){a[y[i].field]=n.get(y[i].field);var o=a[y[i].field]+"";y[i].codedValues[o]&&(a[y[i].field]=y[i].codedValues[o])}else a[y[i].field]=n.get(y[i].field);a._sys_featureid_=e.id,a._sys_isSelected_=!1,s.bootstrapTable("insertRow",{index:t,row:a})}}})}}(void 0)});var E=F.find("#"+O);(s=E.bootstrapTable({data:S,columns:y})).on("check.bs.table",function(e,t,a){var i=t._row_;i&&d&&d.interactionSelect&&(d.interactionSelect.getFeatures().push(i),d.interactionSelect.dispatchEvent({type:"select",selected:[i],deselected:[]}))}),s.on("check-all.bs.table",function(e,t){var a=[];if(d&&d.interactionSelect){d.interactionSelect.getFeatures().clear();for(var i=0;i<t.length;i++){var o=t[i]._row_;d.interactionSelect.getFeatures().push(o),a.push(o)}d.interactionSelect.dispatchEvent({type:"select",selected:a,deselected:[]})}}),s.on("uncheck.bs.table",function(e,t,a){var i=t._row_;i&&d&&d.interactionSelect&&(d.interactionSelect.getFeatures().remove(i),d.interactionSelect.dispatchEvent({type:"select",selected:[],deselected:[i]}))}),s.on("uncheck-all.bs.table",function(e,t){d&&d.interactionSelect&&d.interactionSelect.getFeatures().clear()}),s.on("dbl-click-row.bs.table",function(e,t,a){a.closest("tr").data("index");var i=t._row_;i&&i.getGeometry&&n.mapContainer.zoomToFeature(i)}),s.on("dbl-click-cell.bs.table",function(e,t,a,i,o){var n=o.closest("tr"),r=o.closest("tr").data("index");i._row_&&m(i,r,t,$(n))});var A=$(F.find("#"+n.id+"_form"));A.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(A),$.validator.setDefaults({ignore:t}),A.validate(),!A.valid()){e.cancel=!0;var a=A.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=A.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){}),this.changesApplied=!1,this.dlg.setSize(BootstrapDialog.SIZE_WIDE)},DlgVectorTableView.prototype.exportToCsv=function(l,e,t){var a=function(e){for(var t="",a=!0,i=0;i<l.length;i++){var o=l[i];if(!o.checkbox&&("_sys_operate_"!=o.field&&(void 0===o.visible||o.visible)&&o.field)){var n=e.get(o.field);"_sys_featureid_"==o.field&&(n=e.getId());var r="";null==n||(r=n instanceof Date?n.toLocaleString():n.toString());var s=r.replace(/"/g,'""');0<=s.search(/("|,|\n)/g)&&(s='"'+s+'"'),a||(t+=","),a=!1,t+=s}}return t+"\n"},i="";i+=function(){for(var e="",t=!0,a=0;a<l.length;a++){var i=l[a];if(!i.checkbox&&"_sys_operate_"!=i.field&&(void 0===i.visible||i.visible)&&i.field){var o=i.title.replace(/"/g,'""');0<=o.search(/("|,|\n)/g)&&(o='"'+o+'"'),t||(e+=","),t=!1,e+=o}}return e+"\n"}();for(var o=0;o<e.length;o++){var n=e[o],r=n.getId();!r&&n.get("_cacheInfo")&&(r=n.get("_cacheInfo").uid);var s=!!t[r];this.showSelectedOnly?s&&(i+=a(n)):i+=a(n)}return i},DlgOSMFilter.prototype=Object.create(DlgTaskBase.prototype),DlgOSMFilter.prototype.createUI=function(){var n=this,e=this.obj;e||(e={});var t=e.filterArray||[];t=JSON.parse(JSON.stringify(t));var a='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';a+="  <p>",a+="Define OSM keys and tags to filter data:",a+="  </p>",a+='  <div class="form-group">',a+='    <label class="" for="key">Key:</label>',a+='    <input id="key" name="key" class="mySearch-searchinput form-control background-position-right" placeholder="Key..." type="search" />',a+="  </div>",a+='  <div class="form-group">',a+='    <label class="" for="tag">Tag:</label>',a+='    <input id="tag" name="tag" class="mySearch-searchinput form-control background-position-right" placeholder="Tag..." type="search" />',a+="  </div>",a+='  <div class="form-group">',a+='    <input type="button" class="btn btn-lg btn-block " id="addFilter" value="Add Filter" />',a+="  </div>";var o=0;a+="<hr />",a+='<div class="form-group">',a+=' <label class="col-sm-12">Filters:</label>',a+=' <table id="tblFilter" class=" table order-list col-sm-12">',a+="  <thead>",a+="  <tr><td>Key</td><td></td><td>Tag</td><td></td></tr>",a+="  </thead>",a+="  <tbody>";for(var i=0;i<t.length;i++){var r=t[i].key,s=t[i].tag,l=t[i].operator||"eq";a+="  <tr>",a+='<td><label class="form-control osm-filter-key" name="key_'+o+'"  >',a+=r,a+="</label></td>",s?(a+="<td>","eq"==l&&(a+="="),a+="</td>",a+='<td><label class="form-control osm-filter-tag" data-operator="'+l+'"  name="tag_'+o+'"  >',a+=s,a+="</label></td>"):(a+="<td>Any</td>",a+="<td></td>"),a+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',a+="  </tr>",o++}a+="  </tbody>",a+="  </table>",a+="</div>",a+="</form>",a+="  </div>";var c=$(a).appendTo(this.mainPanel);(n.content=c).find("#addFilter").on("click",function(){var e=c.find("#key").val(),t=c.find("#tag").val();if(e){var a=$("<tr>"),i="";i+='<td><label class="form-control osm-filter-key" name="key_'+o+'"  >',i+=e,i+="</label></td>",t?(i+="<td>",i+="=",i+="</td>",i+='<td><label class="form-control osm-filter-tag" data-operator="eq"  name="tag_'+o+'"  >',i+=t,i+="</label></td>"):(i+="<td>Any</td>",i+="<td></td>"),i+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',a.append(i),c.find("#tblFilter").append(a),o++}}),c.find("#tblFilter").on("click",".ibtnDel",function(e){$(this).closest("tr").remove(),o-=1});var d=$(c.find("#"+n.id+"_form"));d.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(d),$.validator.setDefaults({ignore:t}),d.validate(),!d.valid()){e.cancel=!0;var a=d.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=d.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){var i=[];c.find("#tblFilter > tbody  > tr").each(function(){var e=$(this).find(".osm-filter-key").text(),t=$(this).find(".osm-filter-tag").text(),a=$(this).find(".osm-filter-tag").data("operator");i.push({key:e,tag:t,operator:a})}),e.data.filterArray=i});var p=c.find("#key");p.change(function(){u()}),$(p).autocomplete({appendTo:c,minLength:0,source:function(t,e){t.term;var a=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i");$(this).text();e($.map(n.keys,function(e){if(e.key&&(!t.term||a.test(e.key)))return{label:e.key,value:e.key,data:e.values}}))},select:function(e,t){return $(this).val(t.item.label),u(),!1},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.label,i=this.term;i&&(a=String(a).replace(new RegExp(i,"gi"),"<strong class='ui-state-highlight'>$&</strong>"));var o="";return o+='<div class="" >',o+="<strong>"+a+"</strong>",$("<li></li>").append(o).appendTo(e)};var u=function(){for(var e=c.find("#key").val(),i=[],t=0;t<n.keys.length;t++)if(n.keys[t].key==e){i=n.keys[t].values;break}var a=c.find("#tag");a.val(void 0),$(a).autocomplete({appendTo:c,minLength:0,source:function(t,e){t.term;var a=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i");$(this).text();e($.map(i,function(e){if(e&&(!t.term||a.test(e)))return{label:e,value:e}}))},select:function(e,t){return $(this).val(t.item.label),!1},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.label,i=this.term;i&&(a=String(a).replace(new RegExp(i,"gi"),"<strong class='ui-state-highlight'>$&</strong>"));var o="";return o+='<div class="" >',o+="<strong>"+a+"</strong>",$("<li></li>").append(o).appendTo(e)}};this.changesApplied=!1},DlgOSMShapeTypeSelection.prototype=Object.create(DlgTaskBase.prototype),DlgOSMShapeTypeSelection.prototype.createUI=function(){var e,n=this,t=this.obj,a='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';if(a+="  <p>",a+="  </p>",a+='<div class="form-group">',a+='  <div class="radio col-sm-12 ">',a+='    <label><input id="osmShapeType" name="osmShapeType" value="Point" checked="checked" type="radio"> Points ('+t.Point.count+")",(e=t.Point.tags).length){a+='    <span style="max-width: 100%;text-overflow: ellipsis;overflow: hidden;" class="help-block">Tags:';for(var i=0;i<10&&i<e.length;i++)a+=0==i?e[i].name:", "+e[i].name;10<e.length&&(a+=", ... "),a+="    </span>"}if(a+="  </label></div>",a+=" </div>",a+='<div class="form-group">',a+='  <div class="radio col-sm-12 ">',a+='    <label><input id="osmShapeType" name="osmShapeType" value="MultiLineString"  type="radio"> Lines ('+t.MultiLineString.count+")",(e=t.MultiLineString.tags).length){a+='    <span style="max-width: 100%;text-overflow: ellipsis;overflow: hidden;" class="help-block">Tags:';for(i=0;i<10&&i<e.length;i++)a+=0==i?e[i].name:", "+e[i].name;10<e.length&&(a+=", ... "),a+="    </span>"}if(a+="  </label></div>",a+=" </div>",a+='<div class="form-group">',a+='  <div class="radio col-sm-12 ">',a+='    <label><input id="osmShapeType" name="osmShapeType" value="MultiPolygon"  type="radio"> Polygons ('+t.MultiPolygon.count+")",(e=t.MultiPolygon.tags).length){a+='    <span style="max-width: 100%;text-overflow: ellipsis;overflow: hidden;" class="help-block">Tags:';for(i=0;i<10&&i<e.length;i++)a+=0==i?e[i].name:", "+e[i].name;10<e.length&&(a+=", ... "),a+="    </span>"}a+="  </label></div>",a+=" </div>",a+="</form>",a+="  </div>";var o=$(a).appendTo(this.mainPanel),r=$(o.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){var t=o.find("input[name='osmShapeType']:checked").val();e.data.shapeType=t,e.data.info=n.obj}),this.changesApplied=!1},DlgOSMTagSelection.prototype=Object.create(DlgTaskBase.prototype),DlgOSMTagSelection.prototype.createUI=function(){var n=this,a=this.obj,e='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';e+="   <p>Select tags to be used as layer attribute fields:</p>",e+='              <div class="row">',e+='                  <div class="dual-list list-left col-md-5">',e+='                  <h4 class="text-left text-info">Available tags</h4>',e+='                      <div class="well text-left" style="padding: 4px;">',e+='                          <div class="row">',e+='                              <div class="col-md-2">',e+='                                  <div class="btn-group">',e+='                                      <a class="btn btn-default selector" title="select all"><i class="glyphicon glyphicon-unchecked"></i></a>',e+="                                  </div>",e+="                              </div>",e+='                              <div class="col-md-10">',e+='                                  <div class="input-group" style="display:none">',e+='                                      <input type="text" name="SearchDualList" class="form-control" placeholder="search" />',e+='                                      <span class="input-group-addon glyphicon glyphicon-search"></span>',e+="                                  </div>",e+="                              </div>",e+="                          </div>",e+='                          <ul id="listTags"  class="list-group">';for(var t=0;t<a.length;t++){var i=a[t];5<t&&i.name&&i.count&&(e+='                          <li class="list-group-item" data-name="'+i.name+'" data-action="add" >'+i.name+" ("+i.count+")</li>")}e+="                          </ul>",e+="                      </div>",e+="                  </div>",e+='                  <div class="list-arrows col-md-1 text-center">',e+='                      <button type="button" class="btn btn-default btn-sm move-right">',e+='                          <span class="glyphicon glyphicon-chevron-right"></span>',e+="                      </button>",e+='                      <button type="button" class="btn btn-default btn-sm move-left">',e+='                          <span class="glyphicon glyphicon-chevron-left"></span>',e+="                      </button>",e+="                  </div>",e+='                  <div class="dual-list list-right col-md-5">',e+='                  <h4 class="text-success">Selected tags (Fields)</h4>',e+='                      <div class="well" style="padding: 4px;">',e+='                          <div class="row">',e+='                              <div class="col-md-2">',e+='                                  <div class="btn-group">',e+='                                      <a class="btn btn-default selector" title="select all"><i class="glyphicon glyphicon-unchecked"></i></a>',e+="                                  </div>",e+="                              </div>",e+='                              <div class="col-md-10">',e+='                                  <div class="input-group"  style="display:none">',e+='                                      <input type="text" name="SearchDualList" class="form-control" placeholder="search" />',e+='                                      <span class="input-group-addon glyphicon glyphicon-search"></span>',e+="                                  </div>",e+="                              </div>",e+="                          </div>",e+='                          <ul id="listSelectedTags" class="list-group">';for(t=0;t<a.length;t++){i=a[t];t<=5&&i.name&&i.count&&(e+='                          <li class="list-group-item" data-name="'+i.name+'" data-action="add" >'+i.name+" ("+i.count+")</li>")}e+="                          </ul>",e+="                      </div>",e+="                  </div>",e+="            </div>",e+="</form>",e+="  </div>";var o=$(e).appendTo(this.mainPanel);o.on("click",".list-group .list-group-item",function(){$(this).toggleClass("active")}),o.find(".list-arrows button").click(function(){var e=$(this),t="";e.hasClass("move-left")?((t=$(".list-right ul li.active")).clone().appendTo(".list-left ul"),t.remove()):e.hasClass("move-right")&&((t=$(".list-left ul li.active")).clone().appendTo(".list-right ul"),t.remove())}),o.find(".dual-list .selector").click(function(){var e=$(this);e.hasClass("selected")?(e.removeClass("selected").closest(".well").find("ul li.active").removeClass("active"),e.children("i").removeClass("glyphicon-check").addClass("glyphicon-unchecked")):(e.addClass("selected").closest(".well").find("ul li:not(.active)").addClass("active"),e.children("i").removeClass("glyphicon-unchecked").addClass("glyphicon-check"))}),o.find('[name="SearchDualList"]').keyup(function(e){var t=e.keyCode||e.which;if("9"!=t){"27"==t&&$(this).val(null);var a=$(this).closest(".dual-list").find(".list-group li"),i=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();a.show().filter(function(){return!~$(this).text().replace(/\s+/g," ").toLowerCase().indexOf(i)}).hide()}});var r=$(o.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.tags=a;var t=[];r.find("#listSelectedTags li").each(function(){var e=$(this);"add"===e.data("action")&&t.push(e.data("name"))}),e.data.selectedTags=t}),this.changesApplied=!1},DlgAddGeoJSON.prototype=Object.create(DlgTaskBase.prototype),DlgAddGeoJSON.prototype.createUI=function(){var n=this,e="",t="";this.options.initData&&(e=this.options.initData.layerName||"",t=this.options.initData.geojson||"");var a='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';a+='  <div class="form-group">',a+='    <label class="" for="layerName">Layer name</label>',a+='    <input type="text" name="layerName" id="layerName" value="'+e+'" autofocus placeholder="Layer name" class="form-control" data-val="true" data-val-required="Layer name is required"  />',a+='    <span class="field-validation-valid" data-valmsg-for="layerName" data-valmsg-replace="true"></span>',a+="  </div>",a+='  <div class="form-group">',a+='    <label class="" for="geojson">GeoJSON text:</label>',a+='    <textarea type="text" name="geojson" rows="10" id="geojson"  placeholder="" class="form-control" data-val="true" data-val-required="GeoJSON text is required">'+t+"</textarea>",a+='    <span class="field-validation-valid" data-valmsg-for="geojson" data-valmsg-replace="true"></span>',a+="  </div>",a+="</form>",a+="  </div>";var i=$(a).appendTo(this.mainPanel),r=$(i.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.layerName=i.find("#layerName").val(),e.data.geojson=i.find("#geojson").val()}),this.changesApplied=!1},DlgWCS.prototype=Object.create(DlgTaskBase.prototype),DlgWCS.prototype.createUI=function(){var n=this,e='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';e+='  <div class="form-group">',e+='    <label class="" for="url">WCS url:</label>',e+='    <input type="text" name="url" id="url" value="https://download.data.grandlyon.com/wcs/rdata" placeholder="WCS  address" autocomplete="on" class="form-control" data-val="true" data-val-required="Service url is required" />',e+='    <span class="field-validation-valid" data-valmsg-for="url" data-valmsg-replace="true"></span>',e+="  </div>",e+='<div class="form-group">',e+='  <label class="col-sm-3" for="version">Version:</label>',e+='    <select class="form-control " id="version" >',e+='                          <option value="2.0.1" selected="selected">2.0.1</option>',e+='                          <option value="1.1.1" >1.1.1</option>',e+="    </select>",e+=" </div>",e+='<div class="form-group">',e+='<button type="button" class="btn btn-primary" id="GetCapabilities" ><i class="fa fa-download"></i> Get Capabilities</button>',e+="</div>",e+='    <div id="capabilities_Content" class="panel-body">',e+="    </div>",e+="</form>",e+="  </div>";var r=$(e).appendTo(this.mainPanel);(n.content=r).find("#GetCapabilities").click(function(){var e=$(r.find("#"+n.id+"_form"));e.on("submit",function(e){e.preventDefault()});var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(e),$.validator.setDefaults({ignore:t}),e.validate(),e.valid())n.GetCapabilities();else{var a=e.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=e.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.beforeApplyHandlers.push(function(e){}),this.applyHandlers.push(function(e){}),this.changesApplied=!1},DlgWCS.prototype.GetCapabilities=function(){var i=this,a=i.content.find("#url").val(),o=i.content.find("#version").val()||"2.0.1";i.content.find("#capabilities_Content").html('<div class="wait-icon alert alert-info">Loading service\'s capabilities ...</div>');var e="/proxy/?url="+encodeURIComponent(a+"?SERVICE=WCS&REQUEST=GetCapabilities&VERSION="+o);$.ajax(e,{type:"GET",dataType:"xml",success:function(e){var t;if(e){e.documentElement&&("2.0.1"===o?t=i.GetCapabilities_process_2_0_1(a,e):"1.1.1"===o&&(t=i.GetCapabilities_process_1_1_1(a,e)))}t?i.displayCapabilities(t):i.content.find("#capabilities_Content").html('<div class="alert alert-danger">Loading failed. Check url address and try again.</div>')},error:function(e,t,a){i.content.find("#capabilities_Content").html('<div class="alert alert-danger">Loading failed. Check url address and try again.</div>')}})},DlgWCS.prototype.GetCapabilities_process_1_1_1=function(e,t){var a={wcsUrl:e,version:"1.1.1",coverageSummaries:[]};t.documentElement.prefix;try{a.Title=$("ows\\:ServiceIdentification",t).find("ows\\:Title").first().text()}catch(e){}try{a.Abstract=$("ows\\:ServiceIdentification",t).find("ows\\:Abstract").first().text()}catch(e){}try{a.ProviderName=$("ows\\:ServiceProvider",t).find("ows\\:ProviderName").first().text()}catch(e){}var i=$("Contents",t).find("CoverageSummary");if(0<i.length)for(var o=0;o<i.length;o++){$(i[o]).text();var n=$(i[o]).find("Identifier").text(),r=$(i[o]).find("ows\\:Title").text(),s=$(i[o]).find("ows\\:WGS84BoundingBox"),l=void 0;if(s.length){var c,d,p,u,h=s.first().find("ows\\:LowerCorner"),f=s.first().find("ows\\:UpperCorner");try{if(h.length){var m=h.text();m=m.split(" "),u=parseFloat(m[0]),d=parseFloat(m[1])}if(f.length){var g=f.text();g=g.split(" "),p=parseFloat(g[0]),c=parseFloat(g[1])}void 0!==c&&void 0!==u&&void 0!==p&&void 0!==d&&(l={north:c,west:u,east:p,south:d})}catch(e){}}var y=$(i[o]).find("SupportedFormat").text();n&&a.coverageSummaries.push({coverageId:n,coverageTitle:r,wGS84BoundingBox:l,supportedFormat:y})}return a},DlgWCS.prototype.GetCapabilities_process_2_0_1=function(e,t){var a={wcsUrl:e,version:"2.0.1",coverageSummaries:[]},i="";(i=t.documentElement.prefix)||(i="");try{a.Title=$("ows\\:ServiceIdentification",t).find("ows\\:Title").first().text()}catch(e){}try{a.Abstract=$("ows\\:ServiceIdentification",t).find("ows\\:Abstract").first().text()}catch(e){}try{a.ProviderName=$("ows\\:ServiceProvider",t).find("ows\\:ProviderName").first().text()}catch(e){}var o=$(i+"\\:Contents",t).find(i+"\\:CoverageSummary");if(0<o.length)for(var n=0;n<o.length;n++){$(o[n]).text();var r=$(o[n]).find(i+"\\:CoverageId").text(),s=$(o[n]).find(i+"\\:CoverageSubtype").text(),l=$(o[n]).find("ows\\:WGS84BoundingBox"),c=void 0;if(l.length){var d,p,u,h,f=l.first().find("ows\\:LowerCorner"),m=l.first().find("ows\\:UpperCorner");try{if(f.length){var g=f.text();g=g.split(" "),h=parseFloat(g[0]),p=parseFloat(g[1])}if(m.length){var y=m.text();y=y.split(" "),u=parseFloat(y[0]),d=parseFloat(y[1])}void 0!==d&&void 0!==h&&void 0!==u&&void 0!==p&&(c={north:d,west:h,east:u,south:p})}catch(e){}}r&&s&&a.coverageSummaries.push({coverageId:r,coverageSubtype:s,wGS84BoundingBox:c})}return a},DlgWCS.prototype.DescribeCoverage_process_2_0_1=function(e,t,a,i){a.html("");var o={wcsUrl:e,version:"2.0.1",coverageId:t},n="";(n=i.documentElement.prefix)||(n="");var r=$(n+"\\:CoverageDescription",i).find(n+"\\:ServiceParameters");o.CoverageSubtype=r.find(n+"\\:CoverageSubtype").text(),o.nativeFormat=r.find(n+"\\:nativeFormat").first().text();var s,l=$(n+"\\:CoverageDescription",i).find("gml\\:boundedBy gml\\:Envelope");for(s=0;s<l.length;s++){var c,d,p,u,h=void 0,f=l[s],m=f.attr("srsName"),g=f.find("gml\\:lowerCorner"),y=f.find("gml\\:upperCorner");try{var v,b;if(g.length)v=(v=g.text()).split(" "),u=parseFloat(v[0]),d=parseFloat(v[1]);if(y.length)b=(b=y.text()).split(" "),p=parseFloat(b[0]),c=parseFloat(b[1]);void 0!==c&&void 0!==u&&void 0!==p&&void 0!==d&&(h={north:c,west:u,east:p,south:d})}catch(e){}h&&(h.srsName=m)}return o},DlgWCS.prototype.displayCapabilities=function(o){var n=this,e=n.content.find("#capabilities_Content");if(e.html(""),o){var t="";o.Title&&(t+='<div class="form-group row">',t+='  <label class="col-sm-3">Title:</label>',t+='  <label class="col-sm-9">'+o.Title+"</label>",t+=" </div>"),o.Abstract&&(t+='<div class="form-group row">',t+='  <label class="col-sm-3">Abstract:</label>',t+='  <label class="col-sm-9">'+o.Abstract+"</label>",t+=" </div>"),t+='<div class="panel">',t+='  <div class="panel-body">',t+='    <div class="form-horizontal">',t+="      <legend>Coverages:</legend>";for(var a=0;a<o.coverageSummaries.length;a++){var i=o.coverageSummaries[a];if(i.coverageId){if(t+='<div id="'+i.coverageId+'" data-version="'+o.version+'" class="form-group">',t+='<div class="form-group row">',t+='  <label class="col-sm-3">ID:</label>',t+='  <label class="col-sm-9">'+i.coverageId+"</label>",t+=" </div>",i.coverageTitle&&(t+='<div class="form-group row">',t+='  <label class="col-sm-3">Title:</label>',t+='  <label class="col-sm-9">'+i.coverageTitle+"</label>",t+=" </div>"),i.coverageSubtype&&(t+='<div class="form-group row">',t+='  <label class="col-sm-3">Subtype:</label>',t+='  <label class="col-sm-9">'+i.coverageSubtype+"</label>",t+=" </div>"),i.wGS84BoundingBox&&i.supportedFormat&&"image/tiff"===i.supportedFormat){i.wGS84BoundingBox.west,i.wGS84BoundingBox.south,i.wGS84BoundingBox.east,i.wGS84BoundingBox.north;",urn:ogc:def:crs:EPSG::4326";var r="x,http://www.opengis.net/def/crs/EPSG/0/4326("+i.wGS84BoundingBox.west+","+i.wGS84BoundingBox.east+")",s="y,http://www.opengis.net/def/crs/EPSG/0/4326("+i.wGS84BoundingBox.south+","+i.wGS84BoundingBox.north+")",l=this.mapContainer.getCurrentGeoExtent();l.minx,l.miny,l.maxx,l.maxy;",urn:ogc:def:crs:EPSG::4326";var c="x,http://www.opengis.net/def/crs/EPSG/0/4326("+l.minx+","+l.maxx+")",d="y,http://www.opengis.net/def/crs/EPSG/0/4326("+l.miny+","+l.maxy+")";o.version;"2.0.1";var p=o.wcsUrl+"?SERVICE=WCS&VERSION=2.0.1&REQUEST=GetCoverage",u=p+="&FORMAT="+i.supportedFormat;u=p+="&COVERAGEID="+i.coverageId,p+="&SUBSET="+r,u+="&SUBSET="+c,p+="&SUBSET="+s,u+="&SUBSET="+d;var h=this.mapContainer.map.getSize();t+=' <a href="'+p+'" target="_blank" >Download</a>',t+=' <a href="'+(u+="&SCALESIZE=x("+h[0]+"),y("+h[1]+")")+'" target="_blank" >Download (current map view)</a>'}else t+='<div  class="form-group row">',t+=' <button type="button" class="DescribeCoverage " style="margin-left:15px" data-version="'+o.version+'" data-cid="'+i.coverageId+'" >Details</button>',t+="</div>",t+='<div id="descripe_Content" style="display:none" class="form-group row">',t+="</div>";t+=" </div>"}t+="<hr />"}t+="    </div>",t+="  </div>",t+=" </div>",e.html(t),e.find(".DescribeCoverage").click(function(){var e=o.wcsUrl,t=$(this).data("cid"),a=$(this).data("version"),i=$(this).parent().parent().find("#descripe_Content");n.DescribeCoverage(e,a,t,i)})}},DlgWCS.prototype.DescribeCoverage=function(a,i,o,n){var r=this;n.html('<div class="wait-icon alert alert-info">Loading details ...</div>'),n.show();var e="/proxy/?url=";e+="1.1.1"===i?encodeURIComponent(a+"?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION="+i+"&COVERAGE="+o):encodeURIComponent(a+"?SERVICE=WCS&REQUEST=DescribeCoverage&VERSION="+i+"&COVERAGEID="+o),$.ajax(e,{type:"GET",dataType:"xml",success:function(e){var t;if(e){e.documentElement&&"2.0.1"===i&&(t=r.DescribeCoverage_process_2_0_1(a,o,n,e))}t||n.html('<div class="alert alert-danger">Loading failed.</div>')},error:function(e,t,a){n.html('<div class="alert alert-danger">Loading failed. </div>')}})},IdentifyTask.prototype.getName=function(){return this._name},IdentifyTask.prototype.init=function(e){this._initialized=!0;var i=this,t=this.mapContainer.map;t.getView(),this.mapContainer;i.featureLayers={},i.selectInteraction=new ol.interaction.Select({hitTolerance:5,multi:!0,condition:ol.events.condition.singleClick,filter:function(e,t){if(!t)return!1;if(t.get("custom")&&("measure"==t.get("custom").type||"temp"==t.get("custom").type||t.get("custom").hiddenInToc))return!1;var a=e.getId();return!a&&e.get("_cacheInfo")&&(a=e.get("_cacheInfo").uid),i.featureLayers[a+"-"+e.ol_uid]=t,!0}}),i.selectInteraction.on("select",function(e){this._noselect||this.show(e.mapBrowserEvent.coordinate,i.selectInteraction.getFeatures().getArray())}.bind(this)),this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1});var a=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="identify_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Identify features",onToggle:function(e){if(i.featureLayers={},i.selectInteraction.setActive(!1),i.selectInteraction.getFeatures().clear(),!e)return i.mapContainer.setCurrentTool(null),void i.mapContainer.popup.hide();i.mapContainer.setCurrentTool({name:"identify_task_tool",cursor:function(e,t){if(!i._activated)return"";return'url("/css/images/identify_24_cursor.png")1 1,auto'},onActivate:function(e){t.removeInteraction(i.selectInteraction),t.addInteraction(i.selectInteraction),i.selectInteraction.setActive(!0),a.setActive(!0)},onDeactivate:function(e){i.selectInteraction.getFeatures().clear(),i.selectInteraction.setActive(!1),a.setActive(!1),i.mapContainer.popup.hide()}})}});this.mainCtrl=a,this.mapContainer.topToolbar.addControl(this.mainCtrl)},IdentifyTask.prototype.OnActivated=function(e){if(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl),this.mainCtrl){var t=this.mapContainer.getCurrentTool();t&&"identify_task_tool"===t.name&&(this.mainCtrl.setActive(!0),this.mainCtrl.raiseOnToggle())}},IdentifyTask.prototype.OnDeActivated=function(e){if(this._activated){this.mapContainer.map;this.mapContainer.setCurrentEditAction(void 0),this.selectInteraction&&(this.selectInteraction.getFeatures().clear(),this.selectInteraction.setActive(!1)),this.mainCtrl&&this.mainCtrl.setActive(!1),this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1,this.featureLayers={}}},IdentifyTask.prototype._getHtml=function(a){var e,i=this.mapContainer.map,t=this.mapContainer.popup;if((e={feature:a})&&e.feature){var o=e.feature.getId();!o&&e.feature.get("_cacheInfo")&&(o=e.feature.get("_cacheInfo").uid),e.layer=this.featureLayers[o+"-"+a.ol_uid];var n={},r=null,s=!1;if(e.layer&&(r=LayerHelper.getFields(e.layer))){n={};for(var l=0;l<r.length;l++){var c=(y=r[l]).name,d=y.alias||c;if(n[c]=d,y.domain&&"codedValues"==y.domain.type&&y.domain.items){for(var p={},u=0;u<y.domain.items.length;u++)p[y.domain.items[u].code]=y.domain.items[u].value;y.codedValues=p}}}a=e.feature;var h=e.layer,f='<div class="panel panel-info">',m=null;f+='<div class="panel-heading">',h&&h.get("title")&&(f+=h.get("title")),f+="</div>",f+='<div class="panel-body">',f+='<table class="table table-striped table-condensed">',f+="</thead>",f+="<tbody>";var g=a.getProperties();a.getGeometry();if(r){s=!0;for(l=0;l<r.length;l++){c=(y=r[l]).name;var y,v=y.type,b=(d=y.alias||c,!0);void 0!==y.visible&&(b=y.visible),void 0!==y.hidden&&(b=!y.hidden),"nill"===y.type&&(b=!1);var _=g[c];if(y.codedValues)if(void 0!==y.codedValues[_])_=y.codedValues[_];else if(-1<(_+"").indexOf(";")){var w=(_+"").split(";"),k=[];for(u=0;u<w.length;u++)void 0!==y.codedValues[w[u]]?k.push(y.codedValues[w[u]]):k.push(w[u]);_=k.join(";")}if(b){if(f+="<tr>",f+="<td>",f+=n[P=c]||d,f+="</td>",f+="<td>","_documentslink"==v){var S=[];if(_)try{S=_.split(",")}catch(e){}f+='  <div style="margin-bottom:0;" class="form-group docListPanel" >';for(u=0;S&&u<S.length;u++){var T=S[u];f+='<div style="margin-bottom: 5px;"  class="form-group row">',f+='<div class="col-sm-11 document_item_" data-doc-id="'+T+'" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"">',f+='    <a  target="_blank" data-doc-id="'+T+'" href="/document/'+T+'">'+T+"</a>",f+="</div>",f+="</div>"}f+="  </div>"}else if("_filelink"==v){var C=[];try{C=JSON.parse(_)}catch(e){}var x="";x+='  <div style="margin-bottom:0;" class="form-group docListPanel" >';for(var D=0;C&&D<C.length;D++){var L=C[D];"delete"!=L.action&&(x+='<div style="margin-bottom: 5px;"  class="form-group row">',L.id&&L.dataset?app.get_attachment_url?(x+='    <a  target="_blank" data-file-id="'+L.id+'" href="'+app.get_attachment_url(L.dataset,L.id,!1)+'">'+L.name,L.thumbnail&&(x+='<br/><img style="display: block;max-width: 100%;" src="'+app.get_attachment_url(L.dataset,L.id,!0)+'" />'),x+="</a>","audio/mp3"==L.mimeType||"audio/mp4"==L.mimeType||"audio/m4a"==L.mimeType||"audio/x-m4a"==L.mimeType||"audio/mpeg"==L.mimeType?(x+=' <audio controls style="display:block;width:200px" >',x+='    <source src="'+app.get_attachment_url(L.dataset,L.id)+'" type="'+L.mimeType+'">',x+="           Player not supported.",x+=" </audio>"):"video/mp4"!=L.mimeType&&"video/mpeg"!=L.mimeType||(x+=' <video controls style="display:block;    width: 100%; max-width: 300px;" >',x+='    <source src="'+app.get_attachment_url(L.dataset,L.id)+'" type="'+L.mimeType+'">',x+="           Player not supported.",x+=" </video>")):(x+='    <a  target="_blank" data-file-id="'+L.id+'" href="/dataset/'+L.dataset+"/attachment/"+L.id+'">'+L.name,x+="</a>"):(x+="    <span>"+L.name+"</span>",L.thumbnail_dataUrl?x+='<img style="display: block;max-width: 100%;" src="'+L.thumbnail_dataUrl+'" />':L.dataUrl&&L.mimeType&&-1<L.mimeType.indexOf("image/")&&(x+='<img style="display: block;max-width: 100%;" src="'+L.dataUrl+'" />'),L.dataUrl&&("audio/mp3"==L.mimeType||"audio/mp4"==L.mimeType||"audio/m4a"==L.mimeType||"audio/x-m4a"==L.mimeType||"audio/mpeg"==L.mimeType?(x+=' <audio controls style="display:block;width:200px" >',x+='    <source src="'+L.dataUrl+'" type="'+L.mimeType+'">',x+="           Player not supported.",x+=" </audio>"):"video/mp4"!=L.mimeType&&"video/mpeg"!=L.mimeType||(x+=' <video controls style="display:block;    width: 100%; max-width: 300px;" >',x+='    <source src="'+L.dataUrl+'" type="'+L.mimeType+'">',x+="           Player not supported.",x+=" </video>"))),x+="  </div>")}f+=x+="  </div>"}else f+=_;f+="</td>",f+="</tr>"}}}else for(var P in g)"geometry"!==P&&(s=!0,f+="<tr>",f+="<td>",f+=n[P]||P,f+="</td>",f+="<td>",f+=g[P],f+="</td>",f+="</tr>");if(f+="</tbody>",f+="</table>",f+="</div>",f+='<div class="panel-footer"><nav class="navbar"> </nav></div>',f+="</div>",f=DOMPurify.sanitize(f,{SAFE_FOR_JQUERY:!0}),s){if(m=$(f),footer=m.find(".panel-footer .navbar"),this.updateDocumenListContent(m),1<this._features.length){var O=$('<div class="ol-count"></div>');$('<div class="ol-prev"></div>').on("touchstart click",function(e){this._count--,this._count<1&&(this._count=this._features.length),f=this._getHtml(this._features[this._count-1]),setTimeout(function(){t.show(this._position,f)}.bind(this),350)}.bind(this)).appendTo(O),O.append(this._count+"/"+this._features.length),$('<div class="ol-next"></div>').on("touchstart click",function(e){this._count++,this._count>this._features.length&&(this._count=1),f=this._getHtml(this._features[this._count-1]),setTimeout(function(){t.show(this._position,f)}.bind(this),350)}.bind(this)).appendTo(O),O.appendTo(footer)}$('<button type="button" class="ol-zoombt"><i class="fa fa-search-plus"></i></button>').on("touchstart click",function(e){if("Point"===a.getGeometry().getType())i.getView().animate({center:a.getGeometry().getFirstCoordinate(),zoom:Math.max(i.getView().getZoom(),18)});else{var t=a.getGeometry().getExtent();i.getView().fit(t,{duration:1e3})}}.bind(this)).appendTo(footer)}}if(this.selectInteraction){this._noselect=!0;try{this.selectInteraction.getFeatures().clear()}catch(e){}try{this.selectInteraction.getFeatures().push(a)}catch(e){}this._noselect=!1}return m},IdentifyTask.prototype.updateDocumenListContent=function(e){e.find(".document_item_").each(function(e){var a=$(this),i=a.data("doc-id");$.ajax({url:"/document/"+i+"/info",dataType:"json",success:function(e){if(e&&e.id){var t='    <a  target="_blank" data-doc-id="'+i+'" href="/document/'+i+'">';e.thumbnail?t+='<img style=" " src="'+e.thumbnail+'" />':e.icon&&(t+='     <i style="" class="avatar fa fa-file-o fa-file-'+e.icon+'-o" > </i>'),t+=e.name+"</a>",a.html(t)}else a.parent().remove()}})})},IdentifyTask.prototype.show=function(e,t){var a=this.mapContainer.map,i=this.mapContainer.popup;if((e instanceof ol.Feature||e instanceof Array&&e[0]instanceof ol.Feature)&&(t=e,e=null),this._position=e,this._count=1,t instanceof Array||(t=[t]),this._features=t.slice(),t&&t.length){var o=this._getHtml(t[0]);o?(e&&"Point"!==t[0].getGeometry().getType()||(e=t[0].getGeometry().getFirstCoordinate()),i.show(e,o),i.getElement().parentNode.style.zIndex=500+a.getOverlays().getLength()):i.hide()}else i.hide()},wmsLayerTask.prototype.getName=function(){return this._name},wmsLayerTask.prototype.init=function(e){this._initialized=!0;var a=this,r=this.mapContainer.map,s=r.getView(),t=s.getProjection().getCode();t&&t.indexOf(":")&&(t=t.split(":")[1]);var l=this.mapContainer,i=this.layer,c=i.getSource(),d=i.get("custom");if(c){c.get("details");a.interactionPointer=new ol.interaction.Pointer({handleDownEvent:function(e){var i=l.popup,o=e.coordinate;i.hide();var t="text/plain";d.supportsGetFeatureInfo_html&&(t="text/html");var a=s.getResolution(),n=c.getFeatureInfoUrl(e.coordinate,a,"EPSG:3857",{INFO_FORMAT:t});$.ajax(n,{type:"GET",success:function(e,t){if(e){e.documentElement&&(e=e.documentElement.innerHTML);try{var a='<div class="identifyTask-results" style="overflow:auto;padding-bottom: 0.5em;">';a+=e,a+="</div>",i.show(o,$(a)),i.getElement().parentNode.style.zIndex=500+r.getOverlays().getLength()}catch(e){}}},error:function(e,t,a){$.notify({message:a+"."},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(e){})}}),this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1});var o=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="identify_raster_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"GetFeatureInfo",onToggle:function(e){a.interactionPointer.setActive(!1),e?a.mapContainer.setCurrentTool({name:"getWmsFeatureInfo_tool",cursor:function(e,t){if(!a._activated)return"";return'url("/css/images/identify_raster_24_cursor.png")1 1,auto'},onActivate:function(e){r.removeInteraction(a.interactionPointer),r.addInteraction(a.interactionPointer),a.interactionPointer.setActive(!0),o.setActive(!0)},onDeactivate:function(e){a.interactionPointer.setActive(!1),o.setActive(!1),a.mapContainer.popup.hide()}}):a.mapContainer.setCurrentTool(null)}});this.mainCtrl=o,this.mapContainer.leftToolbar.addControl(this.mainCtrl)}},wmsLayerTask.prototype.OnActivated=function(e){if(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl),this.mainCtrl){var t=this.mapContainer.getCurrentTool();t&&"getWmsFeatureInfo_tool"===t.name&&(this.mainCtrl.setActive(!0),this.mainCtrl.raiseOnToggle())}},wmsLayerTask.prototype.OnDeActivated=function(e){if(this._activated){this.mapContainer.map;this.mapContainer.setCurrentEditAction(void 0),this.interactionPointer&&this.interactionPointer.setActive(!1),this.mainCtrl&&this.mainCtrl.setActive(!1),this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1}},RasterLayerValueTask.prototype.getName=function(){return this._name},RasterLayerValueTask.prototype.init=function(e){this._initialized=!0;var a=this,l=this.mapContainer.map,i=l.getView().getProjection().getCode();i&&i.indexOf(":")&&(i=i.split(":")[1]);var o=this.mapContainer,c=this.layer,t=c.getSource(),n=c.get("custom");n.dataObj&&n.dataObj.details.numberOfBands;if(t){var r=t.get("details"),d={};if(r){if(r.oidField,r.vatInfo&&r.vatInfo.rows){for(var s={},p=0;p<r.vatInfo.rows.length;p++)s[r.vatInfo.rows[p].value]=r.vatInfo.rows[p];d.default=s}for(var u=0;r.bands&&u<r.bands.length;u++){var h=r.bands[u];if(h&&h.vatInfo&&h.vatInfo.rows){for(s={},p=0;p<h.vatInfo.rows.length;p++)s[h.vatInfo.rows[p].value]=h.vatInfo.rows[p];d[(h.name+"").toLowerCase()]=s}}}a.interactionPointer=new ol.interaction.Pointer({handleDownEvent:function(e){var r=o.popup,s=e.coordinate;r.hide();var t="/datalayer/"+n.dataObj.id+"/raster?request=value&srid="+i;t+="&x="+s[0],t+="&y="+s[1],$.ajax(t,{type:"GET",dataType:"json",success:function(e){if(e)try{var t="";for(var a in t+='<table class="table table-striped table-condensed">',t+="<thead>",c&&c.get("title")?t+='<tr><th colspan="2" style=" white-space: nowrap;overflow-x: hidden; max-width: 260px;text-overflow: ellipsis;">'+c.get("title")+"</th></tr>":t+="<tr><th>Field</th><th>Value</th></tr>",t+="</thead>",t+="<tbody>",e){t+="<tr>",t+="<td>",t+=a,t+="</td>",t+="<td>",t+=e[a],t+="</td>",t+="</tr>";var i=d[a.toLowerCase()]||d.default;if(i&&i[e[a]]){var o=i[e[a]];if(o)for(var n in o)"value"!==n&&(t+="<tr>",t+="<td>",t+=n,t+="</td>",t+="<td>",t+=o[n],t+="</td>",t+="</tr>")}}t+="</tbody>",t+="</table>",r.show(s,t),r.getElement().parentNode.style.zIndex=500+l.getOverlays().getLength()}catch(e){}},error:function(e,t,a){$.notify({message:a+"<br/> Make sure to click on selected raster layer area."},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(e){})}}),this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1});var f=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="identify_raster_24_Icon" >&nbsp;</span>',className:"myOlbutton24",title:"Get raster value",onToggle:function(e){a.interactionPointer.setActive(!1),e?a.mapContainer.setCurrentTool({name:"getRasterValue_tool",cursor:function(e,t){if(!a._activated)return"";return'url("/css/images/identify_raster_24_cursor.png")1 1,auto'},onActivate:function(e){l.removeInteraction(a.interactionPointer),l.addInteraction(a.interactionPointer),a.interactionPointer.setActive(!0),f.setActive(!0)},onDeactivate:function(e){a.interactionPointer.setActive(!1),f.setActive(!1),a.mapContainer.popup.hide()}}):a.mapContainer.setCurrentTool(null)}});this.mainCtrl=f,this.mapContainer.leftToolbar.addControl(this.mainCtrl)}},RasterLayerValueTask.prototype.OnActivated=function(e){if(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl),this.mainCtrl){var t=this.mapContainer.getCurrentTool();t&&"getRasterValue_tool"===t.name&&(this.mainCtrl.setActive(!0),this.mainCtrl.raiseOnToggle())}},RasterLayerValueTask.prototype.OnDeActivated=function(e){if(this._activated){this.mapContainer.map;this.mapContainer.setCurrentEditAction(void 0),this.interactionPointer&&this.interactionPointer.setActive(!1),this.mainCtrl&&this.mainCtrl.setActive(!1),this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1}},RasterLayerAnalysisTask.prototype.getName=function(){return this._name},RasterLayerAnalysisTask.prototype.init=function(e){if(app.identity.isAdministrator||app.identity.isDataAnalyst){this._initialized=!0;var o=this,l=this.mapContainer.map.getView().getProjection().getCode();l&&l.indexOf(":")&&(l=l.split(":")[1]);var c=this.mapContainer,t=this.layer,a=t.getSource(),d=t.get("custom");d.dataObj&&d.dataObj.details.numberOfBands;if(a){var i=a.get("details");i&&i.oidField,this._toolbar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mainCtrl=new ol.control.Toggle({html:'<i class="fa fa-tasks"></i>',className:"myOlbutton24",title:"Analysis toolbar",bar:this._toolbar,onToggle:function(e){if(e&&c._registeredToolbars)for(var t=0;t<c._registeredToolbars.length;t++){var a=c._registeredToolbars[t];a!==o.mainCtrl&&a.setActive&&a.setActive(!1)}}}),c._registeredToolbars||(c._registeredToolbars=[]),c._registeredToolbars.push(this.mainCtrl),this.mapContainer.leftToolbar.addControl(this.mainCtrl),this._slope=new ol.control.TextButton({html:"Slope",className:"myOlTextButton24",title:"Calculate slope of the raster layer",handleClick:function(){if("SingleBand_Dem"===LayerHelper.getDetails(o.layer).rasterType)new DlgSlope(c,o.layer,{title:"Slope",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({units:t.units})),i="/datalayer/"+d.dataObj.id+"/analysis?request=slope&srid="+l+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating raster slope...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show();else $.notify({message:'The selected layer is not a DEM.<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#DlgSlope">?</a>'},{type:"info",delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}),this._toolbar.addControl(this._slope),this._hillshade=new ol.control.TextButton({html:"Hillshade",className:"myOlTextButton24",title:"Generate hillshade from the raster layer",handleClick:function(){if("SingleBand_Dem"===LayerHelper.getDetails(o.layer).rasterType)new DlgHillshade(c,o.layer,{title:"Hillshade",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify({azimuth:t.azimuth,altitude:t.altitude})),i="/datalayer/"+d.dataObj.id+"/analysis?request=hillshade&srid="+l+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating raster hillshade...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show();else $.notify({message:'The selected layer is not a DEM.<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#DlgHillshade">?</a>'},{type:"info",delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}),this._toolbar.addControl(this._hillshade),this._clip=new ol.control.TextButton({html:"Clip",className:"myOlTextButton24",title:"Clip raster layer",handleClick:function(){LayerHelper.getDetails(o.layer),new DlgRasterClip(c,o.layer,{title:"Clip",onapply:function(e,t){var a=encodeURIComponent(JSON.stringify(t)),i="/datalayer/"+d.dataObj.id+"/analysis?request=clipRaster&srid="+l+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating raster slope...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}).show()}}),this._toolbar.addControl(this._clip),this._classify=new ol.control.TextButton({html:"Classify",className:"myOlTextButton24",title:"Classify raster data",handleClick:function(){new DlgRasterClassify(c,o.layer,{title:"Classify",onapply:function(e,t){if(t.band&&t.reclass){var a=encodeURIComponent(JSON.stringify(t)),i="/datalayer/"+d.dataObj.id+"/analysis?request=reclass&srid="+l+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Reclassifying raster ...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}},onapply_test:function(e,t){if(t.band&&t.reclass){var a=encodeURIComponent(JSON.stringify(t)),i="/datalayer/"+d.dataObj.id+"/analysis?request=rasterBandHistogram&srid="+l+"&settings="+a,o=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Reclassifying raster ...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),o.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),o.close()}}).done(function(e){o.close()})}}}).show()}}),this._toolbar.addControl(this._classify),this._floodArea=new ol.control.TextButton({html:"Flood area",className:"myOlTextButton24",title:"Point-based flood area",handleClick:function(){if("SingleBand_Dem"===LayerHelper.getDetails(o.layer).rasterType)new DlgRasterPointBasedFloodArea(c,o.layer,{title:"Point-based flood area",onapply:function(e,t){if(t.band&&t.reclass){var o;t.seedPointCoorinates&&(o="ST_Intersects(geom,ST_GeomFromText('POINT("+t.seedPointCoorinates[0]+" "+t.seedPointCoorinates[1]+")',"+t.mapProjectionCode+"))");var n=t.outputName,r=t.outputDescription,a=encodeURIComponent(JSON.stringify(t)),i="/datalayer/"+d.dataObj.id+"/analysis?request=reclass&srid="+l+"&settings="+a,s=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Calculating flood area ...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(i,{type:"GET",dataType:"json",success:function(e){if(e&&e.id){var t=encodeURIComponent(JSON.stringify({outputWhere:o,outputName:n,outputDescription:r,val_field_alias:"Water level elevation"})),a=e.id,i="/datalayer/"+e.id+"/analysis?request=rastertopolygon&srid="+l+"&settings="+t;$.ajax(i,{type:"GET",dataType:"json",success:function(e){if(e&&e.status&&e.id){$.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id);var t="/datalayer/"+a+"/delete?_method=DELETE";$.ajax(t,{type:"POST"}).done(function(e){console.log("temp raster's been deleted")})}else $.notify({message:e.errors+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});s.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),s.close()}}).done(function(e){s.close()})}},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),s.close()}}).done(function(e){})}}}).show();else $.notify({message:'The selected layer is not a DEM.<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#DlgRasterPointBasedFloodArea">?</a>'},{type:"info",delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}),this._toolbar.addControl(this._floodArea),this._rasterToPolygon=new ol.control.TextButton({html:"To Polygon",className:"myOlTextButton24",title:"Convert raster to polygon vector layer",handleClick:function(){var e="/datalayer/"+d.dataObj.id+"/analysis?request=banddistinctvaluecount",i=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Counting distinc values... <a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#rasterToPolygon">?</a>'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(e,{type:"GET",dataType:"json",success:function(e){var t=e.distinct_value_count;if(t&&(t=parseInt(t)),i.close(),2e3<t){var a="Too many distinct values ("+t+').<br/> Try to reclass reaster to fewer values. <a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#rasterToPolygon">?</a>';$.notify({message:a},{type:"danger",delay:5e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}else if(t<100)o.handle_rasterToPolygon();else{a="Too many distinct values ("+t+'). The process may take too much time. </br> Are you sure to continue? <a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#rasterToPolygon">?</a>';confirmDialog.show(a,function(e){e&&o.handle_rasterToPolygon()},{dialogSize:"m",alertType:"warning"})}},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),i.close()}}).done(function(e){i.close()})}}),this._toolbar.addControl(this._rasterToPolygon),this.handle_rasterToPolygon=function(){var e="/datalayer/"+d.dataObj.id+"/analysis?request=rastertopolygon&srid="+l,i=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Generating raster polygons...'},{type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax(e,{type:"GET",dataType:"json",success:function(e){e&&e.id&&($.notify({message:"New data layer is generated"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),c.addLayerById(e.id)),i.close()},error:function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),i.close()}}).done(function(e){i.close()})}}}},RasterLayerAnalysisTask.prototype.OnActivated=function(e){(app.identity.isAdministrator||app.identity.isDataAnalyst)&&(this._activated=!0,this._initialized||this.init(),this.mapContainer.map.addControl(this.mainCtrl))},RasterLayerAnalysisTask.prototype.OnDeActivated=function(e){this._activated&&(app.identity.isAdministrator||app.identity.isDataAnalyst)&&(this.mapContainer.map.removeControl(this.mainCtrl),this._activated=!1)},DlgSlope.prototype=Object.create(DlgTaskBase.prototype),DlgSlope.prototype.createUI=function(){var n=this,e=this.obj;e.get("custom"),LayerHelper.getDetails(e);n.selBand=n.options.selBand||1;var t='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';t+='  <div class="form-group">',t+='    <label class="" for="unites">Units:</label>',t+='    <select class="form-control "   name="units" id="units">',t+='      <option value="DEGREES" selected="selected">Degrees</option>',t+='      <option value="RADIANS" >Radians</option>',t+='      <option value="PERCENT" >Percent</option>',t+="    </select>",t+="  </div>",t+="</form>",t+="  </div>";var a=$(t).appendTo(this.mainPanel),r=$(a.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.units=a.find("#units").val()}),this.changesApplied=!1},DlgHillshade.prototype=Object.create(DlgTaskBase.prototype),DlgHillshade.prototype.createUI=function(){var n=this,e=this.obj;e.get("custom"),LayerHelper.getDetails(e);n.selBand=n.options.selBand||1;var t='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';t+='  <div class="form-group">',t+='    <label id="azimuthLabel" class="" for="azimuth">Azimuth:</label>',t+='    <input type="range" min="0" max="360" value="" name="azimuth" id="azimuth"  />',t+="  </div>",t+='  <div class="form-group">',t+='    <label id="altitudeLabel" class="" for="altitude">Altitude:</label>',t+='    <input type="range" min="0" max="90" value="" name="altitude" id="altitude"  />',t+="  </div>",t+="</form>",t+="  </div>";var a=$(t).appendTo(this.mainPanel);a.find("input[type=range]").on("input",function(){$(this).trigger("change"),$(this).attr("title",$(this).val())}),a.find("#azimuth").trigger("change"),a.find("#azimuth").change(function(){a.find("#azimuthLabel").text("Azimuth: "+$(this).val()+" Degrees")}),a.find("#azimuth").val(315),a.find("#azimuth").attr("title",315),a.find("#azimuth").trigger("change"),a.find("#altitude").change(function(){a.find("#altitudeLabel").text("Altitude: "+$(this).val()+" Degrees")}),a.find("#altitude").val(45),a.find("#altitude").attr("title",45),a.find("#altitude").trigger("change");var r=$(a.find("#"+n.id+"_form"));r.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(r),$.validator.setDefaults({ignore:t}),r.validate(),!r.valid()){e.cancel=!0;var a=r.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=r.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.azimuth=a.find("#azimuth").val(),e.data.altitude=a.find("#altitude").val()}),this.changesApplied=!1},DlgRasterClassify.prototype=Object.create(DlgTaskBase.prototype),DlgRasterClassify.prototype.createUI=function(){var h=this,e=this.obj,t=e.get("custom"),f=LayerHelper.getDetails(e);h.selBand=h.options.selBand||1;var a='<div class="scrollable-content" ><form id="'+h.id+'_form" class="modal-body form-horizontal">';a+='  <div class="form-group">',a+='    <label class="" for="">Raster data layer</label>',a+="    <div>"+t.dataObj.name+"</div>",a+=" </div>",a+='<div class="form-group">',a+='  <label class="col-sm-3" for="bands">Band:</label>',a+='    <select class="form-control " id="bands"  >';for(var i=0;i<f.bands.length;i++)i+1==h.selBand?a+='        <option value="'+(i+1)+'" selected="selected"  >'+(i+1)+" </option>":a+='        <option value="'+(i+1)+'"  >'+(i+1)+" </option>";a+="    </select>",a+="  </div>",a+='    <div id="childContent" class="panel-body">',a+="    </div>",a+="</form>",a+="  </div>";var m=$(a).appendTo(this.mainPanel);h.childContent=m.find("#childContent"),m.find("#bands").change(function(){h.selBand=$(this).val(),h.populateChildPanel()}),h.populateChildPanel();var n=$(m.find("#"+h.id+"_form"));n.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(n),$.validator.setDefaults({ignore:t}),n.validate(),!n.valid()){e.cancel=!0;var a=n.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=n.offset().top,h.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){var t=f.bands[h.selBand-1],a=t.reclass;a||(a={ranges:[],expression:"",noDataValue:t.noDataValue,dataType:t.dataType},t.reclass=a,"Byte"==t.dataType||"Int16"==t.dataType||"Int32"==t.dataType||"UInt16"==t.dataType||"UInt32"==t.dataType?a.dataType="Int32":a.dataType="Float32");var i=a.ranges;i||(i=[]),t.reclass.expression=m.find("#reclass").val(),a.dataType=m.find("#dataType").val(),e.data.band=t.id,e.data.reclass=a,i=[],m.find("#tblRanges > tbody  > tr").each(function(){i.push({from:$(this).find(".range-from").val(),to:$(this).find(".range-to").val(),newFrom:$(this).find(".range-newFrom").val(),newTo:$(this).find(".range-newTo").val()})});var o,n=[];if((a.ranges=i).length)for(var r=0;r<i.length;r++){var s=i[r],l=s.from,c=s.to;""==c&&(c=l);var d=s.newFrom,p=s.newTo,u="["+l+"-"+c+"):"+d+(""!==p?"-"+p:"");n.push(u)}o=n.join(","),t.reclass.expression=o}),this.changesApplied=!1},DlgRasterClassify.prototype.populateChildPanel=function(){var a=this,e=this.obj,t=(e.get("custom"),LayerHelper.getDetails(e).bands[a.selBand-1]),i=t.reclass;i||(i={ranges:[],expression:"",noDataValue:t.noDataValue,dataType:t.dataType},t.reclass=i,"Byte"==t.dataType||"Int16"==t.dataType||"Int32"==t.dataType||"UInt16"==t.dataType||"UInt32"==t.dataType?i.dataType="Int32":i.dataType="Float32");var o=i.ranges;o||(o=[],i.ranges=o);var n="";this.childContent.html(""),n+='<div class="row">',n+='  <label class="col-sm-3" >Data type:</label>',n+='  <label class="col-sm-3" >'+t.dataType+" </label>",n+='  <label class=" col-sm-3" >No-data value:</label>',n+='  <label class="col-sm-3" >'+t.noDataValue+" </label>",n+="</div>",n+='<div class="row">',n+='  <label class=" col-sm-3" >Min value:</label>',n+='  <label class="col-sm-3" >'+t.minimum+" </label>",n+='  <label class=" col-sm-3" >Max value:</label>',n+='  <label class="col-sm-3" >'+t.maximum+" </label>",n+="</div>",t.statistics&&(n+='<div class="row">',n+='  <label class=" col-sm-3" >Mean value:</label>',n+='  <label class="col-sm-3" >'+t.statistics.mean+" </label>",void 0!==t.statistics.std_dev?(n+='  <label class=" col-sm-3" >Std-dev:</label>',n+='  <label class="col-sm-3" >'+t.statistics.std_dev+" </label>"):void 0!==t.statistics.stddev&&(n+='  <label class=" col-sm-3" >Std-dev:</label>',n+='  <label class="col-sm-3" >'+t.statistics.stddev+" </label>"),n+="</div>");var r=0;if(n+="<hr />",n+='<div class="form-group">',n+=' <label class="col-sm-12">Class ranges:</label>',n+=' <table id="tblRanges" class=" table order-list col-sm-12">',n+="  <thead>",n+='  <tr><td colspan="2">Values:</td><td colspan="2">Convert to:</td></tr>',n+="  <tr><td>From</td><td>To</td> <td>From</td><td>To</td></tr>",n+="  </thead>",n+="  <tbody>",0==o.length){n+="  <tr>";var s="";s+='<td><input type="number" class="form-control range-from nospinner" value=""  name="from'+r+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="from'+r+'" data-valmsg-replace="true"></span></td>',s+='<td><input type="number" class="form-control range-to nospinner" value=""  name="to'+r+'"/></td>',s+='<td><input type="number" class="form-control range-newFrom nospinner" value=""  name="newFrom'+r+'"  data-val="true" data-val-required="New value is required" /><span class="field-validation-valid" data-valmsg-for="newFrom'+r+'" data-valmsg-replace="true"></span></td>',n+=s+='<td><input type="number" class="form-control range-newTo nospinner" value=""  name="newTo'+r+'"/></td>',n+="  </tr>",r++}else for(var l=0;l<o.length;l++){var c=o[l];n+="  <tr>";s="";s+='<td><input type="number" class="form-control range-from nospinner" value="'+c.from+'"  name="from'+r+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="from'+r+'" data-valmsg-replace="true"></span></td>',s+='<td><input type="number" class="form-control range-to nospinner" value="'+c.to+'"  name="to'+r+'"/></td>',s+='<td><input type="number" class="form-control range-newFrom nospinner" value="'+c.newFrom+'"  name="newFrom'+r+'"  data-val="true" data-val-required="New value is required" /><span class="field-validation-valid" data-valmsg-for="newFrom'+r+'" data-valmsg-replace="true"></span></td>',s+='<td><input type="number" class="form-control range-newTo nospinner" value="'+c.newTo+'"  name="newTo'+r+'"/></td>',0<l&&(s+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>'),n+=s,n+="  </tr>",r++}n+="  </tbody>",n+="  <tfoot>",n+="         <tr>",n+='   <td colspan="4" style="text-align: left;"><input type="button" class="btn btn-lg btn-block " id="addRange" value="Add Range" /></td>',n+="  </tr>",n+="  </tfoot>",n+="  </table>",n+="</div>",n+='<div class="form-group">',n+='  <label class="col-sm-4" for="dataType">Output data type:</label>',n+='    <select class="form-control " id="dataType"  >',"Int32"==i.dataType?n+='        <option value="Int32" selected="selected"  >Integer</option>':n+='        <option value="Int32"  >Integer</option>',"Float32"==i.dataType?n+='        <option value="Float32" selected="selected"  >Float</option>':n+='        <option value="Float32"  >Float</option>',n+="    </select>",n+="  </div>",this.childContent.html(n),this.childContent.find("#addRange").on("click",function(){var e=$("<tr>"),t="";t+='<td><input type="number" class="form-control range-from nospinner" name="from'+r+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="from'+r+'" data-valmsg-replace="true"></span></td>',t+='<td><input type="number" class="form-control range-to nospinner" name="to'+r+'"/></td>',t+='<td><input type="number" class="form-control range-newFrom nospinner" name="newFrom'+r+'"  data-val="true" data-val-required="New value is required" /><span class="field-validation-valid" data-valmsg-for="newFrom'+r+'" data-valmsg-replace="true"></span></td>',t+='<td><input type="number" class="form-control range-newTo nospinner" name="newTo'+r+'"/></td>',t+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',e.append(t),a.childContent.find("#tblRanges").append(e),r++}),this.childContent.find("#tblRanges").on("click",".ibtnDel",function(e){$(this).closest("tr").remove(),r-=1}),this.childContent.find("#tblRanges").on("wheel","input[type=number]",function(e){$(this).blur()})},DlgRasterClip.prototype=Object.create(DlgTaskBase.prototype),DlgRasterClip.prototype.createUI=function(){var r=this.mapContainer.map.getView().getProjection().getCode();r&&r.indexOf(":")&&(r=r.split(":")[1]);var c=this,e=this.obj,t=e.get("custom"),a=(LayerHelper.getDetails(e),'<div class="scrollable-content" ><form id="'+c.id+'_form" class="modal-body form-horizontal">');a+='  <div class="form-group">',a+='    <label class="" for="">Raster data layer</label>',a+="    <div>"+t.dataObj.name+"</div>",a+=" </div>",a+='    <div id="childContent" class="panel-body">',a+="    </div>",a+="</form>",a+="  </div>";var i=$(a).appendTo(this.mainPanel);c.childContent=i.find("#childContent"),c.populateChildPanel(),c.setActions();var d=$(i.find("#"+c.id+"_form"));d.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;$.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(d),$.validator.setDefaults({ignore:t}),d.validate();var a=[],i=!1;if(c.drawlayer)for(var o=c.drawlayer.getSource().getFeatures(),n=0;n<o.length;n++)a.push(o[n].getGeometry());if(0<a.length?i=!0:$.notify({message:"No clipping area is defined."},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),!d.valid()||!i){e.cancel=!0;var r=d.find(".input-validation-error").first();if(r){var s,l=r.offset().top;s=d.offset().top,c.mainPanel.find(".scrollable-content").animate({scrollTop:l-s},1e3)}}}),this.applyHandlers.push(function(e){var t=[];if(c.drawlayer)for(var a=c.drawlayer.getSource().getFeatures(),i=0;i<a.length;i++)t.push(a[i].getGeometry());if(0<t.length){var o,n;if(0<t.length)o=1<t.length?new ol.Feature({geometry:new ol.geom.GeometryCollection(t),name:"Clip area"}):new ol.Feature({geometry:t[0],name:"Clip area"}),n=new ol.format.GeoJSON({featureProjection:r,dataProjection:"EPSG:3857"}).writeFeatureObject(o);e.data.clipArea=n,e.data.clipAreaSrid=3857}}),this.changesApplied=!1},DlgRasterClip.prototype.populateChildPanel=function(){var e=this.obj,t=this.mapContainer.map.getView().getProjection().getCode();t&&t.indexOf(":")&&(t=t.split(":")[1]);e.get("custom"),LayerHelper.getDetails(e);this.childContent.html(""),this.childContent.html('<div class="form-group">  <div class="col-sm-12 ">    <label> Draw clipping area:</label>  </div> </div><div class="form-group">  <div class="col-sm-1 ">    <button  type="button"   title="Box" id="drawBox" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawRectangleIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>  </div>  <div class="col-sm-1 ">    <button  type="button"   title="Circle" id="drawCircle" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawCircleIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>  </div>  <div class="col-sm-1 ">    <button  type="button"   title="Polygon" id="drawPolygon" style="display:block;line-height:28px;width:28px;background-position:center center" class="drawPolygonIcon btn btn-primary btn-success btn-xs" >&nbsp;</button>  </div> </div>')},DlgRasterClip.prototype.setActions=function(){this.create_actions(this.childContent)},DlgRasterClip.prototype.create_actions=function(e){var t=this,a=this.obj;a.get("custom"),LayerHelper.getDetails(a);e.find("#drawBox").click(function(){t.drawShape("box")}),e.find("#drawCircle").click(function(){t.drawShape("circle")}),e.find("#drawPolygon").click(function(){t.drawShape("polygon")}),e.find("#clearShapes").click(function(){t.drawlayer&&t.drawlayer.getSource().clear()})},DlgRasterClip.prototype.moveLayerToTop=function(){var e=this.mapContainer.map;e.getLayers().remove(this.drawlayer),e.getLayers().push(this.drawlayer)},DlgRasterClip.prototype.closed=function(){this.mapContainer.map.getLayers().remove(this.drawlayer),this.onLayerAddEventKey&&ol.Observable.unByKey(this.onLayerAddEventKey)},DlgRasterClip.prototype.createDrawLayer=function(){var e=this.mapContainer.map,t=this;this.drawsource||(this.drawsource=new ol.source.Vector),this.drawlayer=new ol.layer.Vector({source:this.drawsource,custom:{type:"drawing",keepOnTop:!0,skipSaving:!0,hiddenInToc:!0}}),t.onLayerAddEventKey=e.getLayers().on("add",function(e){e.element!==t.drawlayer&&e.element.get("custom")&&(e.element.get("custom").keepOnTop||t.moveLayerToTop())})},DlgRasterClip.prototype.addShape=function(e){if(e){var t=this.mapContainer.map.getView().getProjection().getCode(),a=new ol.format.GeoJSON({featureProjection:t,dataProjection:"EPSG:3857"});this.drawlayer||this.createDrawLayer();var i=a.readFeatures(e,{featureProjection:t});this.drawlayer.getSource().addFeatures(i),this.drawlayer.changed(),this.moveLayerToTop()}},DlgRasterClip.prototype.drawShape=function(e){var t,a,i,o=this,n=this.mapContainer.map;o.drawlayer||o.createDrawLayer(),o.drawlayer.getSource().clear(),o.interaction=void 0,n.removeInteraction(o.interaction),a="Point",i=void 0,"line"==(t=e)?a="LineString":"polygon"==t?a="Polygon":"circle"==t?(a="Circle",i=ol.interaction.Draw.createRegularPolygon()):"box"==t&&(a="Circle",i=ol.interaction.Draw.createBox()),o.interaction=new ol.interaction.Draw({source:o.drawsource,type:a,geometryFunction:i}),n.addInteraction(o.interaction),o.interaction.on("drawend",function(e){n.removeInteraction(o.interaction),o.moveLayerToTop(),o.dlg.open(),o.setActions()}),o.dlg.getModal().modal("hide"),o.dlg.getModal().hide()},DlgRasterPointBasedFloodArea.prototype=Object.create(DlgTaskBase.prototype),DlgRasterPointBasedFloodArea.prototype.createUI=function(){var i=this.mapContainer.map.getView(),o=i.getProjection().getCode();o&&o.indexOf(":")&&(o=o.split(":")[1]);var n=this,e=this.obj,r=e.get("custom"),s=LayerHelper.getDetails(e);n.minimumValue=void 0,n.seedPointElevation=void 0;var t='<div class="scrollable-content" ><form id="'+n.id+'_form" class="modal-body form-horizontal">';t+='  <div class="form-group">',t+='    <label class="" for="">Raster data layer</label>',t+="    <div>"+r.dataObj.name+"</div>",t+=" </div>",t+='    <div id="childContent" class="panel-body">',t+="    </div>",t+="</form>",t+="  </div>";var a=$(t).appendTo(this.mainPanel);n.childContent=a.find("#childContent"),n.populateChildPanel();var l=$(a.find("#"+n.id+"_form"));l.on("submit",function(e){e.preventDefault()}),this.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(l),$.validator.setDefaults({ignore:t}),l.validate(),!l.valid()){e.cancel=!0;var a=l.find(".input-validation-error").first();if(a){var i,o=a.offset().top;i=l.offset().top,n.mainPanel.find(".scrollable-content").animate({scrollTop:o-i},1e3)}}}),this.applyHandlers.push(function(e){e.data.longitude=parseFloat(n.childContent.find("#longitude").val()),e.data.latitude=parseFloat(n.childContent.find("#latitude").val()),e.data.height=parseFloat(n.childContent.find("#height").val()),e.data.minimumValue=parseFloat(n.minimumValue),e.data.seedPointCoorinates=ol.proj.transform([e.data.longitude,e.data.latitude],"EPSG:4326",i.getProjection()),e.data.mapProjectionCode=o,e.data.seedPointElevation=n.seedPointElevation,e.data.toElevation=e.data.seedPointElevation+e.data.height,e.data.outputName=r.dataObj.name+"-Flood Area",e.data.outputDescription="Point-based flood area\n",e.data.outputDescription+="Location:\n",e.data.outputDescription+="   Longitude:"+e.data.longitude+"\n",e.data.outputDescription+="   Latitude:"+e.data.latitude+"\n",e.data.outputDescription+="   Elevation:"+e.data.seedPointElevation+"\n",e.data.outputDescription+="Water height:"+e.data.height+"\n";var t=s.bands[0],a=t.reclass;a||(a={ranges:[],expression:"",noDataValue:t.noDataValue,dataType:t.dataType},t.reclass=a),t.reclass.expression="["+e.data.minimumValue+"-"+e.data.toElevation+"]:"+e.data.toElevation,e.data.band=t.id,e.data.reclass=a}),this.changesApplied=!1},DlgRasterPointBasedFloodArea.prototype.populateChildPanel=function(){var e=this,t=this.obj,a=this.mapContainer.map.getView().getProjection().getCode();a&&a.indexOf(":")&&(a=a.split(":")[1]);t.get("custom");var i,o=LayerHelper.getDetails(t);o.bands&&o.bands.length&&(o.bands[0].name,i=o.bands[0].minimum),void 0===i&&(i=-1e5),e.minimumValue=i;this.childContent.html(""),this.childContent.html('  <div class="form-group">    <label class="" >Seed point:</label>    <button type="button" id="pickfromMap" class="btn btn-xs btn-info\t"  title="Pick from map"  style="" ><span class="glyphicon glyphicon-map-marker"></span> </button>  </div>  <div class="form-group">  <label class=" " >Longitude:</label>  <input type="number" id="longitude" class="form-control nospinner  " value=""  name="longitude"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="longitude" data-valmsg-replace="true"></span></div>  <div class="form-group">  <label class=" " >Latitude:</label>  <input type="number" id="latitude" class="form-control nospinner  " value=""  name="latitude"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="latitude" data-valmsg-replace="true"></span></div><div class="form-group">  <label class=" " id="seedpointElev" ></label></div><div class="form-group">  <label class="" >Water height above seed point:</label>  <input type="number" id="height" class="form-control nospinner  " value=""  name="height"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="height" data-valmsg-replace="true"></span></div><hr />'),this.childContent.find("#longitude").on("change",function(){e.extractElevationFromMap()}),this.childContent.find("#latitude").on("change",function(){e.extractElevationFromMap()}),this.childContent.find("#pickfromMap").on("click",function(){e.pickFromMap()}),this.childContent.find(".nospinner").on("wheel",function(e){$(this).blur()})},DlgRasterPointBasedFloodArea.prototype.extractElevationFromMap=function(){var i=this,e=this.obj,t=(this.mapContainer.map.getView(),i.childContent.find("#longitude").val()),a=i.childContent.find("#latitude").val(),o=parseFloat(t),n=parseFloat(a);if(!isNaN(o)&&!isNaN(n)){var r=e.get("custom"),s=LayerHelper.getDetails(e),l="Value";s.bands&&s.bands.length&&(l=s.bands[0].name);var c="/datalayer/"+r.dataObj.id+"/raster?request=value&srid=4326";c+="&x="+o,c+="&y="+n,$.ajax(c,{type:"GET",dataType:"json",success:function(e){if(e)try{var t=0;void 0!==e[l]?(t=e[l],i.seedPointElevation=t,i.childContent.find("#seedpointElev").text("Elevation: "+t)):i.childContent.find("#seedpointElev").text("Elevation: Unknown")}catch(e){i.childContent.find("#seedpointElev").text("Elevation: Unknown")}},error:function(e,t,a){i.childContent.find("#seedpointElev").text("Elevation: Unknown")}}).done(function(e){})}},DlgRasterPointBasedFloodArea.prototype.pickFromMap=function(){var o=this,e=this.obj,a=this.mapContainer.map,n=a.getView(),r=n.getProjection().getCode();r&&r.indexOf(":")&&(r=r.split(":")[1]);var s=e.get("custom"),t=LayerHelper.getDetails(e),l="Value";t.bands&&t.bands.length&&(l=t.bands[0].name),o.dlg.getModal().modal("hide"),o.dlg.getModal().hide(),$.notify({message:"Click on map to define seed point coordinates."},{type:"info",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});var c=new ol.interaction.Pointer({handleDownEvent:function(e){a.removeInteraction(c),c.setActive(!1);var i=e.coordinate,t="/datalayer/"+s.dataObj.id+"/raster?request=value&srid="+r;t+="&x="+i[0],t+="&y="+i[1],$.ajax(t,{type:"GET",dataType:"json",success:function(e){if(e)try{var t=0;void 0!==e[l]&&(t=e[l],o.seedPointElevation=t,o.childContent.find("#seedpointElev").text("Elevation: "+t));var a=ol.proj.transform(i,n.getProjection(),"EPSG:4326");o.childContent.find("#longitude").val(a[0]),o.childContent.find("#latitude").val(a[1]);ol.proj.transform(a,"EPSG:4326",n.getProjection())}catch(e){}},error:function(e,t,a){$.notify({message:a+"<br/> You clicked outside of the raster layer area."},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(e){}),o.dlg.open(),o.childContent.find("#pickfromMap").on("click",function(){o.pickFromMap()})}});a.removeInteraction(c),a.addInteraction(c),c.setActive(!0)},MeasureTasks.prototype._init=function(e){this._initialized=!0;var o=this,t=this.mapContainer,i=this.map;o.source=new ol.source.Vector,o.layer=new ol.layer.Vector({source:o.source,custom:{type:"measure",keepOnTop:!0,skipSaving:!0,hiddenInToc:!0},style:function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}}),o.moveLayerToTop(),i.getLayers().on("add",function(e){e.element!==o.layer&&e.element.get("custom")&&(e.element.get("custom").keepOnTop||o._activated&&o.moveLayerToTop())}),o.interaction=void 0;var a=function(e,t){i.removeInteraction(o.interaction),function(e,t){var a;o.task=t,o.interaction=new ol.interaction.Draw({source:o.source,type:e,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),i.addInteraction(o.interaction),o.createMeasureTooltip(),o.createHelpTooltip(),o.removeMapEvents(),o.setMapEvents(),o.interaction.on("drawstart",function(e){o.sketch=e.feature;var i=e.coordinate;a=o.sketch.getGeometry().on("change",function(e){var t,a=e.target;a instanceof ol.geom.Polygon?(t=o.formatArea(a),i=a.getInteriorPoint().getCoordinates()):a instanceof ol.geom.LineString&&(t=o.formatLength(a),i=a.getLastCoordinate()),o.measureTooltip||o.createMeasureTooltip(),o.measureTooltipElement.innerHTML=t,o.measureTooltip.setPosition(i)})},this),o.interaction.on("drawend",function(e){o.measureTooltipElement.className="tooltip tooltip-static",o.measureTooltip.setOffset([0,-7]),o.sketch=null,o.measureTooltipElement=null,o.createMeasureTooltip(),ol.Observable.unByKey(a),o.moveLayerToTop()},this)}(e,t),o.mapContainer.setCurrentEditAction("draw")};this._toolbar=new ol.control.Bar,this._subBar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mapContainer.topToolbar.addControl(this._toolbar);var n=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="measure_length_24_Icon" >&nbsp;</span>',className:"myOlbutton24 myOlbuttonVertical",title:"Measure Length",onToggle:function(e){if(i.removeInteraction(o.interaction),!e)return o.mapContainer.setCurrentTool(null),o.removeMapEvents(),void o.mapContainer.setCurrentEditAction(void 0);t.setCurrentTool({isMeasureTool:!0,name:"measure_LineString",onActivate:function(e){e.prevTool,n.setActive(!0)},onDeactivate:function(e){e.newTool&&e.newTool.isMeasureTool||o.deActivate(),n.setActive(!1)}}),a("LineString","length")}});this.measureLength=n,this._subBar.addControl(n),i.addControl(this._toolbar);var r=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="measure_area_24_Icon" >&nbsp;</span>',className:"myOlbutton24 myOlbuttonVertical",title:"Measure Area",onToggle:function(e){if(i.removeInteraction(o.interaction),!e)return o.mapContainer.setCurrentTool(null),o.removeMapEvents(),void o.mapContainer.setCurrentEditAction(void 0);t.setCurrentTool({isMeasureTool:!0,name:"measure_Polygon",onActivate:function(e){e.prevTool,r.setActive(!0)},onDeactivate:function(e){e.newTool&&e.newTool.isMeasureTool||o.deActivate(),r.setActive(!1)}}),a("Polygon","area")}});this.measureArea=r,this._subBar.addControl(r);var s=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="delete_24_Icon" >&nbsp;</span>',className:"myOlbutton24 myOlbuttonVertical",title:"Clear",handleClick:function(){o.clear()}});this._subBar.addControl(s),this.measureCtrl=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center" class="measure_24_Icon" >&nbsp;</span>',className:"myOlbutton24 ",title:"measure",bar:this._subBar}),this._toolbar.addControl(this.measureCtrl)},MeasureTasks.prototype.OnActivated=function(e){this._activated=!0,this._initialized||this._init(),this.clear()},MeasureTasks.prototype.OnDeActivated=function(){if(this._activated){this.map;this.deActivate(),this._activated=!1}},MeasureTasks.prototype.clear=function(){this.layer&&this.layer.getSource&&this.layer.getSource().clear();for(var e=0;e<this.overlays.length;e++)this.map.removeOverlay(this.overlays[e]);this.measureTooltip=null,this.overlays=[]},MeasureTasks.prototype.deActivate=function(){var e=this.map;this.interaction&&e.removeInteraction(this.interaction),this.removeMapEvents(),this.helpTooltip&&this.map.removeOverlay(this.helpTooltip),this.measureTooltip&&this.map.removeOverlay(this.measureTooltip),this._activated&&(this._activated=!1,this.measureArea.setActive(!1),this.measureLength.setActive(!1),this.interaction=null,this.mapContainer.setCurrentEditAction(void 0),this._activated=!1)},MeasureTasks.prototype.moveLayerToTop=function(){this.map.getLayers().remove(this.layer),this.map.getLayers().push(this.layer)},MeasureTasks.prototype.pointerMoveHandler=function(e){if(!e.dragging&&this.helpTooltip){var t="Click to start drawing";if(this.sketch){var a=this.sketch.getGeometry();a instanceof ol.geom.Polygon?t="Click to continue drawing the polygon":a instanceof ol.geom.LineString&&(t="Click to continue drawing the line")}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")}},MeasureTasks.prototype.mouseoutHandler=function(){this.helpTooltipElement&&this.helpTooltipElement.classList.add("hidden")},MeasureTasks.prototype.formatLength=function(e){var t=ol.sphere.getLength(e);return 1e3<t?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m"},MeasureTasks.prototype.formatArea=function(e){var t=ol.sphere.getArea(e);return 1e6<t?Math.round(t/1e6*100)/100+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"},MeasureTasks.prototype.createHelpTooltip=function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip&&this.map.removeOverlay(this.helpTooltip),this.helpTooltip=new ol.Overlay({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),this.map.addOverlay(this.helpTooltip),this.helpTooltip.getElement().parentNode.style.zIndex=1e4+this.map.getOverlays().getLength()},MeasureTasks.prototype.createMeasureTooltip=function(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="tooltip tooltip-measure",this.measureTooltip=new ol.Overlay({element:this.measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),this.overlays.push(this.measureTooltip),this.map.addOverlay(this.measureTooltip),this.measureTooltip.getElement().parentNode.style.zIndex=this.map.getOverlays().getLength()},MeasureTasks.prototype.setMapEvents=function(){this._pointermove=this.map.on("pointermove",this.pointerMoveHandler.bind(this)),this.map.getViewport().addEventListener("mouseout",this.mouseoutHandler.bind(this))},MeasureTasks.prototype.removeMapEvents=function(){this._pointermove&&ol.Observable.unByKey(this._pointermove),this.map.getViewport().removeEventListener("mouseout",this.mouseoutHandler)},RouteTasks.prototype._init=function(e){this._initialized=!0;var i=this,t=this.mapContainer,a=this.map;i.source=new ol.source.Vector,i.layer=new ol.layer.Vector({source:i.source,custom:{type:"tmp",keepOnTop:!0,skipSaving:!0,hiddenInToc:!0},style:function(e,t){return e.get("isRoute")?new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(237,50,72,0.85)",width:5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ff0000"})})}):new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}}),i.moveLayerToTop(),a.getLayers().on("add",function(e){e.element!==i.layer&&e.element.get("custom")&&(e.element.get("custom").keepOnTop||i._activated&&i.moveLayerToTop())}),i.interaction=void 0;var o=function(e,t){i.routeStopPoints=[],a.removeInteraction(i.interaction),function(e,t){i.task=t,i.interaction=new ol.interaction.Draw({type:e,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),a.addInteraction(i.interaction),i.createHelpTooltip(),i.removeMapEvents(),i.setMapEvents(),i.interaction.on("drawstart",function(e){i.sketch=e.feature},this),i.interaction.on("drawend",function(e){if("route"==i.task&&e.feature){var t=e.feature.getGeometry(),a=ol.proj.toLonLat(t.getCoordinates());i.addStop(a)}},this)}(e,t),i.mapContainer.setCurrentEditAction("draw")};this._toolbar=new ol.control.Bar,this._subBar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mapContainer.topToolbar.addControl(this._toolbar);var n=new ol.control.Toggle({html:'<span style="display:block;line-height:28px;background-position:center center;" class="" ><i class="fa fa-route"></i></span>',className:"myOlbutton24 myOlbuttonVertical",title:"Find Route",onToggle:function(e){if(a.removeInteraction(i.interaction),!e)return i.mapContainer.setCurrentTool(null),i.removeMapEvents(),void i.mapContainer.setCurrentEditAction(void 0);t.setCurrentTool({isRouteTool:!0,name:"measure_Route",onActivate:function(e){e.prevTool,n.setActive(!0),i.activateTab()},onDeactivate:function(e){e.newTool&&e.newTool.isRouteTool||i.deActivate(),i.hideTab(),n.setActive(!1)}}),o("Point","route")},bar:this._subBar});this.measureRoute=n;var r=new ol.control.Button({html:'<span style="display:block;line-height:28px;background-position:center center" class="delete_24_Icon" >&nbsp;</span>',className:"myOlbutton24 myOlbuttonVertical",title:"Clear",handleClick:function(){i.clear(),i.clearTab()}});this._subBar.addControl(r),this._toolbar.addControl(this.measureRoute)},RouteTasks.prototype.OnActivated=function(e){this._activated=!0,this._initialized||this._init(),this.clear(),this.clearTab()},RouteTasks.prototype.OnDeActivated=function(){if(this._activated){this.map;this.deActivate(),this._activated=!1}},RouteTasks.prototype.clear=function(){this.layer&&this.layer.getSource&&this.layer.getSource().clear();for(var e=0;e<this.overlays.length;e++)this.map.removeOverlay(this.overlays[e]);this.segementFeature=null,this.measureTooltip=null,this.overlays=[],this.routeStopPoints=[]},RouteTasks.prototype.deActivate=function(){var e=this.map;this.interaction&&e.removeInteraction(this.interaction),this.removeMapEvents(),this.helpTooltip&&this.map.removeOverlay(this.helpTooltip),this.measureTooltip&&this.map.removeOverlay(this.measureTooltip),this._activated&&(this._activated=!1,this.measureRoute.setActive(!1),this.interaction=null,this.mapContainer.setCurrentEditAction(void 0),this._activated=!1)},RouteTasks.prototype.moveLayerToTop=function(){this.map.getLayers().remove(this.layer),this.map.getLayers().push(this.layer)},RouteTasks.prototype.findRoute0=function(){var r=this;if(!(this.routeStopPoints.length<2)){for(var e=[],t=0;t<this.routeStopPoints.length;t++)e.push(this.routeStopPoints[t].join(","));var a=e.join("|"),i="https://api.openrouteservice.org/directions?api_key="+app.routeServiceTokens[Math.floor(Math.random()*app.routeServiceTokens.length)];i+="&coordinates="+encodeURIComponent(a),i+="&profile="+r.routeProfile,i+="&format=geojson",$.ajax(i,{type:"GET",dataType:"json",success:function(e){if(e){var t,a=e,i=new ol.format.GeoJSON({featureProjection:"EPSG:3857",dataProjection:"EPSG:4326"});try{t=i.readFeatures(a)}catch(e){try{var o=JSON.parse(a);t=i.readFeatures(o)}catch(e){}}if(t){for(var n=0;n<t.length;n++)t[n].set("isRoute",!0),r.createRouteTooltip(t[n]),r.showRouteResult(t[n]);r.source.addFeatures(t)}}},error:function(e,t,a){var i=a||t;e.responseJSON&&e.responseJSON.error&&e.responseJSON.error.message&&(i=e.responseJSON.error.message);$.notify({message:"Failed to find route, "+i},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(){})}},RouteTasks.prototype.findRoute=function(){var r=this;if(!(this.routeStopPoints.length<2)){for(var e=[],t=0;t<this.routeStopPoints.length;t++)e.push(this.routeStopPoints[t].join(","));e.join("|");var a=app.routeServiceTokens[Math.floor(Math.random()*app.routeServiceTokens.length)],i="https://api.openrouteservice.org/v2/directions/"+r.routeProfile+"/geojson",o={coordinates:this.routeStopPoints};$.ajax(i,{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),headers:{Authorization:a},success:function(e){if(e){var t,a=e,i=new ol.format.GeoJSON({featureProjection:"EPSG:3857",dataProjection:"EPSG:4326"});try{t=i.readFeatures(a)}catch(e){try{var o=JSON.parse(a);t=i.readFeatures(o)}catch(e){}}if(t){for(var n=0;n<t.length;n++)t[n].set("isRoute",!0),r.createRouteTooltip(t[n]),r.showRouteResult(t[n]);r.source.addFeatures(t)}}},error:function(e,t,a){var i=a||t;e.responseJSON&&e.responseJSON.error&&e.responseJSON.error.message&&(i=e.responseJSON.error.message);$.notify({message:"Failed to find route, "+i},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}).done(function(){})}},RouteTasks.prototype.createRouteTooltip=function(e){if(e){var t=e.getGeometry();if(t){var a=document.createElement("div");a.className="tooltip tooltip-measure";var i=new ol.Overlay({element:a,offset:[0,-15],positioning:"bottom-center"});this.overlays.push(i),this.map.addOverlay(i),i.getElement().parentNode.style.zIndex=this.map.getOverlays().getLength();var o="",n=e.get("summary");if(n){var r=n;n.length&&(r=n[n.length-1]);var s=this.formatDistance(r.distance);o+=' <i style="margin-right:0.2em;" class="'+this.getProfileIcon(this.routeProfile)+'"></i>',o+=s,o+=' <span style="margin-right:0.2em;" class="route-duration-label fa fa-clock-o"></span>'+this.formatDuration(r.duration)}a.innerHTML=o;var l=t.getCoordinates();l&&l.length&&i.setPosition(l[l.length-1])}}},RouteTasks.prototype.pointerMoveHandler=function(e){if(!e.dragging&&this.helpTooltip){var t="Click to start drawing";if("route"===this.task)t=0==this.routeStopPoints.length?"Origin":"Destination";else if(this.sketch){var a=this.sketch.getGeometry();a instanceof ol.geom.Polygon?t="Click to continue drawing the polygon":a instanceof ol.geom.LineString&&(t="Click to continue drawing the line")}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")}},RouteTasks.prototype.mouseoutHandler=function(){this.helpTooltipElement&&this.helpTooltipElement.classList.add("hidden")},RouteTasks.prototype.formatLength=function(e){var t=ol.sphere.getLength(e);return 100<t?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m"},RouteTasks.prototype.createHelpTooltip=function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip&&this.map.removeOverlay(this.helpTooltip),this.helpTooltip=new ol.Overlay({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),this.map.addOverlay(this.helpTooltip),this.helpTooltip.getElement().parentNode.style.zIndex=1e4+this.map.getOverlays().getLength()},RouteTasks.prototype.setMapEvents=function(){this._pointermove=this.map.on("pointermove",this.pointerMoveHandler.bind(this)),this.map.getViewport().addEventListener("mouseout",this.mouseoutHandler.bind(this))},RouteTasks.prototype.removeMapEvents=function(){this._pointermove&&ol.Observable.unByKey(this._pointermove),this.map.getViewport().removeEventListener("mouseout",this.mouseoutHandler)},RouteTasks.prototype.activateTab=function(){this._tab||(this._tab=$('.nav-tabs a[href="#'+this.tabId+'"]')),this._tabContent||this.crateTabContent(),this._tab.parent("li").show(),this._tab.tab("show")},RouteTasks.prototype.clearTab=function(){this.clearStops(),this.clearResults()},RouteTasks.prototype.clearResults=function(){this._resultsPanel&&this._resultsPanel.html("")},RouteTasks.prototype.clearStops=function(){this._stopsPanel&&this._stopsPanel.html(""),this.getRouteStopPoints(),this.drawStopPoints()},RouteTasks.prototype.hideTab=function(){this._tab||(this._tab=$('.nav-tabs a[href="#'+this.tabId+'"]')),this._tab.parent("li").hide(),$('.nav-tabs a[href="#'+this.tabLayersId+'"]').tab("show")},RouteTasks.prototype.crateTabContent=function(){var e=this;if(this._tab){var t=$("#"+e.tabId);this.tabPanel=t;var a='<div><form style="    padding-top: 0px;" id="'+e.tabId+'_form" class="modal-body form-horizontal">';a+='<div id="'+e.tabId+'_profile"  class="route-profile-selection">',a+='<i class="route-profile fa fa-lg fa-car active" data-profile="driving-car" title="Car"></i>',a+='<i class="route-profile fa fa-lg fa-bus" data-profile="driving-hgv" title="Bus"></i>',a+='<i class="route-profile fa fa-lg fa-bicycle" data-profile="cycling-regular" title="Bicycle"></i>',a+='<i class="route-profile fa fa-lg fa-male" data-profile="foot-walking" title="Walking"></i>',a+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#Route">?</a>',a+="</div>",a+='<div class="" id="'+e.tabId+'_stops" >',a+="</div>",a+='<div class="" id="'+e.tabId+'_results" >',a+="</div>",a+="</form></div>";var i=$(a).appendTo(this.tabPanel);this._tabContent=i,this._profilePanel=i.find("#"+e.tabId+"_profile"),this._stopsPanel=i.find("#"+e.tabId+"_stops"),this._resultsPanel=i.find("#"+e.tabId+"_results"),this._profilePanel.find(".route-profile").click(function(){e.routeProfile=$(this).data("profile"),e._profilePanel.find(".route-profile").removeClass("active"),$(this).addClass("active"),e.performTask()});var o=$(i.find("#"+e.tabId+"_form"));(this._tabForm=o).find("input,textarea,select").change(function(){$(this).addClass("attribute-value-changed")})}},RouteTasks.prototype.drawStopPoints=function(){var e=this,t=this.map.getView().getProjection();try{for(var a=0;a<e.routeStopFeatures.length;a++)e.source.removeFeature(e.routeStopFeatures[a])}catch(e){}this.routeStopFeatures=[];for(a=0;a<e.routeStopPoints.length;a++){var i=new ol.geom.Point(e.routeStopPoints[a]);i.transform("EPSG:4326",t);var o=new ol.Feature;o.setId(a+1),o.setGeometry(i),e.source.addFeature(o),this.routeStopFeatures.push(o)}},RouteTasks.prototype.addStop=function(e){var n=this,i=this.map.getView();n.routeStopPoints.push(e);var t="";this._stopId?this._stopId++:this._stopId=1;var o=e[0],r=e[1];try{o=o.toFixed(4)}catch(e){}try{r=r.toFixed(4)}catch(e){}var a=o+","+r;t+='<div class="form-group route-stop_item" style="    margin-bottom: 5px;">',t+='    <div class="input-group" >',t+='        <span class="input-group-addon route-stop-move-handler" >',t+='        <span style="cursor:pointer" class="glyphicon glyphicon-move"></span>',t+="        </span>",t+='        <span class="input-group-addon" >',t+='          <button type="button" class="route-stop-pick btn btn-xs btn-info\t"  title="Pick from map"  style="" ><span class="glyphicon glyphicon-map-marker"></span> </button>',t+="        </span>",t+='        <input type="text" name="stop_'+this._stopId+'" id="stop_'+this._stopId+'" value="'+a+'" placeholder=""  class="route-stop-input form-control" data-val="false" data-val-required=""  />',t+='        <span class="input-group-addon" >',t+='          <button type="button"  class="route-stop-delete btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button>',t+="        </span>",t+="    </div>",t+='    <span class="field-validation-valid" data-valmsg-for="stop_'+this._stopId+'" data-valmsg-replace="true"></span>',t+=" </div>";var s=$(t).appendTo(this._stopsPanel);s.find(".route-stop-input").on("input",function(){$(this).trigger("change")}),s.find(".route-stop-input").on("focus",function(){var e=$(this).val().split(",");try{if(r=parseFloat(e[1]),o=parseFloat(e[0]),!isNaN(r)&&!isNaN(o)){var t=ol.proj.transform([o,r],"EPSG:4326",i.getProjection()),a=new ol.geom.Point(t);n.zoomToGeom(a)}}catch(e){}}),s.find(".route-stop-input").change(function(){n.performTask()}),s.find(".route-stop-delete").on("click",function(e){$(this).closest(".form-group").remove(),n.performTask()}),s.find(".route-stop-pick").on("click",function(e){var o=$(this).closest(".form-group").find(".route-stop-input");n.pickStopFromMap(function(e){var t=e[0],a=e[1];try{t=t.toFixed(4)}catch(e){}try{a=a.toFixed(4)}catch(e){}var i=t+","+a;o.val(i),n.performTask()})});new Sortable(this._stopsPanel[0],{draggable:".route-stop_item",handle:".route-stop-move-handler",animation:150,direction:"vertical",onUpdate:function(e){n.performTask()}});n.performTask()},RouteTasks.prototype.getRouteStopPoints=function(){var t=this;t.routeStopPoints=[],this._stopsPanel&&this._stopsPanel.find(".route-stop-input").each(function(){var e=$(this).val().split(",");try{if(lat=parseFloat(e[1]),lon=parseFloat(e[0]),isNaN(lat)||isNaN(lon))$(this).addClass("updating-record-faild");else{t.routeStopPoints.push([lon,lat]);$(this).data("stop-index");$(this).data("stop-index",t.routeStopPoints.length-1),$(this).removeClass("updating-record-faild")}}catch(e){$(this).addClass("updating-record-faild")}})},RouteTasks.prototype.performTask=function(){var e=this;e.clear(),e.clearResults(),e.getRouteStopPoints(),e.drawStopPoints(),2<=e.routeStopPoints.length&&e.findRoute()},RouteTasks.prototype.pickStopFromMap=function(a){var i=this,o=this.interaction.getActive();this.interaction.setActive(!1),this.interaction.removeLastPoint();var n=this.map,r=n.getView(),e=r.getProjection().getCode();e&&e.indexOf(":")&&(e=e.split(":")[1]),$.notify({message:"Click on map to define stop point coordinates."},{type:"info",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});var s=new ol.interaction.Pointer({handleDownEvent:function(e){n.removeInteraction(s),s.setActive(!1);var t=ol.proj.transform(e.coordinate,r.getProjection(),"EPSG:4326");ol.proj.transform(t,"EPSG:4326",r.getProjection());a&&a(t),setTimeout(function(){i.interaction.setActive(o)},2e3)}});n.removeInteraction(s),n.addInteraction(s),s.setActive(!0)},RouteTasks.prototype.formatDistance=function(e){return 1e3<e?Math.round(e/1e3*100)/100+" km":Math.round(100*e)/100+" m"},RouteTasks.prototype.formatDuration=function(e){try{var t=Number(e);if(t<60)return"< 1 min";var a=Math.floor(t/3600),i=Math.round(t%3600/60),o=0<i?i+" min":"";return 0<a?(0<a?a+" h":"")+","+o:o}catch(e){return""}},RouteTasks.prototype.getProfileIcon=function(e){var t="";switch(e){case"driving-car":t="fa fa-lg fa-car";break;case"driving-hgv":t="fa fa-lg fa-bus";break;case"cycling-regular":t="fa fa-lg fa-bicycle";break;case"foot-walking":t="fa fa-lg fa-male"}return t},RouteTasks.prototype.showRouteResult=function(e){var t=this;this.map.getView().getProjection();if(e){var a=e.getGeometry();if(a){var i=a.getCoordinates(),o="",n="",r=e.get("summary"),s=e.get("way_points"),l=e.get("segments");if(r){var c=r;r.length&&(c=r[r.length-1]),o=t.formatDistance(c.distance),n=t.formatDuration(c.duration)}d+='<i class="route-profile fa fa-lg fa-car active" data-profile="driving-car" title="Car"></i>',d+='<i class="route-profile fa fa-lg fa-bus" data-profile="driving-hgv" title="Bus"></i>',d+='<i class="route-profile fa fa-lg fa-bicycle" data-profile="cycling-regular" title="Bicycle"></i>',d+='<i class="route-profile fa fa-lg fa-male" data-profile="foot-walking" title="Walking"></i>';var d="";d='<div class="route-total-info">',d+=' <i class="'+t.getProfileIcon(t.routeProfile)+'"></i>',d+=' <div class="route-total-distance">',d+='  <span class="route-distance-label">Disatance:</span>',d+='  <span class="route-distance-value">'+o+"</span>",d+=" </div>",d+='  <div class="route-total-duration">',d+='  <span class="route-duration-label fa fa-clock-o"></span>',d+='  <span class="route-duration-value">'+n+"</span>",d+=" </div>",d+="</div>";var p=$(d).appendTo(this._resultsPanel);p.data("path_line",a),p.click(function(){t.clearPathSegment(),t.zoomToGeom($(this).data("path_line"))});var u=function(e){var t="fa fa-arrow-up ";switch(e){case 0:t+="fa-rotate-270";break;case 1:t+="fa-rotate-90";break;case 2:t+="fa-rotate-225";break;case 3:t+="fa-rotate-135";break;case 4:case 12:t+="fa-rotate-315";break;case 5:case 13:t+="fa-rotate-45"}return t};d="";for(var h=0;l&&h<l.length;h++){var f=l[h];void 0!==f.distance&&t.formatDistance(f.distance),void 0!==f.duration&&t.formatDistance(f.duration);for(var m=f.steps,g=0;m&&g<m.length;g++){var y=m[g],v=y.name,b=y.instruction,_="",w="";void 0!==y.distance&&(_=t.formatDistance(y.distance)),void 0!==y.duration&&(w=t.formatDistance(y.duration));s=y.way_points;d="",d='<div class="route-step-info">',d+=' <div class="route-step-name">',d+=v,d+=" </div>",d+=' <div class="route-step-instruction">',d+=' <i class="'+u(y.type)+'"></i>',d+=b,d+=" </div>",d+=' <div class="route-step-distance">',d+='  <span class="route-step-distance-label"> </span>',d+='  <span class="route-step-distance-value">'+_+"</span>",d+=" </div>",d+='  <div class="route-step-duration">',d+='  <span class="route-step-duration-label fa fa-clock-o"></span>',d+='  <span class="route-step-duration-value">'+w+"</span>",d+=" </div>",d+="</div>";var k=void 0;if(s&&s.length&&i&&i.length){for(var S=[],T=0;T<s.length-1;T++)for(var C=s[T],x=s[T+1],D=C;D<=x&&D<i.length;D++)S.push(i[D]);k=new ol.geom.LineString(S)}var L=$(d).appendTo(this._resultsPanel);L.data("seg_line",k),L.click(function(){t.drawPathSegment($(this).data("seg_line")),t.zoomToGeom($(this).data("seg_line"))}),L.dblclick(function(){})}}}}},RouteTasks.prototype.clearPathSegment=function(e){if(this.segementFeature)try{this.source.removeFeature(this.segementFeature)}catch(e){}this.segementFeature=null},RouteTasks.prototype.drawPathSegment=function(e){this.map.getView().getProjection();e&&(this.segementFeature?this.segementFeature.setGeometry(e):(this.segementFeature=new ol.Feature,this.segementFeature.setGeometry(e),this.segementFeature.set("is_segment",!0),this.source.addFeature(this.segementFeature)))},RouteTasks.prototype.zoomToGeom=function(e){if(e){var t=this.map,a=t.getView(),i=a.getResolutionForExtent(e.getExtent(),t.getSize()),o=Math.floor(a.getZoomForResolution(i)),n=ol.extent.getCenter(e.getExtent());setTimeout(function(){a.animate({center:n,zoom:Math.min(o,21)})},100)}},GeolocationTasks.prototype._init=function(e){this._initialized=!0;var s=this,l=this.mapContainer,r=this.map,t=r.getView(),c=s.geolocation=new ol.Geolocation({trackingOptions:{enableHighAccuracy:!0},projection:t.getProjection()});c.on("error",function(e){$.notify({message:"Geolocation Error:"+e.message},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})});var a=new ol.Feature;c.on("change:accuracyGeometry",function(){a.setGeometry(c.getAccuracyGeometry())});var d=new ol.Feature,i=new ol.style.Icon({anchor:[.5,.56],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/css/images/gps_33_5.png",opacity:.7}),p=function(){"undefined"!=typeof navigator&&navigator.compass&&navigator.compass.getCurrentHeading(function(e){if(e&&!isNaN(e.trueHeading)){var t=e.trueHeading*Math.PI/180+s.map.getView().getRotation();i.setRotation(t)}})};d.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),t.on("change:rotation",function(){p()}),c.on("change:position",function(){var e=c.getPosition(),t=(c.getHeading(),Math.PI,c.get("accuracy"));if(s.zoomToLocation&&!isNaN(t)&&t<100){s.zoomToLocation=!1;var a=r.getView().getZoom();a<18&&(a=18),s.map.getView().animate({zoom:a,center:e})}if(s.keepCenter){var i=s.map.getView().calculateExtent(s.map.getSize()),o=(i[2]-i[0])/20,n=(i[3]-i[1])/20;isNaN(t)||t<(i[2]-i[0])/4&&t<(i[3]-i[1])/4&&(o<t&&(o=t),n<t&&(n=t)),(e[0]<i[0]+o||e[0]>i[2]-o||e[1]<i[1]+n||e[1]>i[3]-n)&&s.map.getView().animate({center:e})}d.setGeometry(e?new ol.geom.Point(e):null),s._tracking&&(s.interactionSnap.setActive(!0),app.dispatchEvent("change:position",{coordinates:e})),p()}),s.source=new ol.source.Vector({features:[a,d]}),s.layer=new ol.layer.Vector({source:s.source,updateWhileAnimating:!0,updateWhileInteracting:!0,custom:{type:"geolocation",keepOnTop:!0,skipSaving:!0,hiddenInToc:!0},style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}),s.interactionSnap=new ol.interaction.Snap({edge:!1,source:s.layer.getSource()}),s.interactionSnap.setActive(!1),s.interactionSnap.removeFeature(a),app.registerSnapInteraction(s.interactionSnap),app.registerEventhandler("map-loaded",function(){s.moveLayerToTop()}),r.getLayers().on("add",function(e){e.element!==s.layer&&e.element.get("custom")&&(e.element.get("custom").keepOnTop||s._activated&&s.moveLayerToTop())}),this._toolbar=new ol.control.Bar,this._subBar=new ol.control.Bar({toggleOne:!0,group:!1}),this.mapContainer.topToolbar.addControl(this._toolbar);var o=new ol.control.Toggle({html:'<i class=" glyphicon glyphicon-lock"></i>',className:"myOlbutton24",title:"Keep me in map view",_statusTip:'<i  class="status_tip_glyph glyphicon glyphicon-lock"></i> Keep me in map view',onToggle:function(e){e?l.showTopStatus(this._statusTip,3e3):l.showTopStatus(""),s.keepCenter=!!e},active:s.keepCenter});this.keepCenterCmd=o,this._subBar.addControl(o),r.addControl(this._toolbar),this.taskCtrl=new ol.control.Toggle({html:'<i class=" glyphicon glyphicon-record"></i>',className:"myOlbutton24",title:"My location",_statusTip:'<i  class="status_tip_glyph glyphicon glyphicon-record"></i> My location',onToggle:function(e){if(e){var i=this.getSubBar().getControls(),o=0,n=i.length,r=function(){if(0<=o&&o<n){var e=i[o],t=e._statusTip||e.get("title")||"  ",a=3e3;"  "==t&&(a=100),t&&l.showTopStatus(t,a,e.element,function(){o++,r()})}};l.showTopStatus(this._statusTip,3e3,void 0,function(){r()})}else l.showTopStatus("");if(!e)return s.zoomToLocation=!1,s.deActivate(),s.geolocation.setTracking(!1),s._tracking=!1,void s.interactionSnap.setActive(!1);s.interactionSnap.setActive(!0),s.layer.setVisible(!0),s.geolocation.setTracking(e),(s._tracking=e)&&(s.zoomToLocation=!0)},bar:this._subBar}),this._toolbar.addControl(this.taskCtrl)},GeolocationTasks.prototype.OnActivated=function(e){this._activated=!0,this._initialized||this._init(),this.clear(),this.layer&&this.layer.getSource&&this.layer.setVisible(!0)},GeolocationTasks.prototype.OnDeActivated=function(){if(this._activated){this.map;this.deActivate(),this._activated=!1}},GeolocationTasks.prototype.clear=function(){this.layer&&this.layer.getSource&&this.layer.setVisible(!1);for(var e=0;e<this.overlays.length;e++)this.map.removeOverlay(this.overlays[e]);this.measureTooltip=null,this.overlays=[]},GeolocationTasks.prototype.deActivate=function(){this.map;this.geolocation.setTracking(!1),this.measureTooltip&&this.map.removeOverlay(this.measureTooltip),this.layer&&this.layer.getSource&&this.layer.setVisible(!1),this._activated&&(this._activated=!1)},GeolocationTasks.prototype.moveLayerToTop=function(){this.map.getLayers().remove(this.layer),this.map.getLayers().push(this.layer)},GeolocationTasks.prototype.formatLength=function(e){var t=ol.sphere.getLength(e);return 100<t?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m"},GeolocationTasks.prototype.isTracking=function(){return this._tracking},GeolocationTasks.prototype.isTracking=function(){return this._tracking},GeolocationTasks.prototype.getPosition=function(){return this.geolocation.getPosition()},ol.inherits(MapContainer,ol.Object),MapContainer.prototype.getActiveLayer=function(){return this.switcher.getActiveLayer()},MapContainer.prototype.setActiveLayer=function(e){this.switcher.setActiveLayer(e)},MapContainer.prototype.setCurrentEditAction=function(e){this.set("currentEditAction",e)},MapContainer.prototype.getCurrentEditAction=function(){return this.get("currentEditAction")},MapContainer.prototype.setCurrentTool=function(e){var t=this.get("currentTool"),a={cancel:!1,newTool:e};t&&t.onDeactivate&&t.onDeactivate(a),a.cancel||(this.set("currentTool",e),e&&e.onActivate&&e.onActivate({prevTool:t}))},MapContainer.prototype.getCurrentTool=function(){return this.get("currentTool")},MapContainer.prototype.create=function(){var n=this,e=new ol.Overlay.Popup({popupClass:"default shadow",className:"ol-overlay-container ol-selectable",closeBox:!1,positioning:"auto",autoPan:!0,stopEvent:!0,autoPanAnimation:{duration:250}});this.popup=e;var r=this.map=new ol.Map({target:this.options.targetEl||"map",layers:[new ol.layer.Tile({title:"OSM",source:new ol.source.OSM,noSwitcherInfo:!0,custom:{baseLayer:!0,type:"ol.layer.Tile",source:"ol.source.OSM"}})],overlays:[e],view:new ol.View({center:ol.proj.fromLonLat([app.initMap_Lon||0,app.initMap_Lat||0]),zoom:app.initMap_Zoom||4,extent:ol.proj.get("EPSG:3857").getExtent()})}),t=(new ol.interaction.Select({condition:ol.events.condition.pointerMove,filter:function(e,t){return n.switcher.getActiveLayer()==t}}),new ol.interaction.DragAndDrop({formatConstructors:[ol.format.GPX,ol.format.GeoJSON,ol.format.IGC,ol.format.KML,ol.format.TopoJSON]}));t.on("addfeatures",function(e){if(e.features&&e.features.length){var t="";if(e.file&&e.file.name&&(t=e.file.name),app.identity&&(app.identity.isAdministrator||app.identity.isPowerUser||app.identity.isDataManager||app.identity.isDataAnalyst)){var a=e.projection||r.getView.getProjection();new DlgAddGeoJSON(this,null,{title:"Add GeoJSON",initData:{layerName:t,geojson:new ol.format.GeoJSON({featureProjection:a,dataProjection:"EPSG:4326"}).writeFeatures(e.features)},onapply:function(e,t){n.addGeoJSON_data(t)}}).show()}}}),r.addInteraction(t);var a=new ol.control.LayerSwitcher({target:$("#layerSwitcher").get(0),reordering:!0,show_progress:!0,toggleVisiblityOnLabelClick:!1,extent:!0,trash:!0,onClick:function(e){},onDblClick:function(e){var t=e.get("custom");t&&t.format,n.zoomToLayer(e)}});a.on("drawlist",function(e){var t=e.layer;$('<div style="margin-left:1em;color:#336699;background-color:transparent;"><i class="fa fa-bars"></i></div>').click(function(){n.showLayerProperties(t)}).appendTo($("> .ol-layerswitcher-buttons",e.li))}),a.on("activeLayerChanged",function(e){n.OnActiveLayerChanged()}),a.on("beforeLayerRemoved",function(a){a.cancel=!0;var i=a.layer;if(i){var e="Remove layer ("+i.get("title")+")?";confirmDialog.show(e,function(e){if(e){a.parentLayer&&a.parentLayer.getLayers?a.parentLayer.getLayers().remove(i):i.get("_parent")&&i.get("_parent").getLayers?i.get("_parent").getLayers().remove(i):r.removeLayer(i);var t=i.get("layerTasks");t&&t.OnDeActivated&&t.OnDeActivated()}},{dialogSize:"sm",alertType:"danger"})}}),this.switcher=a,r.addControl(a),this.mousePositionControl=new ol.control.CoordinatesBar({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",undefinedHTML:"",handleClick:function(){}}),r.addControl(this.mousePositionControl),this.leftToolbar=new ol.control.Bar,this.leftToolbar.setPosition("top-left"),r.addControl(this.leftToolbar),this.topToolbar=new ol.control.Bar,this.topToolbar.setPosition("top"),r.addControl(this.topToolbar),this.rightToolbar=new ol.control.Bar,this.rightToolbar.setPosition("right"),r.addControl(this.rightToolbar),this.bottomToolbar=new ol.control.Bar,this.bottomToolbar.setPosition("bottom"),r.addControl(this.bottomToolbar),this.btnLayerProperties=new ol.control.Button({html:'<i class="fa fa-bars"></i>',className:"myOlbutton24",title:"Layer Properties",handleClick:function(e){n.showLayerProperties(n.getActiveLayer())}}),this.leftToolbar.addControl(this.btnLayerProperties),this.btnLayerProperties.setVisible(!1),this.identifyTask=new IdentifyTask(this.app,this,{}),this.identifyTask.OnActivated(),this.measureTasks=new MeasureTasks(this.app,this,{}),this.measureTasks.OnActivated(),this.routeTasks=new RouteTasks(this.app,this,{}),this.routeTasks.OnActivated(),"https:"===location.protocol&&app.isMobile()&&(this.geolocationTasks=new GeolocationTasks(this.app,this,{}),this.geolocationTasks.OnActivated());var i=new ol.control.SearchNominatim({className:"search nominatim ",polygon:!0,position:!0});r.addControl(i);var s=this.measureTasks.layer;i.on("select",function(e){if(s.getSource().clear(),e.search.geojson){var t=(new ol.format.GeoJSON).readFeature(e.search.geojson,{dataProjection:"EPSG:4326",featureProjection:r.getView().getProjection()});s.getSource().addFeature(t);var a=r.getView(),i=a.getResolutionForExtent(t.getGeometry().getExtent(),r.getSize()),o=a.getZoomForResolution(i),n=ol.extent.getCenter(t.getGeometry().getExtent());setTimeout(function(){a.animate({center:n,zoom:Math.min(o,16)})},100)}else r.getView().animate({center:e.coordinate,zoom:Math.max(r.getView().getZoom(),16)})});var o=new ol.control.Legend({title:"Legend",collapsed:!1});r.addControl(o),o.on("toggle",function(){n.refreshLegend()}),o.on("select",function(e){if(e.index,e.row&&e.row.data&&e.row.data.layer){var t=e.row.data.layer.get("custom"),a=1;t&&t.displayInLegend&&("ol.layer.Vector"===t.type?a=1:"ol.layer.Image"===t.type&&"ol.source.GeoImage"===t.source&&(a=3)),n.showLayerProperties(e.row.data.layer,a)}}),this.legend=o,r.getLayerGroup().on("change",function(){n.refreshLegend()}),r.on("moveend",function(){n.refreshLegend()});var l=new ol.control.CanvasScaleLine;r.addControl(l),this.scaleLineControl=l;var c=new ol.control.Button({html:'<i class="fa fa-print"></i>',className:"myOlbutton24 printpdf",title:"Print",handleClick:function(){new DlgPrint(n,{templates:PrintUtil.templates,activeTemplate:PrintUtil.activeTemplate},{title:"Print",onapply:function(e,t){var a="";t&&t.settings&&t.settings.template&&(a=t.settings.template.thumbnail);var i="Generating PDF File<i><br/><hr />";i+='    <img id="printThumbnail" style="object-fit: contain; height: 200px; object-position: center; box-shadow: #a4a4ad 10px 10px 10px;" src="'+a+'" class="img-thumbnail center-block"  height=""></img>',waitingDialog.show(i,{progressType:""}),PrintUtil.print({mapContainer:n,settings:t.settings,onComplete:function(e){waitingDialog.hide(),e.status||$.notify({message:e.message||"Error: failed to generate PDF"},{z_index:5e4,type:"danger",delay:1e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}})}}).show()}});r.addControl(c);var d=r.getTarget();d="string"==typeof d?$("#"+d):$(d),r.on("pointermove",function(e){e.dragging;var t=n.getCurrentTool(),a="";if(t&&(t.cursor&&(a="function"==typeof t.cursor?t.cursor(r,e):t.cursor),a))d.css("cursor",a);else{var i=r.getEventPixel(e.originalEvent),o=r.hasFeatureAtPixel(i);d.css("cursor",o?"pointer":a)}}),r.on("singleclick",function(e){})},MapContainer.formatLength=function(e){var t=ol.sphere.getLength(e);return 1e3<t?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m"},MapContainer.formatArea=function(e){var t=ol.sphere.getArea(e);return 1e6<t?Math.round(t/1e6*100)/100+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"},MapContainer.prototype.showLayerProperties=function(e,t){new ObjectPropertiesDlg(this,e,{tabs:[new LayerGeneralTab,new LayerStyleTab,new LayerLabelTab,new RasterDisplayTab,new LayerSourceTab],activeTabIndex:t,helpLink:"/help#layerProperties"}).show()},MapContainer.prototype.OnActiveLayerChanged=function(){var a=this.getActiveLayer();if(this._lastActiveLayer!=a){for(var i,e=this.getAllLayersList(),t=0;t<e.length;t++){var o;(o=e[t].get("layerTasks"))&&o.OnDeActivated&&o.OnDeActivated()}if(this._lastActiveLayer=a)(o=a.get("layerTasks"))&&o.OnActivated&&o.OnActivated();if(this.updateUI(),a&&(i=a.get("custom")),i&&i.dataObj&&i.source_schema_updatedAt){var n="/datalayer/"+i.dataObj.id+"/info";$.ajax(n,{type:"GET",dataType:"json",success:function(e){if(e){if(void 0!==e.status)if(!e.status)return void((t=a.getSource())&&(t.set("loading_details","Source does not exist"),t.set("loading_status","failed")));if(e.updatedAt!==i.source_schema_updatedAt){i.source_schema_out_of_date=!0;var t=a.getSource();try{i.dataObj=e,LayerHelper.setDetails(a,JSON.parse(e.details)),i.source_schema_updatedAt=e.updatedAt,t.set("loading_details","Source definition is updated."),t.set("loading_status","out_of_date"),i.source_schema_out_of_date=!1}catch(e){t.set("loading_details","Source definition is out of date."),t.set("loading_status","out_of_date")}}else{i&&i.dataObj&&(i.dataObj.dataRelationships=e.dataRelationships),"out_of_date"==(t=a.getSource()).get("loading_status")&&t.set("loading_status","")}}},error:function(e,t,a){}}).done(function(e){})}}},MapContainer.prototype.zoomToLayer=function(e){var t=this;if(e){var a=e.get("custom");if(a&&a.dataObj&&"ol.format.OSMXML"==a.format&&a.dataObj.options&&a.dataObj.options.info&&a.dataObj.options.info.epsg4326Extent){var i=a.dataObj.options.info.epsg4326Extent;this.setGeoExtent(i[0],i[1],i[2],i[3])}else{if(a&&a.dataObj&&("ol.format.GeoJSON"==a.format||"ol.source.GeoImage"===a.source||"ol.format.WFS"==a.format||"ol.format.WMS"==a.format)){var o,n=e.getSource();if(n.getExtent&&(o=n.getExtent()),o&&o[0]!==1/0)try{return void this.map.getView().fit(o,{size:this.map.getSize()})}catch(e){}n.requestExtent&&n.requestExtent(function(e){if(e&&e[0]!==1/0)try{return void t.map.getView().fit(e,{size:t.map.getSize()})}catch(e){}})}var r=LayerHelper.getDetails(e);r&&this.setGeoExtent(r.ext_west,r.ext_south,r.ext_east,r.ext_north)}}},MapContainer.prototype.zoomToFeature=function(e){var t;if(e&&(e.getGeometry&&(t=e.getGeometry()),t)){var a=t.getExtent();try{if(a)if(a[0]==a[2]&&a[1]==a[3]){var i=this.map.getSize();this.map.getView().fit(a,{size:i,maxZoom:16})}else this.map.getView().fit(a,{size:this.map.getSize()})}catch(e){}}},MapContainer.prototype.setGeoExtent=function(e,t,a,i){if(void 0!==e&&void 0!==t&&void 0!==a&&void 0!==i&&!(isNaN(e)||isNaN(t)||isNaN(a)||isNaN(i))){var o=this.map,n=o.getView().getProjection().getCode(),r=[e,t,a,i];r=ol.extent.applyTransform(r,ol.proj.getTransform("EPSG:4326",n)),o.getView().fit(r,{size:o.getSize()})}},MapContainer.prototype.updateUI=function(){this.getActiveLayer()?this.btnLayerProperties.setVisible(!0):this.btnLayerProperties.setVisible(!1)},MapContainer.prototype.loadFromJson=function(e){var t=JSON.parse(e);this.load(t)},MapContainer.prototype.load=function(e){if(this.mapSettings=e,this.setActiveLayer(null),e.details)try{("string"==typeof e.details||e.details instanceof String)&&(e.details=JSON.parse(e.details))}catch(e){}this.mapSettings=e;var t=this.map,a=t.getView(),i=a.getProjection().getCode();if(e.details&&e.details.navState)a.setCenter(e.details.navState.center),a.setZoom(e.details.navState.zoom),a.setRotation(e.details.navState.rotation);else if(void 0!==e.ext_north&&null!==e.ext_north){var o=[e.ext_west,e.ext_south,e.ext_east,e.ext_north];o=ol.extent.applyTransform(o,ol.proj.getTransform("EPSG:4326",i)),t.getView().fit(o,{size:t.getSize()})}var n=e.details;if(n&&n.layers&&n.layers.length){t.getLayers().clear();for(var r=0;r<n.layers.length;r++){var s=n.layers[r];this.addLayer(s)}}if(e.preview){var l;for(r=0;r<e.preview.length;r++)l=this.addData(e.preview[r]);if(l&&this.zoomToLayer(l),this.legend.setVisible(!1),e.options)(o=e.options.bbox)&&(o=ol.extent.applyTransform(o,ol.proj.getTransform("EPSG:4326",i)),t.getView().fit(o,{size:t.getSize()})),"WMS"==e.options.layerType?this.addNewWMS(e.options):"WFS"==e.options.layerType&&this.addNewWFS(e.options)}n&&n.ui&&this.legend.setVisible(n.ui.legend)},MapContainer.prototype.addLayer=function(e,t){var a=this.createLayer(e);if(a&&(t||(t=this.getActiveLayer()),t&&t instanceof ol.layer.Group?t.getLayers().push(a):this.map.addLayer(a),a&&e.layerGroup&&e.layers))for(var i=0;i<e.layers.length;i++){var o=e.layers[i];this.addLayer(o,a)}return a},MapContainer.prototype.createLayer=function(e){var t=null;if(!e)return t;if(e.layerGroup)return t=new ol.layer.Group({layers:[],name:e.name,title:e.title,opacity:e.opacity}),void 0!==e.visible&&t.set("visible",!!e.visible),t;StyleFactory.randomStyle();if(e.custom&&"ol.layer.Tile"===e.custom.type){if("ol.source.WMS"===e.custom.source){var a=e.custom.dataObj,i=this.sourceFactory.createWMSSource(a);if(i){t=new ol.layer.Tile({title:e.title,source:i,opacity:e.opacity,noSwitcherInfo:!0,custom:{baseLayer:e.custom.baseLayer,type:"ol.layer.Tile",source:"ol.source.WMS",dataObj:a,noSwitcherInfo:void 0===e.custom.noSwitcherInfo||e.custom.noSwitcherInfo,displayInLegend:void 0!==e.custom.displayInLegend&&e.custom.displayInLegend,supportsGetFeatureInfo:e.custom.supportsGetFeatureInfo,supportsGetFeatureInfo_html:e.custom.supportsGetFeatureInfo_html,supportsGetFeatureInfo_text:e.custom.supportsGetFeatureInfo_text,supportsGetFeatureInfo_json:e.custom.supportsGetFeatureInfo_json}});var o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}else if("ol.source.OSM"===e.custom.source){t=new ol.layer.Tile({title:e.title,source:this.sourceFactory.createBaseTileSource({type:"OSM"}),opacity:e.opacity,noSwitcherInfo:!0,custom:{baseLayer:e.custom.baseLayer,type:"ol.layer.Tile",source:"ol.source.OSM",dataObj:e.custom.dataObj,displayInLegend:void 0!==e.custom.displayInLegend&&e.custom.displayInLegend}});o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}else if("ol.source.BingMaps"===e.custom.source){t=new ol.layer.Tile({title:e.title,source:this.sourceFactory.createBaseTileSource({type:"BingMaps",key:e.custom.key,imagerySet:e.custom.imagerySet}),noSwitcherInfo:!0,opacity:e.opacity,custom:{baseLayer:e.custom.baseLayer,type:"ol.layer.Tile",source:"ol.source.BingMaps",key:e.custom.key,imagerySet:e.custom.imagerySet,dataObj:e.custom.dataObj,displayInLegend:void 0!==e.custom.displayInLegend&&e.custom.displayInLegend}});o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}else if("ol.source.XYZ"===e.custom.source){t=new ol.layer.Tile({title:e.title,source:this.sourceFactory.createBaseTileSource({type:"XYZ",params:e.custom.params}),noSwitcherInfo:!0,opacity:e.opacity,custom:{baseLayer:e.custom.baseLayer,type:"ol.layer.Tile",source:"ol.source.XYZ",params:e.custom.params,dataObj:e.custom.dataObj,displayInLegend:void 0!==e.custom.displayInLegend&&e.custom.displayInLegend}});o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}else if(e.custom&&"ol.layer.Vector"===e.custom.type){if(e.custom.dataObj&&"ol.source.Vector"===e.custom.source)if("ol.format.GeoJSON"===e.custom.format){a=e.custom.dataObj;try{("string"==typeof a.details||a.details instanceof String)&&(a.details=JSON.parse(a.details))}catch(e){}var n=void 0;a.details&&a.details.renderer&&(n=RendererFactory.createFromJson(a.details.renderer)),n||(n=RendererFactory.createSimpleRenderer()),a.details&&(a.details.renderer=n.toJson());var r=void 0;if(a.details&&a.details.featureLabeler&&(r=new FeatureLabeler(a.details.featureLabeler)),s=this.sourceFactory.createGeoJsonVectorSource(a,this)){(t=new ol.layer.Vector({title:e.title,source:s,featureLabeler:r,renderer:n,opacity:e.opacity,custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.GeoJSON",shapeType:a.details.shapeType,source_schema_updatedAt:e.custom.source_schema_updatedAt,dataObj:a,displayInLegend:void 0===e.custom.displayInLegend||e.custom.displayInLegend}})).setStyle(n.findStyleFunction(t));o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}else if("ol.format.WFS"===e.custom.format){a=e.custom.dataObj;try{("string"==typeof a.details||a.details instanceof String)&&(a.details=JSON.parse(a.details))}catch(e){}n=void 0;a.details&&a.details.renderer&&(n=RendererFactory.createFromJson(a.details.renderer)),n||(n=RendererFactory.createSimpleRenderer()),a.details&&(a.details.renderer=n.toJson());r=void 0;if(a.details&&a.details.featureLabeler&&(r=new FeatureLabeler(a.details.featureLabeler)),s=this.sourceFactory.createWFSSource(a,this)){(t=new ol.layer.Vector({title:e.title,source:s,featureLabeler:r,renderer:n,opacity:e.opacity,custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.WFS",shapeType:a.details.shapeType,dataObj:a,displayInLegend:void 0===e.custom.displayInLegend||e.custom.displayInLegend}})).setStyle(n.findStyleFunction(t));o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}else if("ol.format.OSMXML"===e.custom.format){a=e.custom.dataObj;try{("string"==typeof a.details||a.details instanceof String)&&(a.details=JSON.parse(a.details))}catch(e){}n=void 0;a.details&&a.details.renderer&&(n=RendererFactory.createFromJson(a.details.renderer)),n||(n=RendererFactory.createSimpleRenderer()),a.details&&(a.details.renderer=n.toJson());var s;r=void 0;if(a.details&&a.details.featureLabeler&&(r=new FeatureLabeler(a.details.featureLabeler)),s=this.sourceFactory.createOsmVectorSource(a,this)){(t=new ol.layer.Vector({title:e.title,source:s,featureLabeler:r,renderer:n,opacity:e.opacity,custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.OSMXML",shapeType:a.details.shapeType,dataObj:a,displayInLegend:void 0===e.custom.displayInLegend||e.custom.displayInLegend}})).setStyle(n.findStyleFunction(t));o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}}else if(e.custom&&"ol.layer.Image"===e.custom.type&&e.custom.dataObj&&"ol.source.GeoImage"===e.custom.source){a=e.custom.dataObj;try{("string"==typeof a.details||a.details instanceof String)&&(a.details=JSON.parse(a.details))}catch(e){}var l=this.sourceFactory.createGeoImageSource(a,this);if(l){var c=a.details.metadata_3857,d=[c.upperleftx,c.upperlefty+c.scaley*c.height,c.upperleftx+c.scalex*c.width,c.upperlefty];t=new ol.layer.Tile({title:e.title,source:l,extent:d,opacity:e.opacity,custom:{type:"ol.layer.Image",source:"ol.source.GeoImage",dataObj:a,source_schema_updatedAt:e.custom.source_schema_updatedAt,displayInLegend:void 0!==e.custom.displayInLegend&&e.custom.displayInLegend}});o=new LayerTasks(this.app,this,t,{});t.set("layerTasks",o)}}return t&&void 0!==e.visible&&t.set("visible",!!e.visible),t},MapContainer.prototype.addData=function(e){if(e){var t=void 0;if(e.dataType&&"vector"===e.dataType&&e.details){var a={title:e.name,custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.GeoJSON",source_schema_updatedAt:e.updatedAt,dataObj:e,displayInLegend:!0}};t=this.addLayer(a)}else if(e.dataType&&"raster"===e.dataType&&e.details){a={title:e.name,custom:{type:"ol.layer.Image",source:"ol.source.GeoImage",source_schema_updatedAt:e.updatedAt,dataObj:e,displayInLegend:!0}};t=this.addLayer(a)}else if(e.dataType&&"baseLayer"===e.dataType){a={title:e.name,custom:{type:"ol.layer.Tile",source:"ol.source."+e.type,params:e.params,dataObj:{details:e.details},displayInLegend:!1}};"BingMaps"==e.type&&(a.custom.baseLayer=e.baseLayer,a.custom.key=e.key,a.custom.imagerySet=e.imagerySet),t=this.addLayer(a)}else this.addLayerById(e.id);return t&&this.setActiveLayer(t),t}},MapContainer.prototype.addLayerById=function(e){var t=this;if(e){var a="/datalayer/"+e+"/info";$.ajax(a,{type:"GET",dataType:"json",success:function(e){e&&t.addData(e)},error:function(e,t,a){}}).done(function(e){})}},MapContainer.prototype.getCurrentGeoExtent=function(){var e=this.getCurrentGeoExtentArray();return{minx:e[0],miny:e[1],maxx:e[2],maxy:e[3]}},MapContainer.prototype.getCurrentGeoExtentArray=function(){var e=this.map,t=e.getView().getProjection().getCode(),a=e.getView().calculateExtent(e.getSize());return a=ol.extent.applyTransform(a,ol.proj.getTransform(t,"EPSG:4326"))},MapContainer.prototype.getAllLayersList=function(){var e=[];return function e(t,a){if(t)for(var i=0;i<t.get("length");i++){var o=t.item(i);a.push(o),o.getLayers&&e(o.getLayers(),a)}}(this.map.getLayers(),e),e},MapContainer.prototype.getMapDetailsJsonStr=function(){var e={},t=this.map,a=t.getView();a.getCenter();e.mapProjectionCode=a.getProjection().getCode();var i=t.getView().calculateExtent(t.getSize());e.geoExtent=ol.extent.applyTransform(i,ol.proj.getTransform(e.mapProjectionCode,"EPSG:4326")),e.navState={zoom:a.getZoom(),center:a.getCenter(),rotation:a.getRotation()},e.ui={legend:this.legend.getVisible()};var o=function e(t){if(t){for(var a=[],i=0;i<t.get("length");i++){var o=t.item(i);if(!o.get("custom")||(o.get("custom"),!o.get("custom").skipSaving)){var n={name:o.get("name"),title:o.get("title"),visible:o.get("visible"),opacity:o.get("opacity"),custom:o.get("custom")};if(o.getLayers){n.layerGroup=!0;var r=e(o.getLayers());r&&(n.layers=r)}a.push(n)}}return a}return null}(t.getLayers());return e.layers=o,JSON.stringify(e)},MapContainer.prototype.exportPngBase64Str=function(l,c){var e=this.map;e.once("postcompose",function(e){var t,a,i,o,n=e.context.canvas;if(void 0!==c){var r=c/n.width*n.height;try{t=n,a=c,i=r,(o=document.createElement("canvas")).width=a,o.height=i,o.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,a,i),n=o}catch(e){}}if(navigator.msSaveBlob){var s=n.toDataURL();l&&l(s.split(",")[1])}else{s=n.toDataURL();l&&l(s.split(",")[1])}}),e.renderSync()},MapContainer.prototype.exportPngBlob0=function(l,c){var e=this.map;e.once("postcompose",function(e){var t,a,i,o,n=e.context.canvas;if(void 0!==c){var r=c/n.width*n.height;try{t=n,a=c,i=r,(o=document.createElement("canvas")).width=a,o.height=i,o.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,a,i),n=o}catch(e){}}if(navigator.msSaveBlob){var s=n.msToBlob();l&&l(s)}else n.toBlob(function(e){l&&l(e)})}),e.renderSync()},MapContainer.prototype.getMapRenderedCanvas=function(){var e=this.map,t=document.createElement("canvas"),a=e.getSize();t.width=a[0],t.height=a[1];var i=t.getContext("2d");return Array.prototype.forEach.call(document.querySelectorAll(".ol-layer canvas"),function(e){if(0<e.width){var t=e.parentNode.style.opacity;i.globalAlpha=""===t?1:Number(t);var a=e.style.transform.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(i,a),i.drawImage(e,0,0)}}),t},MapContainer.prototype.exportPngBlob=function(l,c){var e=this.map,d=this;e.once("rendercomplete",function(e){var t,a,i,o,n=d.getMapRenderedCanvas();if(void 0!==c){var r=c/n.width*n.height;try{t=n,a=c,i=r,(o=document.createElement("canvas")).width=a,o.height=i,o.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,a,i),n=o}catch(e){}}if(navigator.msSaveBlob){var s=n.msToBlob();l&&l(s)}else n.toBlob(function(e){l&&l(e)})}),e.renderSync()},MapContainer.prototype.addTestWms=function(){this.addLayer({title:"test Wms",custom:{type:"ol.layer.Tile",source:"ol.source.WMS",dataObj:{details:{url:"https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r-t.cgi",params:{LAYERS:"nexrad-n0r-wmst"}}}}})},MapContainer.prototype.addTestWFS=function(){this.addLayer({title:"WFS_ISIPO3:parcel",custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.WFS",dataObj:{details:{url:"http://localhost:6080/arcgis/services/wfs/GeoDataServer/WFSServer",params:{typename:"esri:parcel"}}}}})},MapContainer.prototype.addNewWMS=function(e){var t=this,a={title:(e=e||{}).title||"",custom:{type:"ol.layer.Tile",source:"ol.source.WMS",dataObj:{details:{url:e.url||"",params:{LAYERS:e.layers||e.Layers||e.LAYERS||""}}}}},i=this.createLayer(a);if(e.bbox)try{LayerHelper.getDetails(i).ext_north=e.bbox[3],LayerHelper.getDetails(i).ext_south=e.bbox[1],LayerHelper.getDetails(i).ext_east=e.bbox[2],LayerHelper.getDetails(i).ext_west=e.bbox[0]}catch(e){}new ObjectPropertiesDlg(t,i,{isNew:!0,title:"Add new WMS layer",tabs:[new LayerGeneralTab,new LayerStyleTab,new LayerLabelTab,new RasterDisplayTab,new LayerSourceTab],activeTabIndex:4,onapply:function(e){t.map.addLayer(i)},helpLink:"/help#newWMSLayer"}).show()},MapContainer.prototype.addNewWFS=function(e){var t=this,a={title:(e=e||{}).title||e.name||"",custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.WFS",shapeType:e.shapetype||e.shapeType||"",dataObj:{details:{shapeType:e.shapetype||e.shapeType||"",url:e.url||"",params:{typename:e.typename||e.typeName||e.TYPENAME||""}}}}},i=this.createLayer(a);if(e.bbox)try{LayerHelper.getDetails(i).ext_north=e.bbox[3],LayerHelper.getDetails(i).ext_south=e.bbox[1],LayerHelper.getDetails(i).ext_east=e.bbox[2],LayerHelper.getDetails(i).ext_west=e.bbox[0]}catch(e){}new ObjectPropertiesDlg(t,i,{isNew:!0,title:"Add new WFS layer",tabs:[new LayerGeneralTab,new LayerStyleTab,new LayerLabelTab,new LayerSourceTab],activeTabIndex:3,onapply:function(e){t.map.addLayer(i)},helpLink:"/help#newWFSLayer"}).show()},MapContainer.prototype.addNewOSMXML_withOptions=function(e,t){var a=this,i=(e=e||{}).shapeType||"Point",o=[];if(e.info&&e.info[i]&&e.info[i].tags){var n=e.info[i];if(n.selectedTags){if(n.selectedTags.length)for(var r=0;r<n.selectedTags.length;r++){var s=n.selectedTags[r];for(l=0;l<n.tags.length;l++){if((c=n.tags[l]).name&&c.name===s){o.push({name:c.name,alias:c.name,type:"varchar",length:c.length||8});break}}}}else for(var l=0;l<n.tags.length&&l<20;l++){var c;(c=n.tags[l]).name&&o.push({name:c.name,alias:c.name,type:"varchar",length:c.length||8})}}var d={title:"",custom:{type:"ol.layer.Vector",source:"ol.source.Vector",format:"ol.format.OSMXML",shapeType:i,dataObj:{options:e,details:{shapeType:i,fields:o}}}},p=this.createLayer(d);new ObjectPropertiesDlg(a,p,{isNew:!0,title:"Add new OSM Vector layer",tabs:[new LayerGeneralTab,new LayerStyleTab,new LayerLabelTab],activeTabIndex:0,onapply:function(e){p.getSource().set("initFeatures",t),a.map.addLayer(p)},helpLink:"/help#newOSMLayer"}).show()},MapContainer.prototype.addNewOSMXML=function(){var r=this,s=new DlgOSMFilter(this,{filterArray:app.osmFilterArray},{title:"Filter OSM data",onapply:function(e,t){var a=t.filterArray;app.osmFilterArray=a;for(var i="",o=0;a&&o<a.length;o++){var n=a[o];n.tag?n.operator&&"eq"!==n.operator||(i+='["'+n.key+'"="'+n.tag+'"]'):i+='["'+n.key+'"]'}if(i)s.close(),r.addNewOSMXML_filter(i);else{(new ConfirmDialog).show("No filter is defined. Are you sure you want to continue?",function(e){e&&(s.close(),r.addNewOSMXML_filter(i))},{dialogSize:"m",alertType:"danger"})}}}).show()},MapContainer.prototype.addNewOSMXML_filter=function(n){n||(n="");var r=this,s=(this.map.getView(),this.getCurrentGeoExtentArray()),e="("+s[1]+","+s[0]+","+s[3]+","+s[2]+")",t="[out:json];(node"+n+e+";";t+="way"+n+e+";",t+="rel"+n+e+";",t+=");(._; >;);out count;";var l=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Retrieving data from OSM services...'},{z_index:5e4,type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax({url:app.overpassApiServer,type:"POST",data:t,processData:!1,dataType:"json",timeout:app.OSM_REQUEST_TIMEOUT,contentType:"application/json; charset=utf-8"}).done(function(e){if(e&&e.elements&&e.elements.length){var t=e.elements[0].tags,a=function(){l.close(),r.addNewOSMXML_downloadData(n,s)};if(t.total){var i=parseInt(t.total);if(i<=app.OSM_FEATURE_COUNT_LIMIT1)a();else if(i>app.OSM_FEATURE_COUNT_LIMIT1&&i<app.OSM_FEATURE_COUNT_LIMIT2){var o="There are too many features ("+i+') to be downloaded.</br><span class="text-info"> Please try for a smaller map extent or define more restricted filter or confrim to continue</span><br/><b class="text-info">Continue?</b>';confirmDialog.show(o,function(e){e&&a()},{dialogSize:"m",alertType:"danger"})}else!1,$.notify({message:"There are too many features ("+i+') to be downloaded.</br><b><span class="text-info"> Please try for a smaller map extent or define more restricted filter!</span></b>'},{z_index:5e4,type:"danger",delay:1e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}}else $.notify({message:errorThrown+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});l.close()}).fail(function(e,t,a){"timeout"==t?$.notify({message:'Requet Timeout</br><b><span class="text-info"> Please try for a smaller map extent or define more restricted filter!</span></b>'},{z_index:5e4,type:"danger",delay:1e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}):$.notify({message:a+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),l.close()})},MapContainer.prototype.addNewOSMXML_downloadData=function(m,g){var y=this,v=this.map.getView();m||(m="");var e="("+g[1]+","+g[0]+","+g[3]+","+g[2]+")",t="(node"+m+e+";";t+="way"+m+e+";",t+="rel"+m+e+";",t+=");(._; >;);out body;";var b=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Downloading OSM Data...'},{z_index:5e4,type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax({url:app.overpassApiServer,type:"POST",data:t,processData:!1,dataType:"xml",contentType:"text/xml"}).done(function(e,t,a){if(e){var i=(new ol.format.OSMXML).readFeatures(e,{featureProjection:v.getProjection()}),o={filterExpression:m,epsg4326Extent:g,Point:{count:0,tags:{},fields:[]},MultiLineString:{count:0,tags:{},fields:[]},MultiPolygon:{count:0,tags:{},fields:[]}};if(i&&i.length)for(var n=0;n<i.length;n++){var r=i[n],s=void 0,l=r.getGeometry();if(l){var c=l.getType();if("Point"==c?s="Point":"LineString"==c||"MultiLineString"==c?s="MultiLineString":"Polygon"!=c&&"MultiPolygon"!=c||(s="MultiPolygon"),s){o[s].count+=1;var d=r.getProperties();for(var p in d)d.hasOwnProperty(p)&&"geometry"!==p&&(void 0===o[s].tags[p]&&(o[s].tags[p]={count:0,length:8}),o[s].tags[p].count+=1,o[s].tags[p].length=Math.max(o[s].tags[p].length,(d[p]+"").length))}}}for(var s in o){var u=[],h=o[s].tags;for(var p in h)if(h.hasOwnProperty(p)){var f=h[p];f.name=p,u.push(f)}u.sort(function(e,t){var a=t.count-e.count;if(0==a){var i=e.name.toLowerCase(),o=t.name.toLowerCase();if(i<o)return-1;if(o<i)return 1}return a}),o[s].tags=u}y.addNewOSMXML_SelectShapeType(o,i)}else $.notify({message:errorThrown+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});b.close()}).fail(function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),b.close()})},MapContainer.prototype.addNewOSMXML_SelectShapeType=function(e,a){var i=this;new DlgOSMShapeTypeSelection(this,e,{title:"Select shape type",onapply:function(e,t){i.addNewOSMXML_SelectTags({shapeType:t.shapeType,info:t.info},a)}}).show()},MapContainer.prototype.addNewOSMXML_SelectTags=function(a,i){var o=this,e=(a=a||{}).shapeType||"Point";if(a.info&&a.info[e]&&a.info[e].tags){var n=a.info[e];new DlgOSMTagSelection(this,a.info[e].tags,{title:"Select Tags",onapply:function(e,t){t.selectedTags&&(n.selectedTags=t.selectedTags),o.addNewOSMXML_withOptions(a,i)}}).show()}},MapContainer.prototype.addGeoJSON=function(){var a=this;new DlgAddGeoJSON(this,null,{title:"Add GeoJSON",onapply:function(e,t){a.addGeoJSON_data(t)}}).show()},MapContainer.prototype.addGeoJSON_data=function(e){var t,a=e.geojson,i=e.layerName,o=e.featureProjection||"EPSG:4326",n=new ol.format.GeoJSON({featureProjection:o,dataProjection:"EPSG:4326"});try{t=n.readFeatures(a)}catch(e){try{var r=JSON.parse(a);t=n.readFeatures(r)}catch(e){}}if(t){var s={Point:{shapeType:"Point",count:0,tags:{},fields:[]},MultiLineString:{shapeType:"MultiLineString",count:0,tags:{},fields:[]},MultiPolygon:{shapeType:"MultiPolygon",count:0,tags:{},fields:[]}};if(t&&t.length)for(var l=0;l<t.length;l++){var c=void 0;if(_=(b=t[l]).getGeometry())if("Point"==(w=_.getType())?c="Point":"LineString"==w||"MultiLineString"==w?c="MultiLineString":"Polygon"!=w&&"MultiPolygon"!=w||(c="MultiPolygon"),c){s[c].count+=1;var d=b.getProperties();for(var p in d){var u=d[p];"object"==typeof u&&null!=u||d.hasOwnProperty(p)&&"geometry"!==p&&(void 0===s[c].tags[p]&&(s[c].tags[p]={count:0,length:8}),s[c].tags[p].count+=1,s[c].tags[p].length=Math.max(s[c].tags[p].length,(d[p]+"").length))}}}var h=s.Point;for(var c in s){var f=[],m=s[c].tags;for(var p in s[c].count>h.count&&(h=s[c]),m)if(m.hasOwnProperty(p)){var g=m[p];g.name=p,f.push(g)}s[c].tags=f}var y=[],v=h.shapeType;for(l=0;l<t.length;l++){var b,_,w;if(_=(b=t[l]).getGeometry())"Point"==(w=_.getType())?w="Point":"LineString"==w||"MultiLineString"==w?w="MultiLineString":"Polygon"!=w&&"MultiPolygon"!=w||(w="MultiPolygon"),v==w&&y.push(b)}this.addGeoJSON_createDataLayer(i,h,y,o)}else $.notify({message:"Failed to parse GeoJSON text"},{z_index:3e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},MapContainer.prototype.addGeoJSON_createDataLayer=function(e,t,a,i){var o=this,n=(i=i||"EPSG:4326",t.shapeType||"Point"),r=[];if(t.tags)for(var s=0;s<t.tags.length;s++){var l=t.tags[s];l.name&&r.push({name:l.name,alias:l.name,type:"varchar",length:l.length||8})}var c=e,d=new ol.format.GeoJSON({featureProjection:i,dataProjection:"EPSG:4326"}).writeFeatures(a),p=new Blob([d],{type:"text/json;charset=utf-8"}),u={shapeType:n,fields:r};u.fileName=c,u.spatialReference={name:"EPSG:4326",srid:4326};var h=new FormData;h.append("file",p,"geojson.json"),h.append("layerInfo",JSON.stringify(u));var f=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> importing features to new data layer...'},{z_index:5e4,type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax({url:"/datalayer/createfromgeojson",type:"POST",data:h,processData:!1,contentType:!1}).done(function(e){if(e&&e.id){$.notify({message:"New data layer is generated"},{z_index:5e4,type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});var t="/datalayer/"+e.id+"/info";$.ajax(t,{type:"GET",dataType:"json",success:function(e){e&&o.addData(e)}})}f.close()}).fail(function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),f.close()})},MapContainer.prototype.refreshLegend=function(e){var t=this;void 0===e&&(e=100),this._last_refreshLegend_call&&clearTimeout(this._last_refreshLegend_call),this._last_refreshLegend_call=setTimeout(function(){t.refreshLegend_immediate()},e)},MapContainer.prototype.refreshLegend_immediate=function(){var e=this.legend;if(e._rows=[],e.refresh(),e.getVisible()){for(var t=this.getAllLayersList(),a=t.length-1;0<=a;a--){var i=t[a];if(LayerHelper.isLayerVisible(i,!0)){var o=i.get("custom");o&&o.displayInLegend&&("ol.layer.Vector"===o.type?this.refreshLegend_addVectorLayer(i):"ol.layer.Image"===o.type&&"ol.source.GeoImage"===o.source&&this.refreshLegend_addRasterLayer(i))}}e.refresh()}},MapContainer.prototype.refreshLegend_addVectorLayer_=function(e){var t=this.legend,a=LayerHelper.getShapeType(e),i=LayerHelper.getRenderer(e);if(i){var o=i.getDefaultStyle();"MultiPolygon"==a&&(a="Polygon"),"MultiLineString"==a&&(a="LineString");var n=StyleFactory.cloneStyle(o);if(t.addRow({title:e.get("title"),typeGeom:a,style:n,data:{layer:e,style:n}}),"uniqueValueRenderer"==i.name){var r=i.getUniqueValueInfos(),s=0;for(var l in t.addRow({title:i.field,style:void 0,leftOffset:10,data:{layer:e}}),r){if(100<s)break;var c=r[l];n=StyleFactory.cloneStyle(c.style);t.addRow({title:c.label||c.value,typeGeom:a,style:n,leftOffset:10,data:{layer:e,style:c.style}}),s++}}else if("rangeValueRenderer"==i.name){r=i.getRangeValueInfos();t.addRow({title:i.field,style:void 0,leftOffset:10,data:{layer:e}});for(s=0;s<r.length;s++){var d=(c=r[s]).minValue||"",p=c.maxValue||"",u=d+" - "+p;0!=s||d||(u="< "+p),s!=r.length-1||p||(u=">= "+d);n=StyleFactory.cloneStyle(c.style);t.addRow({title:u,typeGeom:a,style:n,leftOffset:10,data:{layer:e,style:c.style}})}}}},MapContainer.prototype.refreshLegend_addRasterLayer_=function(e){var t=this.legend,a=LayerHelper.getDatasetId(e);if(a){var i=LayerHelper.getDetails(e).display,o=!1,n=void 0;if(i&&"colorMap"==i.displayType&&"custom"==i.colorMap&&i.customColorMap&&i.customColorMap.length&&(o=!0,n=i.customColorMap),t.addRow({title:e.get("title"),imgSrc:"/datalayer/"+a+"/thumbnail",data:{layer:e,imgSrc:"/datalayer/"+a+"/thumbnail"}}),o&&n)for(var r=0;r<n.length&&r<50;r++){var s=n[r],l=s.caption;void 0!==l&&""!==l||(l=s.value);var c="rgba("+s.r+","+s.g+","+s.b+","+(s.a/255).toFixed(2)+")",d=new ol.style.Fill({color:c}),p=new ol.style.Stroke({color:c,width:1}),u=new ol.style.Style({fill:d,stroke:p});t.addRow({title:l,typeGeom:"Polygon",style:u,leftOffset:10,data:{layer:e,style:u}})}}},MapContainer.prototype.refreshLegend_addVectorLayer=function(e){var t=this.legend,a=LayerHelper.getShapeType(e),i=LayerHelper.getRenderer(e);if(i){var o=i.getDefaultStyle();"MultiPolygon"==a&&(a="Polygon"),"MultiLineString"==a&&(a="LineString");var n=StyleFactory.cloneStyle(o);if(t.addRow({title:e.get("title"),typeGeom:a,style:n,data:{layer:e,style:n}}),"uniqueValueRenderer"==i.name){var r=i.getUniqueValueInfos(),s=0;for(var l in t.addRow({title:i.field,style:void 0,leftOffset:10,data:{layer:e}}),r){if(100<s)break;var c=r[l];n=StyleFactory.cloneStyle(c.style);t.addRow({title:c.label||c.value,typeGeom:a,style:n,leftOffset:10,data:{layer:e,style:c.style}}),s++}}else if("rangeValueRenderer"==i.name){r=i.getRangeValueInfos();t.addRow({title:i.field,style:void 0,leftOffset:10,data:{layer:e}});for(s=0;s<r.length;s++){var d=(c=r[s]).minValue||"",p=c.maxValue||"",u=d+" - "+p;0!=s||d||(u="< "+p),s!=r.length-1||p||(u=">= "+d);n=StyleFactory.cloneStyle(c.style);t.addRow({title:u,typeGeom:a,style:n,leftOffset:10,data:{layer:e,style:c.style}})}}}},MapContainer.prototype.refreshLegend_addRasterLayer=function(e){var t=this.legend,a=LayerHelper.getDatasetId(e);if(a){var i=LayerHelper.getDetails(e).display,o=!1,n=void 0;if(i&&"colorMap"==i.displayType&&"custom"==i.colorMap&&i.customColorMap&&i.customColorMap.length&&(o=!0,n=i.customColorMap),t.addRow({title:e.get("title"),imgSrc:"/datalayer/"+a+"/thumbnail",data:{layer:e,imgSrc:"/datalayer/"+a+"/thumbnail"}}),o&&n)for(var r=0;r<n.length&&r<50;r++){var s=n[r],l=s.caption;void 0!==l&&""!==l||(l=s.value);var c="rgba("+s.r+","+s.g+","+s.b+","+(s.a/255).toFixed(2)+")",d=new ol.style.Fill({color:c}),p=new ol.style.Stroke({color:c,width:1}),u=new ol.style.Style({fill:d,stroke:p});t.addRow({title:l,typeGeom:"Polygon",style:u,leftOffset:10,data:{layer:e,style:u}})}}},MapContainer.prototype.duplicateLayer=function(e,t){if(e){t=t||{};var a,i,o=this,n=this.map.getView().getProjection().getCode(),r=LayerHelper.getDetails(e);r.spatialReference&&r.spatialReference.srid&&(a=r.spatialReference.srid),r.spatialReference&&(r.spatialReference.name||r.spatialReference.srid)&&(a=r.spatialReference.srid,r.spatialReference.name?(i=r.spatialReference.name,!a&&i&&i.indexOf(":")&&(a=i.split(":")[1])):i="EPSG:"+a,r.spatialReference.proj4&&!proj4.defs[i]&&(proj4.defs(i,r.spatialReference.proj4),ol.proj.proj4.register(proj4)));var s,l=t.srid||a||3857,c=e.getSource().getFeatures(),d=LayerHelper.getVectorLayerSelectTask(e);t.exportSelectionIfAny&&d&&(s=d.interactionSelect.getFeatures()).getLength()&&(c=s.getArray());var p=e.get("title")||r.shapefileName||r.tableName,u=new ol.format.GeoJSON({featureProjection:n,dataProjection:i||"EPSG:"+l}).writeFeatures(c),h=new Blob([u],{type:"text/json;charset=utf-8"}),f=JSON.parse(JSON.stringify(r));f.workspace="postgres",delete f.filter,delete f.datasetName,delete f.params,delete f.url,f.fileName=t.newName||p+"-Copy",f.spatialReference={name:i||"EPSG:"+l,srid:i?a:l,proj4:i?r.spatialReference.proj4:null},f.spatialReference.srid||(f.spatialReference.srid=0);var m=new FormData;m.append("file",h,"geojson.json"),m.append("layerInfo",JSON.stringify(f));var g=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Copying features to new data layer...'},{z_index:5e4,type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax({url:"/datalayer/createfromgeojson",type:"POST",data:m,processData:!1,contentType:!1}).done(function(e){if(e&&e.id){$.notify({message:"New data layer is generated"},{z_index:5e4,type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});var t="/datalayer/"+e.id+"/info";$.ajax(t,{type:"GET",dataType:"json",success:function(e){e&&o.addData(e)}})}g.close()}).fail(function(e,t,a){var i=a;e.responseJSON&&e.responseJSON.error&&(i=e.responseJSON.error),$.notify({message:i+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),g.close()})}},MapContainer.prototype.downloadDataFromWCS=function(){new DlgWCS(this,null,{title:"Download from WCS",onapply:function(e,t){}}).show()},MapContainer.prototype.showTopStatus=function(e,t,a,i){var o=this;this.topStatus&&(this._topStatusTimeoutHandler&&(clearTimeout(this._topStatusTimeoutHandler),this._topStatusTimeoutHandler=null),this._StatusTipElement&&($(this._StatusTipElement).removeClass("active-tip"),this._StatusTipElement=null),this._StatusTipElement=a,this._StatusTipElement&&$(this._StatusTipElement).addClass("active-tip"),this.topStatus.status(e),t&&(this._topStatusTimeoutHandler=setTimeout(function(){o._StatusTipElement&&$(o._StatusTipElement).removeClass("active-tip"),o.topStatus.hide(),i&&i()},t)))},MapContainer.prototype.hideTopStatus=function(){this.topStatus&&this.topStatus.hide()},LayerGeneralTab.TabId="tabGeneral",LayerGeneralTab.prototype.init=function(e){this.parentDialog=e},LayerGeneralTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},LayerGeneralTab.prototype.applied=function(e){return!0},LayerGeneralTab.prototype.create=function(e,t){var n=this,a=((this.layer=e).get("custom"),"");t&&(a="active");var r=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-cog"></i> General</a>  </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var i="";i+="<div>",i+='<form id="'+n.tabId+'_form" class="modal-body form-horizontal">',i+='  <div class="form-group">',i+='    <label class="" for="name1">Name</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#layerProperties_general">?</a>',i+='    <input type="text" name="name1" id="name1" value="" placeholder="Name" class="form-control" data-val="true" data-val-required="Layer name is required" />',i+='    <span class="field-validation-valid" data-valmsg-for="name1" data-valmsg-replace="true"></span>',i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="opacity">Opacity</label>',i+='    <input type="range" min="0" max="100" value="" name="opacity" id="opacity"  />',i+="  </div>",i+="",i+="",i+="",i+="",i+="</form></div>";var o=this.layer.getOpacity(),s=$(i).appendTo(this.tab);s.find("#name1").val(this.layer.get("title")),s.find("input[type=range]").on("input",function(){$(this).trigger("change")}),s.find("#opacity").val(100*o),s.find("#opacity").attr("title",100*o+"%"),s.find("#opacity").change(function(e){n.layer.setOpacity($(this).val()/100),$(this).attr("title",$(this).val()+"%")});var l=$(s.find("#"+n.tabId+"_form"));l.on("submit",function(e){e.preventDefault()}),this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(l),$.validator.setDefaults({ignore:t}),l.validate(),l.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=l.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){n.layer.setOpacity(o)}),this.parentDialog.applyHandlers.push(function(e){n.layer.set("title",s.find("#name1").val()),n.layer.setOpacity(s.find("#opacity").val()/100)})},LayerStyleTab.prototype.init=function(e){this.parentDialog=e},LayerStyleTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},LayerStyleTab.prototype.applied=function(e){return!(!e||!e.get("custom")||"ol.layer.Vector"!=e.get("custom").type)},LayerStyleTab.prototype.create=function(e,t){this.layer=e;var n=this,a="";t&&(a="active");this.parentDialog.mapContainer;var i,o,r,s,l=LayerHelper.getRenderer(this.layer),c=this.layer.get("custom");c&&c.dataObj&&c.format,c&&c.dataObj&&c.format,(i=l&&l.clone?l.clone():l)||(i=RendererFactory.createSimpleRenderer());var d=i.getDefaultStyle();"simpleRenderer"==i.name?o=i:(o=RendererFactory.createSimpleRenderer()).setDefaultStyle(d),"uniqueValueRenderer"==i.name?r=i:(r=RendererFactory.createUniqueValueRenderer()).setDefaultStyle(d),"rangeValueRenderer"==i.name?s=i:(s=RendererFactory.createRangeValueRenderer()).setDefaultStyle(d);LayerHelper.getShapeType(this.layer);var p=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-paint-brush"></i> Style</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var u='<div><form id="'+n.tabId+'_form" class="modal-body form-horizontal">';u+='<div class="form-group">',u+='  <label class="col-sm-offset-1_ col-sm-12 checkbox">',u+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#layerProperties_style">?</a>',u+='   <input type="checkbox" id="displayInLegend" name="displayInLegend" '+(LayerHelper.getDisplayInLegend(this.layer)?'checked="checked"':"")+' value="" /> Show in legend',u+="</label>",u+="</div>",u+='<div class="form-group">',u+='  <label class="col-sm-3" for="rendererType">Display type:</label>',u+='    <select class="form-control " id="rendererType" >',u+='                          <option value="simpleRenderer" '+("simpleRenderer"==i.name?'selected="selected"':"")+" >Simple</option>",u+='                          <option value="uniqueValueRenderer" '+("uniqueValueRenderer"==i.name?'selected="selected"':"")+">Unique values</option>",u+='                          <option value="rangeValueRenderer" '+("rangeValueRenderer"==i.name?'selected="selected"':"")+">Range values</option>",u+="    </select>",u+=" </div>",u+='    <div id="rendererContent" class="panel-body">',u+="    </div>",u+="",u+="",u+="</form></div>";var h=$(u).appendTo(this.tab);n.rendererContent=h.find("#rendererContent"),n.renderer=i,h.find("#rendererType").change(function(){var e=$(this).val();"simpleRenderer"==e?n.renderer=o:"uniqueValueRenderer"==e?n.renderer=r:"rangeValueRenderer"==e&&(n.renderer=s),n.populateRendererPanel()}),n.populateRendererPanel();var f=$(h.find("#"+n.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(f),$.validator.setDefaults({ignore:t}),f.validate(),f.valid())p.find("a").removeClass("text-danger");else{e.cancel=!0,p.find("a").addClass("text-danger"),n.activate();var a=f.find(".input-validation-error").first();if(a){var i=a.offset().top,o=p.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.applyHandlers.push(function(e){n.renderer&&LayerHelper.setRenderer(n.layer,n.renderer),LayerHelper.setDisplayInLegend(n.layer,h.find("#displayInLegend").prop("checked"))})},LayerStyleTab.prototype.populateRendererPanel=function(){this.renderer&&("simpleRenderer"==this.renderer.name?this.populateSimpleRenderer():"uniqueValueRenderer"==this.renderer.name?this.populateUniqueValueRenderer():"rangeValueRenderer"==this.renderer.name&&this.populateRangeRenderer())},LayerStyleTab.prototype.populateSimpleRenderer=function(){if(this.renderer){var i=this,o=LayerHelper.getShapeType(this.layer);this.rendererContent.html(""),this.rendererContent.html("");'<div class="form-group row">','  <label class="col-sm-3">Style:</label>','  <div class="col-sm-9 " id="renderer_defaultStyle" ></div>'," </div>",this.rendererContent.html('<div class="form-group row">  <label class="col-sm-3">Style:</label>  <div class="col-sm-9 " id="renderer_defaultStyle" ></div> </div>'),this.rendererContent.find("#testStyle").click(function(){var e=new ol.style.Style({image:new ol.style.FontSymbol({form:"",gradient:!1,glyph:"fa-plane",fontSize:1,fontStyle:"",radius:15,offsetX:0,offsetY:0,rotation:0,rotateWithView:!1,color:"blue",fill:new ol.style.Fill({color:"white"}),stroke:new ol.style.Stroke({color:"yellow",width:2})}),stroke:new ol.style.Stroke({width:2,color:"#f80"}),fill:new ol.style.Fill({color:[255,136,0,.6]})}),t=StyleFactory.renderStyleSample(e,{width:80,height:40,type:o||"Polygon"});i.rendererContent.find("#renderer_defaultStyle").html(t),i.renderer.setDefaultStyle(e)});var e=StyleFactory.renderStyleSample(this.renderer.getDefaultStyle(),{width:80,height:40,type:o||"Polygon"});this.rendererContent.find("#renderer_defaultStyle").html(e),this.rendererContent.find("#renderer_defaultStyle").first().click(function(e){e.stopPropagation(),e.preventDefault();var a=$(this);new ObjectPropertiesDlg(i.parentDialog.mapContainer,i.renderer.getDefaultStyle(),{title:"Style",tabs:[new StyleImageTab,new StyleStrokeTab,new StyleFillTab],activeTabIndex:"Point"==o?0:"MultiPolygon"==o?2:1,onapply:function(e){var t=StyleFactory.renderStyleSample(i.renderer.getDefaultStyle(),{width:80,height:40,type:o||"Polygon"});a.html(t)},helpLink:"/help#style"}).show()})}},LayerStyleTab.prototype.populateUniqueValueRenderer=function(){var h=this;if(this.renderer){var f=this.layer.get("custom").dataObj.details.fields;if(f){var m=LayerHelper.getShapeType(this.layer);this.rendererContent.html("");var e="";e+='<div class="form-group">',e+='  <label class="col-sm-3" for="renderer_field">Field name:</label>',e+='    <select class="form-control " id="renderer_field" >';for(var t=0;t<f.length;t++){var a=f[t];if("bytea"!==a.type&&"nill"!==a.type){var i=a.name,o=a.alias||i;e+=' <option value="'+i+'" '+(a.name===this.renderer.getField()?'selected="selected"':"")+" >"+o+"</option>"}}e+="    </select>",e+=" </div>",e+='<div class="form-group">',e+='<button id="cmdAddAllUniqueValues" type="button" class="btn btn-primary btn-success">Add all values</button>',e+="</div>",e+='<div class="form-group row">',e+='  <label class="col-sm-3">Default style:</label>',e+='  <div class="col-sm-9 " id="renderer_defaultStyle" ></div>',e+=" </div>",e+='<div class="table-responsive col-sm-12">',e+=' <table class="table table-condensed"><thead><tr>',e+=" <th>Value</th>",e+=' <th class="">Style</th>',e+=" <th></th>",e+=" </tr></thead>",e+=' <tbody id="tblItems">';var n=this.renderer.getUniqueValueInfos();t=0;for(var r in n){e+="<tr>",e+="<td>"+(l=n[r]).label||l.value+"</td>",e+='<td id="item_'+t+'"></td>',e+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t" id="delete_'+t+'" data-key="'+r+'"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',e+="</tr>",t++}e+=" </tbody>",e+=" </table>",e=DOMPurify.sanitize(e,{SAFE_FOR_JQUERY:!0}),this.rendererContent.html(e);var s=StyleFactory.renderStyleSample(this.renderer.getDefaultStyle(),{width:80,height:40,type:m||"Polygon"});this.rendererContent.find("#renderer_defaultStyle").append(s),this.rendererContent.find("#renderer_defaultStyle").first().click(function(e){e.stopPropagation(),e.preventDefault();var a=$(this);new ObjectPropertiesDlg(h.parentDialog.mapContainer,h.renderer.getDefaultStyle(),{title:"Style",tabs:[new StyleImageTab,new StyleStrokeTab,new StyleFillTab],activeTabIndex:"Point"==m?0:"MultiPolygon"==m?2:1,onapply:function(e){var t=StyleFactory.renderStyleSample(h.renderer.getDefaultStyle(),{width:80,height:40,type:m||"Polygon"});a.html(t)},helpLink:"/help#style"}).show()});t=0;for(var r in n){var l=n[r],c=StyleFactory.renderStyleSample(l.style,{width:80,height:40,type:m||"Polygon"});this.rendererContent.find("#item_"+t).first().data("_rendererItem",l),this.rendererContent.find("#item_"+t).first().click(function(e){e.stopPropagation(),e.preventDefault();var a=$(this).data("_rendererItem"),i=$(this);new ObjectPropertiesDlg(h.parentDialog.mapContainer,a.style,{title:"Style",tabs:[new StyleImageTab,new StyleStrokeTab,new StyleFillTab],activeTabIndex:"Point"==m?0:"MultiPolygon"==m?2:1,onapply:function(e){var t=StyleFactory.renderStyleSample(a.style,{width:80,height:40,type:m||"Polygon"});i.html(t)},helpLink:"/help#editing_style"}).show()}),this.rendererContent.find("#item_"+t).html(c),this.rendererContent.find("#delete_"+t).click(function(e){e.stopPropagation(),e.preventDefault();var t=$(this).data("key");try{delete n[t],h.populateUniqueValueRenderer()}catch(e){}}),t++}this.rendererContent.find("#cmdAddAllUniqueValues").click(function(){for(var e=h.renderer.getDefaultStyle(),t=h.rendererContent.find("#renderer_field").val(),a=h.layer.getSource().getFeatures(),i={},o={},n=[],r=0;f&&r<f.length;r++){var s=(d=f[r]).name;d.alias;if((i[s]=d).domain&&"codedValues"==d.domain.type&&d.domain.items){for(var l={},c=0;c<d.domain.items.length;c++)l[d.domain.items[c].code]=d.domain.items[c].value;d.codedValues=l}}var d;if((d=i[t])&&d.domain&&"codedValues"==d.domain.type&&d.domain.items)for(c=0;c<d.domain.items.length;c++)n.push({label:d.domain.items[c].value,value:d.domain.items[c].code});else{for(r=0;r<a.length;r++){var p=a[r].get(t);o[p+""]={label:p+"",value:p+""}}for(var u in o)n.push(o[u])}n=n.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),h.renderer.setField(t),h.renderer.ClearAllValues();for(r=0;r<n.length;r++)"Polygon"==m||"MultiPolygon"==m?h.renderer.addValue(n[r].value,n[r].label+"",StyleFactory.randomStyle({randomStrokeColor:!1,strokeColor:e.getStroke().getColor(),strokeWidth:e.getStroke().getWidth()})):h.renderer.addValue(n[r].value,n[r].label+"",StyleFactory.randomStyle({randomStrokeColor:!0,strokeWidth:e.getStroke().getWidth()}));h.populateRendererPanel()})}}},LayerStyleTab.prototype.populateRangeRenderer=function(){var d=this;if(this.renderer){var e=this.layer.get("custom").dataObj.details.fields;if(e){var p=LayerHelper.getShapeType(this.layer);this.rendererContent.html("");var t="";t+='<div class="form-group">',t+='  <label class="col-sm-3" for="renderer_field">Field name:</label>',t+='    <select class="form-control " id="renderer_field" >';for(var a=0;a<e.length;a++){var i=e[a];if("smallint"===i.type||"integer"===i.type||"bigint"===i.type||"numeric"===i.type||"real"===i.type||"double precision"===i.type||"date"===i.type||"timestamp with time zone"===i.type){var o=i.name,n=i.alias||o;t+=' <option value="'+o+'" '+(i.name===this.renderer.getField()?'selected="selected"':"")+" >"+n+"</option>"}}t+="    </select>",t+=" </div>",t+='<div class="form-group">',t+='<button id="cmdCreateRangevalue" type="button" class="btn btn-primary btn-success">Create range values</button>',t+="</div>",t+='<div class="form-group row">',t+='  <label class="col-sm-3">Default style:</label>',t+='  <div class="col-sm-9 " id="renderer_defaultStyle" ></div>',t+=" </div>",t+='<div class="table-responsive col-sm-12">',t+=' <table class="table table-condensed"><thead><tr>',t+=" <th>From</th>",t+=" <th>To</th>",t+=' <th class="">Style</th>',t+=" <th></th>",t+=" </tr></thead>",t+=' <tbody id="tblItems">';var r=this.renderer.getRangeValueInfos();for(a=0;a<r.length;a++){var s=(u=r[a]).minValue,l=u.maxValue;t+="<tr>",t+="<td>",void 0!==s&&(t+='<input id="rvr_fromvalue'+a+'" name="rvr_fromvalue'+a+'" data-index="'+a+'" type="number" class="form-control nospinner" value="'+s+'"   data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rvr_fromvalue'+a+'" data-valmsg-replace="true"></span>'),t+="</td>",t+="<td>",void 0!==l&&(t+='<input id="rvr_tovalue'+a+'" name="rvr_tovalue'+a+'" data-index="'+a+'" type="number" class="form-control nospinner" value="'+l+'"   data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rvr_tovalue'+a+'" data-valmsg-replace="true"></span>'),t+="</td>",t+='<td id="item_'+a+'"></td>',t+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t" id="delete_'+a+'" data-index="'+a+'"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',t+="</tr>"}t+=" </tbody>",t+=" </table>",t=DOMPurify.sanitize(t,{SAFE_FOR_JQUERY:!0}),this.rendererContent.html(t);var c=StyleFactory.renderStyleSample(this.renderer.getDefaultStyle(),{width:80,height:40,type:p||"Polygon"});this.rendererContent.find("#renderer_defaultStyle").append(c),this.rendererContent.find("#renderer_defaultStyle").first().click(function(e){e.stopPropagation(),e.preventDefault();var a=$(this);new ObjectPropertiesDlg(d.parentDialog.mapContainer,d.renderer.getDefaultStyle(),{title:"Style",tabs:[new StyleImageTab,new StyleStrokeTab,new StyleFillTab],activeTabIndex:"Point"==p?0:"MultiPolygon"==p?2:1,onapply:function(e){var t=StyleFactory.renderStyleSample(d.renderer.getDefaultStyle(),{width:80,height:40,type:p||"Polygon"});a.html(t)},helpLink:"/help#style"}).show()});for(a=0;a<r.length;a++){var u=r[a],h=StyleFactory.renderStyleSample(u.style,{width:80,height:40,type:p||"Polygon"});this.rendererContent.find("#item_"+a).html(h),this.rendererContent.find("#item_"+a).first().data("_rendererItem",u),this.rendererContent.find("#item_"+a).first().click(function(e){e.stopPropagation(),e.preventDefault();var a=$(this).data("_rendererItem"),i=$(this);new ObjectPropertiesDlg(d.parentDialog.mapContainer,a.style,{title:"Style",tabs:[new StyleImageTab,new StyleStrokeTab,new StyleFillTab],activeTabIndex:"Point"==p?0:"MultiPolygon"==p?2:1,onapply:function(e){var t=StyleFactory.renderStyleSample(a.style,{width:80,height:40,type:p||"Polygon"});i.html(t)},helpLink:"/help#style"}).show()}),this.rendererContent.find("#delete_"+a).click(function(e){e.stopPropagation(),e.preventDefault();try{var t=$(this).data("index");r.splice(t,1),d.populateRangeRenderer()}catch(e){}}),this.rendererContent.find("#rvr_fromvalue"+a).change(function(e){e.stopPropagation(),e.preventDefault();try{var t=$(this).data("index");r[t].minValue=parseFloat($(this).val()),d.populateRangeRenderer()}catch(e){}}),this.rendererContent.find("#rvr_tovalue"+a).change(function(e){e.stopPropagation(),e.preventDefault();try{var t=$(this).data("index");r[t].maxValue=parseFloat($(this).val()),d.populateRangeRenderer()}catch(e){}})}this.rendererContent.find("#cmdCreateRangevalue").click(function(){for(var s=d.renderer.getDefaultStyle(),l=d.rendererContent.find("#renderer_field").val(),e=d.layer.getSource().getFeatures(),t={},a=0;a<e.length;a++){var i=e[a].get(l);t[i+""]=i}var c=[];for(var o in t)c.push(t[o]);c=c.sort(function(e,t){return t<e?1:e<t?-1:0}),BootstrapDialog.show({title:"Number of ranges",size:BootstrapDialog.SIZE_SMALL,message:'Input number of ranges: <input type="number" min="1" class="form-control">',onshow:function(e){window.location.hash="inputNumberOfRanges",window.onhashchange=function(){location.hash||e.close()}},onhide:function(e){history.pushState("",document.title,window.location.pathname+window.location.search)},buttons:[{label:"OK",cssClass:"btn-primary",action:function(e){e.close();var t=e.getModalBody().find("input").val();t=parseInt(t),d.renderer.setField(l),d.renderer.ClearAllValues();for(var a=c.length/t,i=void 0,o=void 0,n=0;0<a&&n<c.length;n+=a){var r=Math.floor(n);0!=r&&(i=o,o=c[r],"Polygon"==p||"MultiPolygon"==p?d.renderer.addValue(i,o,"",StyleFactory.randomStyle({randomStrokeColor:!1,strokeColor:s.getStroke().getColor(),strokeWidth:s.getStroke().getWidth()})):d.renderer.addValue(i,o,"",StyleFactory.randomStyle({randomStrokeColor:!0,strokeWidth:s.getStroke().getWidth()})),n+a>=c.length&&(i=o,o=void 0,"Polygon"==p||"MultiPolygon"==p?d.renderer.addValue(i,o,"",StyleFactory.randomStyle({randomStrokeColor:!1,strokeColor:s.getStroke().getColor(),strokeWidth:s.getStroke().getWidth()})):d.renderer.addValue(i,o,"",StyleFactory.randomStyle({randomStrokeColor:!0,strokeWidth:s.getStroke().getWidth()}))))}d.populateRendererPanel()}},{label:"Cancel",action:function(e){e.close()}}]})})}}},LayerLabelTab.prototype.init=function(e){this.parentDialog=e},LayerLabelTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},LayerLabelTab.prototype.applied=function(e){return!(!e||!e.get("custom")||"ol.layer.Vector"!=e.get("custom").type)},LayerLabelTab.prototype.create=function(e,t){this.layer=e;var n=this,a="";t&&(a="active");this.parentDialog.mapContainer;var i,o=LayerHelper.getFeatureLabeler(this.layer);(s=this.layer.get("custom"))&&s.dataObj&&s.format,s&&s.dataObj&&s.format;var r=LayerHelper.getShapeType(this.layer);(i=o&&o.clone?o.clone():o)||((i=new FeatureLabeler).disabled=!0,"MultiLineString"===r&&(i.placement="line"));var s,l=(s=this.layer.get("custom")).dataObj.details.fields;l||(l=[]);var c=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i style="    font-size: 0.7em; color: #9e92dc;" class="glyphicon glyphicon-text-size"></i> Label</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var d='<div><form id="'+n.tabId+'_form" class="modal-body form-horizontal">';d+='<div class="form-group">',d+='  <label class="col-sm-offset-1_ col-sm-12 checkbox">',d+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#layerProperties_label">?</a>',d+='   <input type="checkbox" id="enabelLabeling" name="enabelLabeling" '+(i.disabled?"":'checked="checked"')+' value="" /> Label features',d+="</label>",d+="</div>",d+='<div class="form-group">',d+='  <label class="col-sm-3_" for="fieldName">Field name</label>',d+='    <select class="form-control " id="fieldName" >';for(var p=0;p<l.length;p++){var u=l[p];if("bytea"!==u.type&&"nill"!==u.type){var h=u.name,f=u.alias||h;d+=' <option value="'+h+'" '+(u.name===i.fieldName?'selected="selected"':"")+" >"+f+"</option>"}}d+="    </select>",d+=" </div>",d+='  <div class="form-group">',d+='    <label class="" for="color">Color</label>',d+='    <div id="colorPicker" class="input-group colorpicker-component">',d+='      <input type="text" value="" id="color" class="form-control" />',d+='      <span class="input-group-addon"><i></i></span>',d+="    </div>",d+="  </div>",d+='  <div class="form-group">',d+='    <label class="" for="size">Size</label>',d+='    <input type="range" min="0" max="60" value="" name="size" id="size"  />',d+="  </div>",d+='  <div class="form-group">',d+='    <label class="" for="outline">Outline Color</label>',d+='    <div id="outlinePicker" class="input-group colorpicker-component">',d+='      <input type="text" value="" id="outline" class="form-control" />',d+='      <span class="input-group-addon"><i></i></span>',d+="    </div>",d+="  </div>",d+='  <div class="form-group">',d+='    <label class="" for="outlineWidth">Outline width</label>',d+='    <input type="number" name="outlineWidth" id="outlineWidth" value="'+i.outlineWidth+'" placeholder="Border width" class="form-control" data-val="true" data-val-required="Outline width is required" data-val-range="Input a number  from 0 to 20" min="0" max="20" data-val-range-min="0" data-val-range-max="20" />',d+='    <span class="field-validation-valid" data-valmsg-for="outlineWidth" data-valmsg-replace="true"></span>',d+="  </div>",d+='  <div class="form-group">',d+='    <label class="" for="rotation">Rotation</label>',d+='    <input type="range" min="0" max="360" value="" name="rotation" id="rotation"  />',d+="  </div>",d+='<div class="form-group">',d+='  <label class="col-sm-3_" for="font">Font</label>',d+='    <select class="form-control " id="font" >',d+='                          <option value="Arial" '+("Arial"==i.font?'selected="selected"':"")+" >Arial</option>",d+='                          <option value="Tahoma" '+("Tahoma"==i.font?'selected="selected"':"")+" >Tahoma</option>",d+='                          <option value="serif" '+("serif"==i.font?'selected="selected"':"")+" >Serif</option>",d+="                          <option value=\"'Courier New'\" "+("'Courier New'"==i.baseline?'selected="selected"':"")+" >Courier New</option>",d+="                          <option value=\"'Open Sans'\" "+("'Open Sans'"==i.baseline?'selected="selected"':"")+" >Open Sans</option>",d+='                          <option value="Verdana" '+("Verdana"==i.baseline?'selected="selected"':"")+" >Verdana</option>",d+="    </select>",d+=" </div>",d+='<div class="form-group">',d+='  <label class="col-sm-3_" for="placement">Placement</label>',d+='    <select class="form-control " id="placement" >',d+='                          <option value="point" '+("point"==i.placement?'selected="selected"':"")+" >Point</option>",d+='                          <option value="line" '+("line"==i.placement?'selected="selected"':"")+" >Line</option>",d+="    </select>",d+=" </div>",d+='<div class="form-group">',d+='  <label class="col-sm-3_" for="overflow">Allow overflow</label>',d+='    <select class="form-control " id="overflow" >',d+='                          <option value="true" '+(i.overflow?'selected="selected"':"")+" >Yes</option>",d+='                          <option value="false" '+(i.overflow?"":'selected="selected"')+" >No</option>",d+="    </select>",d+=" </div>",d+='  <div class="form-group">',d+='    <label class="" for="offsetX">Offset X</label>',d+='    <input type="range" name="offsetX" id="offsetX" value="" placeholder="Offset X" class="form-control" min="-20" max="20"  />',d+="  </div>",d+='  <div class="form-group">',d+='    <label class="" for="offsetY">Offset Y</label>',d+='    <input type="range" name="offsetY" id="offsetY" value="" placeholder="Offset Y" class="form-control" min="-20" max="20"  />',d+="  </div>",d+="</form></div>",d=DOMPurify.sanitize(d,{SAFE_FOR_JQUERY:!0});var m=$(d).appendTo(this.tab);function g(){LayerHelper.setFeatureLabeler(n.layer,i),n.layer.changed()}m.find("input[type=range]").on("input",function(){$(this).trigger("change"),$(this).attr("title",$(this).val())}),m.find("#enabelLabeling").prop("checked",!i.disabled),m.find("#enabelLabeling").change(function(){var e=$(this).prop("checked");i.disabled=!e,g()}),m.find("#fieldName").val(i.fieldName),m.find("#fieldName").change(function(){var e=$(this).val();i.fieldName=e,g()}),m.find("#textType").val(i.type),m.find("#textType").change(function(){var e=$(this).val();i.type=e,g()}),m.find("#size").val(i.getSize()),m.find("#size").attr("title",i.getSize()),m.find("#size").change(function(){i.size=1*$(this).val()+"px",g()}),m.find("#colorPicker").colorpicker({color:i.color}).on("changeColor",function(e){i.color=e.color.toString(),g()}),m.find("#outlinePicker").colorpicker({color:i.outline}).on("changeColor",function(e){i.outline=e.color.toString(),g()}),m.find("#outlineWidth").val(i.outlineWidth),m.find("#outlineWidth").attr("title",i.outlineWidth),m.find("#outlineWidth").change(function(){i.outlineWidth=1*$(this).val(),g()}),m.find("#align").val(i.align),m.find("#align").change(function(){var e=$(this).val();i.align=e,g()}),m.find("#baseline").val(i.baseline),m.find("#baseline").change(function(){var e=$(this).val();i.baseline=e,g()});var y=180*i.rotation/Math.PI;m.find("#rotation").val(y),m.find("#rotation").attr("title",y),m.find("#rotation").change(function(){i.rotation=$(this).val()*Math.PI/180,g()}),m.find("#font").val(i.font),m.find("#font").change(function(){var e=$(this).val();i.font=e,g()}),m.find("#weight").val(i.weight),m.find("#weight").change(function(){var e=$(this).val();i.weight=e,g()}),m.find("#placement").val(i.placement),m.find("#placement").change(function(){var e=$(this).val();i.placement=e,g()});var v=180*i.maxangle/Math.PI;m.find("#maxangle").val(v),m.find("#maxangle").attr("title",v),m.find("#maxangle").change(function(){i.maxangle=$(this).val()*Math.PI/180,g()}),m.find("#overflow").val(i.overflow+""),m.find("#overflow").change(function(){var e=$(this).val();i.overflow="true"==e,g()}),m.find("#offsetX").val(i.offsetX),m.find("#offsetX").attr("title",i.offsetX),m.find("#offsetX").change(function(){i.offsetX=1*$(this).val(),g()}),m.find("#offsetY").val(i.offsetY),m.find("#offsetY").attr("title",i.offsetY),m.find("#offsetY").change(function(){i.offsetY=1*$(this).val(),g()});var b=$(m.find("#"+n.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(b),$.validator.setDefaults({ignore:t}),b.validate(),b.valid())c.find("a").removeClass("text-danger");else{e.cancel=!0,c.find("a").addClass("text-danger"),n.activate();var a=b.find(".input-validation-error").first();if(a){var i=a.offset().top,o=c.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.applyHandlers.push(function(e){i&&LayerHelper.setFeatureLabeler(n.layer,i)}),this.parentDialog.cancelHandlers.push(function(e){LayerHelper.setFeatureLabeler(n.layer,o),n.layer.changed()})},LayerSourceTab.prototype.init=function(e){this.parentDialog=e},LayerSourceTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},LayerSourceTab.prototype.applied=function(e){return!(!e||!e.get("custom")||"ol.layer.Vector"!=e.get("custom").type)||(!(!e||!e.get("custom")||"ol.source.GeoImage"!=e.get("custom").source)||!(!e||!e.get("custom")||"ol.source.WMS"!=e.get("custom").source))},LayerSourceTab.prototype.create=function(e,t){var k=this;this.layer=e;var S=this.parentDialog.mapContainer,l=S.map.getView().getProjection().getCode(),r=e.get("custom"),a="";t&&(a="active");var s="",n=$('<li class="'+a+'"><a href="#'+k.tabId+'" data-toggle="tab"><i class="fa fa-database"></i> Source</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+k.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var i='<div><form id="'+k.tabId+'_form" class="modal-body form-horizontal">';(i+="",i+="",i+="",i+="",r.dataObj&&"ol.format.OSMXML"==r.format)&&(s="OSMXML",(h=LayerHelper.getDetails(k.layer))&&(i+='  <div class="form-group">',i+='    <label class="" for="">OSM Vector Data</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#source_osm">?</a>',i+="  </div>"));if(r.dataObj&&"ol.format.GeoJSON"==r.format){s="GeoJSON",i+='  <div class="form-group">',i+='    <label class="" for="">Vector data layer</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#source_vectorLayer">?</a>';var o=r.dataObj.name;d=(d=r.dataObj.description||"").replace(/(?:\r\n|\r|\n)/g,"<br />"),i+='<div class="'+(r.dataObj.dataType?"autocomplete-custom-item icon-"+r.dataObj.dataType:"")+'" >',i+='<img id="datalayerThumbnail" class="avatar48" src="/datalayer/'+r.dataObj.id+'/thumbnail" />',i+=o+(r.dataObj.description?'<br/><small style="white-space: pre;">'+d+"</small>":""),i+='<div class="list-inline">',r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+=' <a target="_blank" href="/datalayer/'+r.dataObj.id+"?dataType="+r.dataObj.dataType+'"><i class="glyphicon glyphicon-edit"></i></a>'),i+='    <li><i class="fa fa-user"></i> <span>'+r.dataObj.OwnerUser.userName+"</span></li>";var c=r.dataObj.updatedAt;try{c=new Date(c).toUTCString()}catch(e){}i+='<li><i class="fa fa-calendar fa-calendar-o"></i><span class="convertTolocalDateTime">'+c+"</span></li>",r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+=' <li style="float: right;">',i+='    <div class=""><button id="cmdupdatethumbnail" type="button" class="btn btn-primary btn-success btn-xs ">Update thumbnail</button></div>',i+=" </lin>"),i+=" </div>",i+="</div>",i+="  </div>",r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="cmdupdateDisplay" > Save display</button>',i+="</div>"),i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="downloadGeoJSON" ><i class="fa fa-download"></i> Download GeoJSON</button>',i+="</div>",i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="downloadShapefile" ><i class="fa fa-download"></i> Download Shapefile</button>',i+="</div>",i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary btn-xs_" id="createLayerFromGeoJSON" ><i class="fa fa-copy"></i> Copy features to a new data layer</button>',i+="</div>",(h=LayerHelper.getDetails(k.layer))&&(h.shapeType&&(i+='<div class="form-group">',i+='  <label class="col-sm-3" for="shapeType">Shape type:</label>',i+='    <select class="form-control " id="shapeType" disabled="disabled"  >',i+='                          <option value="Point" '+("Point"==h.shapeType?'selected="selected"':"")+" >▪    Point</option>",i+='                          <option value="MultiLineString" '+("MultiLineString"==h.shapeType?'selected="selected"':"")+">▬ Line</option>",i+='                          <option value="MultiPolygon" '+("MultiPolygon"==h.shapeType?'selected="selected"':"")+">◇ Polygon</option>",i+="    </select>",i+="  </div>"),h.spatialReference&&(i+='<div class="form-group">',i+='  <label class="col-sm-12" for="">Spatial reference:</label>',h.spatialReference.srid&&!h.spatialReference.alias&&(3857!=h.spatialReference.srid&&"3857"!=h.spatialReference.srid||(h.spatialReference.alias="Google Maps Global Mercator"),4326!=h.spatialReference.srid&&"4326"!=h.spatialReference.srid||(h.spatialReference.alias="WGS 84")),h.spatialReference.name&&(i+='<div class="row">',i+='  <label class="col-sm-offset-1 col-sm-3" >Name:</label>',h.spatialReference.alias?i+='  <label class="col-sm-8" >'+h.spatialReference.name+" ("+h.spatialReference.alias+") </label>":i+='  <label class="col-sm-8" >'+h.spatialReference.name+" </label>",i+="</div>"),h.spatialReference.srid&&(i+='<div class="row">',i+='  <label class="col-sm-offset-1 col-sm-3" >SRID:</label>',i+='  <label class="col-sm-8" >'+h.spatialReference.srid+" </label>",i+="</div>"),i+="</div>"))}if(r.dataObj&&"ol.source.GeoImage"==r.source){s="GeoImage",i+='  <div class="form-group">',i+='    <label class="" for="">Raster data layer</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#source_raster">?</a>';var d;o=r.dataObj.name;d=(d=r.dataObj.description||"").replace(/(?:\r\n|\r|\n)/g,"<br />"),i+='<div class="'+(r.dataObj.dataType?"autocomplete-custom-item icon-"+r.dataObj.dataType:"")+'" >',i+='<img id="datalayerThumbnail" class="avatar48" src="/datalayer/'+r.dataObj.id+'/thumbnail" />',i+=o+(r.dataObj.description?'<br/><small style="white-space: pre;">'+d+"</small>":""),i+='<div class="list-inline">',r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+=' <a target="_blank" href="/datalayer/'+r.dataObj.id+"?dataType="+r.dataObj.dataType+'"><i class="glyphicon glyphicon-edit"></i></a>'),i+='    <li><i class="fa fa-user"></i> <span>'+r.dataObj.OwnerUser.userName+"</span></li>";c=r.dataObj.updatedAt;try{c=new Date(c).toUTCString()}catch(e){}if(i+='<li><i class="fa fa-calendar fa-calendar-o"></i><span class="convertTolocalDateTime">'+c+"</span></li>",r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+=' <li style="float: right;">',i+='    <div class=""><button id="cmdupdatethumbnail" type="button" class="btn btn-primary btn-success btn-xs">Update thumbnail</button></div>',i+=" </lin>"),i+='<li><i class="fa fa-download"></i><a target="_blank" href="/datalayer/'+r.dataObj.id+'/raster?request=geotiff"> Download GeoTIFF</a></li>',i+=" </div>",i+="</div>",i+="  </div>",r&&r.dataObj&&r.dataObj.id&&(app.identity.isAdministrator||r.dataObj.ownerUser==app.identity.id||r.dataObj.OwnerUser&&r.dataObj.OwnerUser.parent===app.identity.id)&&(i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="cmdupdateDisplay" > Save display</button>',i+="</div>"),h=LayerHelper.getDetails(k.layer)){i+='<div class="row">',i+='  <label class="col-sm-4" >Image width:</label>',i+='  <label class="col-sm-8" >'+h.rasterWidth+" Pixels </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-4" >Image height:</label>',i+='  <label class="col-sm-8" >'+h.rasterHeight+" Pixels </label>",i+="</div>";if(i+='<div class="row">',i+='  <label class="col-sm-4" >Raster type:</label>',i+='  <label class="col-sm-8" >'+({SingleBand:"Single-band",SingleBand_Dem:"Single-band (DEM)",SingleBand_Image:"Single-band (Image)",MultiBand:"Multi-band",Image:"Image"}[h.rasterType]||h.rasterType)+" </label>",i+="</div>",h.bands){i+='<div class="form-group">',1<h.bands.length?i+='  <label class="col-sm-12" for="">Bands:</label>':i+='  <label class="col-sm-12" for="">Band:</label>';for(var p=0;p<h.bands.length;p++){var u=h.bands[p];i+='<div class="row">',i+='  <label class="col-sm-offset-1 col-sm-3" >Name:</label>',i+='  <label class="col-sm-8" >'+u.name+" </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >ID:</label>',i+='  <label class="col-sm-7" >'+u.id+" </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Data type:</label>',i+='  <label class="col-sm-7" >'+u.dataType+" </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Min value:</label>',i+='  <label class="col-sm-7" >'+u.minimum+" </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Max value:</label>',i+='  <label class="col-sm-7" >'+u.maximum+" </label>",i+="</div>",i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >No-data value:</label>',i+='  <label class="col-sm-7" >'+u.noDataValue+" </label>",i+="</div>",u.statistics&&(i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Mean value:</label>',i+='  <label class="col-sm-7" >'+u.statistics.mean+" </label>",i+="</div>",void 0!==u.statistics.std_dev?(i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Standard deviation:</label>',i+='  <label class="col-sm-7" >'+u.statistics.std_dev+" </label>",i+="</div>"):void 0!==u.statistics.stddev&&(i+='<div class="row">',i+='  <label class="col-sm-offset-2 col-sm-3" >Standard deviation:</label>',i+='  <label class="col-sm-7" >'+u.statistics.stddev+" </label>",i+="</div>")),i+="<hr />"}i+="</div>"}h.spatialReference&&(i+='<div class="form-group">',i+='  <label class="col-sm-12" for="">Spatial reference:</label>',h.spatialReference.srid&&!h.spatialReference.alias&&(3857!=h.spatialReference.srid&&"3857"!=h.spatialReference.srid||(h.spatialReference.alias="Google Maps Global Mercator"),4326!=h.spatialReference.srid&&"4326"!=h.spatialReference.srid||(h.spatialReference.alias="WGS 84")),h.spatialReference.name&&(i+='<div class="row">',i+='  <label class="col-sm-offset-1 col-sm-3" >Name:</label>',h.spatialReference.alias?i+='  <label class="col-sm-8" >'+h.spatialReference.name+" ("+h.spatialReference.alias+") </label>":i+='  <label class="col-sm-8" >'+h.spatialReference.name+" </label>",i+="</div>"),h.spatialReference.srid&&(i+='<div class="row">',i+='  <label class="col-sm-offset-1 col-sm-3" >SRID:</label>',i+='  <label class="col-sm-8" >'+h.spatialReference.srid+" </label>",i+="</div>"),i+="</div>")}}r.dataObj&&"ol.format.WFS"==r.format&&(s="WFS",(h=LayerHelper.getDetails(k.layer))&&(i+='  <div class="form-group">',i+='    <label class="" for="">WFS (Web Feature Service)</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#source_wfsLayer">?</a>',i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="url">Service url:</label>',i+='    <input type="text" name="url" id="url" value="'+h.url+'" placeholder="WFS address" autocomplete="on" class="form-control" data-val="true"  data-val-url2="Enter a valid Url" data-val-required="Service url is required" />',i+='    <span class="field-validation-valid" data-valmsg-for="url" data-valmsg-replace="true"></span>',i+="  </div>",h.params||(h.params={LAYERS:""}),i+='  <div class="form-group">',i+='    <label class="" for="typename">Feature type:</label>',i+='    <input type="text" name="typename" id="typename" value="'+h.params.typename+'" data-namespace="'+(h.params.typenameNamespace?h.params.typenameNamespace:"")+'" placeholder="WFS feature type" class="form-control" data-val="true" data-val-required="Feature type is required" />',i+='    <span class="field-validation-valid" data-valmsg-for="typename" data-valmsg-replace="true"></span>',i+='    <span class="help-block">Define WFS feature type. Example: ADMIN-AREA</span>',i+='  <a id="cmdGetCapabilities" class="" target="_blank" href="'+h.url+'?SERVICE=WFS&REQUEST=GetCapabilities"> <i> Check service capabilities</i></a>',i+=" to explore published feature types and service availability</span>",i+="</div>",i+='<div class="form-group">',i+='  <label class="col-sm-3" for="shapeType">Shape type:</label>',i+='    <select class="form-control " id="shapeType" >',i+='                          <option value="Point" '+("Point"==r.shapeType?'selected="selected"':"")+" >▪    Point</option>",i+='                          <option value="MultiLineString" '+("MultiLineString"==r.shapeType?'selected="selected"':"")+">▬ Line</option>",i+='                          <option value="MultiPolygon" '+("MultiPolygon"==r.shapeType?'selected="selected"':"")+">◇ Polygon</option>",i+="    </select>",i+=" </div>",i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="downloadGeoJSON" ><i class="fa fa-download"></i> Download GeoJSON</button>',i+="</div>",i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary" id="downloadShapefile" ><i class="fa fa-download"></i> Download Shapefile</button>',i+="</div>",i+='<div class="form-group">',i+='<button type="button" class="btn btn-primary btn-xs_" id="createLayerFromGeoJSON" ><i class="fa fa-copoy"></i> Copy features to a new data layer</button>',i+="</div>"));var h;if(r.dataObj&&"ol.source.WMS"==r.source&&(s="WMS",h=LayerHelper.getDetails(k.layer))){!0;try{("string"==typeof h||h instanceof String)&&(h=JSON.parse(h))}catch(e){}i+='  <div class="form-group">',i+='    <label class="" for="">WMS (Web Map Service)</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#source_wmsLayer">?</a>',i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="url">Service url:</label>',i+='    <input type="text" name="url" id="url" value="'+h.url+'" placeholder="WMS address" autocomplete="on" class="form-control" data-val="true" data-val-url2="Enter a valid Url" data-val-required="Service url is required" />',i+='    <span class="field-validation-valid" data-valmsg-for="url" data-valmsg-replace="true"></span>',i+="  </div>",h.params||(h.params={LAYERS:""}),i+='  <div class="form-group">',i+='    <label class="" for="layers">Layers:</label>',i+='    <input type="text" name="layers" id="layers" value="'+h.params.LAYERS+'" placeholder="WMS Layers" class="form-control" data-val="true" data-val-required="Layers is required" />',i+='    <span class="field-validation-valid" data-valmsg-for="layers" data-valmsg-replace="true"></span>',i+='    <span class="help-block">Define WMS layers with a comma delimited text. Example: ROAD,RIVER,ADMIN-AREA</span>',i+='      <a id="cmdGetCapabilities" class="" target="_blank" href="'+h.url+'?SERVICE=WMS&REQUEST=GetCapabilities"> <i> Check service capabilities</i></a>',i+=" to explore published layers and service availability</span>",i+="</div>"}i+="</form></div>";var g=$(i).appendTo(this.tab);g.find("#name").val(this.layer.get("title"));var f=g.find("#datalayerThumbnail");(g.find("#cmdupdatethumbnail").click(function(){k.updateLayerThumbnail(f)}),g.find("#cmdupdateDisplay").click(function(){k.updateLayerDisplay()}),"GeoJSON"==s)&&(g.find("#shapeType").val(h.shapeType),k.layer.getSource().getFeatures().length||(g.find("#downloadGeoJSON").hide(),g.find("#downloadShapefile").hide(),g.find("#createLayerFromGeoJSON").hide()),g.find("#downloadGeoJSON").click(function(){var e=k.layer.getSource().getFeatures(),t=k.layer.get("title")||h.shapefileName||h.tableName,a=new ol.format.GeoJSON({featureProjection:l,dataProjection:"EPSG:4326"}).writeFeatures(e),i=new Blob([a],{type:"text/json;charset=utf-8"});saveAs(i,t+".json")}));"WFS"==s&&(g.find("#shapeType").val(r.shapeType),k.layer.getSource().getFeatures().length||(g.find("#downloadGeoJSON").hide(),g.find("#downloadShapefile").hide(),g.find("#createLayerFromGeoJSON").hide()),g.find("#downloadGeoJSON").click(function(){var e=k.layer.getSource().getFeatures(),t=k.layer.get("title")||h.shapefileName||h.tableName,a=new ol.format.GeoJSON({featureProjection:l,dataProjection:"EPSG:4326"}).writeFeatures(e),i=new Blob([a],{type:"text/json;charset=utf-8"});saveAs(i,t+".json")}));if("WFS"!=s&&"GeoJSON"!=s||(g.find("#createLayerFromGeoJSON").click(function(){S.duplicateLayer(k.layer,{newName:void 0,exportSelectionIfAny:!1,srid:4326})}),g.find("#downloadShapefile").click(function(){var e=k.layer.getSource().getFeatures(),t=k.layer.get("title")||o.shapefileName||o.tableName,a=new ol.format.GeoJSON({featureProjection:l,dataProjection:"EPSG:4326"}).writeFeatures(e),i=new Blob([a],{type:"text/json;charset=utf-8"}),o=LayerHelper.getDetails(k.layer),n=JSON.parse(JSON.stringify(o));delete n.filter,delete n.datasetName,delete n.params,delete n.url,n.fileName=t+"-Copy",n.spatialReference={name:"EPSG:4326",srid:4326};var r=new FormData;r.append("file",i,"geojson.json"),r.append("layerInfo",JSON.stringify(n));var s=$.notify({message:'<i class="wait-icon-with-padding">The processing is running in the background</i><br /> Creating Shapefile...'},{z_index:5e4,type:"info",delay:0,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}});$.ajax({url:"/datalayer/toShapefile",type:"POST",data:r,processData:!1,contentType:!1,xhrFields:{responseType:"blob"},success:function(e,t,a){var i="",o=a.getResponseHeader("Content-Disposition");if(o&&-1!==o.indexOf("attachment")){var n=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(o);null!=n&&n[1]&&(i=n[1].replace(/['"]/g,""))}i||(i="shapefile.zip");var r=a.getResponseHeader("Content-Type"),s=new Blob([e],{type:r});saveAs(s,i)}}).done(function(e){s.close()}).fail(function(e,t,a){$.notify({message:a+"<br/>Failed to complete task"},{z_index:5e4,type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),s.close()})})),"WMS"==s||"WFS"==s){var m=function(){var e=g.find("#url").val();e?(g.find("#cmdGetCapabilities").attr("href",e+"?SERVICE="+s+"&REQUEST=GetCapabilities"),g.find("#cmdGetCapabilities").removeClass("disabled")):(g.find("#cmdGetCapabilities").removeAttr("href"),g.find("#cmdGetCapabilities").addClass("disabled"))};g.find("#url").change(function(){m()}),m()}var y=$(g.find("#"+k.tabId+"_form"));if(this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(y),$.validator.setDefaults({ignore:t}),y.validate(),y.valid())n.find("a").removeClass("text-danger");else{e.cancel=!0,n.find("a").addClass("text-danger"),k.activate();var a=y.find(".input-validation-error").first();if(a){var i=a.offset().top,o=n.offset().top;k.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){}),this.parentDialog.applyHandlers.push(function(e){if("WMS"==s){var t=g.find("#url").val(),w=g.find("#layers").val();if(t!==LayerHelper.getDetails(k.layer).url||w!==LayerHelper.getDetails(k.layer).params.LAYERS||k.parentDialog.isNew){LayerHelper.getDetails(k.layer).url=t,LayerHelper.getDetails(k.layer).params.LAYERS=w;var a=LayerHelper.getDetails(k.layer).url;app.url_needs_proxy(a)&&(a="/proxy/?url="+encodeURIComponent(a)),k.layer.get("source").setUrl(a),k.layer.get("source").updateParams(LayerHelper.getDetails(k.layer).params);a=LayerHelper.getDetails(k.layer).url+"?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.3.0";app.url_needs_proxy(a)&&(a="/proxy/?url="+encodeURIComponent(a)),$.ajax(a,{type:"GET",dataType:"xml",success:function(e){if(e){var t,a="";e.documentElement&&(a=e.documentElement.prefix),a||(a="");var i=!1;if(0<(t=$("Capability",e).find("GetFeatureInfo")).length&&(i=!0,k.layer.set("_supportsGetFeatureInfo",i)),0<(t=a?$(a+"\\:Cpability",e).find(a+"\\:Layer"):$("Capability",e).find("Layer Name")).length){for(var o,n,r,s,l=w.split(","),c=0;c<l.length;c++)for(var d=0;d<t.length;d++){if($(t[d]).text()==l[c]){var p=$(t[d]).siblings("EX_GeographicBoundingBox"),u=$(t[d]).siblings("LatLonBoundingBox");$(t[d]).siblings("BoundingBox");if(p.length){var h=p.first().find("westBoundLongitude"),f=p.first().find("eastBoundLongitude"),m=p.first().find("northBoundLatitude"),g=p.first().find("southBoundLatitude");try{if(h.length){var y=parseFloat(h.text());isNaN(y)||(void 0===s&&(s=y),s=Math.min(s,y))}if(f.length){var v=parseFloat(f.text());isNaN(v)||(void 0===r&&(r=v),r=Math.max(r,v))}if(m.length){var b=parseFloat(m.text());isNaN(b)||(void 0===o&&(o=b),o=Math.max(o,b))}if(g.length){var _=parseFloat(g.text());isNaN(_)||(void 0===n&&(n=_),n=Math.min(n,_))}}catch(e){}}else if(u.length)try{y=parseFloat(u.attr("minx"));isNaN(y)||(void 0===s&&(s=y),s=Math.min(s,y));v=parseFloat(u.attr("maxx"));isNaN(v)||(void 0===r&&(r=v),r=Math.max(r,v));_=parseFloat(u.attr("miny"));isNaN(_)||(void 0===n&&(n=_),n=Math.min(n,_));b=parseFloat(u.attr("maxy"));isNaN(b)||(void 0===o&&(o=b),o=Math.max(o,b))}catch(e){}}}isNaN(o)||void 0!==o&&(LayerHelper.getDetails(k.layer).ext_north=o,LayerHelper.getDetails(k.layer).ext_south=n,LayerHelper.getDetails(k.layer).ext_east=r,LayerHelper.getDetails(k.layer).ext_west=s,S.setGeoExtent(s,n,r,o))}}},error:function(e,t,a){}})}}if("WFS"==s){t=g.find("#url").val();var h=g.find("#typename").val(),i=g.find("#typename").data("namespace"),o=g.find("#shapeType").val();if(LayerHelper.setShapeType(k.layer,o),t!==LayerHelper.getDetails(k.layer).url||h!==LayerHelper.getDetails(k.layer).params.typename||k.parentDialog.isNew){LayerHelper.setFields(k.layer,null),LayerHelper.getDetails(k.layer).url=t,LayerHelper.getDetails(k.layer).params.typename=h,LayerHelper.getDetails(k.layer).params.typenameNamespace=i;var n=S.sourceFactory.createWFSSource(r.dataObj,S);k.layer.set("source",n),n.clear(),n.refresh();a=LayerHelper.getDetails(k.layer).url+"?SERVICE=WFS&REQUEST=GetCapabilities&VERSION=1.1.0";app.url_needs_proxy(a)&&(a="/proxy/?url="+encodeURIComponent(a)),$.ajax(a,{type:"GET",dataType:"xml",success:function(e){if(e){var t,a="";if(e.documentElement&&(a=e.documentElement.prefix),a||(a=""),0<(t=$("FeatureTypeList",e).find("FeatureType Name")).length){for(var i,o,n,r,s=0;s<t.length;s++){if($(t[s]).text()==h){var l=$(t[s]).siblings("ows\\:WGS84BoundingBox");if(l.length){var c=l.first().find("ows\\:LowerCorner"),d=l.first().find("ows\\:UpperCorner");try{if(c.length){var p=c.text();p=p.split(" "),r=parseFloat(p[0]),o=parseFloat(p[1])}if(d.length){var u=d.text();u=u.split(" "),n=parseFloat(u[0]),i=parseFloat(u[1])}}catch(e){}}}}isNaN(i)||void 0!==i&&(LayerHelper.getDetails(k.layer).ext_north=i,LayerHelper.getDetails(k.layer).ext_south=o,LayerHelper.getDetails(k.layer).ext_east=n,LayerHelper.getDetails(k.layer).ext_west=r,S.setGeoExtent(r,o,n,i))}}},error:function(e,t,a){}})}if(!LayerHelper.getFields(k.layer)){a=LayerHelper.getDetails(k.layer).url+"?SERVICE=WFS&REQUEST=DescribeFeatureType&version=1.1.0&typeName="+r.dataObj.details.params.typename;app.url_needs_proxy(a)&&(a="/proxy/?url="+encodeURIComponent(a)),$.ajax(a,{type:"GET",dataType:"xml",success:function(e){if(e){var a=[],i="xsd";e.documentElement&&(i=e.documentElement.prefix);var t=$(i+"\\:complexContent",e).find(i+"\\:element");t.length,t.each(function(){var e=$(this).attr("name"),t=$(this).attr("type");void 0===t||t==i+":string"||t==i+":date"?a.push({name:e,alias:e,type:"varchar"}):t==i+":double"||t==i+":float"||t==i+":decimal"?a.push({name:e,alias:e,type:"numeric"}):t==i+":byte"||t==i+":integer\t"||t==i+":int"||t==i+":short"?a.push({name:e,alias:e,type:"integer"}):t==i+":long"?a.push({name:e,alias:e,type:"bigint"}):t==i+":boolean"&&a.push({name:e,alias:e,type:"boolean"})})}LayerHelper.setFields(k.layer,a)},error:function(e,t,a){}})}}}),"WMS"==s){var v,b=void 0,_=g.find("#layers");$(_).autocomplete({appendTo:g,minLength:0,source:function(h,f){h.term;var e=g.find("#url").val(),m=new RegExp($.ui.autocomplete.escapeRegex(h.term),"i");$(this).text();if(!b||k.WMS_downloding||e!=v){if(!k.WMS_downloding&&e!==v){k.WMS_downloding=!0;var t=(v=e)+"?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.3.0";app.url_needs_proxy(t)&&(t="/proxy/?url="+encodeURIComponent(t)),$.ajax(t,{type:"GET",dataType:"xml",success:function(e){if(k.WMS_downloding=!1,$("#layers").removeClass("ui-autocomplete-loading"),e){var t,a="";e.documentElement&&(a=e.documentElement.prefix),a||(a="");var i=!1;if(0<(t=$("Capability",e).find("GetFeatureInfo")).length&&(i=!0,k.layer.set("_supportsGetFeatureInfo",i)),0<(t=$("Capability",e).find("Layer > Name ")).length){for(var o=[],n=0;n<t.length;n++){var r=$(t[n]).text(),s={label:r,value:r,title:r,keywords:""},l=$(t[n]).siblings("Title");s.title=l.text();var c=$(t[n]).siblings("ows\\:Keywords");c=$(c).find("ows\\:Keyword");var d=[];c.each(function(e,t){d.push(t.innerHTML)}),d.length&&d.join&&(s.keywords=d.join(", "));var p=$(t[n]).parent().find("Style LegendURL OnlineResource").first();0<p.length&&(s.legend=p[0].getAttributeNS("http://www.w3.org/1999/xlink","href")),o.push(s)}b=o;var u=$.map(b,function(e){if(e.label&&(!h.term||m.test(e.label)||m.test(e.title)||m.test(e.keywords)))return{label:e.label,value:e.value,data:e}});f(u)}}},error:function(e,t,a){k.WMS_downloding=!1,$("#layers").removeClass("ui-autocomplete-loading")}})}}else{var a=$.map(b,function(e){if(e.label&&(!h.term||m.test(e.label)||m.test(e.title)||m.test(e.keywords)))return{label:e.label,value:e.value,data:e}});f(a)}},select:function(e,t){return $(this).val(t.item.label),!k.layer.get("title")&&t.item.data&&$("#"+LayerGeneralTab.TabId+"_form").find("#name").val(t.item.data.title||t.item.data.label),!1},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.label,i="",o="";t.data.title&&(i=t.data.title||""),t.data.keywords&&(o=t.data.keywords||""),i=i.replace(/(?:\r\n|\r|\n)/g,"<br />");var n=this.term;n&&(a=String(a).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"),i=String(i).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"),o=String(o).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"));var r="";return r+='<div class="" >',t.data.legend&&(r+='<img class="avatar48" src="'+t.data.legend+'" />'),r+="<strong>"+a+"</strong>",r+=t.data.title?'<pre class="nostyle" style="display:inline;"><br/><small style="">Title:'+i+"</small></pre>":"",r+=t.data.keywords?'<pre class="nostyle" style="display:inline;"><br/><small style="">Keywords:'+o+"</small></pre>":"",$("<li></li>").append(r).appendTo(e)}}if("WFS"==s){var w,T=void 0,C=g.find("#typename");$(C).autocomplete({appendTo:g,minLength:0,source:function(h,f){h.term;var e=g.find("#url").val(),m=new RegExp($.ui.autocomplete.escapeRegex(h.term),"i");$(this).text();if(!T||k.WFS_downloding||e!=w){if(!k.WFS_downloding&&e!==w){k.WFS_downloding=!0;var t=(w=e)+"?SERVICE=WFS&REQUEST=GetCapabilities&VERSION=1.1.0";app.url_needs_proxy(t)&&(t="/proxy/?url="+encodeURIComponent(t)),$.ajax(t,{type:"GET",dataType:"xml",success:function(e){if(k.WFS_downloding=!1,e){var t,a="";if(e.documentElement&&(a=e.documentElement.prefix),a||(a=""),0==(t=$("FeatureTypeList",e).find("FeatureType Name")).length&&(t=$("wfs\\:FeatureTypeList",e).find("wfs\\:FeatureType wfs\\:Name")),0<t.length){for(var i=[],o=0;o<t.length;o++){var n=$(t[o]).text(),r="";if(n.indexOf(":")){var s=n.split(":");s&&2==s.length&&(r=$(e.documentElement).attr("xmlns:"+s[0]))}var l={label:n,value:n,title:n,namespace:r,keywords:""},c=$(t[o]).siblings("Title");l.title=c.text();var d=$(t[o]).siblings("ows\\:Keywords");d=$(d).find("ows\\:Keyword");var p=[];d.each(function(e,t){p.push(t.innerHTML)}),p.length&&p.join&&(l.keywords=p.join(", ")),i.push(l)}T=i;var u=$.map(T,function(e){if(e.label&&(!h.term||m.test(e.label)||m.test(e.title)||m.test(e.keywords)))return{label:e.label,value:e.value,data:e}});f(u)}}},error:function(e,t,a){k.WFS_downloding=!1,$("#typename").removeClass("ui-autocomplete-loading")}})}}else{var a=$.map(T,function(e){if(e.label&&(!h.term||m.test(e.label)||m.test(e.title)||m.test(e.keywords)))return{label:e.label,value:e.value,data:e}});f(a)}},select:function(e,t){return $(this).val(t.item.label),$(this).data("namespace",t.item.data.namespace),!k.layer.get("title")&&t.item.data&&$("#"+LayerGeneralTab.TabId+"_form").find("#name").val(t.item.data.title||t.item.data.label),!1},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.label,i="",o="";t.data.title&&(i=t.data.title||""),t.data.keywords&&(o=t.data.keywords||""),i=i.replace(/(?:\r\n|\r|\n)/g,"<br />");var n=this.term;n&&(a=String(a).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"),i=String(i).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"),o=String(o).replace(new RegExp(n,"gi"),"<strong class='ui-state-highlight'>$&</strong>"));var r="";return r+='<div class="" >',r+="<strong>"+a+"</strong>",r+=t.data.title?'<pre class="nostyle" style="display:inline;"><br/><small style="">Title:'+i+"</small></pre>":"",r+=t.data.keywords?'<pre class="nostyle" style="display:inline;"><br/><small style="">Keywords:'+o+"</small></pre>":"",$("<li></li>").append(r).appendTo(e)}}},LayerSourceTab.prototype.updateLayerThumbnail=function(a){if(this.layer){this.layer.setVisible(!0);var i=this.layer.get("custom");waitingDialog.show("Updating layer's thumbnail",{progressType:"info"}),app.mapContainer.exportPngBlob(function(e){if(e){var t=new FormData;t.append("file",e),$.ajax({url:"/datalayer/"+i.dataObj.id+"/thumbnail",type:"POST",data:t,processData:!1,contentType:!1}).done(function(e){if(waitingDialog.hide(),e.status){var t=new Date;a.attr("src","/datalayer/"+i.dataObj.id+"/thumbnail?"+t.getTime()),$.notify({message:"Layer's thumbnail saved successfully"},{type:"info",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}else $.notify({message:e.message||"Failed to save thumbnail."},{type:"danger",delay:2e3,z_index:5e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}).fail(function(e,t,a){waitingDialog.hide(),$.notify({message:"Failed to save thumbnail"},{type:"danger",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})})}else waitingDialog.hide()})}},LayerSourceTab.prototype.updateLayerDisplay=function(e){if(this.layer){var t=this.layer.get("custom"),a=LayerHelper.getDetails(this.layer),i={};a.display&&(i.display=JSON.parse(JSON.stringify(a.display))),a.renderer&&(i.renderer=JSON.parse(JSON.stringify(a.renderer))),a.featureLabeler&&(i.featureLabeler=JSON.parse(JSON.stringify(a.featureLabeler))),waitingDialog.show("Saving layer's settings",{progressType:"info"}),$.ajax({url:"/datalayer/"+t.dataObj.id+"/display",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",timeout:3e4,cache:!1,data:JSON.stringify(i)}).done(function(e){if(waitingDialog.hide(),e.status){new Date;$.notify({message:"Layer's display settings saved successfully"},{type:"info",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}else $.notify({message:e.message||"Failed to save settings."},{type:"danger",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}).fail(function(e,t,a){waitingDialog.hide(),$.notify({message:"Failed to save settings"},{type:"danger",z_index:5e4,delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})})}},FeatureAttributesTab.prototype.init=function(e){this.parentDialog=e},FeatureAttributesTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},FeatureAttributesTab.prototype.field_i18n=function(e,t,a){var i=app.i18n,o=t,n=a;return i&&n in i&&(n=i[n]),i&&e&&e.name&&((o=e.name+"."+t)in i&&(n=i[o]),"codedValues"==t&&(o=e.name+".codedValues."+(a+"").trim())in i&&(n=i[o])),e&&e.i18n&&e.i18n[app.language]&&t in(i=e.i18n[app.language])&&("codedValues"==t?(o=(a+"").trim())in i.codedValues&&(n=i.codedValues[o]):n=i[t]),n},FeatureAttributesTab.prototype.onshown=function(){if(this.$form){var e=this.$form.find("[autofocus]").focus().select();if(e&&e.length){var t=e.offset().top,a=this.tabHeader.offset().top;this.tab.animate({scrollTop:t-a-60},1e3)}}},FeatureAttributesTab.prototype.applied=function(e){this.feature=e.feature,this.layer=e.layer,this.transactFeature=e.transactFeature,this.defaultFieldToEdit=e.defaultFieldToEdit;var t=e.fields;if(this.layer&&this.feature){var a=this.layer.get("custom");a&&a.dataObj&&a.dataObj.details&&(t=a.dataObj.details.fields)}return!!t},FeatureAttributesTab.prototype.create__=function(t,a){var i=this;this.feature=t.feature;var e="autosave";if(t.layer){this.layer=t.layer,this.transactFeature=t.transactFeature;this.layer.get("custom");fields=LayerHelper.getFields(this.layer),e+="_"+this.layer.get("title")}if(this.feature&&this.feature.getId){var o=this.feature.getId();!o&&this.feature.get("_cacheInfo")&&(o=this.feature.get("_cacheInfo").uid),o||(o=-1),e+="_"+o}app&&app.controller&&app.controller.storageService?app.controller.storageService.get(e).then(function(e){e?(console.log("autosaved data loaded"),i.create_inner(t,a,e)):i.create_inner(t,a,null)}).catch(function(e){console.log("failed to load autosaved data"),i.create_inner(t,a,null)}):i.create_inner(t,a,null)},FeatureAttributesTab.prototype.create=function(e,t){var p=this;this.feature=e.feature;var d=e.fields,u={};this.fileInfosStorage={};var s=!!e.autosaveId&&e.autosaveId;p._autosave_done=!1;var a=e.initData?e.initData:null;if(e.layer){this.layer=e.layer,this.transactFeature=e.transactFeature;this.layer.get("custom");d=LayerHelper.getFields(this.layer)}var i="";t&&(i="active");var n=$('<li class="'+i+'"><a href="#'+p.tabId+'" data-toggle="tab"><i class="glyphicon glyphicon-list-alt"></i> Attributes</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tabHeader=n,this.tab=$('<div class="tab-pane '+i+'" id="'+p.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var o,r='<div><form id="'+p.tabId+'_form" class="modal-body form-horizontal">',l=null;o=this.feature.getProperties?this.feature.getProperties():this.feature.properties||{};try{l=JSON.parse(JSON.stringify(o))}catch(e){}if(!l){l={};for(var c=0;o&&c<d.length;c++){var h=d[c];l[h.name]=o[h.name],void 0===l[h.name]&&void 0!==h.default&&(l[h.name]=h.default)}}for(c=0;c<d.length;c++){(h=d[c])._index=c}var f={},m=[];for(c=0;c<d.length;c++){var g=(h=d[c]).group;g=p.field_i18n(h,"group",h.group);var y="field_"+c,v=(u[h.name]=h).type.toLowerCase(),b=!1;if(!h.hidden){h.domain&&"codedValues"==h.domain.type&&h.domain.items&&(b=!0),h.isExpression;var _="";if(h.isExpression)_+='  <div class="form-group">',_+='    <label class="" >'+(p.field_i18n(h,"alias",h.alias)||h.name)+"</label>",_+='    <p class="form-control-static">'+o[h.name]+"</p>",_+="  </div>";else b?h.domain.multipleChoice||h.domain.editable?_+=this.getCodedValuesInput_select2(h,o,y):_+=this.getCodedValuesInput(h,o,y):"varchar"==v?_+=this.getTextInput(h,o,y):"nill"==v?_+=this.getNillInput(h,o,y):"date"==v?_+=this.getDateInput(h,o,y):"timestamp with time zone"==v?_+=this.getDateTimeInput(h,o,y):"smallint"==v||"integer"==v||"bigint"==v?_+=this.getIntegerInput(h,o,y):"real"==v||"double precision"==v||"numeric"==v?_+=this.getNumberInput(h,o,y):"boolean"==v?_+=this.getBoolInput(h,o,y):"_filelink"==v?_+=this.getFilesInput(h,o,a,y):"_documentslink"==v&&(_+=this.getDocumentListInput(h,o,y));var w={type:"field",html:_},k=function(e,t){if(!t)return null;if(f[t+=""])return f[t];var a,i,o,n=t;-1<t.indexOf("->")&&(i=t.substring(0,t.lastIndexOf("->")),o=k(e,i),n=t.substring(t.lastIndexOf("->")+2));var r=e._index;return o&&(r=o._index+"-"+e._index),a={type:"group",name:n,_index:r,items:[]},f[t]=a,o?o.items.push(a):m.push(a),a};if(g){var S=k(h,g);S?S.items.push(w):m.push(w)}else m.push(w)}}var T=function(e){var t="";if("field"==e.type)t+=e.html,t+='<hr class="field-sep"/>';else if("group"==e.type){t+='  <div class="panel panel-default collapsible-panel">',t+='    <div class="panel-heading">',t+='        <button type="button" data-toggle="collapse" data-target="#pnlFieldGroup_'+e._index+'"  aria-expanded="false" class="btn btn-link btn-block collapsed">',t+='          <i class="collapse-action glyphicon"></i>',t+='          <h5 class="title"><i class=" fa fa-list-alt"></i> '+e.name+"</h5>",t+="        </button>",t+="      </div>",t+='    <div id="pnlFieldGroup_'+e._index+'" class="panel-field-group panel-collapse collapse in_">';for(var a=0;a<e.items.length;a++)t+=T(e.items[a]);t+="    </div>",t+="   </div>"}return t};for(c=0;c<m.length;c++){var C=m[c];r+=T(C)}r+="",r+="",r+="",r+="",r+="</form></div>",r=DOMPurify.sanitize(r,{SAFE_FOR_JQUERY:!0});var x=$(r).appendTo(this.tab);x.find('[data-toggle="collapse"]').unbind().click(function(e){e.preventDefault();var t=$(this).attr("data-target");return x.find(t).collapse("toggle"),!1}),this.createRelationTabs();var D=$(x.find("#"+p.tabId+"_form"));function L(e){if(e){for(var t=0;t<d.length;t++){var a=d[t],i="field_"+t,o=a.type.toLowerCase();if("_filelink"!=o){var n=D.find("#"+i);if(0!=n.length){var r=n.val();if(a.domain&&"codedValues"==a.domain.type&&Array.isArray(r)&&(r=r.join(";")),r&&(r=DOMPurify.sanitize(r)),"varchar"==o||"_documentslink"==o)"Null"==r&&(r=null),e[a.name]=r;else if("date"==o){var s=r;e[a.name]=s}else"timestamp with time zone"==o?(""===r&&(r=void 0),e[a.name]=r):"smallint"==o||"integer"==o||"bigint"==o?""===r?e[a.name]=void 0:isNaN(+r)||isNaN(parseInt(r))||(e[a.name]=parseInt(r)):"real"==o||"double precision"==o||"numeric"==o?""===r?e[a.name]=void 0:isNaN(+r)||isNaN(parseFloat(r))||(e[a.name]=parseFloat(r)):"boolean"==o&&(n&&n.length&&"checkbox"==n[0].type&&(r=n.prop("checked")),e[a.name]=""===r?null:!1!==r&&"0"!==r&&0!==r&&"false"!==r&&"False"!==r&&"FALSE"!==r&&"no"!==r&&"No"!==r&&"NO"!==r)}}else p.fileInfosStorage&&(e[a.name]=JSON.stringify(p.fileInfosStorage[i]))}if(p.dataRelationshipsTabs&&p.dataRelationshipsTabs.length){var l=[];for(t=0;t<p.dataRelationshipsTabs.length;t++){var c=p.dataRelationshipsTabs[t];l.push($(c).data("dataRelationship"))}e._dataRelationships=l}}}if(this.$form=D,this.updateDocumenListContent(D),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed"),setTimeout(function(){},1e3),D.find("input,textarea,select").change(function(){$(this).addClass("attribute-value-changed"),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed")}),D.find('input[type="checkbox"]').change(function(){$(this).parent().addClass("checkbox-attribute-value-changed"),D.find(".collapsible-panel").has(".checkbox-attribute-value-changed").addClass("has-attribute-value-changed")}),D.find(".uploadfile").click(function(){var o=$(this).data("field-key"),n=D.find("#"+o+"-panel"),r=(D.find("#"+o),[]);try{r=p.fileInfosStorage[o]}catch(e){}r||(r=[]),Array.isArray(r)||(r=[]),p.fileInfosStorage[o]=r;new DlgUpload(p,{uploadUrl:app.get_uploadattachments_url(),onUpload:function(e,t){console.log(t);for(var a=0;a<t.length;a++){var i=t[a];i.id=-1,i.action="new",r.push(i)}n.html(p.getFileListContent(r,o)),e.close()}},{title:$(this).attr("title"),onapply:function(e,t){console.log(t)}}).show()}),D.find(".cameraCapture").unbind().click(function(){var a=$(this).data("field-key"),i=D.find("#"+a+"-panel"),o=(D.find("#"+a),[]);try{o=p.fileInfosStorage[a]}catch(e){}o||(o=[]),Array.isArray(o)||(o=[]),p.fileInfosStorage[a]=o,navigator.camera.getPicture(function(e){var t={name:"captured",id:-1,action:"new"};t.dataUrl="data:image/jpeg;base64,"+e,t.mimeType="image/jpeg",o.push(t),i.html(p.getFileListContent(o,a))},function(e){alert("Failed because: "+e)},{quality:50,destinationType:Camera.DestinationType.DATA_URL})}),D.find(".startRecordAudio").unbind().click(function(){var a=$(this).data("field-key"),e=$(this),t=$(this).parent(),i=$(this).data("field-name"),o=D.find("#"+a+"-panel"),n=(D.find("#"+a),[]);try{n=p.fileInfosStorage[a]}catch(e){}n||(n=[]),Array.isArray(n)||(n=[]),p.fileInfosStorage[a]=n,t.find(".stopRecordAudio").show(),t.find(".audioAmplitude").css("width","0%"),t.find(".audioAmplitude_progress").show(),e.hide();var r=app.getTempAudioRecordingLocation(i+"_recording.mp3"),s=r.fileName,l=new Media(s,function(){d(),console.log("recordAudio():Audio Success"),window.resolveLocalFileSystemURL(r.dirName+r.fileName,function(e){e.file(function(e){app.fileToDataUrlAsync(e).then(function(e){var t={name:"recorded",id:-1,action:"new"};t.dataUrl=e,t.mimeType="audio/mp3",n.push(t),o.html(p.getFileListContent(n,a))}).catch(function(e){console.error(e)})},function(e){console.error(error)})},function(e){console.error(e)})},function(e){d(),console.log("recordAudio():Audio Error: "+e.code)}),c=setInterval(function(){l.getCurrentAmplitude(function(e){console.log(e+"%"),t.find(".audioAmplitude").css("width",100*e+"%")},function(e){console.log("Error getting amp="+e)})},300);function d(){t.find(".stopRecordAudio").hide(),t.find(".audioAmplitude_progress").hide(),t.find(".startRecordAudio").show(),clearInterval(c),e.show()}t.find(".stopRecordAudio").unbind().click(function(){l.stopRecord(),l.release(),d()}),l.startRecord()}),D.on("click",".remove-attachment",function(){var e=$(this).data("field-key"),t=$(this).data("file-index"),a=D.find("#"+e+"-panel"),i=(D.find("#"+e),[]);try{i=p.fileInfosStorage[e]}catch(e){}i||(i=[]),Array.isArray(i)||(i=[]),p.fileInfosStorage[e]=i;try{i.splice(t,1)}catch(e){}a.html(p.getFileListContent(i,e))}),D.on("click",".delete-attachment",function(){var e=$(this).data("field-key"),t=$(this).data("file-index"),a=D.find("#"+e+"-panel"),i=(D.find("#"+e),[]);try{i=p.fileInfosStorage[e]}catch(e){}i||(i=[]),Array.isArray(i)||(i=[]),p.fileInfosStorage[e]=i;try{i[t].action="delete"}catch(e){}a.html(p.getFileListContent(i,e))}),D.on("click",".undelete-attachment",function(){var e=$(this).data("field-key"),t=$(this).data("file-index"),a=D.find("#"+e+"-panel"),i=(D.find("#"+e),[]);try{i=p.fileInfosStorage[e]}catch(e){}i||(i=[]),Array.isArray(i)||(i=[]),p.fileInfosStorage[e]=i;try{i[t].action=void 0}catch(e){}a.html(p.getFileListContent(i,e))}),D.find(".uploadDocument").click(function(){var o=$(this).data("field-key"),n=($(this).data("doc-index"),D.find("#"+o+"-panel")),r=D.find("#"+o),s=[],e=r.val();try{e&&"undefined"!==e&&(s=r.val().split(","))}catch(e){}s||(s=[]),Array.isArray(s)||(s=[]);new DlgUpload(p,{uploadUrl:"/document/upload",onUpload:function(e,t){console.log(t);for(var a=0;a<t.length;a++){var i=t[a];s.push(i.id)}r.val(s.join(",")),n.html(p.getDocumenListContent(s,o)),p.updateDocumenListContent(n),e.close()}},{title:$(this).attr("title"),onapply:function(e,t){console.log(t)}}).show()}),D.find(".selectDocument").click(function(){var a=$(this).data("field-key"),i=($(this).data("doc-index"),D.find("#"+a+"-panel")),o=D.find("#"+a),n=[],e=o.val();try{e&&"undefined"!==e&&(n=o.val().split(","))}catch(e){}n||(n=[]),Array.isArray(n)||(n=[]);new DlgSelectDocument(p,{url:"/documents?format=json",onAdd:function(e,t){t.id&&n.push(t.id),o.val(n.join(",")),i.html(p.getDocumenListContent(n,a)),p.updateDocumenListContent(i),e.close()}},{title:$(this).attr("title"),onapply:function(e,t){console.log(t)}}).show()}),D.on("click",".remove-document",function(){var e=$(this).data("field-key"),t=$(this).data("doc-index"),a=D.find("#"+e+"-panel"),i=D.find("#"+e),o=[];try{o=i.val().split(",")}catch(e){}o||(o=[]),Array.isArray(o)||(o=[]);try{o.splice(t,1)}catch(e){}i.val(o.join(",")),a.html(p.getDocumenListContent(o,e)),p.updateDocumenListContent(a)}),D.find(".select2Single,.select2Multiple").each(function(e){var t=$(this),a=t.data("field-name"),i=u[a],o=[];if(i.domain&&"codedValues"==i.domain.type&&i.domain.items&&i.domain.items.length)for(var n=0;n<i.domain.items.length;n++){var r=i.domain.items[n];o.push({id:r.code,text:p.field_i18n(i,"codedValues",r.value)})}var s=t.data("tags"),l=t.data("allow-clear"),c=t.data("placeholder");t.select2({theme:"bootstrap",dropdownParent:$(this).parent().parent().parent().parent().parent(),data:o,tags:s,placeholder:c,allowClear:l}),$(t).on("change",function(e){t.data("select2").$container.addClass("attribute-value-changed"),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed")})}),this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(D),$.validator.setDefaults({ignore:t}),D.find(".collapsible-panel").removeClass("has-validation-error"),D.validate(),D.valid())n.find("a").removeClass("text-danger");else{e.cancel=!0,n.find("a").addClass("text-danger"),p.activate(),D.find(".collapsible-panel").has(".input-validation-error").addClass("has-validation-error");var a=D.find(".input-validation-error").first();if(a)if(a.scrollintoview)a.scrollintoview({duration:1e3,viewPadding:{y:80},complete:function(){}});else{var i=a.offset().top,o=n.offset().top;p.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){N(),M()}),this.parentDialog.applyHandlers.push(function(e){var t;L(t=p.feature.getProperties?p.feature.getProperties():p.feature.properties||{}),p.feature.setProperties?p.feature.setProperties(t):p.feature.properties=t,N()}),a)for(var P in a)if(Object.prototype.hasOwnProperty.call(a,P)){var O,I=a[P],F="[data-field-name='"+P+"']";if((O=D.find(".select2Single"+F))&&O.length){try{if(O.find("option[value='"+I+"']").length)O.val(I),O.trigger("change");else{var E=new Option(I,I,!0,!0);O.append(E).trigger("change")}O.data("select2").$container.addClass("attribute-value-changed")}catch(e){console.log(e)}continue}if((O=D.find(".select2Multiple"+F))&&O.length){I+="";try{if((I=I.split(";")).length)for(var A=0;A<I.length;A++){var R=I[A];if(!O.find("option[value='"+R+"']").length){E=new Option(R,R,!0,!0);O.append(E)}}O.val(I),O.trigger("change"),O.data("select2").$container.addClass("attribute-value-changed"),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed")}catch(e){console.log(e)}continue}if((O=D.find('input[type!="checkbox"]'+F+",textarea"+F+",select"+F))&&O.length){O.val(I).addClass("attribute-value-changed"),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed");continue}if((O=D.find('input[type="checkbox"]'+F))&&O.length){O.prop("checked",!!I),O.addClass("attribute-value-changed"),O.parent().addClass("checkbox-attribute-value-changed"),D.find(".collapsible-panel").has(".attribute-value-changed").addClass("has-attribute-value-changed");continue}}function M(){p.autosave_timeoutId&&(clearTimeout(p.autosave_timeoutId),console.log("autosaved cleared"))}function N(){M(),app&&app.controller&&app.controller.storageService&&app.controller.storageService.delete(s).then(function(e){p._autosave_done=!1,console.log("autosaved data removed:"+s)}).catch(function(e){console.log("failed to remove autosaved data")})}M(),this.autosave_timeoutId=setTimeout(function(){!function e(){if(s){var t={},a={},i=0;for(var o in L(t),t)if(Object.prototype.hasOwnProperty.call(t,o)){var n=t[o];if(void 0===n&&(n=""),null===n&&(n=""),n+="",l&&o in l){var r=l[o];void 0===r&&(r=""),null===r&&(r=""),n!==r+""&&(a[o]=t[o],i++)}}i&&s&&app&&app.controller&&app.controller.storageService&&app.controller.storageService.set(s,a).then(function(e){p._autosave_done=!0,console.log(a),console.log("autosave done:"+s)}).catch(function(e){console.log("autosave failed")}),p.autosave_timeoutId=setTimeout(function(){e()},1e3*app.AttributePage_AutoSave_Timeout)}}()},1e3*app.AttributePage_AutoSave_Timeout)},FeatureAttributesTab.prototype.createRelationTabs=function(){if(this.layer){var e=this.layer.get("custom");this.dataRelationshipsTabs=[],this.dataRelationshipsContent={};var t,a=this.feature.get("_dataRelationships")||[];if(e&&e.dataObj&&(t=e.dataObj.dataRelationships),(this.dataRelationships=t)&&t.length)for(var i=0;i<t.length;i++){var o=JSON.parse(JSON.stringify(t[i]));o.rows=[];for(var n=0;n<a.length;n++)a[n].id==o.id&&(o.rows=JSON.parse(JSON.stringify(a[n].rows)));$('<li class=""><a href="#'+this.tabId+"-r"+i+'" data-toggle="tab"><i class="fa fa-chain"></i> '+(o._isOrigin?o.forwardLabel:o.backwardLabel)+"</a> </li>").appendTo(this.parentDialog.tabPanelNav);var r=$('<div class="tab-pane " id="'+this.tabId+"-r"+i+'"></div>').appendTo(this.parentDialog.tabPanelContent);this.dataRelationshipsTabs.push(r),$(r).data("dataRelationship",o),this.fillRelationTabRows(r)}}},FeatureAttributesTab.prototype.fillRelationTabRows=function(i){var o=this,n=$(i).data("dataRelationship");if(n){var r=n._isOrigin?n.destinationDatasetDetails.fields:n.originDatasetDetails.fields,e=n.rows||[],t='<div class=" form-horizontal">';t+='  <div class="form-group">',t+='    <table  class="table table-condensed table-hover table-responsive" >',t+="    <thead>",t+="      <tr>",t+="        <th></th>";for(var a=0;a<r.length&&a<4;a++)t+="      <th>"+(r[a].alias||r[a].name)+"</th>";t+="      </tr>",t+="    </thead>",t+="    <tbody>";for(var s=0,l=0;l<e.length;l++){var c=e[l],d=c.properties._editInfo,p="";d&&"delete"==d.action?p+=" featureAttributes_row_deleted":d&&d.modified&&("insert"==d.action?p+=" featureAttributes_row_inserted":p+=" featureAttributes_row_modified"),t+='      <tr class="'+p+'" >',t+="        <td>",d&&"delete"==d.action?t+='          <button style="margin: 2px;" type="button" data-row="'+l+'" class="remove btn btn-xs btn-danger\t" title="UnDelete" ><span class="glyphicon glyphicon-repeat"></span></button>':(t+='          <button style="margin: 2px;" type="button" data-row="'+l+'" class="remove btn btn-xs btn-danger\t" title="Delete" ><span class="glyphicon glyphicon-remove"></span></button>',s++),t+='          <button style="margin: 2px;" type="button" data-row="'+l+'" class="edit btn btn-xs btn-info\t" title="Edit" ><span class="glyphicon glyphicon-edit"></span></button>',t+="        </td>";for(a=0;c.properties&&a<r.length&&a<4;a++){var u=c.properties[r[a].name];void 0===u&&(u=null),t+="      <td>"+u+"</td>"}t+="      </tr>"}t+="    </tbody>",("OneToMany"==n.cardinality||"ManyToMany"==n.cardinality||"OneToOne"==n.cardinality&&s<1)&&(t+="    <tfoot>",t+="      <tr>",t+="        <th>",t+='          <button style="margin: 2px;" type="button"  class="addrow btn btn-xs btn-primary\t" title="Add new row" ><span class="glyphicon glyphicon-plus"></span> Add</button>',t+="        </th>",t+="      </tr>",t+="    </tfoot>"),t+="  </table>",t+="  </div>",t+="</div>",i.html(t),i.find("button.remove").click(function(){var e=$(this).data("row"),t=n.rows[e];t.properties._editInfo=t.properties._editInfo||{},"insert"==t.properties._editInfo.action?n.rows.splice(e,1):("delete"==t.properties._editInfo.action?(t.properties._editInfo.action="undelete",t.properties._editInfo.modified=t.properties._editInfo.modified):t.properties._editInfo.action="delete",n._editInfo=n._editInfo||{},n._editInfo.modified=!0),o.fillRelationTabRows(i)}),i.find("button.addrow").click(function(){$(this).data("row");var t={id:-1,properties:{}},e={}.defaultFieldToEdit;new ObjectPropertiesDlg(o.mapContainer,{fields:r,dataRelationship:n,feature:t,defaultFieldToEdit:e},{title:"Edit attributes",tabs:[new FeatureAttributesTab],onapply:function(e){t.properties._editInfo=t.properties._editInfo||{},t.properties._editInfo.action="insert",t.properties._editInfo.modified=!0,n._editInfo=n._editInfo||{},n._editInfo.modified=!0,n.rows.push(t),o.fillRelationTabRows(i)},helpLink:"/help#editing_attributes"}).show()}),i.find("button.edit").click(function(){var e=$(this).data("row"),t=n.rows[e],a={}.defaultFieldToEdit;new ObjectPropertiesDlg(o.mapContainer,{fields:r,dataRelationship:n,feature:t,defaultFieldToEdit:a},{title:"Edit attributes",tabs:[new FeatureAttributesTab],onapply:function(e){t.properties._editInfo=t.properties._editInfo||{},"insert"!=t.properties._editInfo.action&&(t.properties._editInfo.action="update"),t.properties._editInfo.modified=!0,n._editInfo=n._editInfo||{},n._editInfo.modified=!0,o.fillRelationTabRows(i)},helpLink:"/help#editing_attributes"}).show()})}},FeatureAttributesTab.prototype.getTextInput=function(e,t,a){var i=e.name,o=t[i],n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);var l=!1;!e.default&&s&&(l=!0),void 0===o&&(o=""),null===o&&(o="");var c="";s||(c=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(c=e.default);var d=!1,p=!1,u=htm="";return this.defaultFieldToEdit==e.name&&(u="autofocus"),(!e.length||200<e.length)&&(p=!0),e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+=p?'    <textarea data-field-name="'+e.name+'" '+u+' name="'+a+'" id="'+a+'" rows="4" placeholder="'+c+'" class="form-control" ':'    <input type="text" data-field-name="'+e.name+'" '+u+' name="'+a+'" id="'+a+'" value="'+o+'" placeholder="'+c+'" class="form-control" ',r||(htm+=" readonly "),l&&(d=!0,htm+=' data-val-required="'+n+' is required"'),e.length&&(d=!0,htm+=' data-val-length="Input length exceeds maximum length of '+e.length+' characters" data-val-length-max="'+e.length+'" '),d&&r&&(htm+=' data-val="true"'),htm+=p?" >"+o+"</textarea>":"    />",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+='    <span class="field-validation-valid" data-valmsg-for="'+a+'" data-valmsg-replace="true"></span>',htm+="  </div>",htm},FeatureAttributesTab.prototype.getNillInput=function(e,t,a){var i=e.name,o=(t[i],this.field_i18n(e,"alias",e.alias)||i);htm="";return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+o+"</label>",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+="  </div>",htm},FeatureAttributesTab.prototype.getDateTimeInput=function(e,t,a){var i=e.name,o=t[i],n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);var l=!1;!e.default&&s&&(l=!0),void 0===o&&(o=""),null===o&&(o="");var c="";s||(c=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(c=e.default);var d="";this.defaultFieldToEdit==e.name&&(d="autofocus"),htm="";var p=!1;return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+='    <input type="text" data-field-name="'+e.name+'" '+d+' name="'+a+'" id="'+a+'" value="'+o+'" placeholder="'+c+'" class="form-control" ',r||(htm+=" readonly "),l&&(p=!0,htm+=' data-val-required="'+n+' is required"'),p&&r&&(htm+=' data-val="true"'),htm+="    />",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+='    <span class="field-validation-valid" data-valmsg-for="'+a+'" data-valmsg-replace="true"></span>',htm+="  </div>",htm},FeatureAttributesTab.prototype.getDateInput=function(e,t,a){var i=e.name,o=t[i],n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);var l=!1;!e.default&&s&&(l=!0),void 0===o&&(o=""),null===o&&(o="");var c="";s||(c=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(c=e.default);var d="";this.defaultFieldToEdit==e.name&&(d="autofocus"),htm="";var p=!1;return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+='    <input type="date" data-field-name="'+e.name+'" '+d+'  name="'+a+'" id="'+a+'" value="'+o+'" placeholder="'+c+'" class="form-control" ',r||(htm+=" readonly "),l&&(p=!0,htm+=' data-val-required="'+n+' is required"'),p&&r&&(htm+=' data-val="true"'),htm+="    />",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+='    <span class="field-validation-valid" data-valmsg-for="'+a+'" data-valmsg-replace="true"></span>',htm+="  </div>",htm},FeatureAttributesTab.prototype.getIntegerInput=function(e,t,a){var i=e.name,o=e.type.toLowerCase(),n=t[i],r=this.field_i18n(e,"alias",e.alias)||i,s=!0,l=e.notNull;void 0!==e.editable&&(s=e.editable);var c=!1;!e.default&&l&&(c=!0),void 0===n&&(n=""),null===n&&(n="");var d="";l||(d=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(d=e.default);var p="";this.defaultFieldToEdit==e.name&&(p="autofocus"),htm="";var u=!1;e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+r+"</label>",app.isMobile()?htm+='    <input type="text" inputmode="numeric" data-field-name="'+e.name+'" '+p+' name="'+a+'" id="'+a+'" value="'+n+'" placeholder="'+d+'" class="form-control" ':htm+='    <input type="number"  data-field-name="'+e.name+'" '+p+' name="'+a+'" id="'+a+'" value="'+n+'" placeholder="'+d+'" class="form-control" ',s||(htm+=" readonly "),u=!0,htm+=' data-val-integer="Input an integer" ',c&&(u=!0,htm+=' data-val-required="'+r+' is required"');var h="";if("smallint"==o?(u=!0,h+=' data-val-range="Input a number  from -32768 to +32767" data-val-range-min="-32768" data-val-range-max="32767" ',h+=' min="-32768" max="32767" '):"integer"==o?(u=!0,h+=' data-val-range="Input a number  from -2147483648 to +2147483647" data-val-range-min="-2147483648" data-val-range-max="2147483647" ',h+=' min="-2147483648" max="2147483647" '):"bigint"==o&&(u=!0,h+=' data-val-range="Input a number  from -9223372036854775808 to +9223372036854775807" data-val-range-min="-9223372036854775808" data-val-range-max="9223372036854775807" ',h+=' min="-9223372036854775808" max="9223372036854775807" '),e.domain&&"range"==e.domain.type){var f="",m="";void 0!==e.domain.minValue&&"undefined"!==e.domain.minValue&&""!==e.domain.minValue&&(m=' min="'+e.domain.minValue+'"  ',m+=' max="9223372036854775807"  ',m+=' data-val-range-min="'+e.domain.minValue+'"  ',m+=' data-val-range-max="9223372036854775807"  ',f=' data-val-range="Value must be >= '+e.domain.minValue+'"',u=!0),void 0!==e.domain.maxValue&&"undefined"!==e.domain.maxValue&&""!==e.domain.maxValue&&(m=' min="-9223372036854775808"  ',m+=' max="'+e.domain.maxValue+'"  ',m+=' data-val-range-min="-9223372036854775808"  ',m+=' data-val-range-max="'+e.domain.maxValue+'"  ',f=' data-val-range="Value must be <= '+e.domain.maxValue+'"',u=!0),void 0!==e.domain.minValue&&"undefined"!==e.domain.minValue&&""!==e.domain.minValue&&void 0!==e.domain.maxValue&&"undefined"!==e.domain.maxValue&&""!==e.domain.maxValue&&(m=' min="'+e.domain.minValue+'"  ',m+=' max="'+e.domain.maxValue+'"  ',m+=' data-val-range-min="'+e.domain.minValue+'"  ',m+=' data-val-range-max="'+e.domain.maxValue+'"  ',f=' data-val-range="Value must be between '+e.domain.minValue+" and "+e.domain.maxValue+'"',u=!0),f&&(htm+=m,htm+=f,h="")}return htm+=h+" ",u&&s&&(htm+=' data-val="true"'),htm+="    />",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+='    <span class="field-validation-valid" data-valmsg-for="'+a+'" data-valmsg-replace="true"></span>',htm+="  </div>",htm},FeatureAttributesTab.prototype.getNumberInput=function(e,t,a){var i=e.name,o=(e.type.toLowerCase(),t[i]),n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);var l=!1;!e.default&&s&&(l=!0),void 0===o&&(o=""),null===o&&(o="");var c="";s||(c=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(c=e.default);var d="";this.defaultFieldToEdit==e.name&&(d="autofocus"),htm="";var p=!1;if(e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",app.isMobile()?htm+='    <input type="text" inputmode="numeric" data-field-name="'+e.name+'" '+d+'  name="'+a+'" id="'+a+'" value="'+o+'" placeholder="'+c+'" class="form-control" ':htm+='    <input type="number"  data-field-name="'+e.name+'" '+d+'  name="'+a+'" id="'+a+'" value="'+o+'" placeholder="'+c+'" class="form-control" ',r||(htm+=" readonly "),l&&(p=!0,htm+=' data-val-required="'+n+' is required"'),p=!0,htm+=' data-val-number="Input a number" ',e.domain&&"range"==e.domain.type){var u="",h="";void 0!==e.domain.minValue&&"undefined"!==e.domain.minValue&&""!==e.domain.minValue&&(h=' min="'+e.domain.minValue+'"  ',h+=' max="9223372036854775807"  ',h+=' data-val-range-min="'+e.domain.minValue+'"  ',h+=' data-val-range-max="9223372036854775807"  ',u=' data-val-range="Value must be >= '+e.domain.minValue+'"',p=!0),void 0!==e.domain.maxValue&&"undefined"!==e.domain.maxValue&&""!==e.domain.maxValue&&(h=' min="-9223372036854775808"  ',h+=' max="'+e.domain.maxValue+'"  ',h+=' data-val-range-min="-9223372036854775808"  ',h+=' data-val-range-max="'+e.domain.maxValue+'"  ',u=' data-val-range="Value must be <= '+e.domain.maxValue+'"',p=!0),void 0!==e.domain.minValue&&"undefined"!==e.domain.minValue&&""!==e.domain.minValue&&void 0!==e.domain.maxValue&&"undefined"!==e.domain.maxValue&&""!==e.domain.maxValue&&(h=' min="'+e.domain.minValue+'"  ',h+=' max="'+e.domain.maxValue+'"  ',h+=' data-val-range-min="'+e.domain.minValue+'"  ',h+=' data-val-range-max="'+e.domain.maxValue+'"  ',u=' data-val-range="Value must be between '+e.domain.minValue+" and "+e.domain.maxValue+'"',p=!0),u&&(htm+=h,htm+=u)}return p&&r&&(htm+=' data-val="true"'),htm+="    />",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+='    <span class="field-validation-valid" data-valmsg-for="'+a+'" data-valmsg-replace="true"></span>',htm+="  </div>",htm},FeatureAttributesTab.prototype.getBoolInput=function(e,t,a){var i=e.name,o=(e.type.toLowerCase(),t[i]),n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);var l=!1;!e.default&&s&&(l=!0),void 0===o&&(o="Null"),null===o&&(o="Null");s||app.DROPDOWN_NULL,void 0!==e.default&&(e.default,l=!0);var c="";this.defaultFieldToEdit==e.name&&(c="autofocus"),htm="";return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',l?(htm+='    <label class="">',htm+='    <input type="checkbox" data-field-name="'+e.name+'" '+c+'  name="'+a+'" id="'+a+'" value=""  class="" ',"Null"==o&&(o=null),o&&(htm+='    checked="checked"'),r||(htm+=" readonly "),htm+=" />",htm+=n,htm+="    </label>"):(htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+='    <select data-field-name="'+e.name+'" '+c+' name="'+a+'" id="'+a+'"  class="form-control" ',r||(htm+=" disabled "),htm+=" >",htm+='    <option value="1" '+(o?'selected="selected"':"")+" >True</option>",htm+='    <option value="0" '+(o?"":'selected="selected"')+" >False</option>",htm+='    <option value="" '+("Null"==o?'selected="selected"':"")+" >"+app.DROPDOWN_NULL||"Null</option>",htm+="    </select>"),e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+="  </div>",htm},FeatureAttributesTab.prototype.getFilesInput=function(e,t,a,i){var o=e.name,n=(e.type.toLowerCase(),t[o]),r="";a&&a[o]&&(n=a[o],r="attribute-value-changed");var s=this.field_i18n(e,"alias",e.alias)||o,l=!0,c=e.notNull;void 0!==e.editable&&(l=e.editable);e.default,void 0===n&&(n="Null"),null===n&&(n="Null");c||app.DROPDOWN_NULL,void 0!==e.default&&e.default;this.defaultFieldToEdit,e.name,htm="";var d=[];if(n)try{d=JSON.parse(n)}catch(e){}this.fileInfosStorage[i]=d;return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="'+r+'" for="'+i+'">'+s+"</label>",htm+="  </div>",htm+='  <div class="form-group" id="'+i+'-panel">',htm+=this.getFileListContent(d,i),e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+="  </div>",l&&(htm+='<div class="container upload-commands">',htm+='<button  type="button" data-field-name="'+e.name+'" data-field-key="'+i+'"  class="btn btn-default form-control___ uploadfile "><span class="glyphicon glyphicon-upload"></span></button>',(!e.defaultMimeType||e.defaultMimeType&&-1<e.defaultMimeType.indexOf("image/"))&&navigator&&navigator.camera&&(htm+='<button  type="button" data-field-name="'+e.name+'" data-field-key="'+i+'"  class="btn btn-primary form-control___ cameraCapture "><span class="glyphicon glyphicon-camera"></span></button>'),(!e.defaultMimeType||e.defaultMimeType&&-1<e.defaultMimeType.indexOf("audio/"))&&"undefined"!=typeof Media&&(htm+='<button  type="button" data-field-name="'+e.name+'" data-field-key="'+i+'"  class="btn btn-primary form-control___ startRecordAudio "><span class="glyphicon glyphicon-record"></span></button>',htm+='<button style="display:none;"  type="button" data-field-name="'+e.name+'" data-field-key="'+i+'"  class="btn btn-danger form-control___ stopRecordAudio "><span class="glyphicon glyphicon-stop"></span></button>',htm+='<div style="display:none;" class="progress audioAmplitude_progress">',htm+='<div   class="progress-bar progress-bar-success progress-bar-striped active audioAmplitude"  style="width:0%"> Recording Audio </div>',htm+="</div>"),htm+="</div>"),htm},FeatureAttributesTab.prototype.getFileListContent=function(e,t){for(var a="",i=0;e&&i<e.length;i++){var o=e[i],n="";"new"==o.action?n="info":"delete"==o.action&&(n="danger"),a+='<div class="form-group row '+n+'">',a+='<div class="col-xs-2">',"new"==o.action?a+=' <button type="button" class="remove-attachment btn btn-xs btn-danger\t" data-field-key="'+t+'" data-file-index="'+i+'"   title="Remove"  style="" ><span class="glyphicon glyphicon-remove"></span> </button>':"delete"==o.action?a+=' <button type="button" style="text-decoration: line-through;" class="undelete-attachment btn btn-xs btn-warning\t" data-field-key="'+t+'" data-file-index="'+i+'" title="Undelete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button>':a+=' <button type="button" class="delete-attachment btn btn-xs btn-danger\t" data-field-key="'+t+'"  data-file-index="'+i+'" title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button>',a+="</div>","delete"==o.action?a+='<div class="col-xs-10" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-decoration: line-through;">':a+='<div class="col-xs-10" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">',o.name&&(o.id&&o.dataset?app.get_attachment_url?(a+='    <a  target="_blank" data-file-id="'+o.id+'" href="'+app.get_attachment_url(o.dataset,o.id,!1)+'">'+o.name,o.thumbnail&&(a+='<img style="display: block;max-width: 100%;" src="'+app.get_attachment_url(o.dataset,o.id,!0)+'" />'),a+="</a>","audio/mp3"==o.mimeType||"audio/mp4"==o.mimeType||"audio/m4a"==o.mimeType||"audio/x-m4a"==o.mimeType||"audio/mpeg"==o.mimeType?(a+=' <audio controls style="display:block;    width: 100%; max-width: 300px;" >',a+='    <source src="'+app.get_attachment_url(o.dataset,o.id)+'" type="'+o.mimeType+'">',a+="           Player not supported.",a+=" </audio>"):"video/mp4"!=o.mimeType&&"video/mpeg"!=o.mimeType||(a+=' <video controls style="display:block;    width: 100%; max-width: 300px;" >',a+='    <source src="'+app.get_attachment_url(o.dataset,o.id)+'" type="'+o.mimeType+'">',a+="           Player not supported.",a+=" </video>")):(a+='    <a  target="_blank" data-file-id="'+o.id+'" href="/dataset/'+o.dataset+"/attachment/"+o.id+'">'+o.name,a+="</a>"):(a+="    <span>"+o.name+"</span>",o.thumbnail_dataUrl?a+='<img style="display: block;max-width: 100%;" src="'+o.thumbnail_dataUrl+'" />':o.dataUrl&&o.mimeType&&-1<o.mimeType.indexOf("image/")&&(a+='<img style="display: block;max-width: 100%;" src="'+o.dataUrl+'" />'),o.dataUrl&&("audio/mp3"==o.mimeType||"audio/mp4"==o.mimeType||"audio/m4a"==o.mimeType||"audio/x-m4a"==o.mimeType||"audio/mpeg"==o.mimeType?(a+=' <audio controls style="display:block;    width: 100%; max-width: 300px;" >',a+='    <source src="'+o.dataUrl+'" type="'+o.mimeType+'">',a+="           Player not supported.",a+=" </audio>"):"video/mp4"!=o.mimeType&&"video/mpeg"!=o.mimeType||(a+=' <video controls style="display:block;    width: 100%; max-width: 300px;" >',a+='    <source src="'+o.dataUrl+'" type="'+o.mimeType+'">',a+="           Player not supported.",a+=" </video>")))),a+="</div>",a+="</div>"}return a},FeatureAttributesTab.prototype.getDocumentListInput=function(e,t,a){var i=e.name,o=(e.type.toLowerCase(),t[i]),n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull;void 0!==e.editable&&(r=e.editable);e.default,void 0===o&&(o=""),null===o&&(o="");void 0!==e.default&&e.default;this.defaultFieldToEdit,e.name,htm="";var l=[];if(o)try{l=o.split(",")}catch(e){}return e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+='    <input type="hidden" name="'+a+'" id="'+a+'" data-field-name="'+e.name+'" value="'+o+'" readonly class="form-control"></input>',htm+="  </div>",htm+='  <div style="margin-bottom:0;" class="form-group docListPanel" id="'+a+'-panel">',htm+=this.getDocumenListContent(l,a),htm+="  </div>",r&&(htm+='<div class="btn-toolbar">',htm+='  <button  type="button" data-field-name="'+e.name+'" data-field-key="'+a+'"  class="btn btn-xs btn-primary form-control___ uploadDocument " title="بارگذاری سند" ><span class="glyphicon glyphicon-cloud-upload"></span></button>',htm+='  <button  type="button" data-field-name="'+e.name+'" data-field-key="'+a+'"  class="btn btn-xs btn-primary form-control___ selectDocument " title="انتخاب سند" ><span class="glyphicon glyphicon-paperclip"></span></button>',htm+="</div>"),htm},FeatureAttributesTab.prototype.getDocumenListContent=function(e,t){var a="";fld.description&&(a+='  <div class="form-group" style="margin-bottom: 0;"  >',a+='      <p class="">'+this.field_i18n(fld,"description",fld.description)+"</p>",a+="  </div>");for(var i=0;e&&i<e.length;i++){var o=e[i];a+='<div style="margin-bottom: 5px;"  class="form-group row">',a+='<div class="col-sm-1">',a+='   <button type="button" class="remove-document btn btn-xs btn-warning\t" data-field-key="'+t+'" data-doc-index="'+i+'"   title="Remove"  style="" ><span class="glyphicon glyphicon-remove"></span> </button>',a+="</div>",a+='<div class="col-sm-11 document_item_" data-doc-id="'+o+'" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"">',a+='    <a  target="_blank" data-doc-id="'+o+'" href="/document/'+o+'">'+o+"</a>",a+="</div>",a+="</div>"}return a},FeatureAttributesTab.prototype.updateAllDocumenListContent=function(){},FeatureAttributesTab.prototype.updateDocumenListContent=function(e){e.find(".document_item_").each(function(e){var a=$(this),i=a.data("doc-id");$.ajax({url:"/document/"+i+"/info",dataType:"json",success:function(e){if(e&&e.id){var t='    <a  target="_blank" data-doc-id="'+i+'" href="/document/'+i+'">';e.thumbnail?t+='<img style="" src="'+e.thumbnail+'" />':e.icon&&(t+='     <i style="" class="avatar fa fa-file-o fa-file-'+e.icon+'-o" > </i>'),t+=e.name+"</a>",a.html(t)}else a.parent().remove()}})})},FeatureAttributesTab.prototype.getCodedValuesInput=function(e,t,a){var i=e.name,o=(e.type.toLowerCase(),t[i]),n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull,l=e.domain.items;void 0!==e.editable&&(r=e.editable);var c=!1;!e.default&&s&&(c=!0),void 0===o&&(o="Null"),null===o&&(o="Null");s||app.DROPDOWN_NULL,void 0!==e.default&&e.default;var d="";this.defaultFieldToEdit==e.name&&(d="autofocus"),htm="";e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",htm+='    <select data-field-name="'+e.name+'" '+d+' name="'+a+'" id="'+a+'"  class="form-control" ',r||(htm+=" disabled "),htm+=">";for(var p=0;p<l.length;p++){var u=l[p],h=this.field_i18n(e,"codedValues",u.value);htm+='    <option value="'+u.code+'" '+(o+""==u.code+""?'selected="selected"':"")+" >"+h+"</option>"}return c||(htm+='    <option value="Null" '+("Null"==o?'selected="selected"':"")+" >"+app.DROPDOWN_NULL||"Null</option>"),htm+="    </select>",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+="  </div>",htm},FeatureAttributesTab.prototype.getCodedValuesInput_select2=function(e,t,a){var i=e.name,o=(e.type.toLowerCase(),t[i]),n=this.field_i18n(e,"alias",e.alias)||i,r=!0,s=e.notNull,l=e.domain.items;void 0!==e.editable&&(r=e.editable);var c=!1;!e.default&&s&&(c=!0),void 0===o&&(o=""),null===o&&(o="");var d=[];o&&(d=(o+"").split(";"));var p="";s||(p=app.DROPDOWN_NULL||"Null"),void 0!==e.default&&(p=e.default);var u="";this.defaultFieldToEdit==e.name&&(u="autofocus"),htm="";e.description&&(htm+='  <div class="form-group" style="margin-bottom: 0;"  >',htm+='      <p class="">'+this.field_i18n(e,"description",e.description)+"</p>",htm+="  </div>"),htm+='  <div class="form-group">',htm+='    <label class="" for="'+a+'">'+n+"</label>",e.domain.multipleChoice?htm+='    <select data-field-name="'+e.name+'" '+u+' name="'+a+'[]" id="'+a+'"  class="select2Multiple form-control" multiple="multiple" style="width:auto;_width_:100%;" ':htm+='    <select data-field-name="'+e.name+'" '+u+' name="'+a+'" id="'+a+'"  class="select2Single form-control" style="width:auto;_width_:100%;" ',r||(htm+=" disabled "),e.domain.editable&&(htm+='   data-tags="true" '),c||(htm+='   data-allow-clear="true" '),p&&(htm+='   data-placeholder="'+p+'" '),htm+=" >",e.domain.multipleChoice||c||(htm+="    <option></option>");for(var h=0;h<d.length;h++){for(var f=o=d[h],m=0;m<l.length;m++){var g=l[m];g.code+""==o&&(f=g.value)}htm+='    <option value="'+o+'" selected="selected" >'+this.field_i18n(e,"codedValues",f)+"</option>"}return htm+="    </select>",e.hint&&(htm+='      <small class="text-muted">'+this.field_i18n(e,"hint",e.hint)+"</small>"),htm+="  </div>",htm},FeatureShapeTab.prototype.init=function(e){this.parentDialog=e},FeatureShapeTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},FeatureShapeTab.prototype.applied=function(e){this.feature=e.feature,this.layer=e.layer,this.transactFeature=e.transactFeature;var t="";if(this.layer&&this.feature){var a=this.layer.get("custom");a&&a.dataObj&&(t=a.shapeType)}return!!t&&"Point"!=t},FeatureShapeTab.prototype.create=function(e,t){var n=this,i=this.parentDialog.mapContainer.map.getView().getProjection();this.feature=e.feature,this.feature&&this.feature.clone&&(this.origFeature=this.feature.clone());var a=this.feature.getGeometry();this.layer=e.layer;var o="";t&&(o="active");var r=$('<li class="'+o+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-code"></i> Shape</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+o+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var s='<div><form id="'+n.tabId+'_form" class="modal-body form-horizontal">';s+='  <div class="form-group">',s+='    <label class="" for="wkt">WKT:</label>';var l="";l=(new ol.format.WKT).writeGeometry(a,{dataProjection:"EPSG:4326",featureProjection:i}),s+='    <textarea type="text" name="wkt" rows="10" id="wkt"  placeholder="" class="form-control" data-val="true" data-val-required="WKT text is required">'+(l=this.formatWkT(l))+"</textarea>",s+='    <span class="field-validation-valid" data-valmsg-for="wkt" data-valmsg-replace="true"></span>',s+='    <span id="wktParseError" class="field-validation-error"></span>',s+="  </div>",s+="</form></div>";var c=$(s).appendTo(this.tab);c.find("#wktParseError").hide(),c.find("#wkt").on("input",function(){$(this).trigger("change")}),c.find("#wkt").change(function(){var e=$(this).val();if(c.find("#wktParseError").hide(),e){var t=new ol.format.WKT;try{var a=t.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:i});a&&n.feature.setGeometry(a)}catch(e){c.find("#wktParseError").text(e.message),c.find("#wktParseError").show()}}});var d=$(c.find("#"+n.tabId+"_form"));d.find("input,textarea,select").change(function(){$(this).addClass("attribute-value-changed")}),this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(d),$.validator.setDefaults({ignore:t}),d.validate(),d.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=d.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){n.origFeature&&n.feature&&n.feature.setGeometry(n.origFeature.getGeometry())}),this.parentDialog.applyHandlers.push(function(e){c.find("#wkt").val()})},FeatureShapeTab.prototype.formatWkT=function(e){if(!e)return e;for(var t=function(e){var t,a=[];for(t=0;t<e;t++)a.push(" ");return a.join("")},a=e.replace(/\n/g," ").replace(/\r/g," "),i=[],o=0,n=!1,r=0,s=a.length;r<s;r++){var l=a.charAt(r);n&&l===n?"\\"!==a.charAt(r-1)&&(n=!1):n||'"'!==l&&"'"!==l?n||" "!==l&&"\t"!==l?n||","!==l?n||"("!==l&&"["!==l&&"{"!==l?n||")"!==l&&"]"!==l&&"}"!==l||(l="\n"+t(2*--o)+l):l+="\n"+t(2*++o):l+="\n"+t(2*o):l=" ":n=l,i.push(l)}return i.join("")},FeaturePointTab.prototype.init=function(e){this.parentDialog=e},FeaturePointTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},FeaturePointTab.prototype.applied=function(e){this.feature=e.feature,this.layer=e.layer,this.transactFeature=e.transactFeature;var t="";if(this.layer&&this.feature){var a=this.layer.get("custom");a&&a.dataObj&&(t=a.shapeType)}return"Point"==t},FeaturePointTab.prototype.create=function(e,t){var n=this,i=this.parentDialog.mapContainer.map.getView().getProjection();this.feature=e.feature,this.feature&&this.feature.clone&&(this.origFeature=this.feature.clone());var a=this.feature.getGeometry();this.layer=e.layer;var o="";t&&(o="active");var r=$('<li class="'+o+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-code"></i> Coordinates</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+o+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var s='<div><form id="'+n.tabId+'_form" class="modal-body form-horizontal">',l="",c="";if(a)try{var d=a.clone();d.transform(i,"EPSG:4326"),c=d.getCoordinates()[0],l=d.getCoordinates()[1]}catch(e){}s+='  <div class="form-group">',s+='    <label class="" for="longitude">Longitude:</label>',s+='    <input type="number" name="longitude" id="longitude" value="'+c+'" placeholder="Longitude in decimal degrees" class="form-control" data-val="true" data-val-required="Longitude is required"  />',s+='    <span class="field-validation-valid" data-valmsg-for="longitude" data-valmsg-replace="true"></span>',s+="  </div>",s+='  <div class="form-group">',s+='    <label class="" for="latitude">Latitude:</label>',s+='    <input type="number" name="latitude" id="latitude" value="'+l+'" placeholder="Latitude in decimal degrees" class="form-control" data-val="true" data-val-required="Latitude is required"  />',s+='    <span class="field-validation-valid" data-valmsg-for="latitude" data-valmsg-replace="true"></span>',s+="  </div>",s+="</form></div>";var p=$(s).appendTo(this.tab),u=function(){try{var e=p.find("#latitude").val(),t=p.find("#longitude").val();e=parseFloat(e),t=parseFloat(t);var a=new ol.geom.Point([t,e]);a.transform("EPSG:4326",i),n.feature.setGeometry(a)}catch(e){}};p.find("#latitude").on("input",function(){$(this).trigger("change")}),p.find("#latitude").change(function(){u()}),p.find("#longitude").on("input",function(){$(this).trigger("change")}),p.find("#longitude").change(function(){u()});var h=$(p.find("#"+n.tabId+"_form"));h.find("input,textarea,select").change(function(){$(this).addClass("attribute-value-changed")}),this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(h),$.validator.setDefaults({ignore:t}),h.validate(),h.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=h.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){n.origFeature&&n.feature&&n.feature.setGeometry(n.origFeature.getGeometry())}),this.parentDialog.applyHandlers.push(function(e){p.find("#wkt").val()})},StyleImageTab.prototype.init=function(e){this.parentDialog=e},StyleImageTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},StyleImageTab.prototype.applied=function(e){return!0},StyleImageTab.prototype.create=function(e,t){var n=this,a="";t&&(a="active"),this.style=e,this.org_style=this.style.clone(),this.orig_image=this.org_style.getImage(),this.orig_image&&(this._image=this.orig_image),this._image||(this._image=StyleFactory.randomStyle().getImage(),this.org_style.setImage(this._image));var i="";this._image instanceof ol.style.Circle?(i="Circle",this._origCircle=this._image):this._image instanceof ol.style.FontSymbol?(i="FontSymbol",this._origFontSymbol=this._image):this._image instanceof ol.style.Icon?(i="Icon",this._origIcon=this._image):this._image instanceof ol.style.RegularShape&&(i="RegularShape",this._origRegularShapee=this._image);var r=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-map-marker-alt"></i> '+n.caption+"</a> </li>").appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var o="<div>";o+='    <div id="style_sampleContainer" class="panel-body">',o+="    </div>",o+='<form id="'+n.tabId+'_form" class="modal-body form-horizontal">',o+='<div class="form-group">',o+='  <label class="col-sm-3_" for="symbolType">Type:</label>',o+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#style_point">?</a>',o+='    <select class="form-control " id="symbolType" >',o+='                          <option value="Circle" '+("Circle"==i?'selected="selected"':"")+" >Simple</option>",o+='                          <option value="FontSymbol" '+("FontSymbol"==i?'selected="selected"':"")+">Advanced</option>",o+="    </select>",o+=" </div>",o+='    <div id="symbolTypeContent" class="panel-body">',o+="    </div>",o+="",o+="",o+="",o+="",o+="",o+="",o+="</form></div>";var s=$(o).appendTo(this.tab);n.content=s,n.symbolTypeContent=s.find("#symbolTypeContent"),s.find("#symbolType").change(function(){var e=$(this).val();"Circle"==e?(n._origCircle||(n._origCircle=StyleFactory.randomStyle().getImage()),n._image=n._origCircle):"FontSymbol"==e&&(n._origFontSymbol||(n._origFontSymbol=new ol.style.FontSymbol({form:"",gradient:!1,glyph:"maki-circle",fontSize:1,fontStyle:"",radius:12,offsetX:0,offsetY:0,rotation:0,rotateWithView:!1,color:"#0000ff",fill:new ol.style.Fill({color:"white"}),stroke:new ol.style.Stroke({color:"#000000",width:1})})),n._image=n._origFontSymbol),n.populateSettingPanel()}),n.populateSettingPanel();var l=$(s.find("#"+n.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(l),$.validator.setDefaults({ignore:t}),l.validate(),l.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=l.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){}),this.parentDialog.applyHandlers.push(function(e){n.style.setImage(n._image)})},StyleImageTab.prototype.drawSample=function(){this.org_style.setImage(this._image);var e=StyleFactory.renderStyleSample(this.org_style,{width:80,height:40,type:"Point"});this.content.find("#style_sampleContainer").html(e)},StyleImageTab.prototype.populateSettingPanel=function(){this._image&&(this._image instanceof ol.style.Circle?this.populateCirclePanel():this._image instanceof ol.style.FontSymbol&&this.populateFontSymbolPanel())},StyleImageTab.prototype.populateCirclePanel=function(){var a=this;a.symbolTypeContent.html("");a.symbolTypeContent.html('  <div class="form-group">    <label class="" for="radius">Radius</label>    <input type="range" min="0" max="30" value="" name="radius" id="radius"  />  </div>  <div class="form-group">    <label class="" for="fillColor">Fill color</label>    <div id="fillColorPicker" class="input-group colorpicker-component">      <input type="text" value="" id="fillColor" class="form-control" />      <span class="input-group-addon"><i></i></span>    </div>  </div>  <div class="form-group">    <label class="" for="strokeColor">Border color</label>    <div id="strokeColorPicker" class="input-group colorpicker-component">      <input type="text" value="" id="strokeColor" class="form-control" />      <span class="input-group-addon"><i></i></span>    </div>  </div>    <label class="" for="strokeWidth">Border width</label>    <input type="number" name="strokeWidth" id="strokeWidth" value="" placeholder="Border width" class="form-control" data-val="true" data-val-required="Border width is required" data-val-range="Input a number  from 0 to 20" min="0" max="20" data-val-range-min="0" data-val-range-max="20" />    <span class="field-validation-valid" data-valmsg-for="strokeWidth" data-valmsg-replace="true"></span>  </div>  <div class="form-group">    <label class="" for="opacity">Opacity</label>    <input type="range" min="0" max="100" value="" name="opacity" id="opacity"  />  </div>'),a.symbolTypeContent.find("input[type=range]").on("input",function(){$(this).trigger("change"),$(this).attr("title",$(this).val())}),a.drawSample(),a.symbolTypeContent.find("#radius").val(this._image.getRadius()),a.symbolTypeContent.find("#radius").attr("title",this._image.getRadius()),a.symbolTypeContent.find("#radius").change(function(){a._image.setRadius(1*$(this).val()),a.drawSample()}),a.symbolTypeContent.find("#fillColorPicker").colorpicker({color:this._image.getFill().getColor()}).on("changeColor",function(e){var t=e.color.toString();a._image.getFill().setColor(t),a._image.setRadius(a._image.getRadius()),a.drawSample()}),a.symbolTypeContent.find("#strokeColorPicker").colorpicker({color:this._image.getStroke().getColor()}).on("changeColor",function(e){var t=e.color.toString();a._image.getStroke().setColor(t),a._image.setRadius(a._image.getRadius()),a.drawSample()}),a.symbolTypeContent.find("#strokeWidth").on("input",function(){$(this).trigger("change")}),a.symbolTypeContent.find("#strokeWidth").val(this._image.getStroke().getWidth()),a.symbolTypeContent.find("#strokeWidth").change(function(){a._image.getStroke().setWidth(1*$(this).val()),a._image.setRadius(a._image.getRadius()),a.drawSample()}),a.symbolTypeContent.find("#opacity").val(100*this._image.getOpacity()),a.symbolTypeContent.find("#opacity").attr("title",100*this._image.getOpacity()),a.symbolTypeContent.find("#opacity").change(function(e){a._image.setOpacity($(this).val()/100),a._image.setRadius(a._image.getRadius()),a.drawSample()})},StyleImageTab.prototype.populateFontSymbolPanel=function(){var a=this;a.symbolTypeContent.html("");a.symbolTypeContent.html('<div class="form-group">    <label>Symbol</label>    <div class="input-group" data-toggle="popover" data-placement="top" data-content="Type symbol name" >        <input type="text" name="glyph" id="glyph" value="" placeholder="Symbol"  class="form-control" data-val="true" data-val-required="Symbol is required"  />        <span class="input-group-addon" id="glyphAddon" ></span>    </div>    <span class="field-validation-valid" data-valmsg-for="glyph" data-valmsg-replace="true"></span> </div>  <div class="form-group">    <label class="" for="radius">Size</label>    <input type="range" min="0" max="30" value="" name="radius" id="radius"  />  </div>  <div class="form-group">    <label class="" for="color">Color</label>    <div id="colorPicker" class="input-group colorpicker-component">      <input type="text" value="" id="color" class="form-control" />      <span class="input-group-addon"><i></i></span>    </div>  </div>  <div class="form-group">    <label class="" for="strokeColor">Border color</label>    <div id="strokeColorPicker" class="input-group colorpicker-component">      <input type="text" value="" id="strokeColor" class="form-control" />      <span class="input-group-addon"><i></i></span>    </div>  </div>  <div class="form-group">    <label class="" for="strokeWidth">Border width</label>    <input type="number" name="strokeWidth" id="strokeWidth" value="" placeholder="Border width" class="form-control" data-val="true" data-val-required="Border width is required" data-val-range="Input a number  from 0 to 20" min="0" max="20" data-val-range-min="0" data-val-range-max="20" />    <span class="field-validation-valid" data-valmsg-for="strokeWidth" data-valmsg-replace="true"></span>  </div><div class="form-group">  <label class="col-sm-3_" for="symbolFrame">Frame:</label>   <select class="form-control " id="symbolFrame" >    <option value="none" selected="selected">None</option>    <option value="circle">Circle</option>    <option value="poi">POI</option>    <option value="bubble">Bubble</option>    <option value="marker">Marker</option>    <option value="coma">Coma</option>    <option value="shield">Shield</option>    <option value="blazon">Blazon</option>    <option value="bookmark">Bookmark</option>    <option value="hexagon">Hexagon</option>    <option value="diamond">Diamond</option>    <option value="triangle">Triangle</option>    <option value="sign">Sign</option>    <option value="ban">Ban</option>    <option value="lozenge">Lozenge</option>    <option value="square">Square</option>    </select> </div>  <div class="form-group">    <label class="" for="fillColor">Frame fill color</label>    <div id="fillColorPicker" class="input-group colorpicker-component">      <input type="text" value="" id="fillColor" class="form-control" />      <span class="input-group-addon"><i></i></span>    </div>  </div>  <div class="form-group">    <label class="" for="fontScale">Font scale</label>    <input type="range" min="0" max="200" value="" name="fontScale" id="fontScale"  />  </div>  <div class="form-group">    <label class="" for="opacity">Opacity</label>    <input type="range" min="0" max="100" value="" name="opacity" id="opacity"  />  </div>  <div class="form-group">    <label class="" for="rotation">Rotation</label>    <input type="range" min="0" max="360" value="" name="rotation" id="rotation"  />  </div>  <div class="form-group">    <label class="" for="offsetX">Offset X</label>    <input type="range" name="offsetX" id="offsetX" value="" placeholder="Offset X" class="form-control" min="-20" max="20"  />  </div>  <div class="form-group">    <label class="" for="offsetY">Offset Y</label>    <input type="range" name="offsetY" id="offsetY" value="" placeholder="Offset Y" class="form-control" min="-20" max="20"  />  </div>'),a.symbolTypeContent.find("input[type=range]").on("input",function(){$(this).trigger("change"),$(this).attr("title",$(this).val())}),a.drawSample(),a.create_glyph_AutoSearch(),a.symbolTypeContent.find('[data-toggle="popover"]').popover(),a.symbolTypeContent.find("#glyph").val(),a.symbolTypeContent.find("#glyph").val(this._image.getGlyphName()),a.symbolTypeContent.find("#glyph").change(function(){a._image.glyph_=a._image.getGlyph($(this).val()),a._image.renderMarker_(),a.drawSample(),a.symbolTypeContent.find("#glyphAddon").html('<i style="font-size:1.5em;min-width:2em;" class="fa '+$(this).val()+'" ></i>')}),a.symbolTypeContent.find("#glyphAddon").html('<i style="font-size:1.5em;min-width:2em;" class="fa '+a.symbolTypeContent.find("#glyph").val()+'" ></i>'),a.symbolTypeContent.find("#glyphAddon").click(function(){a.symbolTypeContent.find("#glyph").autocomplete("search")}),a.symbolTypeContent.find("#symbolFrame").val(a._image.form_),a.symbolTypeContent.find("#symbolFrame").change(function(){a._image.form_=$(this).val(),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#radius").val(this._image.getRadius()),a.symbolTypeContent.find("#radius").attr("title",this._image.getRadius()),a.symbolTypeContent.find("#radius").change(function(){var e=StyleFactory.getFontSymbol(a._image);e.radius=1*$(this).val(),a._origFontSymbol=a._image=StyleFactory.fontSymbol(e),a.drawSample()}),a.symbolTypeContent.find("#fontScale").val(100*this._image.fontSize_),a.symbolTypeContent.find("#fontScale").attr("title",100*this._image.fontSize_),a.symbolTypeContent.find("#fontScale").change(function(){a._image.fontSize_=$(this).val()/100,a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#colorPicker").colorpicker({color:this._image.color_}).on("changeColor",function(e){var t=e.color.toString();a._image.color_=t,a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#fillColorPicker").colorpicker({color:this._image.getFill().getColor()}).on("changeColor",function(e){var t=e.color.toString();a._image.getFill().setColor(t),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#strokeColorPicker").colorpicker({color:this._image.getStroke().getColor()}).on("changeColor",function(e){var t=e.color.toString();a._image.getStroke().setColor(t),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#strokeWidth").on("input",function(){$(this).trigger("change")}),a.symbolTypeContent.find("#strokeWidth").val(this._image.getStroke().getWidth()),a.symbolTypeContent.find("#strokeWidth").change(function(){a._image.getStroke().setWidth(1*$(this).val()),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#opacity").val(100*this._image.getOpacity()),a.symbolTypeContent.find("#opacity").attr("title",100*this._image.getOpacity()),a.symbolTypeContent.find("#opacity").change(function(e){a._image.setOpacity($(this).val()/100),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#rotation").val(180*this._image.getRotation()/Math.PI),a.symbolTypeContent.find("#rotation").attr("title",180*this._image.getRotation()/Math.PI),a.symbolTypeContent.find("#rotation").change(function(e){a._image.setRotation($(this).val()*Math.PI/180),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#offsetX").val(this._image.offset_[0]),a.symbolTypeContent.find("#offsetX").change(function(){a._image.offset_[0]=1*$(this).val(),a._image.renderMarker_(),a.drawSample()}),a.symbolTypeContent.find("#offsetY").val(this._image.offset_[1]),a.symbolTypeContent.find("#offsetY").change(function(){a._image.offset_[1]=1*$(this).val(),a._image.renderMarker_(),a.drawSample()})},StyleImageTab.prototype.create_glyph_AutoSearch=function(){var o=[],e=ol.style.FontSymbol.prototype.defs.glyphs;for(var t in e)o.push({name:e[t].name,search:e[t].search,key:t});this.symbolTypeContent.find("#glyph").autocomplete({minLength:0,appendTo:this.symbolTypeContent,source:function(t,e){t.term;var a=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i");$(this).text();if(o){var i=o;e($.map(i,function(e){if(e.name&&(!t.term||a.test(e.name)||a.test(e.key)||a.test(e.search)))return{label:e.key,value:e.key,data:e}}))}else;},select:function(e,t){return $(this).val(t.item.label),$(this).trigger("change"),!1},focus:function(e,t){return!1},open:function(){$("ul.ui-menu").width($(this).innerWidth())}}).focus(function(e,t){$(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(e,t){var a=t.data.name,i=t.data.search||"",o=(this.term,'<div class="autocomplete-custom-item ">');return o+='<i style="font-size:1.5em;" class="  fa '+t.data.key+'" title="'+t.value+'"></i>',o+=a+(t.data.description?'<pre class="nostyle" style="display:inline;"><br/><small style="">'+i+"</small></pre>":""),o+="</div>",$("<li></li>").append(o).appendTo(e)}},StyleFillTab.prototype.init=function(e){this.parentDialog=e},StyleFillTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},StyleFillTab.prototype.applied=function(e){return!0},StyleFillTab.prototype.onStrokeChanged=function(e){this.org_style&&this.org_style.setStroke(e),this._drawSample&&this._drawSample()},StyleFillTab.prototype.create=function(e,t){var n=this,a="";t&&(a="active"),this.style=e,this.org_style=this.style.clone(),this.orig_fill=this.style.getFill(),this.orig_fill&&(this._fill=this.orig_fill.clone()),this._fill||(this._fill=StyleFactory.randomStyle().getFill());var r=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-fill"></i> '+n.caption+"</a> </li>").appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var i="<div>";i+='    <div id="style_sampleContainer" class="panel-body">',i+="    </div>",i+='<form id="'+n.tabId+'_form" class="modal-body form-horizontal">',i+='  <div class="form-group">',i+='    <label class="" for="fillColor">Fill color</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#style_polygon">?</a>',i+='    <div id="fillColorPicker" class="input-group colorpicker-component">',i+='      <input type="text" value="" id="fillColor" class="form-control" />',i+='      <span class="input-group-addon"><i></i></span>',i+="    </div>",i+="  </div>",i+="",i+="",i+="",i+="",i+="</form></div>";var o=$(i).appendTo(this.tab),s=function(){n.org_style.setFill(n._fill);var e=StyleFactory.renderStyleSample(n.org_style,{width:80,height:40,type:"Polygon"});o.find("#style_sampleContainer").html(e)};s(),n._drawSample=s,o.find("#fillColorPicker").colorpicker({color:this._fill.getColor()}).on("changeColor",function(e){var t=e.color.toString();n._fill.setColor(t),s()});var l=$(o.find("#"+n.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(l),$.validator.setDefaults({ignore:t}),l.validate(),l.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=l.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){}),this.parentDialog.applyHandlers.push(function(e){n.style.setFill(n._fill)})},StyleStrokeTab.prototype.init=function(e){this.parentDialog=e},StyleStrokeTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},StyleStrokeTab.prototype.applied=function(e){return!0},StyleStrokeTab.prototype.create=function(e,t){var n=this,a="";t&&(a="active"),this.style=e,this.org_style=this.style.clone(),this.orig_stroke=this.style.getStroke(),this.orig_stroke&&(this._stroke=this.orig_stroke.clone()),this._stroke||(this._stroke=StyleFactory.randomStyle().getStroke());var r=$('<li class="'+a+'"><a href="#'+n.tabId+'" data-toggle="tab"><i class="fa fa-highlighter"></i> '+n.caption+"</a> </li>").appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+a+'" id="'+n.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var i="<div>";i+='    <div id="style_sampleContainer" class="panel-body">',i+="    </div>",i+='<form id="'+n.tabId+'_form" class="modal-body form-horizontal">',i+='  <div class="form-group">',i+='    <label class="" for="strokeColor">Color</label>',i+='<a title="Help" class="close" style=" float: right; margin-right: .5em;" target="_blank" href="/help#style_line">?</a>',i+='    <div id="strokeColorPicker" class="input-group colorpicker-component">',i+='      <input type="text" value="" id="strokeColor" class="form-control" />',i+='      <span class="input-group-addon"><i></i></span>',i+="    </div>",i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="width">Width</label>',i+='    <input type="range" min="0" max="10" value="" name="width" id="width"  />',i+="  </div>",i+='  <div class="form-group">',i+='    <label class="col-sm-3_" for="lineCap">Line cap:</label>',i+='    <select class="form-control " id="lineCap" >',i+='      <option value="round">Rounded end</option>',i+='      <option value="butt">Flat end</option>',i+='      <option value="square">Square end</option>',i+="    </select>",i+="  </div>",i+='  <div class="form-group">',i+='    <label class="col-sm-3_" for="lineJoin">Line join:</label>',i+='    <select class="form-control " id="lineJoin" >',i+='      <option value="round">Rounded corner</option>',i+='      <option value="bevel">Beveled corner</option>',i+='      <option value="miter">Sharp corner (Miter)</option>',i+="    </select>",i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="lineDash">Line dash</label>',i+='    <input type="text" name="lineDash" id="lineDash" value="" placeholder="Line dash pattern" class="form-control" />',i+="  </div>",i+='  <div class="form-group">',i+='    <label class="" for="lineDashOffset">Line dash offset</label>',i+='    <input type="range" min="0" max="20" value="" name="lineDashOffset" id="lineDashOffset"  />',i+="  </div>",i+="",i+="",i+="",i+="",i+="</form></div>";var o=$(i).appendTo(this.tab);o.find("input[type=range]").on("input",function(){$(this).trigger("change"),$(this).attr("title",$(this).val())});var s=function(){n.org_style.setStroke(n._stroke);var e=StyleFactory.renderStyleSample(n.org_style,{width:80,height:40,type:"Line"});if(o.find("#style_sampleContainer").html(e),n.parentDialog)for(var t=0;t<n.parentDialog.propertyTabs.length;t++){var a=n.parentDialog.propertyTabs[t];"StyleFillTab"==a.tabId&&a.onStrokeChanged(n._stroke)}};s(),o.find("#strokeColorPicker").colorpicker({color:this._stroke.getColor()}).on("changeColor",function(e){var t=e.color.toString();n._stroke.setColor(t),s()}),o.find("#width").val(this._stroke.getWidth()),o.find("#width").attr("title",this._stroke.getWidth()),o.find("#width").change(function(e){n._stroke.setWidth(1*$(this).val()),s()}),o.find("#miterLimit").val(this._stroke.getMiterLimit()),o.find("#miterLimit").change(function(e){n._stroke.setMiterLimit(1*$(this).val()),s()}),o.find("#lineDashOffset").val(this._stroke.getLineDashOffset()),o.find("#lineDashOffset").change(function(e){n._stroke.setLineDashOffset(1*$(this).val()),s()}),o.find("#lineCap").val(this._stroke.getLineCap()),o.find("#lineCap").change(function(e){n._stroke.setLineCap($(this).val()),s()}),o.find("#lineJoin").val(this._stroke.getLineJoin()),o.find("#lineJoin").change(function(e){n._stroke.setLineJoin($(this).val()),s()});var l=this._stroke.getLineDash();l=l&&l.length?l.join(","):void 0,o.find("#lineDash").on("input",function(){$(this).trigger("change")}),o.find("#lineDash").val(l),o.find("#lineDash").change(function(e){var t=$(this).val();if(t){t=t.split(",");for(var a=0;a<t.length;a++)try{t[a]=parseInt(t[a])}catch(e){}}n._stroke.setLineDash(t),s()});var c=$(o.find("#"+n.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:""}),$.validator.unobtrusive.parse(c),$.validator.setDefaults({ignore:t}),c.validate(),c.valid())r.find("a").removeClass("text-danger");else{e.cancel=!0,r.find("a").addClass("text-danger"),n.activate();var a=c.find(".input-validation-error").first();if(a){var i=a.offset().top,o=r.offset().top;n.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){}),this.parentDialog.applyHandlers.push(function(e){n.style.setStroke(n._stroke)})},RasterDisplayTab.prototype.init=function(e){this.parentDialog=e},RasterDisplayTab.prototype.activate=function(){$('.nav-tabs a[href="#'+this.tabId+'"]').tab("show")},RasterDisplayTab.prototype.applied=function(e){if(e&&e.get("custom")&&"ol.source.GeoImage"==e.get("custom").source){var t=e.get("custom");if(t.dataObj&&1<=t.dataObj.details.numberOfBands)return!0}return!1},RasterDisplayTab.prototype.create=function(e,t){var y=this;this.layer=e;this.parentDialog.mapContainer;var a=e.get("custom"),i=a.dataObj.details.numberOfBands,o="";t&&(o="active");var n=$('<li class="'+o+'"><a href="#'+y.tabId+'" data-toggle="tab"><i class="fa fa-paint-brush"></i> Display</a> </li>').appendTo(this.parentDialog.tabPanelNav);this.tab=$('<div class="tab-pane '+o+'" id="'+y.tabId+'"></div>').appendTo(this.parentDialog.tabPanelContent);var r='<div><form id="'+y.tabId+'_form" class="modal-body form-horizontal">';if(r+="",r+="",r+="",r+="",a.dataObj&&"ol.source.GeoImage"==a.source){"GeoImage";var v=LayerHelper.getDetails(y.layer);v.display&&(y.display=JSON.parse(JSON.stringify(v.display))),y.display||(y.display={displayType:"colorMap",band:1,colorMap:"grayscale",reclass:!1});var b=y.display,s=b.band||1;r+='<div class="form-group">',r+='<div class="form-group">',r+='  <label class="col-sm-offset-1_ col-sm-12 checkbox">',r+='<a title="Help" class="close" style=" " target="_blank" href="/help#layerProperties_rasterDisplay">?</a>',r+='   <input type="checkbox" id="displayInLegend" name="displayInLegend" '+(LayerHelper.getDisplayInLegend(this.layer)?'checked="checked"':"")+' value="" /> Display in legend',r+="</label>",r+="</div>",r+='  <label class="col-sm-3" style="" for="displayType">Display type:</label>',r+='    <div class="col-sm-6"><select class=" form-control " id="displayType"  >',1<i&&(r+='                          <option value="RGB" '+("RGB"==b.displayType?'selected="selected"':"")+" >RGB</option>"),r+='                          <option value="colorMap" '+("colorMap"==b.displayType?'selected="selected"':"")+">Color Map</option>",r+="    </select></div>",r+="  </div>",r+='<div id="rgb_settings" class="form-group">',r+='<div class="form-group">',r+='  <label class="col-sm-offset-1 col-sm-3" style="" for="redBand">Red:</label>',r+='    <div class="col-sm-5"><select class="rgb-band form-control " data-band="RBand" id="redBand"  >';for(var l=0;l<v.bands.length;l++){r+=' <option value="'+(d=(c=v.bands[l]).id)+'" '+(b.RBand==d?'selected="selected"':"")+" >"+c.name+"</option>"}r+="    </select></div>",r+="  </div>",r+='<div class="form-group">',r+='  <label class="col-sm-offset-1 col-sm-3" style=" " for="greenBand">Green:</label>',r+='    <div class="col-sm-5"><select class="rgb-band form-control "  data-band="GBand" id="greenBand"  >';for(l=0;l<v.bands.length;l++){r+=' <option value="'+(d=(c=v.bands[l]).id)+'" '+(b.GBand==d?'selected="selected"':"")+" >"+c.name+"</option>"}r+="    </select></div>",r+="  </div>",r+='<div class="form-group">',r+='  <label class="col-sm-offset-1 col-sm-3" style=" " for="blueBand">Blue:</label>',r+='    <div class="col-sm-5"><select class="rgb-band form-control "  data-band="BBand" id="blueBand"  >';for(l=0;l<v.bands.length;l++){r+=' <option value="'+(d=(c=v.bands[l]).id)+'" '+(b.BBand==d?'selected="selected"':"")+" >"+c.name+"</option>"}r+="    </select></div>",r+="  </div>",r+='<div class="form-group">',r+='  <label class="col-sm-offset-1 col-sm-3" style=" " for="alphaBand">Alpha:</label>',r+='    <div class="col-sm-5"><select class="rgb-band form-control "  data-band="ABand" id="alphaBand"  >',r+=' <option value="" '+(b.ABand?"":'selected="selected"')+" >None</option>";for(l=0;l<v.bands.length;l++){var c,d;r+=' <option value="'+(d=(c=v.bands[l]).id)+'" '+(b.ABand==d?'selected="selected"':"")+" >"+c.name+"</option>"}r+="    </select></div>",r+="  </div>",r+="</div>",r+='<div id="colormap_settings" class="form-group">',r+="</div>"}r+="</form></div>";var _=function(e){var s,t=(l=v.bands[e-1]).minimum,a=l.maximum;v.vatInfo&&v.vatInfo.rows&&(s=v.vatInfo),l.vatInfo&&(s=l.vatInfo);var i=t,o=a;delete b.minimum,delete b.maximum,void 0!==b.minimum?i=b.minimum:b.minimum=i,void 0!==b.maximum?o=b.maximum:b.maximum=o;var n="";n+='<div class="form-group">',n+='  <label class="col-sm-offset-1 col-sm-3" style="" for="colorMapBand">Band:</label>',n+='    <div class="col-sm-5"><select class="form-control " id="colorMapBand"  >';for(var r=0;r<v.bands.length;r++){var l,c=(l=v.bands[r]).id;n+=' <option value="'+c+'" '+(b.band==c?'selected="selected"':"")+" >"+l.name+"</option>"}n+="    </select></div>",n+="  </div>",n+='<div class="form-group">',n+='  <label class="col-sm-offset-1 col-sm-3" style=" " for="colorMapType">Color map:</label>',n+='    <div class="col-sm-5"><select class="form-control " id="colorMapType"  >',n+='                          <option value="grayscale" '+("grayscale"==b.colorMap?'selected="selected"':"")+" >Grayscale</option>",n+='                          <option value="pseudocolor" '+("pseudocolor"==b.colorMap?'selected="selected"':"")+">Pseudocolor</option>",n+='                          <option value="fire" '+("fire"==b.colorMap?'selected="selected"':"")+">Fire</option>",n+='                          <option value="bluered" '+("bluered"==b.colorMap?'selected="selected"':"")+">Bluered</option>",n+='                          <option value="custom" '+("custom"==b.colorMap?'selected="selected"':"")+">Custom</option>",n+="    </select></div>",n+="  </div>",n+='<div id="customColorMap" class="form-group">',n+=' <table id="tblColors" class=" table order-list col-sm-12">',n+="  <thead>",n+="  <tr><td>Value</td><td>Color</td><td>Caption</td></tr>",n+="  </thead>",n+="  <tbody>";var d=b.customColorMap||[],p=0;if(0==d.length){n+="  <tr>";var u=StyleFactory.randomColor(null,1),h="";h+='<td><input type="text" class="form-control range-rasterValue nospinner" value=""  name="rasterValue'+p+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rasterValue'+p+'" data-valmsg-replace="true"></span></td>',h+="<td>",h+='    <div id="fillColorPicker'+p+'" class="input-group colorpicker-component">',h+='      <input type="text" value="'+u+'" id="fillColor'+p+'" class="colorpicker-item form-control" />',h+='      <span class="input-group-addon"><i class="raster-color" ></i></span>',h+="    </div>",h+="</td>",n+=h+='<td><input type="text" class="form-control range-rasterCaption nospinner" value=""  name="rasterCaption'+p+'" ></td>',n+="  </tr>",p++}else for(var f=0;f<d.length;f++){var m=d[f],g="rgba("+m.r+","+m.g+","+m.b+","+(m.a/255).toFixed(2)+")";n+="  <tr>";h="";h+='<td><input type="text" class="form-control range-rasterValue nospinner" value="'+m.value+'"  name="rasterValue'+p+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rasterValue'+p+'" data-valmsg-replace="true"></span></td>',h+="<td>",h+='    <div id="fillColorPicker'+p+'" class="input-group colorpicker-component">',h+='      <input type="text" value="'+g+'" id="fillColor'+p+'" class=" colorpicker-item form-control" />',h+='      <span class="input-group-addon"><i class="raster-color" ></i></span>',h+="    </div>",h+="</td>",h+='<td><input type="text" class="form-control range-rasterCaption nospinner" value="'+(m.caption||"")+'"  name="rasterCaption'+p+'" ></td>',n+=h+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',n+="  </tr>",p++}n+="  </tbody>",n+="  <tfoot>",n+="         <tr>",n+='   <td colspan="" style="text-align: left;"><input type="button" class="btn btn-info btn-xs_ btn-block_ " id="addRange" value="Add range"></td>',s&&(n+='   <td colspan="" style="text-align: left;"><input type="button" class="btn btn-info btn-xs_ btn-block_ " id="addAllRange" value="Add all values"></td>'),n+='   <td colspan="" style="text-align: left;"><input type="button" class="btn btn-danger btn-xs_ btn-block_ " id="deleteAllRanges" value="Delete all"></td>',n+="  </tr>",n+="  </tfoot>",n+="  </table>",n+="</div>",n+='  <div class="form-group">',n+='    <label class="col-sm-offset-1 col-sm-3" style="" for="minimum">Minimum:</label>',n+='    <div class="col-sm-3"><input class="form-control" type="number" min="'+t+'" max="'+a+'" value="'+i+'" name="minimum" style="direction:ltr; " id="minimum"  /></div>',n+="  </div>",n+='  <div class="form-group">',n+='    <label class="col-sm-offset-1 col-sm-3" style="" for="minimum">Maximum:</label>',n+='    <div class="col-sm-3"><input class="form-control" type="number" min="'+t+'" max="'+a+'" value="'+o+'" name="maximum" style="direction:ltr; " id="maximum"  /></div>',n+="  </div>",n=DOMPurify.sanitize(n,{SAFE_FOR_JQUERY:!0}),w.find("#colormap_settings").html(n),w.find("#colorMapBand").unbind("change").change(function(){y.display.band=$(this).val(),_(y.display.band)}),w.find("#colorMapType").unbind("change").change(function(){y.display.colorMap=$(this).val(),"custom"===y.display.colorMap?w.find("#customColorMap").show():w.find("#customColorMap").hide()}),"custom"===y.display.colorMap?w.find("#customColorMap").show():w.find("#customColorMap").hide(),w.find("#minimum").unbind("change").change(function(){y.display.minimum=$(this).val(),void 0!==y.display.maximum&&y.display.minimum>y.display.maximum&&w.find("#maximum").val(y.display.minimum)}),w.find("#maximum").unbind("change").change(function(){y.display.maximum=$(this).val(),void 0!==y.display.minimum&&y.display.maximum<y.display.minimum&&w.find("#minimum").val(y.display.maximum)}),w.find(),w.find("#addRange").unbind("click").on("click",function(){var e=$("<tr>"),t=StyleFactory.randomColor(null,1),a="";a+='<td><input type="text" class="form-control range-rasterValue nospinner" value=""  name="rasterValue'+p+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rasterValue'+p+'" data-valmsg-replace="true"></span></td>',a+="<td>",a+='    <div id="fillColorPicker'+p+'" class="input-group colorpicker-component">',a+='      <input type="text" value="'+t+'" id="fillColor'+p+'" class="colorpicker-item form-control" />',a+='      <span class="input-group-addon"><i class="raster-color" ></i></span>',a+="    </div>",a+="</td>",a+='<td><input type="text" class="form-control range-rasterCaption nospinner" value=""  name="rasterCaption'+p+'" ></td>',a+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',e.append(a),w.find("#tblColors").append(e),w.find("#tblColors .colorpicker-component").colorpicker(),p++}),w.find("#addAllRange").unbind("click").on("click",function(){if(s){var e="count";s.fields&&3<=s.fields.length&&(e=s.fields[2].name),w.find("#tblColors").find("tbody tr").remove();for(var t=p=0;t<s.rows.length;t++){var a=s.rows[t].value,i=s.rows[t][e];void 0===i&&(i=a);var o=$("<tr>"),n=StyleFactory.randomColor(null,1),r="";r+='<td><input type="text" class="form-control range-rasterValue nospinner" value="'+a+'"  name="rasterValue'+p+'"  data-val="true" data-val-required="Value is required"/><span class="field-validation-valid" data-valmsg-for="rasterValue'+p+'" data-valmsg-replace="true"></span></td>',r+="<td>",r+='    <div id="fillColorPicker'+p+'" class="input-group colorpicker-component">',r+='      <input type="text" value="'+n+'" id="fillColor'+p+'" class="colorpicker-item form-control" />',r+='      <span class="input-group-addon"><i class="raster-color" ></i></span>',r+="    </div>",r+="</td>",r+='<td><input type="text" class="form-control range-rasterCaption nospinner" value="'+i+'"  name="rasterCaption'+p+'" ></td>',r+=' <td><button type="button" class="ibtnDel btn btn-xs btn-danger\t"  title="Delete"  style="" ><span class="glyphicon glyphicon-remove"></span> </button></td>',o.append(r),w.find("#tblColors").append(o),w.find("#tblColors .colorpicker-component").colorpicker(),p++}}}),w.find("#deleteAllRanges").unbind("click").on("click",function(e){w.find("#tblColors").find("tbody tr").remove(),p=0}),w.find("#tblColors").unbind("click").on("click",".ibtnDel",function(e){$(this).closest("tr").remove(),p-=1}),w.find("#tblColors .colorpicker-component").colorpicker()},w=$(r).appendTo(this.tab);_(s),w.find("#displayType").change(function(){y.display.displayType=$(this).val(),"RGB"===y.display.displayType?(y.display.displayType.reclass=!0,w.find("#rgb_settings").show(),w.find("#colormap_settings").hide()):(w.find("#rgb_settings").hide(),w.find("#colormap_settings").show())}),w.find("#displayType").trigger("change"),w.find(".rgb-band").change(function(){var e=$(this).val(),t=$(this).data("band");y.display[t]=e});var p=$(w.find("#"+y.tabId+"_form"));this.parentDialog.beforeApplyHandlers.push(function(e){var t=$.validator.defaults.ignore;if($.validator.setDefaults({ignore:":hidden"}),$.validator.unobtrusive.parse(p),$.validator.setDefaults({ignore:t}),p.validate(),p.valid())n.find("a").removeClass("text-danger");else{e.cancel=!0,n.find("a").addClass("text-danger"),y.activate();var a=p.find(".input-validation-error").first();if(a){var i=a.offset().top,o=n.offset().top;y.tab.animate({scrollTop:i-o-60},1e3)}}}),this.parentDialog.cancelHandlers.push(function(e){}),this.parentDialog.applyHandlers.push(function(e){var o=[];w.find("#tblColors > tbody  > tr").each(function(){var e=$(this).find(".range-rasterValue").val(),t=$(this).find(".range-rasterCaption").val(),a=$(this).find(".colorpicker-component").data("colorpicker").color;if(a){var i=a.toRGB();o.push({caption:t,value:e,r:i.r,g:i.g,b:i.b,a:255*i.a})}else o.push({caption:t,value:e,r:0,g:0,b:0,a:0})}),o.sort(function(e,t){var a=e.value+"",i=t.value+"";try{return isNaN(a)||isNaN(i)?0<=i.indexOf("%")&&0<=a.indexOf("%")?(i=i.replace("%",""),a=a.replace("%",""),parseFloat(i)-parseFloat(a)):a<i:parseFloat(i)-parseFloat(a)}catch(e){return 0}}),"custom"==y.display.colorMap&&(y.display.customColorMap=o),LayerHelper.setRasterDisplay(y.layer,y.display);var t=y.parentDialog.mapContainer.sourceFactory.createGeoImageSource(a.dataObj,y.parentDialog.mapContainer);y.layer.set("source",t),LayerHelper.setDisplayInLegend(y.layer,w.find("#displayInLegend").prop("checked"))})},ObjectPropertiesDlg.prototype.create=function(){this.activeTabIndex||(this.activeTabIndex=0);for(var e=0;e<this.propertyTabs.length;e++){var t=this.propertyTabs[e];t&&t.applied&&t.applied(this.obj)&&t.create&&t.create(this.obj,this.activeTabIndex===e)}this.changesApplied=!1},ObjectPropertiesDlg.prototype.apply=function(){for(var e=0;e<this.beforeApplyHandlers.length;e++){var t={cancel:!1};if((0,this.beforeApplyHandlers[e])(t),t.cancel)return!1}for(e=0;e<this.applyHandlers.length;e++){t={cancel:!1};if((0,this.applyHandlers[e])(t),t.cancel)return!1}return!0},ObjectPropertiesDlg.prototype.cancelSettings=function(){for(var e=0;e<this.cancelHandlers.length;e++){(0,this.cancelHandlers[e])()}return!0},ObjectPropertiesDlg.prototype.show=function(){return this.create(),this.dlg.open(),this};