/*! imsep 2021-01-09 */

$(function(){pageTask.init();var a=$("#keywordArray").val(),t=[];a&&(t=a.split(";")),$("#subject").select2({data:t,dir:app.layout,tags:!0,tokenSeparators:[";","؛"]}),$("#theme").select2({dir:app.layout,tags:!1,tokenSeparators:[";","؛"]})});var pageTask={init:function(){var a=this;this.fillUI();var t=$("#language").data("initvalue");t||(t="English"),$("#language").val(t),$("#cmdSave").click(function(){a.submit()})},fillUI:function(){},submit:function(){$.validator.unobtrusive.parse(document);var a=$("#mainForm");a.validate();if(a.valid())waitingDialog.show("Saving",{progressType:""}),$.ajax({type:a.attr("method"),url:a.attr("action"),data:a.serialize(),success:function(a){a.id;waitingDialog.hide();location.protocol,location.host,location.pathname;var t="/datalayer/"+a.id+"/editmetadata";if(t!=location.pathname){var e=location.protocol+"//"+location.host+t;window.history.replaceState({},document.title,e)}a.status?($.notify({message:"Metadata saved"},{type:"success",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}}),a.datasetType?window.location.href=location.protocol+"//"+location.host+"/datalayer/"+a.id+"?dataType="+a.datasetType:window.location.href=location.protocol+"//"+location.host+"/datalayers"):$.notify({message:a.errors||a.error||a.message||"Failed to save metadata"},{type:"danger",delay:1e4,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},error:function(a,t,e){waitingDialog.hide(),console.log("An error occurred."),$.notify({message:"Error in saving metadata"},{type:"danger",delay:2e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}});else{var t=$(".input-validation-error").first();t&&$("html, body").animate({scrollTop:t.offset().top-20},1e3)}}};